{
  while (!this.isCanceled) {
    TransferEnvelope te=null;
    try {
      te=this.queuedEnvelopes.take();
      try {
        if (writeTransferEnvelope(te)) {
          break;
        }
      }
 catch (      IOException ioe) {
        ioe.printStackTrace();
      }
    }
 catch (    InterruptedException e) {
      if (this.isCanceled) {
        break;
      }
    }
  }
  while (!this.queuedEnvelopes.isEmpty()) {
    final TransferEnvelope te=this.queuedEnvelopes.poll();
    final Buffer buffer=te.getBuffer();
    if (buffer != null) {
      buffer.recycleBuffer();
    }
  }
  this.hasDataLeft=false;
}
