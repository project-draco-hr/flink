{
  while (!this.isCanceled) {
    TransferEnvelope te=null;
    try {
      te=this.queuedEnvelopes.take();
      if (!writeToCheckpointAndRecycle(te)) {
        break;
      }
    }
 catch (    InterruptedException e) {
      if (this.isCanceled) {
        break;
      }
    }
  }
  if (this.firstSerializedFileBuffer != null) {
    this.firstSerializedFileBuffer.recycleBuffer();
    this.firstSerializedFileBuffer=null;
  }
  while (!this.queuedEnvelopes.isEmpty()) {
    final TransferEnvelope te=this.queuedEnvelopes.poll();
    final Buffer buffer=te.getBuffer();
    if (buffer != null) {
      buffer.recycleBuffer();
    }
  }
  this.hasDataLeft=false;
}
