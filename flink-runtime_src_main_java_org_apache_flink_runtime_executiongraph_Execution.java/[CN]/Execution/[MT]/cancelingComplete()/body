{
  while (true) {
    ExecutionState current=this.state;
    if (current == CANCELED) {
      return;
    }
 else     if (current == CANCELING || current == RUNNING) {
      if (transitionState(current,CANCELED)) {
        try {
          vertex.executionCanceled();
        }
  finally {
          vertex.getExecutionGraph().deregisterExecution(this);
          assignedResource.releaseSlot();
        }
        return;
      }
    }
 else {
      if (current != FAILED) {
        String message=String.format("Asynchronous race: Found state %s after successful cancel call.",state);
        LOG.error(message);
        vertex.getExecutionGraph().fail(new Exception(message));
      }
      return;
    }
  }
}
