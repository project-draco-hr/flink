{
  super.close();
synchronized (commitedOffsets) {
    LOG.info("Setting final offset from " + Arrays.toString(commitedOffsets));
    if (finalOffset == null) {
      finalOffset=new long[commitedOffsets.length];
    }
    for (int i=0; i < commitedOffsets.length; i++) {
      if (commitedOffsets[i] > 0) {
        if (finalOffset[i] > 0) {
          throw new RuntimeException("This is unexpected on i = " + i);
        }
        finalOffset[i]=commitedOffsets[i];
      }
    }
  }
}
