{
  try {
    final String forwardClassName=ForwardTask.class.getSimpleName();
    final File inputFile=TestUtils.createInputFile(limit);
    final File outputFile=new File(TestUtils.getTempDir() + File.separator + TestUtils.getRandomFilename());
    final File jarFile=TestUtils.createJarFile(forwardClassName);
    final JobGraph jg=new JobGraph("Job Graph 1");
    final JobFileInputVertex i1=new JobFileInputVertex("Input 1",jg);
    i1.setFileInputClass(FileLineReader.class);
    i1.setFilePath(new Path("file://" + inputFile.getAbsolutePath().toString()));
    final JobTaskVertex t1=new JobTaskVertex("Task 1",jg);
    t1.setTaskClass(ForwardTask.class);
    final JobTaskVertex t2=new JobTaskVertex("Task 2",jg);
    t2.setTaskClass(ForwardTask.class);
    JobFileOutputVertex o1=new JobFileOutputVertex("Output 1",jg);
    o1.setFileOutputClass(FileLineWriter.class);
    o1.setFilePath(new Path("file://" + outputFile.getAbsolutePath().toString()));
    t1.setVertexToShareInstancesWith(i1);
    t2.setVertexToShareInstancesWith(i1);
    o1.setVertexToShareInstancesWith(i1);
    try {
      i1.connectTo(t1,ChannelType.NETWORK,CompressionLevel.NO_COMPRESSION);
      t1.connectTo(t2,ChannelType.FILE,CompressionLevel.NO_COMPRESSION);
      t2.connectTo(o1,ChannelType.INMEMORY,CompressionLevel.NO_COMPRESSION);
    }
 catch (    JobGraphDefinitionException e) {
      e.printStackTrace();
    }
    jg.addJar(new Path("file://" + TestUtils.getTempDir() + File.separator+ forwardClassName+ ".jar"));
    JobClient jobClient=new JobClient(jg);
    if (!jobClient.submitJobAndWait()) {
      fail("Job execution failed");
    }
    final BufferedReader bufferedReader=new BufferedReader(new FileReader(outputFile));
    for (int i=0; i < limit; i++) {
      final String number=bufferedReader.readLine();
      try {
        assertEquals(i,Integer.parseInt(number));
      }
 catch (      NumberFormatException e) {
        fail(e.getMessage());
      }
    }
    bufferedReader.close();
    inputFile.delete();
    outputFile.delete();
    jarFile.delete();
  }
 catch (  IOException ioe) {
    ioe.printStackTrace();
    fail(ioe.getMessage());
  }
}
