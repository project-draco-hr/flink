{
  function=input.getExecutionEnvironment().clean(function);
  String callLocation=Utils.getCallLocationName();
  String udfName="Reduce at " + callLocation;
  SingleOutputStreamOperator<T,?> result=createFastTimeOperatorIfValid(function,input.getType(),udfName);
  if (result != null) {
    return result;
  }
  String opName="TriggerWindow(" + windowAssigner + ", "+ trigger+ ", "+ udfName+ ")";
  KeySelector<T,K> keySel=input.getKeySelector();
  OneInputStreamOperator<T,T> operator;
  boolean setProcessingTime=input.getExecutionEnvironment().getStreamTimeCharacteristic() == TimeCharacteristic.ProcessingTime;
  if (evictor != null) {
    operator=new EvictingWindowOperator<>(windowAssigner,windowAssigner.getWindowSerializer(getExecutionEnvironment().getConfig()),keySel,input.getKeyType().createSerializer(getExecutionEnvironment().getConfig()),new HeapWindowBuffer.Factory<T>(),new ReduceWindowFunction<K,W,T>(function),trigger,evictor).enableSetProcessingTime(setProcessingTime);
  }
 else {
    @SuppressWarnings("unchecked") ReduceFunction<T> functionCopy=(ReduceFunction<T>)SerializationUtils.clone(function);
    operator=new WindowOperator<>(windowAssigner,windowAssigner.getWindowSerializer(getExecutionEnvironment().getConfig()),keySel,input.getKeyType().createSerializer(getExecutionEnvironment().getConfig()),new PreAggregatingHeapWindowBuffer.Factory<>(functionCopy),new ReduceWindowFunction<K,W,T>(function),trigger).enableSetProcessingTime(setProcessingTime);
  }
  return input.transform(opName,input.getType(),operator);
}
