{
  super.close();
  LOG.info("Starting close " + Arrays.toString(commitedOffsets));
synchronized (sync) {
    if (finalOffset == null) {
      finalOffset=new long[commitedOffsets.length];
    }
    for (int i=0; i < commitedOffsets.length; i++) {
      if (commitedOffsets[i] > 0) {
        if (finalOffset[i] > 0) {
          throw new RuntimeException("This is unexpected on i = " + i);
        }
        finalOffset[i]=commitedOffsets[i];
      }
    }
  }
  LOG.info("Finished closing. Final " + Arrays.toString(finalOffset));
}
