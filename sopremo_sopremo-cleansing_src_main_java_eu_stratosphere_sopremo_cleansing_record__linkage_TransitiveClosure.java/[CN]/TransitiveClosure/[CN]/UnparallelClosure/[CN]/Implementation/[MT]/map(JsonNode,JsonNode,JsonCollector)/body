{
  BinarySparseMatrix matrix=new BinarySparseMatrix();
  for (  JsonNode pair : allPairs) {
    matrix.set(pair.get(0),pair.get(1));
    matrix.set(pair.get(1),pair.get(0));
  }
  warshall(matrix);
  if (emitClusters) {
    Set<JsonNode> remainingRows=new HashSet<JsonNode>(matrix.getRows());
    while (!remainingRows.isEmpty()) {
      ArrayNode cluster=new ArrayNode(null);
      JsonNode row=remainingRows.iterator().next();
      cluster.add(row);
      for (      JsonNode column : matrix.get(row))       cluster.add(column);
      remainingRows.remove(cluster);
    }
  }
 else {
    for (    JsonNode row : matrix.getRows())     for (    JsonNode column : matrix.get(row))     if (JsonNodeComparator.INSTANCE.compare(row,column) < 0)     out.collect(key,JsonUtil.asArray(row,column));
  }
}
