{
  final BinarySparseMatrix matrix=new BinarySparseMatrix();
  for (  final JsonNode pair : allPairs) {
    matrix.set(pair.get(0),pair.get(1));
    matrix.set(pair.get(1),pair.get(0));
  }
  warshall(matrix);
  if (this.emitClusters) {
    final Set<JsonNode> remainingRows=new HashSet<JsonNode>(matrix.getRows());
    while (!remainingRows.isEmpty()) {
      final ArrayNode cluster=new ArrayNode(null);
      final JsonNode row=remainingRows.iterator().next();
      cluster.add(row);
      for (      final JsonNode column : matrix.get(row))       cluster.add(column);
      remainingRows.remove(cluster);
    }
  }
 else   for (  final JsonNode row : matrix.getRows())   for (  final JsonNode column : matrix.get(row))   if (JsonNodeComparator.INSTANCE.compare(row,column) < 0)   out.collect(key,JsonUtil.asArray(row,column));
}
