{
  JsonStream input=this.getInput(0);
  JsonStream backLookup;
  if (this.idProjection == DEFAULT_PROJECTION) {
    final JsonStream entityExtractor=new RemoveDuplicateEntities(new FlattenPairs(input));
    final GlobalEnumeration globalEnumeration=new GlobalEnumeration(entityExtractor);
    globalEnumeration.setIdGeneration(GlobalEnumeration.LONG_COMBINATION);
    input=new SubstituteWithKeyValueList(input,globalEnumeration);
    backLookup=globalEnumeration;
  }
 else {
    backLookup=new Projection(this.idProjection,EvaluationExpression.SAME_VALUE,input);
    input=new Projection(new ArrayCreation(new PathExpression(new ArrayAccess(0),this.idProjection),new PathExpression(new ArrayAccess(1),this.idProjection)),input);
  }
  final Grouping groupAll=new Grouping(EvaluationExpression.SAME_VALUE,input);
  final UnparallelClosure pairs=new UnparallelClosure(this.emitClusters,groupAll);
  return SopremoModule.valueOf(this.getName(),new SubstituteWithKeyValueList(pairs,backLookup));
}
