{
  JsonStream input=getInput(0);
  JsonStream backLookup;
  if (idProjection == DEFAULT_PROJECTION) {
    JsonStream entityExtractor=new RemoveDuplicateEntities(new FlattenPairs(input));
    GlobalEnumeration globalEnumeration=new GlobalEnumeration(entityExtractor);
    globalEnumeration.setIdGeneration(GlobalEnumeration.LONG_COMBINATION);
    input=new SubstituteWithKeyValueList(input,globalEnumeration);
    backLookup=globalEnumeration;
  }
 else {
    backLookup=new Projection(idProjection,EvaluationExpression.SAME_VALUE,input);
    input=new Projection(new ArrayCreation(new PathExpression(new ArrayAccess(0),idProjection),new PathExpression(new ArrayAccess(1),idProjection)),input);
  }
  Grouping groupAll=new Grouping(EvaluationExpression.SAME_VALUE,input);
  UnparallelClosure pairs=new UnparallelClosure(emitClusters,groupAll);
  return SopremoModule.valueOf(getName(),new SubstituteWithKeyValueList(pairs,backLookup));
}
