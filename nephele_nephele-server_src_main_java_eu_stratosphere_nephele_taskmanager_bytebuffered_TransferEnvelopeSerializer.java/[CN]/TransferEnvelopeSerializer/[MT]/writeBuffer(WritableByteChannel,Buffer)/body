{
  while (true) {
    if (!this.bufferExistanceSerialized) {
      if (!this.serializationStarted) {
        this.tempBuffer.position(0);
        if (buffer == null) {
          this.tempBuffer.put(0,(byte)0);
          this.tempBuffer.limit(1);
        }
 else {
          this.tempBuffer.put(0,(byte)1);
          integerToByteBuffer(buffer.size(),1,this.tempBuffer);
        }
        this.serializationStarted=true;
      }
      if (this.tempBuffer.hasRemaining()) {
        if (writableByteChannel.write(tempBuffer) == 0) {
          return true;
        }
      }
 else {
        this.bufferExistanceSerialized=true;
        this.serializationStarted=false;
        if (buffer == null) {
          this.serializationState=SerializationState.FULLYSERIALIZED;
          return false;
        }
      }
    }
 else {
      buffer.read(writableByteChannel);
      if (!buffer.hasRemaining()) {
        buffer.rewind();
        this.serializationState=SerializationState.FULLYSERIALIZED;
        return false;
      }
      return true;
    }
  }
}
