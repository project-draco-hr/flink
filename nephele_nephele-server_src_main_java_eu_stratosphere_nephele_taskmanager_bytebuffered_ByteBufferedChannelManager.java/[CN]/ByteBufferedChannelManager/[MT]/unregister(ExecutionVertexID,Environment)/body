{
synchronized (this.registeredChannels) {
    for (int i=0; i < environment.getNumberOfOutputGates(); ++i) {
      final OutputGate<?> outputGate=environment.getOutputGate(i);
      for (int j=0; j < outputGate.getNumberOfOutputChannels(); ++j) {
        final AbstractOutputChannel<?> outputChannel=outputGate.getOutputChannel(j);
        this.registeredChannels.remove(outputChannel.getID());
      }
    }
    for (int i=0; i < environment.getNumberOfInputGates(); ++i) {
      final InputGate<?> inputGate=environment.getInputGate(i);
      for (int j=0; j < inputGate.getNumberOfInputChannels(); ++j) {
        final AbstractInputChannel<?> inputChannel=inputGate.getInputChannel(j);
        this.registeredChannels.remove(inputChannel.getID());
      }
    }
  }
synchronized (this.taskMap) {
    final TaskContext taskContext=this.taskMap.remove(vertexID);
    if (taskContext == null) {
      LOG.error("taskContext is null!");
      return;
    }
    taskContext.releaseAllResources();
  }
  redistributeGlobalBuffers();
}
