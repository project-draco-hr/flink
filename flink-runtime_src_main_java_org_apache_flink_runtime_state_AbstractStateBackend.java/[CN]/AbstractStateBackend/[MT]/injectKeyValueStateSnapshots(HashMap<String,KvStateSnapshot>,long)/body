{
  if (keyValueStateSnapshots != null) {
    if (keyValueStatesByName == null) {
      keyValueStatesByName=new HashMap<>();
    }
    for (    Map.Entry<String,KvStateSnapshot> state : keyValueStateSnapshots.entrySet()) {
      KvState kvState=state.getValue().restoreState(this,keySerializer,userCodeClassLoader,recoveryTimestamp);
      keyValueStatesByName.put(state.getKey(),kvState);
    }
    keyValueStates=keyValueStatesByName.values().toArray(new KvState[keyValueStatesByName.size()]);
  }
}
