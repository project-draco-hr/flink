{
  InstanceID instanceID=new InstanceID(StringUtils.hexStringToByte(instanceIdStr));
  StackTrace message=null;
  Throwable exception=null;
  final Future<Object> response=jobmanager.ask(new RequestStackTrace(instanceID),timeout);
  try {
    message=(StackTrace)Await.result(response,timeout);
  }
 catch (  Exception ex) {
    exception=ex;
  }
  JSONObject obj=new JSONObject();
  try {
    if (message != null) {
      obj.put("stackTrace",message.stackTrace());
    }
 else     if (exception != null) {
      obj.put("errorMessage",exception.getMessage());
    }
  }
 catch (  JSONException e) {
    LOG.warn("Json object creation failed",e);
  }
  PrintWriter writer=resp.getWriter();
  writer.write(obj.toString());
}
