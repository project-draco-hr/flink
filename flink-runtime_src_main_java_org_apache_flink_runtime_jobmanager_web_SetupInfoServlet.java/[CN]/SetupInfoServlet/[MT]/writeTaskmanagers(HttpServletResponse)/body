{
  Set<InstanceConnectionInfo> keys=jobmanager.getInstances().keySet();
  List<InstanceConnectionInfo> list=new ArrayList<InstanceConnectionInfo>(keys);
  Collections.sort(list);
  JSONObject obj=new JSONObject();
  JSONArray array=new JSONArray();
  for (  InstanceConnectionInfo k : list) {
    JSONObject objInner=new JSONObject();
    Instance instance=jobmanager.getInstances().get(k);
    long time=new Date().getTime() - instance.getLastHeartBeat();
    try {
      objInner.put("inetAdress",k.getInetAdress());
      objInner.put("ipcPort",k.ipcPort());
      objInner.put("dataPort",k.dataPort());
      objInner.put("timeSinceLastHeartbeat",time / 1000);
      objInner.put("slotsNumber",instance.getTotalNumberOfSlots());
      objInner.put("freeSlots",instance.getNumberOfAvailableSlots());
      objInner.put("cpuCores",instance.getResources().getNumberOfCPUCores());
      objInner.put("physicalMemory",instance.getResources().getSizeOfPhysicalMemory() >>> 20);
      objInner.put("freeMemory",instance.getResources().getSizeOfJvmHeap() >>> 20);
      objInner.put("managedMemory",instance.getResources().getSizeOfManagedMemory() >>> 20);
      array.put(objInner);
    }
 catch (    JSONException e) {
      LOG.warn("Json object creation failed",e);
    }
  }
  try {
    obj.put("taskmanagers",array);
  }
 catch (  JSONException e) {
    LOG.warn("Json object creation failed",e);
  }
  PrintWriter w=resp.getWriter();
  w.write(obj.toString());
}
