{
  SopremoPlan actualPlan=parseScript("using cleansing;\n" + "$personCluster = read 'personCluster.json';\n" + "abbr = fn(str, prefix) str + prefix;\n"+ "MergeAddresses = javaudf('eu.stratosphere.simple.jaql.cleanse.FusionTest.mergeAddresses');\n"+ "$fusedPersons = fuse $personCluster\n"+ "	default vote(abbr);\n"+ "write $fusedPersons to hdfs('fusedPersons.json');");
  SopremoPlan expectedPlan=new SopremoPlan();
  Source personCluster=new Source("personCluster.json");
  Fusion fusion=new Fusion().withInputs(personCluster);
  fusion.setDefaultValueRule(new BeliefResolution(new MethodCall("abbr",EvaluationExpression.VALUE)));
  Sink fusedPersons=new Sink("fusedPersons.json").withInputs(fusion);
  expectedPlan.setSinks(fusedPersons);
  assertEquals(expectedPlan,actualPlan);
}
