{
  final SopremoPlan actualPlan=this.parseScript("using cleansing;\n" + "$personCluster = read 'personCluster.json';\n" + "abbr = fn(prefix, str) startsWith(prefix, str);\n"+ "$fusedPersons = fuse $personCluster\n"+ "	into { \n"+ "		lastName: [vote(abbr), longest],\n"+ "	};\n"+ "write $fusedPersons to hdfs('fusedPersons.json');");
  final SopremoPlan expectedPlan=new SopremoPlan();
  final Source personCluster=new Source("personCluster.json");
  final Fusion fusion=new Fusion().withInputs(personCluster);
  fusion.addFusionRule(new BeliefResolution(new MethodCall("abbr",EvaluationExpression.VALUE)),new ObjectAccess("lastName"));
  fusion.addFusionRule(new MethodCall("longest",EvaluationExpression.VALUE),new ObjectAccess("lastName"));
  final Sink fusedPersons=new Sink("fusedPersons.json").withInputs(fusion);
  expectedPlan.setSinks(fusedPersons);
  assertEquals(expectedPlan,actualPlan);
}
