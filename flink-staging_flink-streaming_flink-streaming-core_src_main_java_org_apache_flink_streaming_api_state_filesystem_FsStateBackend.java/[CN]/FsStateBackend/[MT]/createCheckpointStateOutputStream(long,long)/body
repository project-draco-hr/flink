{
  checkFileSystemInitialized();
  final Path checkpointDir=createCheckpointDirPath(checkpointID);
  filesystem.mkdirs(checkpointDir);
  Exception latestException=null;
  for (int attempt=0; attempt < 10; attempt++) {
    Path targetPath=new Path(checkpointDir,UUID.randomUUID().toString());
    try {
      FSDataOutputStream outStream=filesystem.create(targetPath,false);
      return new FsCheckpointStateOutputStream(outStream,targetPath,filesystem);
    }
 catch (    Exception e) {
      latestException=e;
    }
  }
  throw new Exception("Could not open output stream for state backend",latestException);
}
