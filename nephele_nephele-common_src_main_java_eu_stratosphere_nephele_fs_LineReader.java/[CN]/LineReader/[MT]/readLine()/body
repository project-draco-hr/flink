{
  if (this.stream == null || this.overLimit) {
    return null;
  }
  int curr=0;
  int countInWrapBuffer=0;
  while (true) {
    if (this.readPos >= this.limit) {
      if (!fillBuffer()) {
        if (countInWrapBuffer > 0) {
          byte[] tmp=new byte[countInWrapBuffer];
          System.arraycopy(this.wrapBuffer,0,tmp,0,countInWrapBuffer);
          return tmp;
        }
 else {
          return null;
        }
      }
    }
    int startPos=this.readPos;
    int count=0;
    while (this.readPos < this.limit && (curr=this.readBuffer[this.readPos++]) != LF) {
    }
    if (curr == LF) {
      count=this.readPos - startPos - 1;
      if (this.readPos == 1 && countInWrapBuffer > 0 && this.wrapBuffer[countInWrapBuffer - 1] == CR) {
        countInWrapBuffer--;
      }
 else       if (this.readPos > startPos + 1 && this.readBuffer[this.readPos - 2] == CR) {
        count--;
      }
      if (countInWrapBuffer > 0) {
        byte[] end=new byte[countInWrapBuffer + count];
        System.arraycopy(this.wrapBuffer,0,end,0,countInWrapBuffer);
        System.arraycopy(this.readBuffer,0,end,countInWrapBuffer,count);
        return end;
      }
 else {
        byte[] end=new byte[count];
        System.arraycopy(this.readBuffer,startPos,end,0,count);
        return end;
      }
    }
 else {
      count=this.limit - startPos;
      while (this.wrapBuffer.length - countInWrapBuffer < count) {
        byte[] tmp=new byte[this.wrapBuffer.length * 2];
        System.arraycopy(this.wrapBuffer,0,tmp,0,countInWrapBuffer);
        this.wrapBuffer=tmp;
      }
      System.arraycopy(this.readBuffer,startPos,this.wrapBuffer,countInWrapBuffer,count);
      countInWrapBuffer+=count;
    }
  }
}
