{
  if (message instanceof LeaderSessionMessage) {
    LeaderSessionMessage msg=(LeaderSessionMessage)message;
    if (msg.leaderSessionID().isDefined() && getLeaderSessionID().isDefined()) {
      if (getLeaderSessionID().equals(msg.leaderSessionID())) {
        handleMessage(msg.message());
      }
 else {
        handleDiscardedMessage(msg);
      }
    }
 else {
      handleDiscardedMessage(msg);
    }
  }
 else   if (message instanceof RequiresLeaderSessionID) {
    throw new Exception("Received a message " + message + " without a leader session "+ "ID, even though it requires to have one.");
  }
 else {
    handleMessage(message);
  }
}
