{
  while (true) {
    RequestFuture<Long> future=sendListOffsetRequest(partition,timestamp);
    client.poll(future);
    if (future.succeeded())     return future.value();
    if (!future.isRetriable())     throw future.exception();
    if (future.exception() instanceof InvalidMetadataException)     client.awaitMetadataUpdate();
 else     Utils.sleep(retryBackoffMs);
  }
}
