{
  if (simulate) {
    this.inputs[SPENDING][FUND]=new Source(this.getInternalInputFormat(),String.format("%s/EarmarkFunds.json",this.outputDir));
    return;
  }
  ObjectCreation fundProjection=new ObjectCreation();
  final BatchAggregationExpression batch=new BatchAggregationExpression();
  fundProjection.addMapping("id",new MethodCall("format",new ConstantExpression("spendings%s"),new PathExpression(batch.add(BuiltinFunctions.FIRST),new ObjectAccess("UniqueTransactionID"))));
  fundProjection.addMapping("amount",batch.add(BuiltinFunctions.SUM,new TernaryExpression(new ObjectAccess("DollarsObligated"),this.coerce(DecimalNode.class,new ObjectAccess("DollarsObligated")),new ConstantExpression(0))));
  fundProjection.addMapping("currency",new ConstantExpression("USD"));
  ObjectCreation date=new ObjectCreation();
  date.addMapping("year",batch.add(BuiltinFunctions.FIRST,new ObjectAccess("FiscalYear")));
  fundProjection.addMapping("date",date);
  fundProjection.addMapping("subject",new PathExpression(batch.add(BuiltinFunctions.FIRST),new ObjectAccess("ProductorServiceCode")));
  if (this.scrubbed[SPENDING] == null)   this.scrubSpending(true);
  Grouping grouping=new Grouping().withInputs(this.scrubbed[SPENDING]).withGroupingKey(new ObjectAccess("UniqueTransactionID")).withResultProjection(fundProjection);
  this.inputs[SPENDING][FUND]=grouping;
  this.sinks.add(new Sink(this.getInternalOutputFormat(),String.format("%s/SpendingFunds.json",this.outputDir)).withInputs(grouping));
}
