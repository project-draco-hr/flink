{
  final List<BlockChannelAccess<?,?>> channelAccesses=new ArrayList<BlockChannelAccess<?,?>>(channelIDs.size());
  final MergeIterator mergeIterator=getMergingIterator(channelIDs,readBuffers,channelAccesses);
  final KeyGroupedIterator groupedIter=new KeyGroupedIterator(mergeIterator,this.keyPositions,this.keyClasses);
  final Channel.ID mergedChannelID=this.ioManager.createChannel();
  final BlockChannelWriter writer=this.ioManager.createBlockChannelWriter(mergedChannelID);
  registerOpenChannelToBeRemovedAtShudown(writer);
  final ChannelWriterOutputView output=new ChannelWriterOutputView(writer,writeBuffers,this.ioBufferSize);
  final WriterCollector collector=new WriterCollector(output);
  final ReduceStub combineStub=this.combineStub;
  try {
    while (groupedIter.nextKey()) {
      combineStub.combine(groupedIter.getValues(),collector);
    }
  }
 catch (  Exception e) {
    throw new IOException("An error occurred in the combiner user code.");
  }
  writer.close();
  unregisterOpenChannelToBeRemovedAtShudown(writer);
  registerChannelToBeRemovedAtShudown(mergedChannelID);
  for (int i=0; i < channelAccesses.size(); i++) {
    unregisterOpenChannelToBeRemovedAtShudown(channelAccesses.get(i));
  }
  return mergedChannelID;
}
