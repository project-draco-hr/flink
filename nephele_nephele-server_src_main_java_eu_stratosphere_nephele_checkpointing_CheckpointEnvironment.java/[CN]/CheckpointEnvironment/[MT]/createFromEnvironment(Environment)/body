{
  final JobID jobID=environment.getJobID();
  final Map<GateID,Set<ChannelID>> outputChannelIDs=new HashMap<GateID,Set<ChannelID>>();
  final Map<GateID,Set<ChannelID>> inputChannelIDs=new HashMap<GateID,Set<ChannelID>>();
  Iterator<GateID> gateIt=environment.getOutputGateIDs().iterator();
  while (gateIt.hasNext()) {
    final GateID gateID=gateIt.next();
    outputChannelIDs.put(gateID,environment.getOutputChannelIDsOfGate(gateID));
  }
  gateIt=environment.getInputGateIDs().iterator();
  while (gateIt.hasNext()) {
    final GateID gateID=gateIt.next();
    inputChannelIDs.put(gateID,environment.getInputChannelIDsOfGate(gateID));
  }
  return new CheckpointEnvironment(jobID,Collections.unmodifiableMap(outputChannelIDs),Collections.unmodifiableMap(inputChannelIDs));
}
