{
  final Menu tableContextMenu=new Menu(getShell());
  final MenuItem addItem=new MenuItem(tableContextMenu,SWT.PUSH);
  addItem.setText("Add...");
  addItem.addSelectionListener(new SelectionAdapter(){
    @Override public void widgetSelected(    final SelectionEvent arg0){
      addOrEditSelectedTableItems();
    }
  }
);
  final MenuItem editItem=new MenuItem(tableContextMenu,SWT.PUSH);
  editItem.setText("Edit...");
  editItem.addSelectionListener(new SelectionAdapter(){
    @Override public void widgetSelected(    final SelectionEvent arg0){
      addOrEditSelectedTableItems();
    }
  }
);
  final MenuItem removeItem=new MenuItem(tableContextMenu,SWT.PUSH);
  removeItem.setText("Remove...");
  removeItem.addSelectionListener(new SelectionAdapter(){
    @Override public void widgetSelected(    final SelectionEvent arg0){
      removeSelectedTableItems();
    }
  }
);
  tableContextMenu.addMenuListener(new MenuAdapter(){
    @Override public void menuShown(    final MenuEvent arg0){
      TableItem[] selectedItems=failureEventTable.getSelection();
      if (selectedItems == null) {
        return;
      }
      if (selectedItems.length == 0) {
        editItem.setEnabled(false);
        removeItem.setEnabled(false);
        return;
      }
      if (selectedItems[0].getData() == null) {
        editItem.setEnabled(false);
        removeItem.setEnabled(false);
        return;
      }
      editItem.setEnabled(true);
      removeItem.setEnabled(true);
    }
  }
);
  return tableContextMenu;
}
