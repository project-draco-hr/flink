{
  byte[] dest=new byte[length];
  if (buffer.hasArray()) {
    System.arraycopy(buffer.array(),buffer.arrayOffset() + offset,dest,0,length);
  }
 else {
    buffer.mark();
    buffer.position(offset);
    buffer.get(dest,0,length);
    buffer.reset();
  }
  return dest;
}
