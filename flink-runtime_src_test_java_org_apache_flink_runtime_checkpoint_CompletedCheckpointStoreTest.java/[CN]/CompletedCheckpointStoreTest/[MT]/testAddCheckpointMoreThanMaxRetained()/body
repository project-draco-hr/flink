{
  CompletedCheckpointStore checkpoints=createCompletedCheckpoints(1,userClassLoader);
  TestCheckpoint[] expected=new TestCheckpoint[]{createCheckpoint(0),createCheckpoint(1),createCheckpoint(2),createCheckpoint(3)};
  checkpoints.addCheckpoint(expected[0]);
  assertEquals(1,checkpoints.getNumberOfRetainedCheckpoints());
  for (int i=1; i < expected.length; i++) {
    checkpoints.addCheckpoint(expected[i]);
    expected[i - 1].awaitDiscard();
    assertTrue(expected[i - 1].isDiscarded());
    assertEquals(userClassLoader,expected[i - 1].getDiscardClassLoader());
    assertEquals(1,checkpoints.getNumberOfRetainedCheckpoints());
  }
}
