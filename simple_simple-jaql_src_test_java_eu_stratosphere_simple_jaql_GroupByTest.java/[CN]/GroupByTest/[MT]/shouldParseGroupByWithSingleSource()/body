{
  Transformation transformation=new Transformation();
  transformation.addMapping(new ValueAssignment("d",createPath("$","dept")));
  Path[] params={createPath("$","[*]","income")};
  transformation.addMapping(new ValueAssignment("total",new Function("sum",params)));
  assertParseResult(new Aggregation(transformation,Arrays.asList(createPath("$","dept")),this.employeeSource()),this.employeeJaql() + "employees -> group by d = $.dept into {d, total: sum($[*].income)};");
}
