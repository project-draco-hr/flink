{
  ObjectCreation transformation=new ObjectCreation();
  transformation.addMapping("d",createPath("$","dept"));
  PathExpression[] params={createPath("$","[*]","income")};
  transformation.addMapping("total",new FunctionCall("sum",params));
  assertParseResult(new Aggregation(transformation,Arrays.asList(createPath("$","dept")),this.employeeSource()),this.employeeJaql() + "employees -> group each emp by d = emp.dept as deptEmps into {d, total: sum(deptEmps[*].income)};");
}
