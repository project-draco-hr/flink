{
  Transformation transformation=new Transformation();
  transformation.addMapping(new ValueAssignment("d",createPath("$","d")));
  transformation.addMapping(new ValueAssignment("total",new JsonPath.Function("sum",createPath("$","[*]","income"))));
  assertParseResult(new Aggregation(transformation,Arrays.asList(createPath("$","dept")),employeeSource()),employeeJaql() + "employees -> group each emp by d = emp.dept as deptEmps into {d, total: sum(deptEmps[*].income)};");
}
