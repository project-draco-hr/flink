{
  Transformation transformation=new Transformation();
  transformation.addMapping(new ValueAssignment("d",createPath("$","dept")));
  Path[] params={createPath("$","[*]","income")};
  transformation.addMapping(new ValueAssignment("total",new Function("sum",params)));
  assertParseResult(new Aggregation(transformation,Arrays.asList(createPath("$","dept")),this.employeeSource()),this.employeeJaql() + "employees -> group each emp by d = emp.dept as deptEmps into {d, total: sum(deptEmps[*].income)};");
}
