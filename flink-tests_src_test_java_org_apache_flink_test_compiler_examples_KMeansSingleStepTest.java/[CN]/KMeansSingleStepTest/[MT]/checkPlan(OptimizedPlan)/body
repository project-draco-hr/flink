{
  OptimizerPlanNodeResolver or=getOptimizerPlanNodeResolver(plan);
  final SinkPlanNode sink=or.getNode(SINK);
  final SingleInputPlanNode reducer=or.getNode(REDUCER_NAME);
  final SingleInputPlanNode combiner=(SingleInputPlanNode)reducer.getPredecessor();
  final SingleInputPlanNode mapper=or.getNode(MAPPER_NAME);
  assertEquals(1,mapper.getBroadcastInputs().size());
  assertEquals(ShipStrategyType.FORWARD,mapper.getInput().getShipStrategy());
  assertEquals(ShipStrategyType.BROADCAST,mapper.getBroadcastInputs().get(0).getShipStrategy());
  assertEquals(LocalStrategy.NONE,mapper.getInput().getLocalStrategy());
  assertEquals(LocalStrategy.NONE,mapper.getBroadcastInputs().get(0).getLocalStrategy());
  assertEquals(DriverStrategy.COLLECTOR_MAP,mapper.getDriverStrategy());
  assertNull(mapper.getInput().getLocalStrategyKeys());
  assertNull(mapper.getInput().getLocalStrategySortOrder());
  assertNull(mapper.getBroadcastInputs().get(0).getLocalStrategyKeys());
  assertNull(mapper.getBroadcastInputs().get(0).getLocalStrategySortOrder());
  Assert.assertNotNull(combiner);
  assertEquals(ShipStrategyType.FORWARD,combiner.getInput().getShipStrategy());
  assertEquals(LocalStrategy.NONE,combiner.getInput().getLocalStrategy());
  assertEquals(DriverStrategy.SORTED_GROUP_COMBINE,combiner.getDriverStrategy());
  assertNull(combiner.getInput().getLocalStrategyKeys());
  assertNull(combiner.getInput().getLocalStrategySortOrder());
  assertEquals(set0,combiner.getKeys(0));
  assertEquals(set0,combiner.getKeys(1));
  assertEquals(ShipStrategyType.PARTITION_HASH,reducer.getInput().getShipStrategy());
  assertEquals(LocalStrategy.COMBININGSORT,reducer.getInput().getLocalStrategy());
  assertEquals(DriverStrategy.SORTED_GROUP_REDUCE,reducer.getDriverStrategy());
  assertEquals(set0,reducer.getKeys(0));
  assertEquals(set0,reducer.getInput().getLocalStrategyKeys());
  assertTrue(Arrays.equals(reducer.getInput().getLocalStrategySortOrder(),reducer.getSortOrders(0)));
  assertEquals(ShipStrategyType.FORWARD,sink.getInput().getShipStrategy());
  assertEquals(LocalStrategy.NONE,sink.getInput().getLocalStrategy());
}
