{
  JobID jobId=new JobID();
  JobVertexID jobVertexId=new JobVertexID();
  int numKeyGroups=123;
  String registrationName="asdasdasdasd";
  KvStateLocation location=new KvStateLocation(jobId,jobVertexId,numKeyGroups,registrationName);
  KvStateID[] kvStateIds=new KvStateID[numKeyGroups];
  KvStateServerAddress[] serverAddresses=new KvStateServerAddress[numKeyGroups];
  InetAddress host=InetAddress.getLocalHost();
  for (int keyGroupIndex=0; keyGroupIndex < numKeyGroups; keyGroupIndex++) {
    kvStateIds[keyGroupIndex]=new KvStateID();
    serverAddresses[keyGroupIndex]=new KvStateServerAddress(host,1024 + keyGroupIndex);
    location.registerKvState(keyGroupIndex,kvStateIds[keyGroupIndex],serverAddresses[keyGroupIndex]);
    assertEquals(keyGroupIndex + 1,location.getNumRegisteredKeyGroups());
  }
  for (int keyGroupIndex=0; keyGroupIndex < numKeyGroups; keyGroupIndex++) {
    assertEquals(kvStateIds[keyGroupIndex],location.getKvStateID(keyGroupIndex));
    assertEquals(serverAddresses[keyGroupIndex],location.getKvStateServerAddress(keyGroupIndex));
  }
  for (int keyGroupIndex=0; keyGroupIndex < numKeyGroups; keyGroupIndex++) {
    kvStateIds[keyGroupIndex]=new KvStateID();
    serverAddresses[keyGroupIndex]=new KvStateServerAddress(host,1024 + keyGroupIndex);
    location.registerKvState(keyGroupIndex,kvStateIds[keyGroupIndex],serverAddresses[keyGroupIndex]);
    assertEquals(numKeyGroups,location.getNumRegisteredKeyGroups());
  }
  for (int keyGroupIndex=0; keyGroupIndex < numKeyGroups; keyGroupIndex++) {
    assertEquals(kvStateIds[keyGroupIndex],location.getKvStateID(keyGroupIndex));
    assertEquals(serverAddresses[keyGroupIndex],location.getKvStateServerAddress(keyGroupIndex));
  }
  for (int keyGroupIndex=0; keyGroupIndex < numKeyGroups; keyGroupIndex++) {
    location.unregisterKvState(keyGroupIndex);
    assertEquals(numKeyGroups - keyGroupIndex - 1,location.getNumRegisteredKeyGroups());
  }
  for (int keyGroupIndex=0; keyGroupIndex < numKeyGroups; keyGroupIndex++) {
    assertEquals(null,location.getKvStateID(keyGroupIndex));
    assertEquals(null,location.getKvStateServerAddress(keyGroupIndex));
  }
  assertEquals(0,location.getNumRegisteredKeyGroups());
}
