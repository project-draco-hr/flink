{
  if (buffer == null || !buffer.isDirect()) {
    throw new IllegalArgumentException("Can't initialize from non-direct ByteBuffer.");
  }
  this.offHeapMemory=buffer;
  this.heapMemory=null;
  this.size=buffer.capacity();
  this.address=getAddress(buffer);
  this.addressLimit=this.address + size;
  if (address >= Long.MAX_VALUE - Integer.MAX_VALUE) {
    throw new RuntimeException("Segment initialized with too large address: " + address + " ; Max allowed address is "+ (Long.MAX_VALUE - Integer.MAX_VALUE - 1));
  }
}
