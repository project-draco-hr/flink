{
  CheckpointState ics=CheckpointState.UNDECIDED;
  boolean hasFileChannels=false;
  for (int i=0; i < this.environment.getNumberOfOutputGates(); ++i) {
    if (this.environment.getOutputGate(i).getChannelType() == ChannelType.FILE) {
      hasFileChannels=true;
      break;
    }
  }
  if (hasFileChannels) {
    ics=CheckpointState.PARTIAL;
  }
 else {
    ForceCheckpoint forcedCheckpoint=this.environment.getInvokable().getClass().getAnnotation(ForceCheckpoint.class);
    if (forcedCheckpoint != null) {
      ics=forcedCheckpoint.checkpoint() ? CheckpointState.PARTIAL : CheckpointState.NONE;
    }
  }
  this.checkpointState.set(ics);
}
