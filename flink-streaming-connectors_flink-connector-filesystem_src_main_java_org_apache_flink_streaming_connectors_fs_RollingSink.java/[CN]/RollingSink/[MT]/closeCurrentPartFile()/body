{
  if (writer != null) {
    writer.close();
  }
  if (outStream != null) {
    hflushOrSync(outStream);
    outStream.close();
    outStream=null;
  }
  if (currentPartPath != null) {
    Path inProgressPath=new Path(currentPartPath.getParent(),inProgressPrefix + currentPartPath.getName()).suffix(inProgressSuffix);
    Path pendingPath=new Path(currentPartPath.getParent(),pendingPrefix + currentPartPath.getName()).suffix(pendingSuffix);
    FileSystem fs=inProgressPath.getFileSystem(new org.apache.hadoop.conf.Configuration());
    fs.rename(inProgressPath,pendingPath);
    LOG.debug("Moving in-progress bucket {} to pending file {}",inProgressPath,pendingPath);
    this.bucketState.pendingFiles.add(currentPartPath.toString());
  }
}
