{
  if (this.template.hasUnclosedBranches()) {
    if (this.branchPlan == null) {
      this.branchPlan=new HashMap<OptimizerNode,PlanNode>(8);
    }
    final PlanNode pred1=this.input1.getSource();
    final PlanNode pred2=this.input2.getSource();
    for (    UnclosedBranchDescriptor uc : this.template.getOpenBranches()) {
      OptimizerNode brancher=uc.getBranchingNode();
      PlanNode selectedCandidate=null;
      if (pred1.branchPlan != null) {
        selectedCandidate=pred1.branchPlan.get(brancher);
        this.branchPlan.put(brancher,selectedCandidate);
      }
      if (selectedCandidate == null && pred2.branchPlan != null) {
        selectedCandidate=pred2.branchPlan.get(brancher);
        this.branchPlan.put(brancher,selectedCandidate);
      }
      if (selectedCandidate == null) {
        throw new CompilerException("Candidates for a node with open branches are missing information about the selected candidate ");
      }
    }
  }
}
