{
  if (instanceConnectionInfo == null) {
    LOG.warn("Supplied instance connection info is null");
    return null;
  }
synchronized (this.reservedInstancesToJobMapping) {
    if (this.reservedInstancesToJobMapping.size() == 0) {
      return null;
    }
    final HashSet<JobID> jobsWithReservedInstances=new HashSet<JobID>();
    for (    JobID id : this.reservedInstancesToJobMapping.values()) {
      jobsWithReservedInstances.add(id);
    }
    for (    final JobID jobID : jobsWithReservedInstances) {
      JobToInstancesMapping mapping=null;
synchronized (this.jobToInstancesAssignmentMap) {
        mapping=this.jobToInstancesAssignmentMap.get(jobID);
      }
      if (mapping == null) {
        LOG.error("Unknown mapping for job ID " + jobID);
        continue;
      }
      AmazonEC2Client ec2client=EC2ClientFactory.getEC2Client(mapping.getAwsAccessId(),mapping.getAwsSecretKey());
      DescribeInstancesRequest request=new DescribeInstancesRequest();
      DescribeInstancesResult result=ec2client.describeInstances(request);
      for (      Reservation r : result.getReservations()) {
        for (        Instance t : r.getInstances()) {
          InetAddress candidateAddress=null;
          try {
            candidateAddress=InetAddress.getByName(t.getPrivateIpAddress());
          }
 catch (          UnknownHostException e) {
            LOG.warn("Cannot convert " + t.getPrivateIpAddress() + " into an IP address");
            continue;
          }
          if (instanceConnectionInfo.getAddress().equals(candidateAddress)) {
            NetworkTopology networkTopology;
synchronized (this.networkTopologies) {
              networkTopology=this.networkTopologies.get(jobID);
            }
            if (networkTopology == null) {
              throw new InstanceException("Cannot find network topology for job " + jobID);
            }
            return convertIntoCloudInstance(t,instanceConnectionInfo,mapping.getAwsAccessId(),mapping.getAwsSecretKey(),networkTopology.getRootNode(),hardwareDescription);
          }
        }
      }
    }
  }
  return null;
}
