{
  final String ipcAddressString=GlobalConfiguration.getString(ConfigConstants.JOB_MANAGER_IPC_ADDRESS_KEY,null);
  InetAddress ipcAddress=null;
  if (ipcAddressString != null) {
    try {
      ipcAddress=InetAddress.getByName(ipcAddressString);
    }
 catch (    UnknownHostException e) {
      throw new Exception("Cannot convert " + ipcAddressString + " to an IP address: "+ e.getMessage(),e);
    }
  }
  final int ipcPort=GlobalConfiguration.getInteger(ConfigConstants.JOB_MANAGER_IPC_PORT_KEY,ConfigConstants.DEFAULT_JOB_MANAGER_IPC_PORT);
  this.recommendedClientPollingInterval=GlobalConfiguration.getInteger(ConfigConstants.JOBCLIENT_POLLING_INTERVAL_KEY,ConfigConstants.DEFAULT_JOBCLIENT_POLLING_INTERVAL);
  this.eventCollector=new EventCollector(this.recommendedClientPollingInterval);
  int archived_items=GlobalConfiguration.getInteger(ConfigConstants.JOB_MANAGER_WEB_ARCHIVE_COUNT,ConfigConstants.DEFAULT_JOB_MANAGER_WEB_ARCHIVE_COUNT);
  if (archived_items > 0) {
    this.archive=new MemoryArchivist(archived_items);
    this.eventCollector.registerArchivist(archive);
  }
 else {
    this.archive=null;
  }
  this.accumulatorManager=new AccumulatorManager(Math.min(1,archived_items));
  this.inputSplitManager=new InputSplitManager();
  final InetSocketAddress rpcServerAddress=new InetSocketAddress(ipcAddress,ipcPort);
  try {
    final int handlerCount=GlobalConfiguration.getInteger(ConfigConstants.JOB_MANAGER_IPC_HANDLERS_KEY,ConfigConstants.DEFAULT_JOB_MANAGER_IPC_HANDLERS);
    this.jobManagerServer=RPC.getServer(this,rpcServerAddress.getHostName(),rpcServerAddress.getPort(),handlerCount);
    this.jobManagerServer.start();
  }
 catch (  IOException e) {
    throw new Exception("Cannot start RPC server: " + e.getMessage(),e);
  }
  LOG.info("Starting job manager in " + executionMode + " mode");
  if (executionMode == ExecutionMode.LOCAL) {
    try {
      this.instanceManager=new LocalInstanceManager();
    }
 catch (    Throwable t) {
      throw new Exception("Cannot instantiate local instance manager: " + t.getMessage(),t);
    }
  }
 else {
    final String instanceManagerClassName=JobManagerUtils.getInstanceManagerClassName(executionMode);
    LOG.info("Trying to load " + instanceManagerClassName + " as instance manager");
    this.instanceManager=JobManagerUtils.loadInstanceManager(instanceManagerClassName);
    if (this.instanceManager == null) {
      throw new Exception("Unable to load instance manager " + instanceManagerClassName);
    }
  }
  final String schedulerClassName=JobManagerUtils.getSchedulerClassName(executionMode);
  LOG.info("Trying to load " + schedulerClassName + " as scheduler");
  this.scheduler=JobManagerUtils.loadScheduler(schedulerClassName,this,this.instanceManager);
  if (this.scheduler == null) {
    throw new Exception("Unable to load scheduler " + schedulerClassName);
  }
  this.multicastManager=new MulticastManager(this.scheduler);
  if (GlobalConfiguration.getBoolean(ProfilingUtils.ENABLE_PROFILING_KEY,false)) {
    final String profilerClassName=GlobalConfiguration.getString(ProfilingUtils.JOBMANAGER_CLASSNAME_KEY,"eu.stratosphere.nephele.profiling.impl.JobManagerProfilerImpl");
    this.profiler=ProfilingUtils.loadJobManagerProfiler(profilerClassName,ipcAddress);
    if (this.profiler == null) {
      throw new Exception("Cannot load profiler");
    }
  }
 else {
    this.profiler=null;
    LOG.debug("Profiler disabled");
  }
  Runtime.getRuntime().addShutdownHook(new JobManagerCleanUp(this));
}
