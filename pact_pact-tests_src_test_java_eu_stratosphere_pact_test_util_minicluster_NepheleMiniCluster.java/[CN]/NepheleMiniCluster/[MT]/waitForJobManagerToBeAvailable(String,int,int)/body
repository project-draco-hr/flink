{
  final InetSocketAddress address=new InetSocketAddress(hostname,port);
  ExtendedManagementProtocol jobManagerConnection=null;
  RPCService rpcService=new RPCService();
  try {
    jobManagerConnection=rpcService.getProxy(address,ExtendedManagementProtocol.class);
    Map<InstanceType,InstanceTypeDescription> map=null;
    final long startTime=System.currentTimeMillis();
    do {
      try {
        map=jobManagerConnection.getMapOfAvailableInstanceTypes();
        if (map != null && map.size() > 0) {
          break;
        }
      }
 catch (      Exception e) {
      }
      Thread.sleep(500);
    }
 while ((System.currentTimeMillis() - startTime) < timeoutMillies);
  }
 catch (  Throwable t) {
    LOG.error(t);
    throw new IOException("Waiting for JobManager to come up failed.",t);
  }
 finally {
    rpcService.shutDown();
  }
}
