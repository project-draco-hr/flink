{
  long memory=this.memorySize;
  if (memory < 1) {
    Runtime r=Runtime.getRuntime();
    memory=r.maxMemory() - r.totalMemory() + r.freeMemory();
    memory/=2;
    memory/=(1024 * 1024);
  }
  final InstanceType instanceType=new InstanceType("default-local",1,1,(int)memory,1,0);
  final String nepheleConfigDirJob=nepheleConfigDir + "/job";
  final int rpcPort=6501, dataPort=7501;
  new FileWriter().dir(nepheleConfigDirJob).file("nephele-user.xml").write("<?xml version=\"1.0\" encoding=\"UTF-8\"?>","<configuration>","    <property>","        <key>jobmanager.instancemanager.local.classname</key>","        <value>" + LocalInstanceManager.class.getName() + "</value>","    </property>","    <property>","        <key>jobmanager.scheduler.local.classname</key>","        <value>" + LocalScheduler.class.getName() + "</value>","    </property>","    <property>","        <key>fs.hdfs.hdfsdefault</key>","        <value>" + hdfsConfigDir + "/hadoop-default.xml</value>","    </property>","    <property>","        <key>fs.hdfs.hdfssite</key>","        <value>" + hdfsConfigDir + "/hadoop-site.xml</value>","    </property>","    <property>","        <key>servicenetwork</key>","        <value>" + getLocalIpAddress() + "</value>","    </property>","    <property>","        <key>" + ConfigConstants.JOB_MANAGER_IPC_ADDRESS_KEY + "</key>","        <value>" + getLocalIpAddress() + "</value>","    </property>","    <property>","        <key>" + ConfigConstants.TASK_MANAGER_IPC_PORT_KEY + "</key>","        <value>" + rpcPort + "</value>","    </property>","    <property>","        <key>" + ConfigConstants.TASK_MANAGER_DATA_PORT_KEY + "</key>","        <value>" + dataPort + "</value>","    </property>","    <property>","        <key>taskmanager.setup.usediscovery</key>","        <value>false</value>","    </property>","    <property>","        <key>jobmanager.visualization.enable</key>","        <value>" + (visualizerEnabled ? "true" : "false") + "</value>","    </property>","    <property>","        <key>" + ConfigConstants.JOBMANAGER_LOCALINSTANCE_TYPE_KEY + "</key>","        <value>" + instanceType.toStringRepresentation() + "</value>","    </property>","    <property>","        <key>taskmanager.memory.size</key>","        <value>" + instanceType.getMemorySize() + "</value>","    </property>","    <property>","        <key>channel.network.allowSpilling</key>","        <value>true</value>","    </property>","</configuration>").close().file("pact-user.xml").write("<?xml version=\"1.0\" encoding=\"UTF-8\"?>","<configuration>","    <property>","        <key>pact.parallelization.degree</key>","        <value>1</value>","    </property>","    <property>","        <key>pact.parallelization.intra-node-degree</key>","        <value>1</value>","    </property>","    <property>","        <key>pact.parallelization.maxmachines</key>","        <value>1</value>","    </property>","    <property>","        <key>pact.parallelization.default-instance-type</key>","        <value>" + instanceType.toStringRepresentation() + "</value>","    </property>","</configuration>").close();
  LOG.info("Initializing job manager thread with '" + nepheleConfigDirJob + "'.");
  runner=new Thread(){
    @Override public void run(){
      jobManager=new JobManager(nepheleConfigDirJob,"local");
      jobManager.runTaskLoop();
    }
  }
;
  runner.setDaemon(true);
  runner.start();
  try {
    Thread.sleep(10000);
  }
 catch (  InterruptedException e) {
  }
}
