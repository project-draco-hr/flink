{
  if (this.instancesWithAvailableResources.isEmpty()) {
    return null;
  }
  Iterable<Instance> locationsIterable=vertex.getPreferredLocations();
  Iterator<Instance> locations=locationsIterable == null ? null : locationsIterable.iterator();
  if (locations != null && locations.hasNext()) {
    while (locations.hasNext()) {
      Instance location=locations.next();
      if (location != null && this.instancesWithAvailableResources.remove(location)) {
        localizedAssignments++;
        if (LOG.isDebugEnabled()) {
          LOG.debug("Local assignment: " + vertex.getSimpleName() + " --> "+ location);
        }
        return location;
      }
    }
    Instance instance=this.instancesWithAvailableResources.poll();
    nonLocalizedAssignments++;
    if (LOG.isDebugEnabled()) {
      LOG.debug("Non-local assignment: " + vertex.getSimpleName() + " --> "+ instance);
    }
    return instance;
  }
 else {
    Instance instance=this.instancesWithAvailableResources.poll();
    unconstrainedAssignments++;
    if (LOG.isDebugEnabled()) {
      LOG.debug("Unconstrained assignment: " + vertex.getSimpleName() + " --> "+ instance);
    }
    return instance;
  }
}
