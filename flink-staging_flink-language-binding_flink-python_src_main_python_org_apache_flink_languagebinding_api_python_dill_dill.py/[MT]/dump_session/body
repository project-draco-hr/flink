def dump_session(filename='/tmp/session.pkl', main_module=_main_module):
    'pickle the current state of __main__ to a file'
    f = open(filename, 'wb')
    try:
        pickler = Pickler(f, 2)
        pickler._main_module = main_module
        _byref = pickler._byref
        pickler._byref = False
        pickler._session = True
        pickler.dump(main_module)
        pickler._session = False
        pickler._byref = _byref
    finally:
        f.close()
    return
