{
  count=new AtomicInteger();
  final MemorySegmentSource fullBufferSource;
  final MemorySegmentSource emptyBufferSource;
  this.emptyBuffers=new ArrayBlockingQueue<MemorySegment>(memSegments.size() + 1);
  this.fullBuffers=new ArrayBlockingQueue<MemorySegment>(memSegments.size() + 1);
  fullBufferSource=getTimeoutSource((ArrayBlockingQueue<MemorySegment>)this.fullBuffers);
  emptyBufferSource=getBlockingSource((ArrayBlockingQueue<MemorySegment>)this.emptyBuffers);
  this.emptyBuffers.addAll(memSegments);
  this.readEnd=new ReadEnd(this.emptyBuffers,fullBufferSource,segmentSize);
  this.writeEnd=new WriteEnd(this.fullBuffers,emptyBufferSource,segmentSize);
}
