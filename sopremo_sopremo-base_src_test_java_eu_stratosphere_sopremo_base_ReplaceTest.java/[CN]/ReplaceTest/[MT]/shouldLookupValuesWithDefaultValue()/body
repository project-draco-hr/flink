{
  final Replace replace=new Replace();
  final SopremoTestPlan sopremoPlan=new SopremoTestPlan(replace);
  final EvaluationContext context=sopremoPlan.getEvaluationContext();
  context.getFunctionRegistry().put(CoreFunctions.class);
  replace.withReplaceExpression(new ObjectAccess("fieldToReplace")).withDefaultExpression(new FunctionCall("format",context,new ConstantExpression("default %s"),new ObjectAccess("fieldToReplace"))).withDictionaryKeyExtraction(new ArrayAccess(0)).withDictionaryValueExtraction(new ArrayAccess(1));
  sopremoPlan.getInput(0).addObject("field1",1,"fieldToReplace","key1","field2",2).addObject("field1",2,"fieldToReplace","notInList","field2",2).addObject("field1",3,"fieldToReplace","key2","field2",2).addObject("field1",4,"fieldToReplace","notInList2","field2",2);
  sopremoPlan.getInput(1).addArray("key1","value1").addArray("key2","value2").addArray("key3","value3");
  sopremoPlan.getExpectedOutput(0).addObject("field1",1,"fieldToReplace","value1","field2",2).addObject("field1",2,"fieldToReplace","default notInList","field2",2).addObject("field1",3,"fieldToReplace","value2","field2",2).addObject("field1",4,"fieldToReplace","default notInList2","field2",2);
  sopremoPlan.run();
}
