{
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  DataOutputViewStreamWrapper out=new DataOutputViewStreamWrapper(baos);
  try {
    writeKeyAndNamespace(out);
    byte[] key=baos.toByteArray();
    byte[] valueBytes=db.get(key);
    if (valueBytes == null) {
      baos.reset();
      valueSerializer.serialize(foldFunction.fold(stateDesc.getDefaultValue(),value),out);
      db.put(writeOptions,key,baos.toByteArray());
    }
 else {
      ACC oldValue=valueSerializer.deserialize(new DataInputViewStreamWrapper(new ByteArrayInputStream(valueBytes)));
      ACC newValue=foldFunction.fold(oldValue,value);
      baos.reset();
      valueSerializer.serialize(newValue,out);
      db.put(writeOptions,key,baos.toByteArray());
    }
  }
 catch (  Exception e) {
    throw new RuntimeException("Error while adding data to RocksDB",e);
  }
}
