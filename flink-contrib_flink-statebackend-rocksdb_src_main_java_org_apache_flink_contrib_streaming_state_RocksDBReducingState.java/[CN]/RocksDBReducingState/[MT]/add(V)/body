{
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  DataOutputViewStreamWrapper out=new DataOutputViewStreamWrapper(baos);
  try {
    writeKeyAndNamespace(out);
    byte[] key=baos.toByteArray();
    byte[] valueBytes=backend.db.get(columnFamily,key);
    if (valueBytes == null) {
      baos.reset();
      valueSerializer.serialize(value,out);
      backend.db.put(columnFamily,writeOptions,key,baos.toByteArray());
    }
 else {
      V oldValue=valueSerializer.deserialize(new DataInputViewStreamWrapper(new ByteArrayInputStream(valueBytes)));
      V newValue=reduceFunction.reduce(oldValue,value);
      baos.reset();
      valueSerializer.serialize(newValue,out);
      backend.db.put(columnFamily,writeOptions,key,baos.toByteArray());
    }
  }
 catch (  Exception e) {
    throw new RuntimeException("Error while adding data to RocksDB",e);
  }
}
