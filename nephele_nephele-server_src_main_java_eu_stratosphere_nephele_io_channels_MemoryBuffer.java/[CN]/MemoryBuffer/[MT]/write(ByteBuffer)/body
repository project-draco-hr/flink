{
  if (!this.writeMode.get()) {
    throw new IOException("Cannot write to buffer, buffer already switched to read mode");
  }
  final int sourceRemaining=src.remaining();
  final int thisRemaining=this.byteBuffer.remaining();
  final int excess=sourceRemaining - thisRemaining;
  if (excess <= 0) {
    this.byteBuffer.put(src);
    return sourceRemaining;
  }
 else {
    final int oldLimit=src.limit();
    src.limit(src.position() + thisRemaining);
    this.byteBuffer.put(src);
    src.limit(oldLimit);
    return thisRemaining;
  }
}
