{
  boolean finished=false;
  while (!finished) {
    MemorySegment request=null;
    try {
      request=requestQueue.take();
    }
 catch (    InterruptedException e1) {
      throw new RuntimeException("BlockResettableIterator: Unable to take next request",e1);
    }
    Buffer.Output out=new Buffer.Output();
    out.bind(request);
    if (next != null)     out.write(next);
    finished=true;
    while (reader.hasNext()) {
      try {
        next=reader.next();
      }
 catch (      Exception e) {
        throw new RuntimeException(e);
      }
      if (!out.write(next)) {
        finished=false;
        break;
      }
    }
    Buffer.Input in=new Buffer.Input();
    in.bind(request);
    in.reset(out.getPosition());
    out.unbind();
    finishedTasks.add(in);
  }
  Buffer.Input in=new Buffer.Input();
  finishedTasks.add(in);
}
