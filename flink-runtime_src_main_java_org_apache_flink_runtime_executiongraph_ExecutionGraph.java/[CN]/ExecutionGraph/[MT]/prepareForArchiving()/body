{
  if (!state.isTerminalState()) {
    throw new IllegalStateException("Can only archive the job from a terminal state");
  }
  try {
    executionConfig=(ExecutionConfig)InstantiationUtil.readObjectFromConfig(jobConfiguration,ExecutionConfig.CONFIG_KEY,userClassLoader);
  }
 catch (  Exception e) {
    LOG.warn("Error deserializing the execution config while archiving the execution graph",e);
  }
  userClassLoader=null;
  scheduler=null;
  checkpointCoordinator=null;
  executionContext=null;
  for (  ExecutionJobVertex vertex : verticesInCreationOrder) {
    vertex.prepareForArchiving();
  }
  intermediateResults.clear();
  currentExecutions.clear();
  requiredJarFiles.clear();
  jobStatusListenerActors.clear();
  executionListenerActors.clear();
}
