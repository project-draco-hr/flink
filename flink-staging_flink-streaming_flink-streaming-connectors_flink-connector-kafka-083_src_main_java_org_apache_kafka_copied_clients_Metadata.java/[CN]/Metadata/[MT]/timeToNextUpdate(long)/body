{
  long timeToExpire=needUpdate ? 0 : Math.max(this.lastSuccessfulRefreshMs + this.metadataExpireMs - nowMs,0);
  long timeToAllowUpdate=this.lastRefreshMs + this.refreshBackoffMs - nowMs;
  return Math.max(timeToExpire,timeToAllowUpdate);
}
