{
  if (maxWaitMs < 0) {
    throw new IllegalArgumentException("Max time to wait for metadata updates should not be < 0 milli seconds");
  }
  long begin=System.currentTimeMillis();
  long remainingWaitMs=maxWaitMs;
  while (this.version <= lastVersion) {
    if (remainingWaitMs != 0)     wait(remainingWaitMs);
    long elapsed=System.currentTimeMillis() - begin;
    if (elapsed >= maxWaitMs)     throw new TimeoutException("Failed to update metadata after " + maxWaitMs + " ms.");
    remainingWaitMs=maxWaitMs - elapsed;
  }
}
