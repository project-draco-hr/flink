{
  final ArrayList<String> resultFiles=new ArrayList<String>();
  if (getFilesystemProvider().isDir(resultPath)) {
    final String[] files=getFilesystemProvider().listFiles(resultPath);
    final Comparator<String> fileNameComp=new Comparator<String>(){
      @Override public int compare(      String o1,      String o2){
        if (o1.length() < o2.length())         return -1;
 else         if (o1.length() > o2.length())         return 1;
 else         return o1.compareTo(o2);
      }
    }
;
    Arrays.sort(files,fileNameComp);
    for (    String file : files) {
      if (!getFilesystemProvider().isDir(file)) {
        resultFiles.add(resultPath + "/" + file);
      }
    }
  }
 else {
    resultFiles.add(resultPath);
  }
  final Iterator<T> expectedLines=result.iterator();
  for (  String resultFile : resultFiles) {
    final InputStream is=getFilesystemProvider().getInputStream(resultFile);
    final BufferedReader reader=new BufferedReader(new InputStreamReader(is));
    String line=null;
    while ((line=reader.readLine()) != null) {
      Assert.assertTrue("More lines in result than expected lines.",expectedLines.hasNext());
      String nextExpected=expectedLines.next().toString();
      Assert.assertEquals("Expected result and obtained result do not match.",nextExpected,line);
    }
    reader.close();
  }
  Assert.assertFalse("More expected lines than obtained lines.",expectedLines.hasNext());
}
