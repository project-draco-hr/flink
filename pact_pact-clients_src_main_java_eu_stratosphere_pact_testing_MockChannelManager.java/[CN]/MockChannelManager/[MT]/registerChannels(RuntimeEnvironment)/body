{
  for (int i=0; i < environment.getNumberOfOutputGates(); ++i) {
    final RuntimeOutputGate<? extends Record> outputGate=environment.getOutputGate(i);
    for (int j=0; j < outputGate.getNumberOfOutputChannels(); ++j) {
      final AbstractOutputChannel<?> outputChannel=outputGate.getOutputChannel(j);
      MockOutputChannelBroker channelBroker=new MockOutputChannelBroker(outputChannel,this.transitBufferPool,this);
      outputChannel.setByteBufferedOutputChannelBroker(channelBroker);
      this.registeredChannels.put(outputChannel.getID(),channelBroker);
    }
  }
  for (int i=0; i < environment.getNumberOfInputGates(); ++i) {
    final RuntimeInputGate<?> inputGate=environment.getInputGate(i);
    for (int j=0; j < inputGate.getNumberOfInputChannels(); ++j) {
      final AbstractInputChannel<?> inputChannel=inputGate.getInputChannel(j);
      MockInputChannelBroker channelBroker=new MockInputChannelBroker(inputChannel,this);
      inputChannel.setInputChannelBroker(channelBroker);
      this.registeredChannels.put(inputChannel.getID(),channelBroker);
    }
  }
}
