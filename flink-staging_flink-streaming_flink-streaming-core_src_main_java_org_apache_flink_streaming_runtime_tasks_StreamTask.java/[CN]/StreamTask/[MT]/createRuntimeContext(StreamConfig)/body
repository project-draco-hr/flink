{
  Environment env=getEnvironment();
  String operatorName=conf.getStreamOperator(userClassLoader).getClass().getSimpleName();
  KeySelector<?,Serializable> statePartitioner=conf.getStatePartitioner(userClassLoader);
  StreamOperatorState state=statePartitioner == null ? new StreamOperatorState(getStateHandleProvider()) : new PartitionedStreamOperatorState(getStateHandleProvider(),statePartitioner);
  return new StreamingRuntimeContext(operatorName,env,getUserCodeClassLoader(),getExecutionConfig(),state);
}
