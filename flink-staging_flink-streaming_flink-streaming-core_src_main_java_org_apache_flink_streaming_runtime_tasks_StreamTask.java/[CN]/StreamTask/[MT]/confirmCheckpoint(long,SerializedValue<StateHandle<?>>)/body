{
synchronized (checkpointLock) {
    List<Map<String,PartitionedStateHandle>> chainedStates=(List<Map<String,PartitionedStateHandle>>)stateHandle.deserializeValue(getUserCodeClassLoader()).getState();
    for (int i=0; i < chainedStates.size(); i++) {
      Map<String,PartitionedStateHandle> chainedState=chainedStates.get(i);
      if (chainedState != null) {
        StreamOperator<?> chainedOperator=outputHandler.getChainedOperators().get(i);
        if (chainedOperator instanceof StatefulStreamOperator) {
          for (          Entry<String,PartitionedStateHandle> stateEntry : chainedState.entrySet()) {
            for (            StateHandle<Serializable> handle : stateEntry.getValue().getState().values()) {
              ((StatefulStreamOperator)chainedOperator).confirmCheckpointCompleted(checkpointId,stateEntry.getKey(),handle);
            }
          }
        }
      }
    }
  }
}
