{
synchronized (checkpointLock) {
    if (stateHandle != null) {
      List<Tuple2<StateHandle<Serializable>,Map<String,PartitionedStateHandle>>> chainedStates=(List<Tuple2<StateHandle<Serializable>,Map<String,PartitionedStateHandle>>>)stateHandle.deserializeValue(getUserCodeClassLoader()).getState();
      for (int i=0; i < chainedStates.size(); i++) {
        Tuple2<StateHandle<Serializable>,Map<String,PartitionedStateHandle>> chainedState=chainedStates.get(i);
        StreamOperator<?> chainedOperator=outputHandler.getChainedOperators().get(i);
        if (chainedState != null) {
          if (chainedState.f0 != null) {
            ((StatefulStreamOperator)chainedOperator).confirmCheckpointCompleted(checkpointId,null,chainedState.f0);
          }
          if (chainedState.f1 != null) {
            if (chainedOperator instanceof StatefulStreamOperator) {
              for (              Entry<String,PartitionedStateHandle> stateEntry : chainedState.f1.entrySet()) {
                for (                StateHandle<Serializable> handle : stateEntry.getValue().getState().values()) {
                  ((StatefulStreamOperator)chainedOperator).confirmCheckpointCompleted(checkpointId,stateEntry.getKey(),handle);
                }
              }
            }
          }
        }
      }
    }
  }
}
