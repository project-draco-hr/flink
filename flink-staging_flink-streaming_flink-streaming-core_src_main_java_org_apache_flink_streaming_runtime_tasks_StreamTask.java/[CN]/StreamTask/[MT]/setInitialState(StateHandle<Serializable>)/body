{
  Serializable state=stateHandle.getState();
  List<Serializable> chainedStates=(List<Serializable>)state;
  Serializable headState=chainedStates.get(0);
  if (headState != null) {
    if (streamOperator instanceof StatefulStreamOperator) {
      ((StatefulStreamOperator<?>)streamOperator).restoreInitialState((Map<String,PartitionedStateHandle>)headState);
    }
  }
  for (int i=1; i < chainedStates.size(); i++) {
    Serializable chainedState=chainedStates.get(i);
    if (chainedState != null) {
      StreamOperator<?> chainedOperator=outputHandler.getChainedOperators().get(i - 1);
      if (chainedOperator instanceof StatefulStreamOperator) {
        ((StatefulStreamOperator<?>)chainedOperator).restoreInitialState((Map<String,PartitionedStateHandle>)chainedState);
      }
    }
  }
}
