{
  this.counter.set(0);
  final List<String> par3=new ArrayList<String>(NUMBER_OF_TEST_STRINGS);
  for (int i=0; i < NUMBER_OF_TEST_STRINGS; ++i) {
    par3.add(constructTestString(i));
  }
  RPCService rpcService=null;
  try {
    rpcService=new RPCService(RPC_TEST_PORT,NUMBER_OF_RPC_HANDLERS,getTypesToRegister());
    rpcService.setProtocolCallbackHandler(RPCTestProtocol.class,this);
    final RPCTestProtocol proxy=rpcService.getProxy(new InetSocketAddress("localhost",RPC_TEST_PORT),RPCTestProtocol.class);
    final Thread[] threads=new Thread[NUMBER_OF_RPC_CALLS];
    for (int i=0; i < NUMBER_OF_RPC_CALLS; ++i) {
      final int par2=i;
      final Runnable runnable=new Runnable(){
        @Override public void run(){
          assertEquals(par2,proxy.testMethod(false,par2,par3));
        }
      }
;
      threads[i]=new Thread(runnable);
      threads[i].start();
    }
    for (int i=0; i < NUMBER_OF_RPC_CALLS; ++i) {
      threads[i].join();
    }
  }
 catch (  Exception e) {
    fail(StringUtils.stringifyException(e));
  }
 finally {
    if (rpcService != null) {
      rpcService.shutDown();
    }
  }
}
