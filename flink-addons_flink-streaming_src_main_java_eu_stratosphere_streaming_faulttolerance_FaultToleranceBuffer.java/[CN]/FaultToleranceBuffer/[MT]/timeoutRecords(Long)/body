{
  if (timeOfLastUpdate + timeout < currentTime) {
    if (log.isTraceEnabled()) {
      log.trace("Updating record buffer");
    }
    List<UID> timedOutRecords=new LinkedList<UID>();
    Map<Long,Set<UID>> timedOut=recordsByTime.subMap(0L,currentTime - timeout);
    for (    Set<UID> recordSet : timedOut.values()) {
      if (!recordSet.isEmpty()) {
        for (        UID recordID : recordSet) {
          timedOutRecords.add(recordID);
        }
      }
    }
    for (    UID recordID : timedOutRecords) {
      fail(recordID);
    }
    timedOut.clear();
    timeOfLastUpdate=currentTime;
    return timedOutRecords;
  }
  return null;
}
