{
  SopremoTestPlan sopremoPlan=new SopremoTestPlan(1,1);
  Transformation transformation=new Transformation();
  transformation.addMapping(new ValueAssignment("d",createPath("$","dept")));
  transformation.addMapping(new ValueAssignment("total",new Function("sum",createPath("$","[*]","income"))));
  sopremoPlan.getOutputOperator(0).setInputOperators(new Aggregation(transformation,Arrays.asList(createPath("$","dept")),sopremoPlan.getInputOperator(0)));
  sopremoPlan.getInput(0).add(createJsonObject("id",1L,"dept",1L,"income",12000L)).add(createJsonObject("id",2L,"dept",1L,"income",13000L)).add(createJsonObject("id",3L,"dept",2L,"income",15000L)).add(createJsonObject("id",4L,"dept",1L,"income",10000L)).add(createJsonObject("id",5L,"dept",3L,"income",8000L)).add(createJsonObject("id",6L,"dept",2L,"income",5000L)).add(createJsonObject("id",7L,"dept",1L,"income",24000L));
  sopremoPlan.getOutput(0).addExpected(createJsonObject("d",1L,"total",59000L)).addExpected(createJsonObject("d",2L,"total",20000L)).addExpected(createJsonObject("d",3L,"total",8000L));
  sopremoPlan.run();
}
