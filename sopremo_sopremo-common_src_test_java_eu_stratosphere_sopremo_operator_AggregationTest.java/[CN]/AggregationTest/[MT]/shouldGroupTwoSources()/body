{
  SopremoTestPlan sopremoPlan=new SopremoTestPlan(2,1);
  Transformation transformation=new Transformation();
  transformation.addMapping(new ValueAssignment("dept",createPath("0","dept")));
  transformation.addMapping(new ValueAssignment("deptName",createPath("1","[0]","name")));
  transformation.addMapping(new ValueAssignment("emps",createPath("0","[*]","id")));
  transformation.addMapping(new ValueAssignment("numEmps",new Function("count",createPath("0","dept"))));
  sopremoPlan.getOutputOperator(0).setInputOperators(new Aggregation(transformation,Arrays.asList(createPath("0","dept"),createPath("1","did")),sopremoPlan.getInputOperators(0,2)));
  sopremoPlan.getInput(0).add(createJsonObject("id",1L,"dept",1L,"income",12000L)).add(createJsonObject("id",2L,"dept",1L,"income",13000L)).add(createJsonObject("id",3L,"dept",2L,"income",15000L)).add(createJsonObject("id",4L,"dept",1L,"income",10000L)).add(createJsonObject("id",5L,"dept",3L,"income",8000L)).add(createJsonObject("id",6L,"dept",2L,"income",5000L)).add(createJsonObject("id",7L,"dept",1L,"income",24000L));
  sopremoPlan.getInput(1).add(createJsonObject("did",1L,"name","development")).add(createJsonObject("did",2L,"name","marketing")).add(createJsonObject("did",3L,"name","sales"));
  sopremoPlan.getOutput(0).addExpected(createJsonObject("dept",1L,"deptName","development","emps",new long[]{1L,2L,4L,7L},"numEmps",4L)).addExpected(createJsonObject("dept",2L,"deptName","marketing","emps",new long[]{3L,6L},"numEmps",2L)).addExpected(createJsonObject("dept",3L,"deptName","sales","emps",new long[]{5L},"numEmps",1L));
  sopremoPlan.run();
}
