{
  StreamExecutionEnvironment env=StreamExecutionEnvironment.getExecutionEnvironment();
  env.getConfig().setExecutionRetryDelay(0);
  env.setParallelism(4);
  env.enableCheckpointing(1000);
  DataStream<Tuple2<Integer,Integer>> input=env.addSource(new RichSourceFunction<Tuple2<Integer,Integer>>(){
    @Override public void open(    Configuration parameters){
      if (FAILURES_SO_FAR.incrementAndGet() <= NUM_FAILURES) {
        throw new RuntimeException("fail");
      }
    }
    @Override public void run(    SourceContext<Tuple2<Integer,Integer>> ctx){
    }
    @Override public void cancel(){
    }
  }
);
  input.keyBy(0).map(new MapFunction<Tuple2<Integer,Integer>,Integer>(){
    @Override public Integer map(    Tuple2<Integer,Integer> value){
      return value.f0;
    }
  }
).addSink(new SinkFunction<Integer>(){
    @Override public void invoke(    Integer value){
    }
  }
);
  try {
    env.execute();
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
}
