{
  StreamRecord record1=new ArrayStreamRecord(1).setTuple(0,new Tuple1<String>("R1")).setId(1);
  UID id=record1.getId();
  buffer.add(record1);
  assertArrayEquals(new int[]{0,1,2,2},buffer.ackCounter.get(id));
  StreamRecord failedRecord=buffer.failChannel(id,1);
  assertArrayEquals(new int[]{1,1,0,2},buffer.ackCounter.get(id));
  assertArrayEquals(new int[]{2,0,2,0},buffer.ackCounter.get(failedRecord.getId()));
  assertEquals(2,buffer.ackCounter.size());
  buffer.ack(id,1);
  assertArrayEquals(new int[]{1,1,-1,2},buffer.ackCounter.get(id));
  assertEquals(2,buffer.ackCounter.size());
  assertEquals(null,buffer.failChannel(id,1));
  assertArrayEquals(new int[]{1,1,-1,2},buffer.ackCounter.get(id));
  assertArrayEquals(new int[]{2,0,2,0},buffer.ackCounter.get(failedRecord.getId()));
  assertEquals(2,buffer.ackCounter.size());
  buffer.failChannel(failedRecord.getId(),1);
  assertFalse(buffer.ackCounter.containsKey(failedRecord.getId()));
}
