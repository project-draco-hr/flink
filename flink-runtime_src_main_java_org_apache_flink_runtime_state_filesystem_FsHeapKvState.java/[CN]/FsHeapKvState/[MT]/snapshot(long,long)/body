{
  try (FsStateBackend.FsCheckpointStateOutputStream out=backend.createCheckpointStateOutputStream(checkpointId,timestamp)){
    DataOutputViewStreamWrapper outView=new DataOutputViewStreamWrapper(out);
    outView.writeInt(size());
    writeStateToOutputView(outView);
    outView.flush();
    return new FsHeapKvStateSnapshot<>(getKeySerializer(),getValueSerializer(),out.closeAndGetPath());
  }
 }
