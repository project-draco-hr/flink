{
  try (FsStateBackend.FsCheckpointStateOutputStream out=backend.createCheckpointStateOutputStream(checkpointId,timestamp)){
    OutputViewDataOutputStreamWrapper outView=new OutputViewDataOutputStreamWrapper(new DataOutputStream(out));
    outView.writeInt(size());
    writeStateToOutputView(outView);
    outView.flush();
    return new FsHeapKvStateSnapshot<>(getKeySerializer(),getValueSerializer(),out.closeAndGetPath());
  }
 }
