{
  File file=new File(testDataDir + fileName);
  File checkFile=new File(testChekSumDir + fileName + ".md5");
  String checkSumDesired=new String();
  String checkSumActaul=new String();
  File testDataDirectory=new File(testDataDir);
  testDataDirectory.mkdirs();
  try {
    FileReader fileReader=new FileReader(checkFile);
    BufferedReader bufferedReader=new BufferedReader(fileReader);
    checkSumDesired=bufferedReader.readLine();
    bufferedReader.close();
    fileReader.close();
  }
 catch (  FileNotFoundException e) {
    throw new RuntimeException("File not found: " + file.getAbsolutePath(),e);
  }
catch (  IOException e) {
    throw new RuntimeException("Cannot read file: " + file.getAbsolutePath(),e);
  }
  if (file.exists()) {
    if (LOG.isInfoEnabled()) {
      LOG.info("{} already exists.",fileName);
    }
    try {
      checkSumActaul=DigestUtils.md5Hex(FileUtils.readFileToByteArray(file));
    }
 catch (    IOException e) {
      throw new RuntimeException("Cannot read file to byte array: " + file.getAbsolutePath(),e);
    }
    if (!checkSumActaul.equals(checkSumDesired)) {
      if (LOG.isInfoEnabled()) {
        LOG.info("Checksum is incorrect.");
        LOG.info("Downloading file.");
      }
      download(fileName);
    }
  }
 else {
    if (LOG.isInfoEnabled()) {
      LOG.info("File does not exist.");
      LOG.info("Downloading file.");
    }
    download(fileName);
  }
}
