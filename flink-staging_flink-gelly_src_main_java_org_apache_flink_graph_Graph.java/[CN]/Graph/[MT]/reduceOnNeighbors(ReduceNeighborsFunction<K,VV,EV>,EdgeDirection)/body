{
switch (direction) {
case IN:
    final DataSet<Tuple3<K,Edge<K,EV>,Vertex<K,VV>>> edgesWithSources=edges.join(this.vertices).where(0).equalTo(0).with(new ProjectVertexIdJoin<K,VV,EV>(1));
  return edgesWithSources.groupBy(0).reduce(new ApplyNeighborReduceFunction<K,VV,EV>(reduceNeighborsFunction)).map(new ApplyNeighborhoodMapFunction<K,VV,EV>());
case OUT:
DataSet<Tuple3<K,Edge<K,EV>,Vertex<K,VV>>> edgesWithTargets=edges.join(this.vertices).where(1).equalTo(0).with(new ProjectVertexIdJoin<K,VV,EV>(0));
return edgesWithTargets.groupBy(0).reduce(new ApplyNeighborReduceFunction<K,VV,EV>(reduceNeighborsFunction)).map(new ApplyNeighborhoodMapFunction<K,VV,EV>());
case ALL:
DataSet<Tuple3<K,Edge<K,EV>,Vertex<K,VV>>> edgesWithNeighbors=edges.flatMap(new EmitOneEdgeWithNeighborPerNode<K,VV,EV>()).join(this.vertices).where(1).equalTo(0).with(new ProjectEdgeWithNeighbor<K,VV,EV>());
return edgesWithNeighbors.groupBy(0).reduce(new ApplyNeighborReduceFunction<K,VV,EV>(reduceNeighborsFunction)).map(new ApplyNeighborhoodMapFunction<K,VV,EV>());
default :
throw new IllegalArgumentException("Illegal edge direction");
}
}
