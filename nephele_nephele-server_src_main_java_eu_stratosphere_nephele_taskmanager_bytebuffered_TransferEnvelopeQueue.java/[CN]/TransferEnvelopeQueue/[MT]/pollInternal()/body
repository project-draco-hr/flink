{
  if (isEmpty()) {
    return null;
  }
  checkHeadQueue();
  final TransferEnvelope retVal=this.headQueue.poll();
  if (retVal == null) {
    throw new IllegalStateException("headQueue returned null");
  }
  if (this.headQueue.isEmpty()) {
    this.channelQueues.remove(this.headQueue);
    this.headQueue=null;
    this.iterator=null;
    return retVal;
  }
  if (this.channelQueues.size() > 1) {
    if (this.iterator.hasNext()) {
      this.headQueue=this.iterator.next();
    }
 else {
      this.iterator=null;
      this.headQueue=null;
    }
  }
  return retVal;
}
