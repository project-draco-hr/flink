{
  System.out.println("==NO CACHE ENTRY FOUND. CREATING TREE==");
  final ExecutionGraph eg=this.scheduler.getExecutionGraphByID(jobID);
  final AbstractOutputChannel<? extends Record> outputChannel=eg.getOutputChannelByID(sourceChannelID);
  final OutputGate<? extends Record> broadcastgate=outputChannel.getOutputGate();
  System.out.println("Output gate is: " + broadcastgate.toString());
  final LinkedList<AbstractOutputChannel<? extends Record>> outputChannels=new LinkedList<AbstractOutputChannel<? extends Record>>();
  for (  AbstractOutputChannel<? extends Record> c : broadcastgate.getOutputChannels()) {
    if (c.isBroadcastChannel()) {
      outputChannels.add(c);
    }
  }
  System.out.println("Number of output channels attached: " + outputChannels.size());
  for (  AbstractOutputChannel<? extends Record> c : broadcastgate.getOutputChannels()) {
    System.out.println("Out channel ID: " + c.getID() + " connected channel: "+ c.getConnectedChannelID()+ " target instance: "+ eg.getVertexByChannelID(c.getConnectedChannelID()).getAllocatedResource().getInstance().getInstanceConnectionInfo());
  }
  final LinkedList<TreeNode> treenodes=new LinkedList<TreeNode>();
  TreeNode actualnode;
  actualnode=new TreeNode(source);
  for (Iterator<AbstractOutputChannel<? extends Record>> iter=outputChannels.iterator(); iter.hasNext(); ) {
    AbstractOutputChannel<? extends Record> actualoutputchannel=iter.next();
    ExecutionVertex targetVertex=eg.getVertexByChannelID(actualoutputchannel.getConnectedChannelID());
    if (targetVertex.getAllocatedResource().getInstance().getInstanceConnectionInfo().equals(source)) {
      actualnode.addLocalTarget(actualoutputchannel.getConnectedChannelID());
      iter.remove();
    }
  }
  treenodes.add(actualnode);
  LinkedList<TreeNode> receivernodes=new LinkedList<TreeNode>();
  while (outputChannels.size() > 0) {
    AbstractOutputChannel<? extends Record> firstChannel=outputChannels.pollFirst();
    ExecutionVertex firstTarget=eg.getVertexByChannelID(firstChannel.getConnectedChannelID());
    InstanceConnectionInfo actualinstance=firstTarget.getAllocatedResource().getInstance().getInstanceConnectionInfo();
    actualnode=new TreeNode(actualinstance);
    actualnode.addLocalTarget(firstChannel.getConnectedChannelID());
    for (Iterator<AbstractOutputChannel<? extends Record>> iter=outputChannels.iterator(); iter.hasNext(); ) {
      AbstractOutputChannel<? extends Record> actualoutputchannel=iter.next();
      ExecutionVertex actualTarget=eg.getVertexByChannelID(actualoutputchannel.getConnectedChannelID());
      if (actualTarget.getAllocatedResource().getInstance().getInstanceConnectionInfo().equals(actualinstance)) {
        actualnode.addLocalTarget(actualoutputchannel.getConnectedChannelID());
        iter.remove();
      }
    }
    receivernodes.add(actualnode);
  }
  if (randomize) {
    Collections.shuffle(receivernodes);
  }
 else {
    Collections.sort(receivernodes);
  }
  treenodes.addAll(receivernodes);
  return treenodes;
}
