{
  if (nonPartitionedStateBackend == null) {
    return retry(new Callable<DbStateHandle<S>>(){
      public DbStateHandle<S> call() throws Exception {
        long handleId=rnd.nextLong();
        String jobIdShort=env.getJobID().toShortString();
        dbAdapter.setCheckpointInsertParams(jobIdShort,insertStatement,checkpointID,timestamp,handleId,InstantiationUtil.serializeObject(state));
        insertStatement.executeUpdate();
        return new DbStateHandle<S>(jobIdShort,checkpointID,timestamp,handleId,dbConfig);
      }
    }
,numSqlRetries,sqlRetrySleep);
  }
 else {
    return nonPartitionedStateBackend.checkpointStateSerializable(state,checkpointID,timestamp);
  }
}
