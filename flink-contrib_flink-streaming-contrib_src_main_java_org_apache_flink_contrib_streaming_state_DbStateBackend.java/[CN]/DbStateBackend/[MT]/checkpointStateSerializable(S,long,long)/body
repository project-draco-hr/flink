{
  if (nonPartitionedStateBackend == null) {
    return retry(new Callable<DbStateHandle<S>>(){
      public DbStateHandle<S> call() throws Exception {
        long handleId=rnd.nextLong();
        String appIdShort=env.getApplicationID().toShortString();
        byte[] serializedState=InstantiationUtil.serializeObject(state);
        dbAdapter.setCheckpointInsertParams(appIdShort,insertStatement,checkpointID,timestamp,handleId,serializedState);
        insertStatement.executeUpdate();
        return new DbStateHandle<S>(appIdShort,checkpointID,timestamp,handleId,dbConfig,serializedState.length);
      }
    }
,numSqlRetries,sqlRetrySleep);
  }
 else {
    return nonPartitionedStateBackend.checkpointStateSerializable(state,checkpointID,timestamp);
  }
}
