{
  String jobName=plan.getJobName();
  TezClient tezClient=TezClient.create(jobName,tezConf);
  tezClient.start();
  try {
    OptimizedPlan optPlan=getOptimizedPlan(plan,parallelism);
    TezDAGGenerator dagGenerator=new TezDAGGenerator(tezConf,new Configuration());
    DAG dag=dagGenerator.createDAG(optPlan);
    if (jarPath != null) {
      addLocalResource(tezConf,jarPath,dag);
    }
    tezClient.waitTillReady();
    LOG.info("Submitting DAG to Tez Client");
    DAGClient dagClient=tezClient.submitDAG(dag);
    LOG.info("Submitted DAG to Tez Client");
    DAGStatus dagStatus=dagClient.waitForCompletion();
    if (dagStatus.getState() != DAGStatus.State.SUCCEEDED) {
      LOG.error(jobName + " failed with diagnostics: " + dagStatus.getDiagnostics());
      throw new RuntimeException(jobName + " failed with diagnostics: " + dagStatus.getDiagnostics());
    }
    LOG.info(jobName + " finished successfully");
    return new JobExecutionResult(null,runTime,null);
  }
  finally {
    tezClient.stop();
  }
}
