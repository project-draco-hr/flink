{
  Object key=nextRecord.getKey(keySelector);
  accumulator=values.get(key);
  nextValue=nextObject;
  if (accumulator != null) {
    callUserFunctionAndLogException();
    values.put(key,folded);
    collector.collect(folded);
  }
 else {
    values.put(key,initialValue);
    collector.collect(initialValue);
  }
}
