{
  Future<Object> listResponse=jobManager.ask(JobManagerMessages.getRequestRunningJobsStatus(),askTimeout);
  List<JobStatusMessage> jobs;
  try {
    Object result=Await.result(listResponse,askTimeout);
    jobs=((JobManagerMessages.RunningJobsStatus)result).getStatusMessages();
  }
 catch (  Exception e) {
    throw new Exception("Could not cancel job - failed to retrieve running jobs from the JobManager.",e);
  }
  if (jobs.isEmpty()) {
    throw new Exception("Could not cancel job - no running jobs");
  }
  if (jobs.size() != 1) {
    throw new Exception("Could not cancel job - more than one running job.");
  }
  JobStatusMessage status=jobs.get(0);
  if (status.getJobState().isTerminalState()) {
    throw new Exception("Could not cancel job - job is not running any more");
  }
  JobID jobId=status.getJobId();
  Future<Object> response=jobManager.ask(new JobManagerMessages.CancelJob(jobId),askTimeout);
  try {
    Await.result(response,askTimeout);
  }
 catch (  Exception e) {
    throw new Exception("Sending the 'cancel' message failed.",e);
  }
}
