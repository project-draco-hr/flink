{
  if (!(this.getKeys() instanceof Keys.SelectorFunctionKeys)) {
    throw new InvalidProgramException("KeySelector group-sorting keys can only be used with KeySelector grouping keys.");
  }
  TypeInformation<K> keyType=TypeExtractor.getKeySelectorTypes(keySelector,this.dataSet.getType());
  SortedGrouping<T> sg=new SortedGrouping<T>(this.dataSet,this.keys,new Keys.SelectorFunctionKeys<T,K>(keySelector,this.dataSet.getType(),keyType),order);
  sg.customPartitioner=getCustomPartitioner();
  return sg;
}
