{
  KeyValuePair<Key,Value> pair=null;
  if (LOG.isInfoEnabled())   LOG.info(getLogString("Start PACT code"));
  final Iterator<FileInputSplit> splitIterator=getFileInputSplits();
  boolean immutable=config.getMutability() == DataSourceConfig.Mutability.IMMUTABLE;
  while (!this.taskCanceled && splitIterator.hasNext()) {
    final FileInputSplit split=splitIterator.next();
    final long start=split.getStart();
    final long length=split.getLength();
    if (LOG.isDebugEnabled())     LOG.debug(getLogString("Opening input split " + split.getPath()));
    FSDataInputStream fdis=null;
    InputSplitOpenThread isot=new InputSplitOpenThread(split);
    isot.start();
    try {
      isot.join();
    }
 catch (    InterruptedException ie) {
      if (isot.getFSDataInputStream() != null) {
        isot.getFSDataInputStream().close();
      }
    }
    if (!this.taskCanceled) {
      try {
        if (!isot.fsDataInputStreamSuccessfullyObtained()) {
          throw isot.getException();
        }
        fdis=isot.getFSDataInputStream();
        format.setInput(fdis,start,length,(1024 * 1024));
        format.open();
        if (LOG.isDebugEnabled())         LOG.debug(getLogString("Starting reader on file " + split.getPath()));
        if (!immutable) {
          pair=format.createPair();
        }
        while (!this.taskCanceled && !format.reachedEnd()) {
          if (immutable) {
            pair=format.createPair();
          }
          boolean valid=format.nextPair(pair);
          if (valid) {
            output.collect(pair.getKey(),pair.getValue());
          }
        }
        if (LOG.isDebugEnabled())         LOG.debug(getLogString("Closing input split " + split.getPath()));
      }
 catch (      Exception ex) {
        if (!this.taskCanceled) {
          if (LOG.isErrorEnabled())           LOG.error(getLogString("Unexpected ERROR in PACT code"));
          throw ex;
        }
      }
 finally {
        if (format != null) {
          try {
            format.closeInput();
          }
 catch (          IOException ioe) {
            LOG.error("Exception caught while closing input of InputFormat");
            throw ioe;
          }
          try {
            format.close();
          }
 catch (          IOException ioe) {
            LOG.error("Exception caught while closing InputFormat");
            throw ioe;
          }
        }
      }
    }
  }
  if (!this.taskCanceled) {
    if (LOG.isInfoEnabled())     LOG.info(getLogString("Finished PACT code"));
  }
 else {
    if (LOG.isWarnEnabled())     LOG.warn(getLogString("PACT code cancelled"));
  }
}
