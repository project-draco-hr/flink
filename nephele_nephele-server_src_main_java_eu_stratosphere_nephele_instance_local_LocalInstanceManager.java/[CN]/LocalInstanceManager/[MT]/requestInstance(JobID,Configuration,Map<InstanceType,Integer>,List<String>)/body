{
  final Iterator<Map.Entry<InstanceType,Integer>> it=instanceMap.entrySet().iterator();
  while (it.hasNext()) {
    final Map.Entry<InstanceType,Integer> entry=it.next();
    for (int i=0; i < entry.getValue().intValue(); i++) {
      boolean assignmentSuccessful=false;
      AllocatedResource allocatedResource=null;
synchronized (this.synchronizationObject) {
        if (this.localInstance != null) {
          if (this.allocatedResource == null) {
            allocatedResource=new AllocatedResource(this.localInstance,entry.getKey(),new AllocationID());
            this.allocatedResource=allocatedResource;
            assignmentSuccessful=true;
          }
        }
      }
      if (assignmentSuccessful) {
        new LocalInstanceNotifier(this.instanceListener,jobID,allocatedResource).start();
      }
 else {
        throw new InstanceException("No instance of type " + entry.getKey() + " available");
      }
    }
  }
}
