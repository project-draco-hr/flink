{
  FileDataSource initialInput=new FileDataSource(TextInputFormat.class,input,"input");
  BulkIteration iteration=new BulkIteration("Loop");
  iteration.setInput(initialInput);
  iteration.setMaximumNumberOfIterations(5);
  Assert.assertTrue(iteration.getMaximumNumberOfIterations() > 1);
  ReduceOperator sumReduce=ReduceOperator.builder(new SumReducer()).input(iteration.getPartialSolution()).name("Compute sum (Reduce)").build();
  iteration.setNextPartialSolution(sumReduce);
  MapOperator terminationMapper=MapOperator.builder(new TerminationMapper()).input(sumReduce).name("Compute termination criterion (Map)").build();
  iteration.setTerminationCriterion(terminationMapper);
  FileDataSink finalResult=new FileDataSink(CsvOutputFormat.class,output,iteration,"Output");
  CsvOutputFormat.configureRecordFormat(finalResult).recordDelimiter('\n').fieldDelimiter(' ').field(StringValue.class,0);
  Plan plan=new Plan(finalResult,"Iteration with AllReducer (keyless Reducer)");
  plan.setDefaultParallelism(numSubTasks);
  Assert.assertTrue(plan.getDefaultParallelism() > 1);
  return plan;
}
