{
  if (node == null) {
    throw new NullPointerException();
  }
  if (node.isMissing()) {
    return this.remove(index);
  }
  if (index < 0 || index >= this.size()) {
    if (index == this.size()) {
      this.add(node);
      return MissingNode.getInstance();
    }
 else {
      throw new IndexOutOfBoundsException();
    }
  }
  if (index < this.schema.getHeadSize()) {
    for (int i=0; i < index; i++) {
      if (this.record.isNull(i))       throw new IndexOutOfBoundsException();
    }
    IJsonNode oldNode=SopremoUtil.unwrap(this.record.getField(index,JsonNodeWrapper.class));
    this.record.setField(index,node);
    return oldNode;
  }
 else {
    return this.getOtherField().set(index - this.schema.getHeadSize(),node);
  }
}
