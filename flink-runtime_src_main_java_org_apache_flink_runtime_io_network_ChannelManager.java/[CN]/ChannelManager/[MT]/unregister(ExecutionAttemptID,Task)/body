{
  final Environment environment=task.getEnvironment();
  if (environment == null) {
    return;
  }
  for (  ChannelID id : environment.getOutputChannelIDs()) {
    Channel channel=this.channels.remove(id);
    if (channel != null) {
      channel.destroy();
      removeFromReceiverCacheAndMaybeCloseTcpConnection(channel);
    }
  }
  for (  ChannelID id : environment.getInputChannelIDs()) {
    Channel channel=this.channels.remove(id);
    if (channel != null) {
      channel.destroy();
      removeFromReceiverCacheAndMaybeCloseTcpConnection(channel);
    }
  }
  for (  GateID id : environment.getInputGateIDs()) {
    LocalBufferPoolOwner bufferPool=this.localBuffersPools.remove(id);
    if (bufferPool != null) {
      bufferPool.clearLocalBufferPool();
    }
  }
  LocalBufferPoolOwner bufferPool=this.localBuffersPools.remove(executionId);
  if (bufferPool != null) {
    bufferPool.clearLocalBufferPool();
  }
  redistributeBuffers();
}
