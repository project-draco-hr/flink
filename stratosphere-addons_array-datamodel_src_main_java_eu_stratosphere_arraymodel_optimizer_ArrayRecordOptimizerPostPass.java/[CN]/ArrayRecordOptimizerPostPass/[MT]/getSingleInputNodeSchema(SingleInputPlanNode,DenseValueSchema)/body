{
  SingleInputOperator<?> contract=(SingleInputOperator<?>)node.getSingleInputNode().getPactContract();
  Function stub=contract.getUserCodeWrapper().getUserCodeObject();
  if (AbstractArrayModelFunction.class.isAssignableFrom(stub.getClass())) {
    AbstractArrayModelFunction ams=(AbstractArrayModelFunction)stub;
    Class<? extends Value>[] types=ams.getDataTypes(0);
    if (types == null) {
      throw new CompilerPostPassException("Missing type annotation in UDF for '" + contract.getName() + "'.");
    }
    addToSchema(types,schema);
    schema.setNumFields(types.length);
  }
 else {
    throw new CompilerException("Incompatibe stub type. Array data model programs require array data model stubs.");
  }
}
