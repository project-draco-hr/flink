{
  isRunning=true;
  try {
    if (streaming) {
      collectMessages(collector);
    }
 else {
      collectFiniteMessages(collector);
    }
  }
  finally {
    closeConnection();
    isRunning=false;
  }
}
