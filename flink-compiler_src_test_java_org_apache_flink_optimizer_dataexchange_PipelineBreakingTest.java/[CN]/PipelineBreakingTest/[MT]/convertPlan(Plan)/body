{
  PactCompiler.GraphCreatingVisitor dagCreator=new PactCompiler.GraphCreatingVisitor(17,p.getExecutionConfig().getExecutionMode());
  p.accept(dagCreator);
  List<DataSinkNode> sinks=dagCreator.getSinks();
  OptimizerNode rootNode;
  if (sinks.size() == 1) {
    rootNode=sinks.get(0);
  }
 else {
    Iterator<DataSinkNode> iter=sinks.iterator();
    rootNode=iter.next();
    while (iter.hasNext()) {
      rootNode=new SinkJoiner(rootNode,iter.next());
    }
  }
  rootNode.accept(new PactCompiler.IdAndEstimatesVisitor(null));
  rootNode.accept(new PactCompiler.BranchesVisitor());
  return sinks;
}
