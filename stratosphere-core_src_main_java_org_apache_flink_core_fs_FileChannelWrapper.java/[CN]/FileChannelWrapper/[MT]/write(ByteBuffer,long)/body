{
  if (position != this.nextExpectedWritePosition) {
    throw new IOException("Next expected write position is " + this.nextExpectedWritePosition);
  }
  final FSDataOutputStream outputStream=getOutputStream();
  int totalBytesWritten=0;
  while (src.hasRemaining()) {
    final int length=Math.min(this.buf.length,src.remaining());
    src.get(this.buf,0,length);
    outputStream.write(this.buf,0,length);
    totalBytesWritten+=length;
  }
  this.nextExpectedWritePosition+=totalBytesWritten;
  return totalBytesWritten;
}
