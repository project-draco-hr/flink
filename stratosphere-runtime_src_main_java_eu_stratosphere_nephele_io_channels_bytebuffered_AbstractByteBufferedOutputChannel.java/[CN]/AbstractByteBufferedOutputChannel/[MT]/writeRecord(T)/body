{
  if (this.dataBuffer == null) {
    requestWriteBufferFromBroker();
  }
  if (this.closeRequested) {
    throw new IOException("Channel is aready requested to be closed");
  }
  while (this.serializationBuffer.dataLeftFromPreviousSerialization()) {
    this.serializationBuffer.read(this.dataBuffer);
    if (this.dataBuffer.remaining() == 0) {
      releaseWriteBuffer();
      requestWriteBufferFromBroker();
    }
  }
  if (this.serializationBuffer.dataLeftFromPreviousSerialization()) {
    throw new IOException("Serialization buffer is expected to be empty!");
  }
  this.serializationBuffer.serialize(record);
  this.serializationBuffer.read(this.dataBuffer);
  if (this.dataBuffer.remaining() == 0) {
    releaseWriteBuffer();
  }
}
