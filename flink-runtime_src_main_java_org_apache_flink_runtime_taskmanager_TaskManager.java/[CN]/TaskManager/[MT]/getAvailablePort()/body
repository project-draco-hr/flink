{
  ServerSocket serverSocket=null;
  int port=0;
  for (int i=0; i < 50; i++) {
    try {
      serverSocket=new ServerSocket(0);
      port=serverSocket.getLocalPort();
      if (port != 0) {
        serverSocket.close();
        break;
      }
    }
 catch (    IOException e) {
      LOG.debug("Unable to allocate port " + e.getMessage(),e);
    }
  }
  if (!serverSocket.isClosed()) {
    try {
      serverSocket.close();
    }
 catch (    IOException e) {
      LOG.debug("error closing port",e);
    }
  }
  return port;
}
