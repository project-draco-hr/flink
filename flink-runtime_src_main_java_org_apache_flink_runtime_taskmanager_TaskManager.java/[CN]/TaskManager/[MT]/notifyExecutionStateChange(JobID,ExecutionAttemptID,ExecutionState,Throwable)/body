{
  boolean success=false;
  try {
    success=this.jobManager.updateTaskExecutionState(new TaskExecutionState(jobID,executionId,newExecutionState,optionalError));
    if (!success) {
      Task task=runningTasks.get(executionId);
      if (task != null) {
        task.failExternally(new IllegalStateException("Task has been disposed on JobManager."));
      }
    }
  }
 catch (  Throwable t) {
    String msg="Error sending task state update to JobManager.";
    LOG.error(msg,t);
    ExceptionUtils.rethrow(t,msg);
  }
 finally {
    if (!success || newExecutionState == ExecutionState.FINISHED || newExecutionState == ExecutionState.CANCELED || newExecutionState == ExecutionState.FAILED) {
      unregisterTask(executionId);
    }
  }
}
