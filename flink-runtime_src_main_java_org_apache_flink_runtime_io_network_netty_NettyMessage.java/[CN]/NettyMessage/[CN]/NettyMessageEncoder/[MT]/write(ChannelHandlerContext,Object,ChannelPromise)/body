{
  if (msg instanceof NettyMessage) {
    try {
      ctx.write(((NettyMessage)msg).write(ctx.alloc()),promise);
    }
 catch (    Throwable t) {
      throw new IOException("Error while serializing message: " + msg,t);
    }
  }
 else {
    ctx.write(msg,promise);
  }
}
