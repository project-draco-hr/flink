{
  final ChannelType channelType;
  final DistributionPattern distributionPattern;
switch (connection.getShipStrategy()) {
case FORWARD:
case PARTITION_LOCAL_HASH:
case PARTITION_LOCAL_RANGE:
    distributionPattern=DistributionPattern.POINTWISE;
  channelType=ChannelType.INMEMORY;
break;
case BROADCAST:
case PARTITION_HASH:
case PARTITION_RANGE:
distributionPattern=DistributionPattern.BIPARTITE;
channelType=ChannelType.NETWORK;
break;
default :
throw new RuntimeException("Unknown runtime ship strategy: " + connection.getShipStrategy());
}
sourceVertex.connectTo(targetVertex,channelType,CompressionLevel.NO_COMPRESSION,distributionPattern);
sourceConfig.addInputToGroup(inputNumber);
final int outputIndex=sourceConfig.getNumOutputs();
sourceConfig.addOutputShipStrategy(connection.getShipStrategy());
if (outputIndex == 0) {
sourceConfig.setOutputSerializert(connection.getSerializer());
}
if (connection.getShipStrategyComparator() != null) {
sourceConfig.setOutputComparator(connection.getShipStrategyComparator(),outputIndex);
}
}
