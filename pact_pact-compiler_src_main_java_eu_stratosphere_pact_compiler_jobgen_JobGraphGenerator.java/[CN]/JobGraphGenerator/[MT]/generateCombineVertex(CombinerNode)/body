{
  final ReduceContract rc=combineNode.getPactContract();
  final JobTaskVertex combineVertex;
  final TaskConfig combineConfig;
  if (isChainable(combineNode)) {
    combineVertex=null;
    combineConfig=new TaskConfig(new Configuration());
    this.chainedTasks.put(combineNode,new TaskInChain(ChainedCombineTask.class,combineConfig,"Combiner for " + rc.getName()));
  }
 else {
    combineVertex=new JobTaskVertex("Combiner for " + combineNode.getPactContract().getName(),this.jobGraph);
    combineVertex.setTaskClass(CombineTask.class);
    combineConfig=new TaskConfig(combineVertex.getConfiguration());
  }
  combineConfig.setStubClass(combineNode.getPactContract().getUserCodeClass());
  combineConfig.setLocalStrategy(LocalStrategy.COMBININGSORT);
  final Ordering secondaryOrder=combineNode.getPactContract().getSecondaryOrder();
  if (secondaryOrder == null) {
    PactRecordComparatorFactory.writeComparatorSetupToConfig(combineConfig.getConfiguration(),combineConfig.getPrefixForInputParameters(0),combineNode.getPactContract().getKeyColumnNumbers(0),combineNode.getPactContract().getKeyClasses());
  }
 else {
    PactRecordComparatorFactory.writeComparatorSetupToConfig(combineConfig.getConfiguration(),combineConfig.getPrefixForInputParameters(0),combineNode.getPactContract().getKeyColumnNumbers(0),combineNode.getPactContract().getKeyClasses(),secondaryOrder.getFieldPositions(),secondaryOrder.getTypes());
  }
  assignMemory(combineConfig,combineNode.getMemoryPerTask());
  combineConfig.setStubParameters(combineNode.getPactContract().getParameters());
  return combineVertex;
}
