{
  final MapContract mc=((MapNode)mapNode).getPactContract();
  final JobTaskVertex mapVertex;
  final TaskConfig mapConfig;
  if (isChainable(mapNode)) {
    mapVertex=null;
    mapConfig=new TaskConfig(new Configuration());
    this.chainedTasks.put(mapNode,new TaskInChain(ChainedMapDriver.class,mapConfig,mc.getName()));
  }
 else {
    mapVertex=new JobTaskVertex(mapNode.getPactContract().getName(),this.jobGraph);
    mapConfig=new TaskConfig(mapVertex.getConfiguration());
    mapVertex.setTaskClass(RegularPactTask.class);
    mapConfig.setDriver(MapDriver.class);
  }
  mapConfig.setStubClass(mc.getUserCodeClass());
switch (mapNode.getLocalStrategy()) {
case NONE:
    mapConfig.setLocalStrategy(LocalStrategy.NONE);
  break;
default :
throw new CompilerException("Invalid local strategy for 'Map' (" + mapNode.getName() + "): "+ mapNode.getLocalStrategy());
}
mapConfig.setStubParameters(mapNode.getPactContract().getParameters());
return mapVertex;
}
