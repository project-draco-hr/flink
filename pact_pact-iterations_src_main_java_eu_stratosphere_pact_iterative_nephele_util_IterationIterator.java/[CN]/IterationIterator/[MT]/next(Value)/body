{
  if (closed) {
    return false;
  }
  while (true) {
    try {
      boolean success=iter.next(target);
      if (!success) {
        throw new RuntimeException("Channel is not closed but exhausted");
      }
      return success;
    }
 catch (    StateChangeException ex) {
      if (listener.isChanged()) {
        ChannelState state=listener.getState();
        if (state == ChannelState.CLOSED) {
          closed=true;
          return false;
        }
 else {
          throw new RuntimeException("Should never happen");
        }
      }
    }
  }
}
