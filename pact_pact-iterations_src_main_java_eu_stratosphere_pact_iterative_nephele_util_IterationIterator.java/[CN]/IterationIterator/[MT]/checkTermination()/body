{
  while (true) {
    try {
      boolean success=iter.next(dummyRecord);
      if (success) {
        throw new RuntimeException("Record received but only events were expected");
      }
 else {
        return true;
      }
    }
 catch (    StateChangeException ex) {
      if (listener.isChanged()) {
        if (listener.getState() == ChannelState.OPEN) {
          closed=false;
          return false;
        }
 else {
          throw new RuntimeException("Only expected state change is to open" + listener.getState());
        }
      }
    }
  }
}
