{
  final TaskManagerMetricGroup group=new TaskManagerMetricGroup(new MetricRegistry(new Configuration()),"localhost",new AbstractID().toString());
  final JobID jid1=new JobID();
  final JobID jid2=new JobID();
  final String jobName1="testjob";
  final String jobName2="anotherJob";
  final AbstractID vertex11=new AbstractID();
  final AbstractID vertex12=new AbstractID();
  final AbstractID vertex13=new AbstractID();
  final AbstractID vertex21=new AbstractID();
  final AbstractID execution11=new AbstractID();
  final AbstractID execution12=new AbstractID();
  final AbstractID execution13=new AbstractID();
  final AbstractID execution21=new AbstractID();
  TaskMetricGroup tmGroup11=group.addTaskForJob(jid1,jobName1,vertex11,execution11,17,"test");
  TaskMetricGroup tmGroup12=group.addTaskForJob(jid1,jobName1,vertex12,execution12,13,"test");
  TaskMetricGroup tmGroup21=group.addTaskForJob(jid2,jobName2,vertex21,execution21,7,"test");
  assertEquals(2,group.numRegisteredJobMetricGroups());
  assertFalse(tmGroup11.parent().isClosed());
  assertFalse(tmGroup12.parent().isClosed());
  assertFalse(tmGroup21.parent().isClosed());
  tmGroup11.close();
  tmGroup21.close();
  assertTrue(tmGroup11.isClosed());
  assertTrue(tmGroup21.isClosed());
  assertFalse(tmGroup11.parent().isClosed());
  assertFalse(tmGroup12.parent().isClosed());
  assertTrue(tmGroup21.parent().isClosed());
  assertEquals(1,group.numRegisteredJobMetricGroups());
  TaskMetricGroup tmGroup13=group.addTaskForJob(jid1,jobName1,vertex13,execution13,0,"test");
  tmGroup12.close();
  tmGroup13.close();
  assertTrue(tmGroup11.parent().isClosed());
  assertTrue(tmGroup12.parent().isClosed());
  assertTrue(tmGroup13.parent().isClosed());
  assertEquals(0,group.numRegisteredJobMetricGroups());
}
