{
  final boolean[] callme={false};
  try {
    String[] arguments={"-c",TEST_JAR_CLASSLOADERTEST_CLASS,getTestJarPath(),"true","arg1","arg2"};
    String[] progArgs={"true","arg1","arg2"};
    InfoOptions options=CliFrontendParser.parseInfoCommand(arguments);
    assertEquals(getTestJarPath(),options.getJarFilePath());
    assertEquals(TEST_JAR_CLASSLOADERTEST_CLASS,options.getEntryPointClassName());
    assertArrayEquals(progArgs,options.getProgramArgs());
    CliFrontend frontend=new CliFrontend(CliFrontendTestUtils.getConfigDir());
    PackagedProgram prog=spy(frontend.buildProgram(options));
    ClassLoader testClassLoader=new ClassLoader(prog.getUserCodeClassLoader()){
      @Override public Class<?> loadClass(      String name) throws ClassNotFoundException {
        if ("org.apache.hadoop.hive.ql.io.RCFileInputFormat".equals(name)) {
          callme[0]=true;
          return String.class;
        }
 else {
          return super.loadClass(name);
        }
      }
    }
;
    when(prog.getUserCodeClassLoader()).thenReturn(testClassLoader);
    assertEquals(TEST_JAR_CLASSLOADERTEST_CLASS,prog.getMainClassName());
    assertArrayEquals(progArgs,prog.getArguments());
    Configuration c=new Configuration();
    c.setString(ConfigConstants.JOB_MANAGER_IPC_ADDRESS_KEY,"devil");
    Client cli=new Client(c,getClass().getClassLoader());
    cli.getOptimizedPlanAsJson(prog,666);
  }
 catch (  ProgramInvocationException pie) {
    assertTrue("Classloader was not called",callme[0]);
    if (!(pie.getCause() instanceof ClassNotFoundException)) {
      System.err.println(pie.getMessage());
      pie.printStackTrace();
      fail("Program caused an exception: " + pie.getMessage());
    }
  }
catch (  Exception e) {
    System.err.println(e.getMessage());
    e.printStackTrace();
    assertTrue("Classloader was not called",callme[0]);
    fail("Program caused an exception: " + e.getMessage());
  }
}
