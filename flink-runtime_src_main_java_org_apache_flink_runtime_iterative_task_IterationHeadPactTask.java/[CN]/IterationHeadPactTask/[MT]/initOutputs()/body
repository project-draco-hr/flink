{
  super.initOutputs();
  this.finalOutputWriters=new ArrayList<RecordWriter<?>>();
  final TaskConfig finalOutConfig=this.config.getIterationHeadFinalOutputConfig();
  final ClassLoader userCodeClassLoader=getUserCodeClassLoader();
  this.finalOutputCollector=RegularPactTask.getOutputCollector(this,finalOutConfig,userCodeClassLoader,this.finalOutputWriters,config.getNumOutputs(),finalOutConfig.getNumOutputs());
  final int writersIntoStepFunction=this.eventualOutputs.size();
  final int writersIntoFinalResult=this.finalOutputWriters.size();
  final int syncGateIndex=this.config.getIterationHeadIndexOfSyncOutput();
  if (writersIntoStepFunction + writersIntoFinalResult != syncGateIndex) {
    throw new Exception("Error: Inconsistent head task setup - wrong mapping of output gates.");
  }
  this.toSync=getEnvironment().getWriter(syncGateIndex);
}
