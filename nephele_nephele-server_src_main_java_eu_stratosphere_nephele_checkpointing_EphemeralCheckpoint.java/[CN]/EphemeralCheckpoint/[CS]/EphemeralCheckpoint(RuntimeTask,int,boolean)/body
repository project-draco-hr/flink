{
  this.task=task;
  this.totalNumberOfOutputChannels=totalNumberOfOutputChannels;
  this.checkpointingDecision=(ephemeral ? CheckpointingDecisionState.UNDECIDED : CheckpointingDecisionState.CHECKPOINTING);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Created checkpoint for vertex " + task.getVertexID() + ", state "+ this.checkpointingDecision);
  }
  if (this.checkpointingDecision == CheckpointingDecisionState.CHECKPOINTING) {
    try {
      this.task.checkpointStateChanged(CheckpointState.PARTIAL);
    }
 catch (    Exception e) {
      LOG.error(StringUtils.stringifyException(e));
    }
    this.writeThread=new WriteThread(FileBufferManager.getInstance(),this.task.getVertexID(),this.totalNumberOfOutputChannels);
    this.writeThread.start();
  }
}
