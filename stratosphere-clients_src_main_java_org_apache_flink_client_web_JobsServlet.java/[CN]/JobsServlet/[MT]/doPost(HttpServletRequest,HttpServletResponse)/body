{
  if (!ServletFileUpload.isMultipartContent(req)) {
    resp.sendError(HttpServletResponse.SC_BAD_REQUEST);
    return;
  }
  DiskFileItemFactory fileItemFactory=new DiskFileItemFactory();
  fileItemFactory.setSizeThreshold(20 * 1024 * 1024);
  fileItemFactory.setRepository(tmpDir);
  String filename=null;
  ServletFileUpload uploadHandler=new ServletFileUpload(fileItemFactory);
  try {
    @SuppressWarnings("unchecked") Iterator<FileItem> itr=((List<FileItem>)uploadHandler.parseRequest(req)).iterator();
    while (itr.hasNext()) {
      FileItem item=itr.next();
      if (!item.isFormField()) {
        if (item.getFieldName().equals("upload_jar_file")) {
          filename=item.getName();
          File file=new File(destinationDir,filename);
          item.write(file);
          break;
        }
      }
    }
  }
 catch (  FileUploadException ex) {
    resp.sendError(HttpServletResponse.SC_NOT_ACCEPTABLE,"Invalid Fileupload.");
    return;
  }
catch (  Exception ex) {
    resp.sendError(HttpServletResponse.SC_INTERNAL_SERVER_ERROR,"An unknown error occurred during the file upload.");
    return;
  }
  resp.sendRedirect(targetPage);
}
