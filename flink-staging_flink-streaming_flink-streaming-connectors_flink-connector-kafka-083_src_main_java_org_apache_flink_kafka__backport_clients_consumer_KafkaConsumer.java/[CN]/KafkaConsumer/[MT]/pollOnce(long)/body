{
  coordinator.ensureCoordinatorKnown();
  if (subscriptions.partitionsAutoAssigned())   coordinator.ensurePartitionAssignment();
  if (!subscriptions.hasAllFetchPositions())   updateFetchPositions(this.subscriptions.missingFetchPositions());
  Cluster cluster=this.metadata.fetch();
  fetcher.initFetches(cluster);
  client.poll(timeout);
  return fetcher.fetchedRecords();
}
