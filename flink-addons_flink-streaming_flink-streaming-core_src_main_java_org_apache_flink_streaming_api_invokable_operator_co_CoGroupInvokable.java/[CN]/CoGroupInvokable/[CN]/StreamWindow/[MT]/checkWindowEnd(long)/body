{
  nextRecordTime=timeStamp;
  while (miniBatchEnd()) {
    circularList1.newSlide();
    circularList2.newSlide();
    minibatchCounter++;
    if (windowEnd()) {
      callUserFunctionAndLogException();
      circularList1.shiftWindow(batchPerSlide);
      circularList2.shiftWindow(batchPerSlide);
    }
  }
}
