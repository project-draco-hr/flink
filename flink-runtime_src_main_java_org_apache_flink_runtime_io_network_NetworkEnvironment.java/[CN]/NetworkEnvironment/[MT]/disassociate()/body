{
synchronized (lock) {
    if (!isAssociated()) {
      return;
    }
    LOG.debug("Disassociating NetworkEnvironment from TaskManager. Cleaning all intermediate results.");
    kvStateRegistry=null;
    if (kvStateServer != null) {
      try {
        kvStateServer.shutDown();
      }
 catch (      Throwable t) {
        throw new IOException("Cannot shutdown KvStateNettyServer",t);
      }
      kvStateServer=null;
    }
    if (connectionManager != null) {
      try {
        LOG.debug("Shutting down network connection manager");
        connectionManager.shutdown();
        connectionManager=null;
      }
 catch (      Throwable t) {
        throw new IOException("Cannot shutdown network connection manager",t);
      }
    }
    if (partitionManager != null) {
      try {
        LOG.debug("Shutting down intermediate result partition manager");
        partitionManager.shutdown();
        partitionManager=null;
      }
 catch (      Throwable t) {
        throw new IOException("Cannot shutdown partition manager",t);
      }
    }
    partitionConsumableNotifier=null;
    partitionStateChecker=null;
    if (taskEventDispatcher != null) {
      taskEventDispatcher.clearAll();
      taskEventDispatcher=null;
    }
    networkBufferPool.destroyAllBufferPools();
  }
}
