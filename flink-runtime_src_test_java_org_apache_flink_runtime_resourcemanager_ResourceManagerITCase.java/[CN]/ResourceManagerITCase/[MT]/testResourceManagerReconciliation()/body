{
  new JavaTestKit(system){
{
      new Within(duration("10 seconds")){
        @Override protected void run(){
          ActorGateway jobManager=TestingUtils.createJobManager(system,config,"ReconciliationTest");
          ActorGateway me=TestingUtils.createForwardingActor(system,getTestActor(),Option.<String>empty());
          ResourceID resourceID=ResourceID.generate();
          jobManager.tell(new RegistrationMessages.RegisterTaskManager(resourceID,Mockito.mock(InstanceConnectionInfo.class),null,1),me);
          expectMsgClass(RegistrationMessages.AcknowledgeRegistration.class);
          ActorGateway resourceManager=TestingUtils.createResourceManager(system,jobManager.actor(),config);
          resourceManager.tell(new TestingResourceManager.NotifyWhenResourceManagerConnected(),me);
          expectMsgEquals(Messages.getAcknowledge());
          resourceManager.tell(new TestingResourceManager.GetRegisteredResources(),me);
          TestingResourceManager.GetRegisteredResourcesReply reply=expectMsgClass(TestingResourceManager.GetRegisteredResourcesReply.class);
          assertEquals(1,reply.resources.size());
          assertTrue(reply.resources.contains(resourceID));
        }
      }
;
    }
  }
;
}
