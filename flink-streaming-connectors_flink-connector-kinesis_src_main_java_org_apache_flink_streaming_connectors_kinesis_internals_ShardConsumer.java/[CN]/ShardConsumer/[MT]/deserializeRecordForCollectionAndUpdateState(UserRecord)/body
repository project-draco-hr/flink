{
  ByteBuffer recordData=record.getData();
  byte[] dataBytes=new byte[recordData.remaining()];
  recordData.get(dataBytes);
  byte[] keyBytes=record.getPartitionKey().getBytes();
  final long approxArrivalTimestamp=record.getApproximateArrivalTimestamp().getTime();
  final T value=deserializer.deserialize(keyBytes,dataBytes,subscribedShard.getStreamName(),record.getSequenceNumber(),approxArrivalTimestamp);
  if (record.isAggregated()) {
    fetcherRef.emitRecordAndUpdateState(value,approxArrivalTimestamp,subscribedShardStateIndex,new SequenceNumber(record.getSequenceNumber(),record.getSubSequenceNumber()));
  }
 else {
    fetcherRef.emitRecordAndUpdateState(value,approxArrivalTimestamp,subscribedShardStateIndex,new SequenceNumber(record.getSequenceNumber()));
  }
}
