{
  ByteBuffer recordData=record.getData();
  byte[] dataBytes=new byte[recordData.remaining()];
  recordData.get(dataBytes);
  final long approxArrivalTimestamp=record.getApproximateArrivalTimestamp().getTime();
  final T value=deserializer.deserialize(dataBytes,record.getPartitionKey(),record.getSequenceNumber(),approxArrivalTimestamp,subscribedShard.getStreamName(),subscribedShard.getShard().getShardId());
  if (record.isAggregated()) {
    fetcherRef.emitRecordAndUpdateState(value,approxArrivalTimestamp,subscribedShardStateIndex,new SequenceNumber(record.getSequenceNumber(),record.getSubSequenceNumber()));
  }
 else {
    fetcherRef.emitRecordAndUpdateState(value,approxArrivalTimestamp,subscribedShardStateIndex,new SequenceNumber(record.getSequenceNumber()));
  }
}
