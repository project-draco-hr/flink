{
  if (partitioned) {
    if (statePartitioner != null) {
      return new PartitionedStreamOperatorState(provider,statePartitioner,cl);
    }
 else {
      throw new RuntimeException("A partitioning key must be provided for pastitioned state.");
    }
  }
 else {
    return new StreamOperatorState(provider);
  }
}
