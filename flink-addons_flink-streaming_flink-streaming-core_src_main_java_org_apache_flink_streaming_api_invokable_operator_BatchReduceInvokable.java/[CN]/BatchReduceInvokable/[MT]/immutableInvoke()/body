{
  reuse=loadNextRecord();
  ArrayList<IN> list;
  while (!state.isFull()) {
    list=new ArrayList<IN>(granularity);
    try {
      state.pushBack(fillArray(list));
    }
 catch (    NullPointerException e) {
      throw new RuntimeException("DataStream length must be greater than batchsize");
    }
  }
  boolean go=reduce();
  while (go) {
    if (state.isEmittable()) {
      go=reduce();
    }
 else {
      list=(ArrayList<IN>)state.popFront();
      list.clear();
      state.pushBack(fillArray(list));
      emitted=false;
      go=reuse != null;
    }
  }
  if (!emitted) {
    reduce();
  }
}
