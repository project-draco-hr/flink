{
  if (miniBatchInProgress()) {
    addToBuffer();
  }
  if (minibatchCounter >= 0) {
    for (long i=0; i < (numberOfBatches - minibatchCounter); i++) {
      circularBuffer.remove();
    }
    if (!circularBuffer.isEmpty()) {
      reduce(this);
    }
  }
}
