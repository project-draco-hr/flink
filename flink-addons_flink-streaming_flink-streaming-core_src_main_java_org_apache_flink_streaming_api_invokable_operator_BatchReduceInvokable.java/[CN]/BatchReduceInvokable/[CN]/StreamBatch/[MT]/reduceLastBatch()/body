{
  if (miniBatchInProgress()) {
    addToBuffer();
  }
  if (changed == true && minibatchCounter >= 0) {
    if (circularBuffer.isFull()) {
      for (long i=0; i < (numberOfBatches - minibatchCounter); i++) {
        if (!circularBuffer.isEmpty()) {
          circularBuffer.remove();
        }
      }
    }
    if (!circularBuffer.isEmpty()) {
      reduce(this);
    }
  }
}
