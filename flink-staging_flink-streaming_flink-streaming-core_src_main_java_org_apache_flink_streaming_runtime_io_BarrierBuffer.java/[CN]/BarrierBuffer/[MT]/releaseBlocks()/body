{
  if (LOG.isDebugEnabled()) {
    LOG.debug("Releasing blocks");
  }
  for (int i=0; i < blockedChannels.length; i++) {
    blockedChannels[i]=false;
  }
  numReceivedBarriers=0;
  if (nonProcessed.isEmpty()) {
    ArrayDeque<SpillingBufferOrEvent> empty=nonProcessed;
    nonProcessed=blockedNonProcessed;
    blockedNonProcessed=empty;
  }
 else {
    throw new IllegalStateException("Unconsumed data from previous checkpoint alignment " + "when starting next checkpoint alignment");
  }
  spillReader.setSpillFile(bufferSpiller.getSpillFile());
  bufferSpiller.resetSpillFile();
}
