{
  if (!nonProcessed.isEmpty()) {
    throw new RuntimeException("Error in barrier buffer logic");
  }
  nonProcessed=blockedNonProcessed;
  blockedNonProcessed=new LinkedList<SpillingBufferOrEvent>();
  try {
    spillReader.setSpillFile(bufferSpiller.getSpillFile());
    bufferSpiller.resetSpillFile();
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
  blockedChannels.clear();
  currentBarrier=null;
  if (LOG.isDebugEnabled()) {
    LOG.debug("All barriers received, blocks released");
  }
}
