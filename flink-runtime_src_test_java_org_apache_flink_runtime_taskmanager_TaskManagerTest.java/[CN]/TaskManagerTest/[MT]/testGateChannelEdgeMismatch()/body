{
  new JavaTestKit(system){
{
      try {
        ActorRef jm=system.actorOf(Props.create(SimpleJobManager.class));
        final ActorRef tm=createTaskManager(jm);
        final JobID jid=new JobID();
        JobVertexID vid1=new JobVertexID();
        JobVertexID vid2=new JobVertexID();
        final ExecutionAttemptID eid1=new ExecutionAttemptID();
        final ExecutionAttemptID eid2=new ExecutionAttemptID();
        final TaskDeploymentDescriptor tdd1=new TaskDeploymentDescriptor(jid,vid1,eid1,"Sender",0,1,new Configuration(),new Configuration(),Sender.class.getName(),Collections.<GateDeploymentDescriptor>emptyList(),Collections.<GateDeploymentDescriptor>emptyList(),new ArrayList<BlobKey>(),0);
        final TaskDeploymentDescriptor tdd2=new TaskDeploymentDescriptor(jid,vid2,eid2,"Receiver",2,7,new Configuration(),new Configuration(),Receiver.class.getName(),Collections.<GateDeploymentDescriptor>emptyList(),Collections.<GateDeploymentDescriptor>emptyList(),new ArrayList<BlobKey>(),0);
        new Within(duration("1 second")){
          @Override protected void run(){
            try {
              tm.tell(new SubmitTask(tdd1),getRef());
              tm.tell(new SubmitTask(tdd2),getRef());
              TaskOperationResult result=expectMsgClass(TaskOperationResult.class);
              assertFalse(result.success());
              assertEquals(eid1,result.executionID());
              result=expectMsgClass(TaskOperationResult.class);
              assertFalse(result.success());
              assertEquals(eid2,result.executionID());
              tm.tell(new TestingTaskManagerMessages.NotifyWhenTaskRemoved(eid1),getRef());
              tm.tell(new TestingTaskManagerMessages.NotifyWhenTaskRemoved(eid2),getRef());
              expectMsgEquals(true);
              expectMsgEquals(true);
              tm.tell(TestingTaskManagerMessages.getRequestRunningTasksMessage(),getRef());
              Map<ExecutionAttemptID,Task> tasks=expectMsgClass(TestingTaskManagerMessages.ResponseRunningTasks.class).asJava();
              assertEquals(0,tasks.size());
            }
 catch (            Exception e) {
              e.printStackTrace();
              fail(e.getMessage());
            }
          }
        }
;
      }
 catch (      Exception e) {
        e.printStackTrace();
        fail(e.getMessage());
      }
    }
  }
;
}
