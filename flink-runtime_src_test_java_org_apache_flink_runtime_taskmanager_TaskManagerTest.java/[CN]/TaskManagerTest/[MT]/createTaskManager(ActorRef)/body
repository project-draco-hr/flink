{
  Configuration cfg=new Configuration();
  cfg.setInteger(ConfigConstants.TASK_MANAGER_MEMORY_SIZE_KEY,10);
  String jobManagerURL=jm.path().toString();
  ActorRef taskManager=TestingUtils.startTestingTaskManagerWithConfiguration("localhost",jobManagerURL,cfg,system);
  Future<Object> response=Patterns.ask(taskManager,TaskManagerMessages.getNotifyWhenRegisteredAtJobManagerMessage(),timeout);
  try {
    FiniteDuration d=new FiniteDuration(20,TimeUnit.SECONDS);
    Await.ready(response,d);
  }
 catch (  Exception e) {
    throw new RuntimeException("Exception while waiting for the task manager registration.",e);
  }
  return taskManager;
}
