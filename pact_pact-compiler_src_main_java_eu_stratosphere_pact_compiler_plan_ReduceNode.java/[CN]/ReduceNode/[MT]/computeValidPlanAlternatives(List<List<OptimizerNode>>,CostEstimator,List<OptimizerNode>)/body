{
  FieldSet keySet=new FieldSet(getPactContract().getKeyColumnNumbers(0));
  for (  List<OptimizerNode> predList : alternativeSubPlanCominations) {
    ShipStrategy ss=ShipStrategy.NONE;
    for (    PactConnection c : this.input) {
      ShipStrategy newSS=c.getShipStrategy();
      if (newSS == ShipStrategy.BROADCAST || newSS == ShipStrategy.SFR)       continue;
      if (ss == ShipStrategy.NONE) {
        ss=newSS;
        continue;
      }
      if (ss == newSS)       continue;
      continue;
    }
    GlobalProperties gp;
    LocalProperties lp;
    if (ss == ShipStrategy.NONE) {
      if (predList.size() == 1) {
        gp=predList.get(0).getGlobalProperties();
        lp=predList.get(0).getLocalProperties();
        if ((partitioningIsOnRightFields(gp) && gp.getPartitioning().isPartitioned()) || isFieldSetUnique(keySet)) {
          ss=ShipStrategy.FORWARD;
        }
 else {
          ss=ShipStrategy.PARTITION_HASH;
        }
        gp=PactConnection.getGlobalPropertiesAfterConnection(predList.get(0),this,ss);
        lp=PactConnection.getLocalPropertiesAfterConnection(predList.get(0),this,ss);
      }
 else {
        gp=new GlobalProperties();
        lp=new LocalProperties();
        ss=ShipStrategy.PARTITION_HASH;
      }
    }
 else {
      if (predList.size() == 1) {
        gp=PactConnection.getGlobalPropertiesAfterConnection(predList.get(0),this,ss);
        lp=PactConnection.getLocalPropertiesAfterConnection(predList.get(0),this,ss);
      }
 else {
        gp=new GlobalProperties();
        lp=new LocalProperties();
      }
      if (!((partitioningIsOnRightFields(gp) && gp.getPartitioning().isPartitioned()) || isFieldSetUnique(keySet))) {
        continue;
      }
    }
    boolean localStrategyNeeded=false;
    if (lp.getOrdering() == null || lp.getOrdering().groupsFieldSet(keySet) == false) {
      localStrategyNeeded=true;
    }
    if (localStrategyNeeded && lp.isGrouped() == true) {
      localStrategyNeeded=!lp.getGroupedFields().equals(keySet);
    }
    if (localStrategyNeeded) {
      localStrategyNeeded=!isFieldSetUnique(keySet);
    }
    LocalStrategy ls=getLocalStrategy();
    if (localStrategyNeeded) {
      if (ls != LocalStrategy.NONE) {
        if (ls != LocalStrategy.COMBININGSORT && ls != LocalStrategy.SORT) {
          continue;
        }
      }
 else {
        ls=isCombineable() ? LocalStrategy.COMBININGSORT : LocalStrategy.SORT;
      }
    }
    if (ls == LocalStrategy.COMBININGSORT || ls == LocalStrategy.SORT) {
      Ordering ordering=new Ordering();
      for (      Integer index : keySet) {
        ordering.appendOrdering(index,Order.ASCENDING);
      }
      lp.setOrdering(ordering);
      lp.setGrouped(true,keySet);
    }
    if (isCombineable() && ss != ShipStrategy.FORWARD) {
      int index=0;
      for (      OptimizerNode pred : predList) {
        OptimizerNode combiner=new CombinerNode(getPactContract(),pred,this.combinerReducingFactor);
        combiner.setDegreeOfParallelism(pred.getDegreeOfParallelism());
        estimator.costOperator(combiner);
        predList.set(index,combiner);
        ++index;
      }
    }
    ReduceNode n=new ReduceNode(this,predList,this.input,gp,lp);
    for (    PactConnection cc : n.getInputConnections()) {
      cc.setShipStrategy(ss);
    }
    n.setLocalStrategy(ls);
    n.getGlobalProperties().filterByNodesConstantSet(this,0);
    n.getLocalProperties().filterByNodesConstantSet(this,0);
    estimator.costOperator(n);
    outputPlans.add(n);
  }
}
