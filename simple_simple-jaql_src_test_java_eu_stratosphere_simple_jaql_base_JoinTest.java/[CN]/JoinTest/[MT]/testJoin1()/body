{
  SopremoPlan actualPlan=parseScript("$users = read 'users.json';\n" + "$pages = read 'pages.json';\n" + "$result = join $users, $pages\n"+ "  where $users.id == $pages.userid\n"+ "  into { $users.name, $pages.* };\n"+ "write $result to 'result.json';");
  SopremoPlan expectedPlan=new SopremoPlan();
  Source users=new Source("users.json");
  Source pages=new Source("pages.json");
  Join join=new Join().withInputs(users,pages).withJoinCondition(new ComparativeExpression(JsonUtil.createPath("0","id"),BinaryOperator.EQUAL,JsonUtil.createPath("1","userid"))).withResultProjection(new ObjectCreation(new ObjectCreation.FieldAssignment("name",JsonUtil.createPath("0","name")),new ObjectCreation.CopyFields(JsonUtil.createPath("1"))));
  Sink result=new Sink("result.json").withInputs(join);
  expectedPlan.setSinks(result);
  assertEquals(expectedPlan,actualPlan);
}
