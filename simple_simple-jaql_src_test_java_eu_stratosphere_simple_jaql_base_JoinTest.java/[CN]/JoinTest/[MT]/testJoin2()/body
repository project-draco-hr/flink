{
  final SopremoPlan actualPlan=this.parseScript("$users = read 'users.json';\n" + "$pages = read 'pages.json';\n" + "$result = join $u in $users, $p in $pages\n"+ "  where $u.id == $p.userid\n"+ "  into { $u.name, $p.* };\n"+ "write $result to 'result.json';");
  final SopremoPlan expectedPlan=new SopremoPlan();
  final Source users=new Source("users.json");
  final Source pages=new Source("pages.json");
  final Join join=new Join().withInputs(users,pages).withJoinCondition(new ComparativeExpression(JsonUtil.createPath("0","id"),BinaryOperator.EQUAL,JsonUtil.createPath("1","userid"))).withResultProjection(new ObjectCreation(new ObjectCreation.FieldAssignment("name",JsonUtil.createPath("0","name")),new ObjectCreation.CopyFields(JsonUtil.createPath("1"))));
  final Sink result=new Sink("result.json").withInputs(join);
  expectedPlan.setSinks(result);
  assertEquals(expectedPlan,actualPlan);
}
