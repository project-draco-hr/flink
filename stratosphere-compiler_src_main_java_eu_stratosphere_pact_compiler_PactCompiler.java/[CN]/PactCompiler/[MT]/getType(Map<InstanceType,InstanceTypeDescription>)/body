{
  if (types == null || types.size() < 1) {
    throw new IllegalArgumentException("No instance type found.");
  }
  InstanceTypeDescription retValue=null;
  long totalMemory=0;
  int numInstances=0;
  final Iterator<InstanceTypeDescription> it=types.values().iterator();
  while (it.hasNext()) {
    final InstanceTypeDescription descr=it.next();
    if (descr.getHardwareDescription() == null || descr.getInstanceType() == null) {
      continue;
    }
    final int curInstances=descr.getMaximumNumberOfAvailableInstances();
    final long curMemory=curInstances * descr.getHardwareDescription().getSizeOfFreeMemory();
    if ((retValue == null) || (curInstances > numInstances && (int)(curMemory * 1.2f) > totalMemory) || (curInstances * retValue.getInstanceType().getNumberOfCores() >= numInstances && (int)(curMemory * 1.5f) > totalMemory)) {
      retValue=descr;
      numInstances=curInstances;
      totalMemory=curMemory;
    }
  }
  if (retValue == null) {
    throw new CompilerException("No instance currently registered at the job-manager. Retry later.\n" + "If the system has recently started, it may take a few seconds until the instances register.");
  }
  return retValue;
}
