{
  KafkaTopicPartitionState<TopicPartition>[] partitions=subscribedPartitions();
  Map<TopicPartition,OffsetAndMetadata> offsetsToCommit=new HashMap<>(partitions.length);
  for (  KafkaTopicPartitionState<TopicPartition> partition : partitions) {
    Long offset=offsets.get(partition.getKafkaTopicPartition());
    if (offset != null) {
      offsetsToCommit.put(partition.getKafkaPartitionHandle(),new OffsetAndMetadata(offset,""));
    }
  }
  if (this.consumer != null) {
synchronized (consumerLock) {
      this.consumer.commitSync(offsetsToCommit);
    }
  }
}
