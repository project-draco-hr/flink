{
  while (true) {
    int data;
    try {
      data=reader.read();
    }
 catch (    SocketException e) {
      socketClosed=true;
      break;
    }
    if (data == -1) {
      socket.close();
      long retry=0;
      boolean success=false;
      while (retry < maxRetry && !success) {
        if (!retryForever) {
          retry++;
        }
        LOG.warn("Lost connection to server socket. Retrying in " + (CONNECTION_RETRY_SLEEP / 1000) + " seconds...");
        try {
          socket=new Socket();
          socket.connect(new InetSocketAddress(hostname,port),CONNECTION_TIMEOUT_TIME);
          success=true;
        }
 catch (        ConnectException ce) {
          Thread.sleep(CONNECTION_RETRY_SLEEP);
        }
      }
      if (success) {
        LOG.info("Server socket is reconnected.");
      }
 else {
        LOG.error("Could not reconnect to server socket.");
        break;
      }
      reader=new BufferedReader(new InputStreamReader(socket.getInputStream()));
      continue;
    }
    if (data == delimiter) {
      String result=buffer.toString();
      buffer=new StringBuffer();
      return result;
    }
 else     if (data != '\r') {
      buffer.append((char)data);
    }
  }
  return null;
}
