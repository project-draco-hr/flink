{
  if (LOG.isDebugEnabled()) {
    LOG.debug("Iteration source {} invoked",getName());
  }
  Collection<RecordWriterOutput<?>> outputs=outputHandler.getOutputs();
  try {
    StreamRecord<OUT> nextRecord;
    while (true) {
      if (shouldWait) {
        nextRecord=dataChannel.poll(iterationWaitTime,TimeUnit.MILLISECONDS);
      }
 else {
        nextRecord=dataChannel.take();
      }
      if (nextRecord == null) {
        break;
      }
      for (      RecordWriterOutput<?> output : outputs) {
        ((RecordWriterOutput<OUT>)output).collect(nextRecord);
      }
    }
  }
 catch (  Exception e) {
    LOG.error("Iteration Head " + getEnvironment().getTaskNameWithSubtasks() + " failed",e);
    throw e;
  }
 finally {
    isRunning=false;
    outputHandler.flushOutputs();
    clearBuffers();
  }
}
