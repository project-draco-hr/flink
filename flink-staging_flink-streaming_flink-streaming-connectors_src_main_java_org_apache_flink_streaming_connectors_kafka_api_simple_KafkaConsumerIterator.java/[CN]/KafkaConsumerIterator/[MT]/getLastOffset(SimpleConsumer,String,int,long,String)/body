{
  TopicAndPartition topicAndPartition=new TopicAndPartition(topic,partition);
  Map<TopicAndPartition,PartitionOffsetRequestInfo> requestInfo=new HashMap<TopicAndPartition,PartitionOffsetRequestInfo>();
  requestInfo.put(topicAndPartition,new PartitionOffsetRequestInfo(whichTime,1));
  kafka.javaapi.OffsetRequest request=new kafka.javaapi.OffsetRequest(requestInfo,kafka.api.OffsetRequest.CurrentVersion(),clientName);
  OffsetResponse response=consumer.getOffsetsBefore(request);
  if (response.hasError()) {
    throw new RuntimeException("Error fetching data Offset Data the Broker. Reason: " + response.errorCode(topic,partition));
  }
  long[] offsets=response.offsets(topic,partition);
  return offsets[0];
}
