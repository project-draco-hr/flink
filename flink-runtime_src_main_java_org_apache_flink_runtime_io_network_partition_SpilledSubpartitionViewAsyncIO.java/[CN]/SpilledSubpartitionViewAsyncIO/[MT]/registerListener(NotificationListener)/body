{
  checkNotNull(listener);
  checkError();
synchronized (lock) {
    if (isReleased || !returnedBuffers.isEmpty()) {
      return false;
    }
    if (registeredListener == null) {
      registeredListener=listener;
      return true;
    }
  }
  throw new IllegalStateException("Already registered listener.");
}
