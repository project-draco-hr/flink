{
  if (this.charBuffer.remaining() == 0) {
    final int maxLen=this.streamBuffer.capacity();
    this.streamBuffer.clear();
    if (this.reachedLimit) {
      final int read=this.stream.read(this.streamBuffer.array(),0,maxLen);
      this.streamBuffer.limit(read);
    }
 else {
      final int read=this.stream.read(this.streamBuffer.array(),0,(int)Math.min(maxLen,this.limit - this.relativePos));
      this.relativePos+=read;
      this.streamBuffer.limit(read);
      this.reachedLimit=this.limit <= this.relativePos;
    }
    this.charBuffer.clear();
    this.decoder.decode(this.streamBuffer,this.charBuffer,false);
    this.charBuffer.flip();
  }
}
