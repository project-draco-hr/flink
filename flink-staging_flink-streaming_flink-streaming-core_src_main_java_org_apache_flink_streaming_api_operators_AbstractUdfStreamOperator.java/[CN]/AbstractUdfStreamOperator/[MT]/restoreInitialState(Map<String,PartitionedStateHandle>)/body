{
  for (  Entry<String,PartitionedStateHandle> snapshot : snapshots.entrySet()) {
    Map<Serializable,StateHandle<Serializable>> handles=snapshot.getValue().getState();
    StreamOperatorState restoredState=runtimeContext.getState(snapshot.getKey(),!(handles instanceof ImmutableMap));
    restoredState.restoreState(snapshot.getValue().getState());
  }
}
