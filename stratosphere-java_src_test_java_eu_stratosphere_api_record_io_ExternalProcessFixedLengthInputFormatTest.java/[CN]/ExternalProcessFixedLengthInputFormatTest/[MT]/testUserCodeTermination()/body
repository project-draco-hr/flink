{
  Configuration config=new Configuration();
  config.setInteger(ExternalProcessFixedLengthInputFormat.RECORDLENGTH_PARAMETER_KEY,8);
  config.setInteger(MyExternalProcessTestInputFormat.FAILCOUNT_PARAMETER_KEY,100);
  ExternalProcessInputSplit split=new ExternalProcessInputSplit(1,this.neverEndingCommand);
  Record record=new Record();
  boolean userException=false;
  boolean processDestroyed=false;
  try {
    format.configure(config);
    format.open(split);
    while (!format.reachedEnd()) {
      try {
        format.nextRecord(record);
      }
 catch (      RuntimeException re) {
        userException=true;
        break;
      }
    }
    format.close();
  }
 catch (  IOException e) {
    Assert.fail();
  }
catch (  RuntimeException e) {
    if (e.getMessage().equals("External process was destroyed although stream was not fully read.")) {
      processDestroyed=true;
    }
  }
 finally {
    Assert.assertTrue(userException && processDestroyed);
  }
}
