{
  initializeConnection();
  Map<String,Integer> topicCountMap=new HashMap<String,Integer>();
  topicCountMap.put(topicId,numThreads);
  Map<String,List<KafkaStream<byte[],byte[]>>> consumerMap=consumer.createMessageStreams(topicCountMap);
  KafkaStream<byte[],byte[]> stream=consumerMap.get(topicId).get(0);
  ConsumerIterator<byte[],byte[]> it=stream.iterator();
  while (it.hasNext()) {
    IN out=deserialize(it.next().message());
    if (closeWithoutSend) {
      break;
    }
    collector.collect(out);
    if (sendAndClose) {
      break;
    }
  }
  consumer.shutdown();
}
