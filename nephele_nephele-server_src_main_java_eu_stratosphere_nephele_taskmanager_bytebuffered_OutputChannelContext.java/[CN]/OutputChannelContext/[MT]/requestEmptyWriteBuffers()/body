{
  if (this.outgoingTransferEnvelope == null) {
    this.outgoingTransferEnvelope=createNewOutgoingTransferEnvelope();
  }
 else {
    if (this.outgoingTransferEnvelope.getBuffer() != null) {
      LOG.error("Channel " + this.byteBufferedOutputChannel.getID() + "'s transfer envelope already has a buffer attached");
      return null;
    }
  }
  final int uncompressedBufferSize=calculateBufferSize();
  final Buffer buffer=this.outputGateContext.requestEmptyBufferBlocking(this,uncompressedBufferSize);
  final BufferPairResponse bufferResponse=new BufferPairResponse(null,buffer);
  this.outgoingTransferEnvelope.setBuffer(bufferResponse.getUncompressedDataBuffer());
  return bufferResponse;
}
