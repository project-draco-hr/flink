{
  if (this.outgoingTransferEnvelope != null) {
    this.outgoingTransferEnvelope.addEvent(event);
  }
 else {
    final TransferEnvelope ephemeralTransferEnvelope=createNewOutgoingTransferEnvelope();
    ephemeralTransferEnvelope.addEvent(event);
    if (!this.isReceiverRunning) {
      this.queuedOutgoingEnvelopes.add(ephemeralTransferEnvelope);
    }
 else {
      if (this.queuedOutgoingEnvelopes.isEmpty()) {
        this.outputGateContext.processEnvelope(this,ephemeralTransferEnvelope);
      }
 else {
        this.queuedOutgoingEnvelopes.add(ephemeralTransferEnvelope);
        flushQueuedOutgoingEnvelopes();
      }
    }
  }
}
