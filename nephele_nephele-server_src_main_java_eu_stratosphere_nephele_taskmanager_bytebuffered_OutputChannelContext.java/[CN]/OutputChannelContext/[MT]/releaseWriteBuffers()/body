{
  if (this.outgoingTransferEnvelope == null) {
    LOG.error("Cannot find transfer envelope for channel with ID " + this.byteBufferedOutputChannel.getID());
    return;
  }
  if (this.outgoingTransferEnvelope.getBuffer() == null) {
    LOG.error("Channel " + this.byteBufferedOutputChannel.getID() + " has no buffer attached");
    return;
  }
  final Buffer buffer=this.outgoingTransferEnvelope.getBuffer();
  buffer.finishWritePhase();
  if (!this.isReceiverRunning) {
    this.queuedOutgoingEnvelopes.add(this.outgoingTransferEnvelope);
  }
 else {
    if (!this.queuedOutgoingEnvelopes.isEmpty()) {
      this.queuedOutgoingEnvelopes.add(this.outgoingTransferEnvelope);
      if (!this.spillingQueueRegisteredWithNetworkConnection) {
        if (this.outputGateContext.registerSpillingQueueWithNetworkConnection(this.byteBufferedOutputChannel.getID(),this.queuedOutgoingEnvelopes)) {
          this.spillingQueueRegisteredWithNetworkConnection=true;
        }
 else {
          while (!this.queuedOutgoingEnvelopes.isEmpty()) {
            this.outputGateContext.processEnvelope(this,this.queuedOutgoingEnvelopes.poll());
          }
        }
      }
    }
 else {
      this.outputGateContext.processEnvelope(this,this.outgoingTransferEnvelope);
    }
  }
  this.outgoingTransferEnvelope=null;
}
