{
  numElementsTotal++;
  if (!killedLeaderBefore) {
    Thread.sleep(10);
    if (failer && numElementsTotal >= failCount) {
      KafkaServer toShutDown=null;
      for (      KafkaServer kafkaServer : brokers) {
        if (leaderToShutDown.equals(kafkaServer.config().advertisedHostName() + ":" + kafkaServer.config().advertisedPort())) {
          toShutDown=kafkaServer;
          break;
        }
      }
      if (toShutDown == null) {
        throw new Exception("Cannot find broker to shut down");
      }
 else {
        hasBeenCheckpointedBeforeFailure=hasBeenCheckpointed;
        killedLeaderBefore=true;
        toShutDown.shutdown();
      }
    }
  }
  return value;
}
