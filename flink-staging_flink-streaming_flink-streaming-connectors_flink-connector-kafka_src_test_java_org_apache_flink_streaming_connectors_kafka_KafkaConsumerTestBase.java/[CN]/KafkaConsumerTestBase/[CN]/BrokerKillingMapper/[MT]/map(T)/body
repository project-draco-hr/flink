{
  numElementsTotal++;
  if (!killedLeaderBefore) {
    Thread.sleep(10);
    if (failer && numElementsTotal >= failCount) {
      KafkaServer toShutDown=null;
      for (      KafkaServer kafkaServer : brokers) {
        String connectionUrl=NetUtils.hostAndPortToUrlString(kafkaServer.config().advertisedHostName(),kafkaServer.config().advertisedPort());
        if (leaderToShutDown.equals(connectionUrl)) {
          toShutDown=kafkaServer;
          break;
        }
      }
      if (toShutDown == null) {
        StringBuilder listOfBrokers=new StringBuilder();
        for (        KafkaServer kafkaServer : brokers) {
          listOfBrokers.append(NetUtils.hostAndPortToUrlString(kafkaServer.config().advertisedHostName(),kafkaServer.config().advertisedPort()));
          listOfBrokers.append(" ; ");
        }
        throw new Exception("Cannot find broker to shut down: " + leaderToShutDown + " ; available brokers: "+ listOfBrokers.toString());
      }
 else {
        hasBeenCheckpointedBeforeFailure=hasBeenCheckpointed;
        killedLeaderBefore=true;
        toShutDown.shutdown();
      }
    }
  }
  return value;
}
