{
  BufferPool pool1=new NetworkBufferPool(100,1024).createBufferPool(100,true);
  BufferPool pool2=new NetworkBufferPool(100,1024).createBufferPool(100,true);
  MockInputGate myIG=new MockInputGate(new BufferPool[]{pool1,pool2},new BarrierGenerator[]{new CountBarrier(100000),new RandomBarrier(100000)});
  BarrierBuffer barrierBuffer=new BarrierBuffer(myIG,new BarrierBufferTest.MockReader(myIG));
  try {
    for (int i=0; i < 2000000; i++) {
      BufferOrEvent boe=barrierBuffer.getNextNonBlocked();
      if (boe.isBuffer()) {
        boe.getBuffer().recycle();
      }
 else {
        barrierBuffer.processBarrier(boe);
      }
    }
  }
 catch (  Exception e) {
    fail();
  }
 finally {
    barrierBuffer.cleanup();
  }
}
