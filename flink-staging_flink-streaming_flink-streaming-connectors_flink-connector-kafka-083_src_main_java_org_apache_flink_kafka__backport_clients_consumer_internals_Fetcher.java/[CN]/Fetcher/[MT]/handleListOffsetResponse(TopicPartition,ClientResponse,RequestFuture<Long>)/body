{
  if (clientResponse.wasDisconnected()) {
    future.raise(new DisconnectException());
  }
 else {
    ListOffsetResponse lor=new ListOffsetResponse(clientResponse.responseBody());
    short errorCode=lor.responseData().get(topicPartition).errorCode;
    if (errorCode == Errors.NONE.code()) {
      List<Long> offsets=lor.responseData().get(topicPartition).offsets;
      if (offsets.size() != 1)       throw new IllegalStateException("This should not happen.");
      long offset=offsets.get(0);
      log.debug("Fetched offset {} for partition {}",offset,topicPartition);
      future.complete(offset);
    }
 else     if (errorCode == Errors.NOT_LEADER_FOR_PARTITION.code() || errorCode == Errors.UNKNOWN_TOPIC_OR_PARTITION.code()) {
      log.warn("Attempt to fetch offsets for partition {} failed due to obsolete leadership information, retrying.",topicPartition);
      future.raise(Errors.forCode(errorCode));
    }
 else {
      log.error("Attempt to fetch offsets for partition {} failed due to: {}",topicPartition,Errors.forCode(errorCode).exception().getMessage());
      future.raise(new StaleMetadataException());
    }
  }
}
