{
  flinkUberjar=findFile(".",new RootDirFilenameFilter());
  Assert.assertNotNull(flinkUberjar);
  String flinkDistRootDir=flinkUberjar.getParentFile().getParent();
  if (!flinkUberjar.exists()) {
    Assert.fail("Unable to locate yarn-uberjar.jar");
  }
  try {
    LOG.info("Starting up MiniYARN cluster");
    if (yarnCluster == null) {
      yarnCluster=new MiniYARNCluster(YarnTestBase.class.getName(),2,1,1);
      yarnCluster.init(conf);
      yarnCluster.start();
    }
    Map<String,String> map=new HashMap<String,String>(System.getenv());
    File flinkConfFilePath=findFile(flinkDistRootDir,new ContainsName("flink-conf.yaml"));
    Assert.assertNotNull(flinkConfFilePath);
    map.put("FLINK_CONF_DIR",flinkConfFilePath.getParent());
    File yarnConfFile=writeYarnSiteConfigXML(conf);
    map.put("YARN_CONF_DIR",yarnConfFile.getParentFile().getAbsolutePath());
    setEnv(map);
    Assert.assertTrue(yarnCluster.getServiceState() == Service.STATE.STARTED);
  }
 catch (  Exception ex) {
    ex.printStackTrace();
    LOG.error("setup failure",ex);
    Assert.fail();
  }
}
