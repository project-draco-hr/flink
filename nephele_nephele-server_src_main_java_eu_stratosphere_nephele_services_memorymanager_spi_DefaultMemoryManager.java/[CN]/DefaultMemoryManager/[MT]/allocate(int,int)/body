{
  Collection<MemorySegment> segments=new ArrayList<MemorySegment>(numberOfSegments);
  for (int i=0; i < numberOfSegments; i++) {
    try {
      segments.add(allocate(segmentSize));
    }
 catch (    MemoryAllocationException e) {
      release(segments);
      throw e;
    }
  }
  return segments;
}
