{
  new JavaTestKit(system){
{
      try {
        final JobVertexID jid=new JobVertexID();
        final ActionQueue actions=new ActionQueue();
        final ExecutionJobVertex ejv=getJobVertexExecutingTriggered(jid,actions);
        final ExecutionVertex vertex=new ExecutionVertex(ejv,0,new IntermediateResult[0]);
        final ExecutionAttemptID execId=vertex.getCurrentExecutionAttempt().getAttemptId();
        setVertexState(vertex,ExecutionState.SCHEDULED);
        assertEquals(ExecutionState.SCHEDULED,vertex.getExecutionState());
        ActorRef taskManager=system.actorOf(Props.create(new CancelSequenceTaskManagerCreator(new TaskOperationResult(execId,false),new TaskOperationResult(execId,true))));
        Instance instance=getInstance(taskManager);
        AllocatedSlot slot=instance.allocateSlot(new JobID());
        vertex.deployToSlot(slot);
        assertEquals(ExecutionState.DEPLOYING,vertex.getExecutionState());
        vertex.cancel();
        assertEquals(ExecutionState.CANCELING,vertex.getExecutionState());
        Runnable deployAction=actions.popNextAction();
        Runnable cancelAction=actions.popNextAction();
        cancelAction.run();
        assertEquals(ExecutionState.CANCELING,vertex.getExecutionState());
        deployAction.run();
        assertEquals(ExecutionState.CANCELING,vertex.getExecutionState());
        actions.triggerNextAction();
        vertex.getCurrentExecutionAttempt().cancelingComplete();
        assertEquals(ExecutionState.CANCELED,vertex.getExecutionState());
        assertTrue(slot.isReleased());
        assertNull(vertex.getFailureCause());
        assertTrue(vertex.getStateTimestamp(ExecutionState.CREATED) > 0);
        assertTrue(vertex.getStateTimestamp(ExecutionState.CANCELING) > 0);
        assertTrue(vertex.getStateTimestamp(ExecutionState.CANCELED) > 0);
      }
 catch (      Exception e) {
        e.printStackTrace();
        fail(e.getMessage());
      }
    }
  }
;
}
