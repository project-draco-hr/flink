{
  long timeSinceLastHeartbeat=now - Math.max(lastHeartbeatSend,lastSessionReset);
  long hbInterval=timeout / HEARTBEATS_PER_SESSION_INTERVAL;
  if (timeSinceLastHeartbeat > hbInterval)   return 0;
 else   return hbInterval - timeSinceLastHeartbeat;
}
