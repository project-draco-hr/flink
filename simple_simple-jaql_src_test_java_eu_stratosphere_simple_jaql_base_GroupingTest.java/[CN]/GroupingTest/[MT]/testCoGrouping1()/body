{
  SopremoPlan actualPlan=parseScript("$employees = read 'employees.json';" + "$depts = read 'departments.json';" + "$result = group $es in $employees by $es.dept,"+ "	$ds in $depts by $ds.did into {"+ "	dept: $ds.did,"+ "	deptName: $ds[0].name,"+ "	emps: $es[*].id,"+ "	numEmps: count($es) "+ "};"+ "write $result to 'output.json'; ");
  SopremoPlan expectedPlan=new SopremoPlan();
  Source employees=new Source("employees.json");
  Source depts=new Source("departments.json");
  Grouping selection=new Grouping().withInputs(employees,depts).withGroupingKey(0,JsonUtil.createPath("0","dept")).withGroupingKey(1,JsonUtil.createPath("0","did")).withResultProjection(new ObjectCreation(new ObjectCreation.FieldAssignment("dept",JsonUtil.createPath("1","did")),new ObjectCreation.FieldAssignment("deptName",JsonUtil.createPath("1","[0]","name")),new ObjectCreation.FieldAssignment("emps",JsonUtil.createPath("0","[*]","id")),new ObjectCreation.FieldAssignment("numEmps",new MethodCall("count",JsonUtil.createPath("0")))));
  Sink output=new Sink("output.json").withInputs(selection);
  expectedPlan.setSinks(output);
  assertEquals(expectedPlan,actualPlan);
}
