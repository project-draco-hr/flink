{
  SopremoPlan actualPlan=parseScript("$employees = read 'employees.json';\n" + "$result = group $employees by $.dept into {\n" + "	$.dept,\n"+ "	total: sum($[*].income)\n"+ "};\n"+ "write $result to 'output.json'; ");
  SopremoPlan expectedPlan=new SopremoPlan();
  Source input=new Source("employees.json");
  Grouping selection=new Grouping().withInputs(input).withGroupingKey(JsonUtil.createPath("0","dept")).withResultProjection(new ObjectCreation(new ObjectCreation.FieldAssignment("dept",JsonUtil.createPath("0","dept")),new ObjectCreation.FieldAssignment("total",new MethodCall("sum",JsonUtil.createPath("0","[*]","income")))));
  Sink output=new Sink("output.json").withInputs(selection);
  expectedPlan.setSinks(output);
  assertEquals(expectedPlan,actualPlan);
}
