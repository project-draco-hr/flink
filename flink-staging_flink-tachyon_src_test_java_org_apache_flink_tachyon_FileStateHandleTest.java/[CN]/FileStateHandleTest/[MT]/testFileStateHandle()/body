{
  Serializable state="state";
  StateHandleProvider<Serializable> handleProvider=FileStateHandle.createProvider(hdfsURI + hdPath);
  FileStateHandle handle=(FileStateHandle)handleProvider.createStateHandle(state);
  try {
    handleProvider.createStateHandle(null);
    fail();
  }
 catch (  RuntimeException e) {
  }
  assertTrue(handle.stateFetched());
  assertFalse(handle.isWritten());
  SerializedValue<StateHandle<Serializable>> serializedHandle=new SerializedValue<StateHandle<Serializable>>(handle);
  assertTrue(handle.isWritten());
  FileStateHandle deserializedHandle=(FileStateHandle)serializedHandle.deserializeValue(Thread.currentThread().getContextClassLoader());
  assertFalse(deserializedHandle.stateFetched());
  assertEquals(state,deserializedHandle.getState());
  assertTrue(hdfs.listFiles(hdPath,true).hasNext());
  deserializedHandle.discardState();
  assertFalse(hdfs.listFiles(hdPath,true).hasNext());
}
