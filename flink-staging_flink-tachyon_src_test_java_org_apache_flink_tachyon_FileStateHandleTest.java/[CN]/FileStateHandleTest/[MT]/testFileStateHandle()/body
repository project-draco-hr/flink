{
  Serializable state="state";
  StateHandleProvider<Serializable> handleProvider=FileStateHandle.createProvider(hdfsURI + hdPath);
  FileStateHandle handle=(FileStateHandle)handleProvider.createStateHandle(state);
  assertTrue(handle.stateFetched());
  SerializedValue<StateHandle<Serializable>> serializedHandle=new SerializedValue<StateHandle<Serializable>>(handle);
  FileStateHandle deserializedHandle=(FileStateHandle)serializedHandle.deserializeValue(Thread.currentThread().getContextClassLoader());
  assertFalse(deserializedHandle.stateFetched());
  assertEquals(state,deserializedHandle.getState());
  assertTrue(hdfs.listFiles(hdPath,true).hasNext());
  handle.discardState();
  assertFalse(hdfs.listFiles(hdPath,true).hasNext());
}
