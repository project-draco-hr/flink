{
  StreamRecord record1=(new StreamRecord(1)).setId("1");
  record1.addRecord(new StringValue("V1"));
  StreamRecord record2=(new StreamRecord(1)).setId("1");
  record2.addRecord(new StringValue("V2"));
  faultTolerancyBuffer.addRecord(record1);
  faultTolerancyBuffer.addRecord(record2);
  Long record1TS=faultTolerancyBuffer.getRecordTimestamps().get(record1.getId());
  Long record2TS=faultTolerancyBuffer.getRecordTimestamps().get(record2.getId());
  faultTolerancyBuffer.removeRecord(record1.getId());
  assertTrue(faultTolerancyBuffer.getRecordBuffer().containsKey(record2.getId()));
  assertTrue(faultTolerancyBuffer.getAckCounter().containsKey(record2.getId()));
  assertTrue(faultTolerancyBuffer.getRecordTimestamps().containsKey(record2.getId()));
  assertTrue(faultTolerancyBuffer.getRecordsByTime().get(record2TS).contains(record2.getId()));
  assertFalse(faultTolerancyBuffer.getRecordBuffer().containsKey(record1.getId()));
  assertFalse(faultTolerancyBuffer.getAckCounter().containsKey(record1.getId()));
  assertFalse(faultTolerancyBuffer.getRecordTimestamps().containsKey(record1.getId()));
  assertFalse(faultTolerancyBuffer.getRecordsByTime().get(record1TS).contains(record1.getId()));
  List<String> addedRecords=new ArrayList<String>();
  for (int i=0; i < 10000; i++) {
    StreamRecord record=(new StreamRecord(1)).setId(String.valueOf(i % 5));
    addedRecords.add(record.getId());
    faultTolerancyBuffer.addRecord(record);
  }
  for (int i=0; i < 10000; i++) {
    String id=addedRecords.get(i);
    assertFalse(faultTolerancyBuffer.getAckCounter().get(id) == null);
    assertFalse(faultTolerancyBuffer.getRecordTimestamps().get(id) == null);
    faultTolerancyBuffer.removeRecord(id);
    assertTrue(faultTolerancyBuffer.getAckCounter().get(id) == null);
    assertTrue(faultTolerancyBuffer.getRecordTimestamps().get(id) == null);
  }
}
