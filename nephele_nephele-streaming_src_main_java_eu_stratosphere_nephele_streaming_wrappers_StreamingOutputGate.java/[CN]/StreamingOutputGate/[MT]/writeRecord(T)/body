{
  final long timestamp=this.streamListener.recordEmitted(record);
  if (timestamp >= 0) {
    final int numberOfOutputChannels=getNumberOfOutputChannels();
    if (this.lastThroughputTimestamp < 0) {
      this.lastSentBytes=new long[numberOfOutputChannels];
      for (int i=0; i < numberOfOutputChannels; ++i) {
        this.lastSentBytes[i]=getOutputChannel(i).getAmountOfDataTransmitted();
      }
    }
 else {
      for (int i=0; i < numberOfOutputChannels; ++i) {
        final AbstractOutputChannel<? extends Record> outputChannel=getOutputChannel(i);
        final long amountOfDataTransmitted=outputChannel.getAmountOfDataTransmitted();
        final long dataDiff=amountOfDataTransmitted - this.lastSentBytes[i];
        this.lastSentBytes[i]=amountOfDataTransmitted;
        final long timeDiff=timestamp - this.lastThroughputTimestamp;
        final double throughput=(double)(1000 * 8 * dataDiff) / (double)(1024 * 1024 * timeDiff);
        this.streamListener.reportChannelThroughput(outputChannel.getID(),throughput);
      }
    }
    this.lastThroughputTimestamp=timestamp;
  }
  if (this.streamChain == null) {
    getWrappedOutputGate().writeRecord(record);
  }
 else {
    this.streamChain.writeRecord(record);
  }
}
