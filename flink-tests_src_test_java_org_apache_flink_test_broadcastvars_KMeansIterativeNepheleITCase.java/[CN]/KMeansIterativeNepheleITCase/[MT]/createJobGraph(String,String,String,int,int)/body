{
  final TypeSerializerFactory<?> serializer=RecordSerializerFactory.get();
  @SuppressWarnings("unchecked") final TypeComparatorFactory<?> int0Comparator=new RecordComparatorFactory(new int[]{0},new Class[]{IntValue.class});
  JobGraph jobGraph=new JobGraph("KMeans Iterative");
  InputFormatVertex points=createPointsInput(jobGraph,pointsPath,numSubTasks,serializer);
  InputFormatVertex centers=createCentersInput(jobGraph,centersPath,numSubTasks,serializer);
  JobVertex head=createIterationHead(jobGraph,numSubTasks,serializer);
  JobVertex mapper=createMapper(jobGraph,numSubTasks,serializer,serializer,serializer,int0Comparator);
  JobVertex reducer=createReducer(jobGraph,numSubTasks,serializer,int0Comparator,serializer);
  JobVertex sync=createSync(jobGraph,numIterations,numSubTasks);
  OutputFormatVertex output=createOutput(jobGraph,resultPath,numSubTasks,serializer);
  JobGraphUtils.connect(points,mapper,DistributionPattern.POINTWISE);
  JobGraphUtils.connect(centers,head,DistributionPattern.POINTWISE);
  JobGraphUtils.connect(head,mapper,DistributionPattern.ALL_TO_ALL);
  new TaskConfig(mapper.getConfiguration()).setBroadcastGateIterativeWithNumberOfEventsUntilInterrupt(0,numSubTasks);
  new TaskConfig(mapper.getConfiguration()).setInputCached(0,true);
  new TaskConfig(mapper.getConfiguration()).setRelativeInputMaterializationMemory(0,MEMORY_FRACTION_PER_CONSUMER);
  JobGraphUtils.connect(mapper,reducer,DistributionPattern.ALL_TO_ALL);
  new TaskConfig(reducer.getConfiguration()).setGateIterativeWithNumberOfEventsUntilInterrupt(0,numSubTasks);
  JobGraphUtils.connect(head,output,DistributionPattern.POINTWISE);
  JobGraphUtils.connect(head,sync,DistributionPattern.ALL_TO_ALL);
  SlotSharingGroup sharingGroup=new SlotSharingGroup();
  points.setSlotSharingGroup(sharingGroup);
  centers.setSlotSharingGroup(sharingGroup);
  head.setSlotSharingGroup(sharingGroup);
  mapper.setSlotSharingGroup(sharingGroup);
  reducer.setSlotSharingGroup(sharingGroup);
  sync.setSlotSharingGroup(sharingGroup);
  output.setSlotSharingGroup(sharingGroup);
  mapper.setStrictlyCoLocatedWith(head);
  reducer.setStrictlyCoLocatedWith(head);
  return jobGraph;
}
