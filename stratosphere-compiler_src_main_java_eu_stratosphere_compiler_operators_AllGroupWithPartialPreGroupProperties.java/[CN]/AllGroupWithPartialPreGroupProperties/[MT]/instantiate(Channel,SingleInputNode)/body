{
  if (in.getShipStrategy() == ShipStrategyType.FORWARD) {
    return new SingleInputPlanNode(node,"Reduce(" + node.getPactContract().getName() + ")",in,DriverStrategy.ALL_GROUP_REDUCE);
  }
 else {
    Channel toCombiner=new Channel(in.getSource());
    toCombiner.setShipStrategy(ShipStrategyType.FORWARD);
    GroupReduceNode combinerNode=((GroupReduceNode)node).getCombinerUtilityNode();
    combinerNode.setDegreeOfParallelism(in.getSource().getDegreeOfParallelism());
    combinerNode.setSubtasksPerInstance(in.getSource().getSubtasksPerInstance());
    SingleInputPlanNode combiner=new SingleInputPlanNode(combinerNode,"Combine (" + node.getPactContract().getName() + ")",toCombiner,DriverStrategy.ALL_GROUP_REDUCE);
    combiner.setCosts(new Costs(0,0));
    combiner.initProperties(toCombiner.getGlobalProperties(),toCombiner.getLocalProperties());
    Channel toReducer=new Channel(combiner);
    toReducer.setShipStrategy(in.getShipStrategy(),in.getShipStrategyKeys(),in.getShipStrategySortOrder());
    toReducer.setLocalStrategy(in.getLocalStrategy(),in.getLocalStrategyKeys(),in.getLocalStrategySortOrder());
    return new SingleInputPlanNode(node,"Reduce(" + node.getPactContract().getName() + ")",toReducer,DriverStrategy.ALL_GROUP_REDUCE);
  }
}
