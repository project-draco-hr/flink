{
  DataOutputSerializer ser=new DataOutputSerializer(Math.max(size() * 16,16));
  writeStateToOutputView(ser);
  byte[] bytes=ser.getCopyOfBuffer();
  return new MemoryHeapKvStateSnapshot<K,V>(getKeySerializer(),getValueSerializer(),bytes,size());
}
