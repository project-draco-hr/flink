{
  if (this.buf.capacity() < numberOfBytes) {
    final ByteBuffer newBuf=ByteBuffer.allocate(numberOfBytes);
    newBuf.put(this.buf);
    newBuf.flip();
    this.buf=newBuf;
  }
  int remaining=this.buf.remaining();
  while (remaining < numberOfBytes) {
    final int offset=this.buf.position();
    if (offset > 0) {
      for (int i=0; i < remaining; ++i) {
        this.buf.put(i,this.buf.get(offset + i));
      }
    }
    this.buf.position(remaining);
    this.buf.limit(this.buf.capacity());
    final int read=this.readableByteChannel.read(this.buf);
    if (read < 0) {
      throw new BufferUnderflowException();
    }
    this.buf.flip();
    remaining=this.buf.remaining();
  }
}
