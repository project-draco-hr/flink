{
  requestPartitionsOnce();
  while (true) {
    if (currentReaderIndex == 0) {
      if ((bufferReader1.isFinished() && bufferReader2.isFinished())) {
        return 0;
      }
      currentReaderIndex=getNextReaderIndexBlocking();
    }
    if (currentReaderIndex == 1) {
      while (true) {
        if (reader1currentRecordDeserializer != null) {
          RecordDeserializer.DeserializationResult result=reader1currentRecordDeserializer.getNextRecord(target1);
          if (result.isBufferConsumed()) {
            reader1currentRecordDeserializer.getCurrentBuffer().recycle();
            reader1currentRecordDeserializer=null;
            currentReaderIndex=0;
          }
          if (result.isFullRecord()) {
            return 1;
          }
        }
        final Buffer nextBuffer=bufferReader1.getNextBufferBlocking();
        final int channelIndex=bufferReader1.getChannelIndexOfLastBuffer();
        if (nextBuffer == null) {
          currentReaderIndex=0;
          break;
        }
        reader1currentRecordDeserializer=reader1RecordDeserializers[channelIndex];
        reader1currentRecordDeserializer.setNextBuffer(nextBuffer);
      }
    }
 else     if (currentReaderIndex == 2) {
      while (true) {
        if (reader2currentRecordDeserializer != null) {
          RecordDeserializer.DeserializationResult result=reader2currentRecordDeserializer.getNextRecord(target2);
          if (result.isBufferConsumed()) {
            reader2currentRecordDeserializer.getCurrentBuffer().recycle();
            reader2currentRecordDeserializer=null;
            currentReaderIndex=0;
          }
          if (result.isFullRecord()) {
            return 2;
          }
        }
        final Buffer nextBuffer=bufferReader2.getNextBufferBlocking();
        final int channelIndex=bufferReader2.getChannelIndexOfLastBuffer();
        if (nextBuffer == null) {
          currentReaderIndex=0;
          break;
        }
        reader2currentRecordDeserializer=reader2RecordDeserializers[channelIndex];
        reader2currentRecordDeserializer.setNextBuffer(nextBuffer);
      }
    }
 else {
      throw new IllegalStateException("Bug: unexpected current reader index.");
    }
  }
}
