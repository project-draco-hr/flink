{
  final InternalJobStatus currentJobStatus=eg.getJobStatus();
switch (currentJobStatus) {
case CREATED:
    if (eg.jobHasScheduledStatus()) {
      return InternalJobStatus.SCHEDULED;
    }
 else     if (latestStateChange == ExecutionState.CANCELED) {
      if (eg.jobHasFailedOrCanceledStatus()) {
        return InternalJobStatus.CANCELED;
      }
    }
  break;
case SCHEDULED:
if (latestStateChange == ExecutionState.RUNNING) {
  return InternalJobStatus.RUNNING;
}
 else if (latestStateChange == ExecutionState.CANCELED) {
  if (eg.jobHasFailedOrCanceledStatus()) {
    return InternalJobStatus.CANCELED;
  }
}
break;
case RUNNING:
if (latestStateChange == ExecutionState.CANCELING || latestStateChange == ExecutionState.CANCELED) {
return InternalJobStatus.CANCELING;
}
if (latestStateChange == ExecutionState.FAILED) {
final Iterator<ExecutionVertex> it=new ExecutionGraphIterator(eg,true);
while (it.hasNext()) {
final ExecutionVertex vertex=it.next();
if (vertex.getExecutionState() == ExecutionState.FAILED) {
if (!vertex.hasRetriesLeft()) {
  System.out.println(" Vertex failed finally");
  return InternalJobStatus.FAILING;
}
 else {
  return InternalJobStatus.RECOVERING;
}
}
}
}
if (latestStateChange == ExecutionState.RECOVERING) {
return InternalJobStatus.RECOVERING;
}
if (eg.jobHasFinishedStatus()) {
return InternalJobStatus.FINISHED;
}
break;
case RECOVERING:
if (latestStateChange == ExecutionState.RERUNNING) {
if (this.recovering.isEmpty()) {
return InternalJobStatus.RUNNING;
}
}
if (latestStateChange == ExecutionState.FAILED) {
LOG.info("Another Failed Vertex while recovering");
}
break;
case FAILING:
if (eg.jobHasFailedOrCanceledStatus()) {
return InternalJobStatus.FAILED;
}
break;
case FAILED:
LOG.error("Received update of execute state in job status FAILED");
break;
case CANCELING:
if (eg.jobHasFailedOrCanceledStatus()) {
return InternalJobStatus.CANCELED;
}
break;
case CANCELED:
LOG.error("Received update of execute state in job status CANCELED");
break;
case FINISHED:
LOG.error("Received update of execute state in job status FINISHED");
break;
}
return currentJobStatus;
}
