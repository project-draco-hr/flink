{
  try {
    int numUnreleasedBCVars=0;
{
      TaskManager[] tms=executor.getTaskManagers();
      if (tms != null) {
        for (        TaskManager tm : tms) {
          numUnreleasedBCVars+=tm.getBroadcastVariableManager().getNumberOfVariablesWithReferences();
        }
      }
    }
    if (this.executor != null) {
      this.executor.stop();
      this.executor=null;
      FileSystem.closeAll();
      System.gc();
    }
    Assert.assertEquals("Not all broadcast variables were released.",0,numUnreleasedBCVars);
  }
  finally {
    deleteAllTempFiles();
  }
}
