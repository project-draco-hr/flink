{
  try {
    int numUnreleasedBCVars=0;
    int numActiveConnections=0;
{
      TaskManager[] tms=executor.getTaskManagers();
      if (tms != null) {
        for (        TaskManager tm : tms) {
          numUnreleasedBCVars+=tm.getBroadcastVariableManager().getNumberOfVariablesWithReferences();
          numActiveConnections+=tm.getChannelManager().getNetworkConnectionManager().getNumberOfActiveConnections();
        }
      }
    }
    if (this.executor != null) {
      this.executor.stop();
      this.executor=null;
      FileSystem.closeAll();
      System.gc();
    }
    Assert.assertEquals("Not all broadcast variables were released.",0,numUnreleasedBCVars);
    Assert.assertEquals("Not all network connections were released.",0,numActiveConnections);
  }
  finally {
    deleteAllTempFiles();
  }
}
