{
  final Instance host=createTestClusterInstance();
  final JobID jobID=new JobID();
  for (int run=0; run < 2; ++run) {
    AllocatedResource[] allocatedResources=new AllocatedResource[8];
    for (int i=0; i < 8; ++i) {
      try {
        allocatedResources[i]=host.allocateSlot(jobID);
      }
 catch (      InstanceException ex) {
        fail(ex.getMessage());
      }
      assertNotNull(allocatedResources[i]);
    }
    boolean instanceException=false;
    try {
      host.allocateSlot(jobID);
    }
 catch (    InstanceException ex) {
      instanceException=true;
    }
    assertTrue(instanceException);
    Collection<AllocatedSlot> allocatedSlots=host.removeAllocatedSlots();
    Set<AllocationID> removedAllocationIDs=new HashSet<AllocationID>();
    for (    AllocatedSlot slot : allocatedSlots) {
      removedAllocationIDs.add(slot.getAllocationID());
    }
    final Set<AllocationID> allocationIDs=new HashSet<AllocationID>();
    for (int i=0; i < allocatedResources.length; ++i) {
      allocationIDs.add(allocatedResources[i].getAllocationID());
    }
    assertEquals(allocationIDs.size(),removedAllocationIDs.size());
    final Iterator<AllocationID> it=allocationIDs.iterator();
    while (it.hasNext()) {
      assertTrue(removedAllocationIDs.remove(it.next()));
    }
    assertEquals(0,removedAllocationIDs.size());
  }
}
