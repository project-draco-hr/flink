{
  if (this.totalLen + len > this.bufferSize) {
    throw new IOException("Insufficient buffer space");
  }
  int written=0;
  while (written < len) {
    if (this.lenInPacket == RPCMessage.MAXIMUM_MSG_SIZE) {
      this.lenInPacket=0;
      this.totalLen+=RPCMessage.METADATA_SIZE;
    }
    final int amountOfDataToWrite=Math.min((len - written),(RPCMessage.MAXIMUM_MSG_SIZE - this.lenInPacket));
    System.arraycopy(b,off + written,this.buf,this.totalLen,amountOfDataToWrite);
    this.lenInPacket+=amountOfDataToWrite;
    this.totalLen+=amountOfDataToWrite;
    written+=amountOfDataToWrite;
  }
}
