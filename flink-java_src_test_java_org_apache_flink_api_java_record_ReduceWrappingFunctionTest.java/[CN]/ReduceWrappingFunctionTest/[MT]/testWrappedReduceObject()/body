{
  try {
    AtomicInteger methodCounter=new AtomicInteger();
    ReduceOperator reduceOp=ReduceOperator.builder(new TestReduceFunction(methodCounter)).build();
    RichFunction reducer=(RichFunction)reduceOp.getUserCodeWrapper().getUserCodeObject();
    reducer.close();
    reducer.open(new Configuration());
    assertEquals(2,methodCounter.get());
    final List<Record> target=new ArrayList<Record>();
    Collector<Record> collector=new Collector<Record>(){
      @Override public void collect(      Record record){
        target.add(record);
      }
      @Override public void close(){
      }
    }
;
    List<Record> source=new ArrayList<Record>();
    source.add(new Record(new IntValue(42),new LongValue(11)));
    source.add(new Record(new IntValue(13),new LongValue(17)));
    ((GroupReduceFunction<Record,Record>)reducer).reduce(source,collector);
    assertEquals(2,target.size());
    assertEquals(new IntValue(42),target.get(0).getField(0,IntValue.class));
    assertEquals(new LongValue(11),target.get(0).getField(1,LongValue.class));
    assertEquals(new IntValue(13),target.get(1).getField(0,IntValue.class));
    assertEquals(new LongValue(17),target.get(1).getField(1,LongValue.class));
    target.clear();
    ((GroupCombineFunction<Record,Record>)reducer).combine(source,collector);
    assertEquals(2,target.size());
    assertEquals(new IntValue(42),target.get(0).getField(0,IntValue.class));
    assertEquals(new LongValue(11),target.get(0).getField(1,LongValue.class));
    assertEquals(new IntValue(13),target.get(1).getField(0,IntValue.class));
    assertEquals(new LongValue(17),target.get(1).getField(1,LongValue.class));
    target.clear();
    SerializationUtils.clone((java.io.Serializable)reducer);
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
}
