{
  this.config=new TaskConfig(getTaskConfiguration());
  try {
    this.userCodeClassLoader=LibraryCacheManager.getClassLoader(getEnvironment().getJobID());
    @SuppressWarnings("unchecked") Class<S> stubClass=(Class<S>)this.config.getStubClass(stubSuperClass,this.userCodeClassLoader);
    this.stub=InstantiationUtil.instantiate(stubClass,stubSuperClass);
  }
 catch (  IOException ioe) {
    throw new Exception("The ClassLoader for the user code could not be instantiated from the library cache.",ioe);
  }
catch (  ClassNotFoundException cnfe) {
    throw new Exception("The stub implementation class was not found.",cnfe);
  }
catch (  ClassCastException ccex) {
    throw new Exception("The stub class is not a proper subclass of " + stubSuperClass.getName(),ccex);
  }
}
