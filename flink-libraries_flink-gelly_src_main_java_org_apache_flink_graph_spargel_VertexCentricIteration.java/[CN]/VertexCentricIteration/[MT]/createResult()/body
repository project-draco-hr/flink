{
  if (this.initialVertices == null) {
    throw new IllegalStateException("The input data set has not been set.");
  }
  TypeInformation<K> keyType=((TupleTypeInfo<?>)initialVertices.getType()).getTypeAt(0);
  TypeInformation<Tuple2<K,Message>> messageTypeInfo=new TupleTypeInfo<Tuple2<K,Message>>(keyType,messageType);
  Graph<K,VV,EV> graph=Graph.fromDataSet(initialVertices,edgesWithValue,initialVertices.getExecutionEnvironment());
  if (this.configuration != null && this.configuration.isOptNumVertices()) {
    try {
      long numberOfVertices=graph.numberOfVertices();
      messagingFunction.setNumberOfVertices(numberOfVertices);
      updateFunction.setNumberOfVertices(numberOfVertices);
    }
 catch (    Exception e) {
      e.printStackTrace();
    }
  }
  if (this.configuration != null) {
    messagingFunction.setDirection(this.configuration.getDirection());
  }
 else {
    messagingFunction.setDirection(EdgeDirection.OUT);
  }
  EdgeDirection messagingDirection=messagingFunction.getDirection();
  if (this.configuration != null && this.configuration.isOptDegrees()) {
    return createResultVerticesWithDegrees(graph,messagingDirection,messageTypeInfo);
  }
 else {
    return createResultSimpleVertex(messagingDirection,messageTypeInfo);
  }
}
