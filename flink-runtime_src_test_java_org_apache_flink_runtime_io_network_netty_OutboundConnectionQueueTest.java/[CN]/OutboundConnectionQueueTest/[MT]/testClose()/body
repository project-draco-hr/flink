{
  initTest(false);
  JobID jid=new JobID();
  ChannelID cid=new ChannelID();
  Assert.assertTrue(queue.enqueue(new Envelope(1,jid,cid)));
  Assert.assertTrue(queue.enqueue(new Envelope(2,jid,cid)));
  Assert.assertTrue(queue.enqueue(new Envelope(3,jid,cid)));
  controller.triggerWrite();
  controller.fireIdle();
  verifier.waitForClose();
  verifier.verifyEnvelopeReceived(cid,3);
  Mockito.verify(connectionManager,Mockito.times(1)).close(Mockito.any(RemoteReceiver.class));
}
