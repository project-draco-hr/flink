{
  controller=new TestControlHandler(autoTriggerWrite);
  verifier=new TestVerificationHandler();
  channel=Mockito.spy(new EmbeddedChannel(new ChannelInboundHandlerAdapter(){
    @Override public void exceptionCaught(    ChannelHandlerContext ctx,    Throwable cause) throws Exception {
      exception=cause;
      super.exceptionCaught(ctx,cause);
    }
  }
));
  connectionManager=Mockito.mock(NetworkConnectionManager.class);
  receiver=Mockito.mock(RemoteReceiver.class);
  queue=new OutboundConnectionQueue(channel,receiver,connectionManager,0);
  channel.pipeline().addFirst("Test Control Handler",controller);
  channel.pipeline().addFirst("Test Verification Handler",verifier);
  exception=null;
}
