{
  try {
    List<KeyGroupsStateHandle> keyedStates=Collections.emptyList();
    if (keyGroupsStateHandleFuture != null) {
      if (!keyGroupsStateHandleFuture.isDone()) {
        keyGroupsStateHandleFuture.run();
      }
      KeyGroupsStateHandle keyGroupsStateHandle=this.keyGroupsStateHandleFuture.get();
      if (keyGroupsStateHandle != null) {
        keyedStates=Collections.singletonList(keyGroupsStateHandle);
      }
    }
    if (chainedStateHandles.isEmpty() && keyedStates.isEmpty()) {
      owner.getEnvironment().acknowledgeCheckpoint(checkpointId);
    }
 else {
      owner.getEnvironment().acknowledgeCheckpoint(checkpointId,chainedStateHandles,keyedStates);
    }
    if (LOG.isDebugEnabled()) {
      LOG.debug("Finished asynchronous checkpoints for checkpoint {} on task {}. Returning handles on " + "keyed states {}.",checkpointId,name,keyedStates);
    }
  }
 catch (  Exception e) {
    AsynchronousException asyncException=new AsynchronousException(e);
    owner.registerAsyncException(asyncException);
  }
 finally {
synchronized (cancelables) {
      cancelables.remove(this);
    }
  }
}
