{
  boolean isDirectEmit=chainedTaskConfig.isDirectedEmit();
  CollectorWrapper<OUT> wrapper=isDirectEmit ? new DirectedCollectorWrapper(chainedTaskConfig.getOutputSelectors(cl)) : new CollectorWrapper<OUT>();
  for (  StreamEdge outputEdge : chainedTaskConfig.getNonChainedOutputs(cl)) {
    Integer output=outputEdge.getTargetVertex();
    Collector<?> outCollector=outputMap.get(output);
    if (isDirectEmit) {
      ((DirectedCollectorWrapper<OUT>)wrapper).addCollector(outCollector,chainedTaskConfig.getSelectedNames(output));
    }
 else {
      wrapper.addCollector(outCollector);
    }
  }
  for (  StreamEdge outputEdge : chainedTaskConfig.getChainedOutputs(cl)) {
    Integer output=outputEdge.getTargetVertex();
    Collector<?> outCollector=createChainedCollector(chainedConfigs.get(output));
    if (isDirectEmit) {
      ((DirectedCollectorWrapper<OUT>)wrapper).addCollector(outCollector,chainedTaskConfig.getSelectedNames(output));
    }
 else {
      wrapper.addCollector(outCollector);
    }
  }
  if (chainedTaskConfig.isChainStart()) {
    return wrapper;
  }
 else {
    ChainableInvokable chainableInvokable=chainedTaskConfig.getUserInvokable(vertex.getUserCodeClassLoader());
    chainableInvokable.setup(wrapper,chainedTaskConfig.getTypeSerializerIn1(vertex.getUserCodeClassLoader()));
    chainedInvokables.add(chainableInvokable);
    return chainableInvokable;
  }
}
