{
  SelectionKey key=keyForId(send.destination());
  Transmissions transmissions=transmissions(key);
  if (transmissions.hasSend())   throw new IllegalStateException("Attempt to begin a send operation with prior send operation still in progress.");
  transmissions.send=send;
  try {
    key.interestOps(key.interestOps() | SelectionKey.OP_WRITE);
  }
 catch (  CancelledKeyException e) {
    close(transmissions.id);
    this.failedSends.add(send.destination());
  }
}
