{
  ServerSocket blocker=null;
  try {
    final String localHostName="localhost";
    final InetAddress localAddress=InetAddress.getByName(localHostName);
    blocker=new ServerSocket(0,50,localAddress);
    final int port=blocker.getLocalPort();
    try {
      TaskManager.runTaskManager(localHostName,port,new Configuration(),StreamingMode.BATCH_ONLY,TaskManager.class);
      fail("This should fail with an IOException");
    }
 catch (    IOException e) {
      assertNotNull(e.getMessage());
      assertTrue(e.getMessage().contains("Address already in use"));
    }
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
 finally {
    if (blocker != null) {
      try {
        blocker.close();
      }
 catch (      IOException e) {
      }
    }
  }
}
