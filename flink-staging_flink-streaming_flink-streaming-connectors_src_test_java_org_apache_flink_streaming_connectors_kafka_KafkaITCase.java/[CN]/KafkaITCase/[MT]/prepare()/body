{
  LOG.info("Starting KafkaITCase.prepare()");
  tmpZkDir=tempFolder.newFolder();
  tmpKafkaDirs=new ArrayList<File>(NUMBER_OF_KAFKA_SERVERS);
  for (int i=0; i < NUMBER_OF_KAFKA_SERVERS; i++) {
    tmpKafkaDirs.add(tempFolder.newFolder());
  }
  kafkaHost=InetAddress.getLocalHost().getHostName();
  zkPort=NetUtils.getAvailablePort();
  zookeeperConnectionString="localhost:" + zkPort;
  zookeeper=null;
  brokers=null;
  try {
    LOG.info("Starting Zookeeper");
    zookeeper=getZookeeper();
    LOG.info("Starting KafkaServer");
    brokers=new ArrayList<KafkaServer>(NUMBER_OF_KAFKA_SERVERS);
    for (int i=0; i < NUMBER_OF_KAFKA_SERVERS; i++) {
      brokers.add(getKafkaServer(i,tmpKafkaDirs.get(i)));
    }
    LOG.info("ZK and KafkaServer started.");
  }
 catch (  Throwable t) {
    LOG.warn("Test failed with exception",t);
    Assert.fail("Test failed with: " + t.getMessage());
  }
}
