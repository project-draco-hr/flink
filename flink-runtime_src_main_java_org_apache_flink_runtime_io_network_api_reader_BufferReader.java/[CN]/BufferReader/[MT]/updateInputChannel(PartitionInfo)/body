{
synchronized (requestLock) {
    if (isReleased) {
      return;
    }
    final IntermediateResultPartitionID partitionId=partitionInfo.getPartitionId();
    InputChannel current=inputChannels.get(partitionId);
    if (current.getClass() == UnknownInputChannel.class) {
      UnknownInputChannel unknownChannel=(UnknownInputChannel)current;
      InputChannel newChannel;
      if (partitionInfo.getProducerLocation() == PartitionLocation.REMOTE) {
        newChannel=unknownChannel.toRemoteInputChannel(partitionInfo.getProducerAddress());
      }
 else       if (partitionInfo.getProducerLocation() == PartitionLocation.LOCAL) {
        newChannel=unknownChannel.toLocalInputChannel();
      }
 else {
        throw new IllegalStateException("Tried to update unknown channel with unknown channel.");
      }
      inputChannels.put(partitionId,newChannel);
      newChannel.requestIntermediateResultPartition(queueToRequest);
    }
  }
}
