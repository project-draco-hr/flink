{
  if (!this.isShutdownInProgress.compareAndSet(false,true)) {
    return;
  }
  for (  ExecutionGraph e : this.currentJobs.values()) {
    e.fail(new Exception("The JobManager is shutting down."));
  }
  if (this.executorService != null) {
    this.executorService.shutdown();
    try {
      this.executorService.awaitTermination(5000L,TimeUnit.MILLISECONDS);
    }
 catch (    InterruptedException e) {
      LOG.debug("Shutdown of executor thread pool interrupted",e);
    }
  }
  if (this.instanceManager != null) {
    this.instanceManager.shutdown();
  }
  if (this.libraryCacheManager != null) {
    try {
      this.libraryCacheManager.shutdown();
    }
 catch (    IOException e) {
      LOG.warn("Could not properly shutdown the library cache manager.",e);
    }
  }
  if (this.jobManagerServer != null) {
    this.jobManagerServer.stop();
  }
  if (this.eventCollector != null) {
    this.eventCollector.shutdown();
  }
  if (this.scheduler != null) {
    this.scheduler.shutdown();
  }
  if (this.server != null) {
    try {
      this.server.stop();
    }
 catch (    Exception e1) {
      throw new RuntimeException("Error shtopping the web-info-server.",e1);
    }
  }
  this.isShutDown=true;
  LOG.debug("Shutdown of job manager completed");
}
