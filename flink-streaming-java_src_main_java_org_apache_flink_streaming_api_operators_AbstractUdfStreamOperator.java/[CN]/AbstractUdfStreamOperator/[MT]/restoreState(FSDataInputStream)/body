{
  super.restoreState(in);
  if (userFunction instanceof Checkpointed) {
    @SuppressWarnings("unchecked") Checkpointed<Serializable> chkFunction=(Checkpointed<Serializable>)userFunction;
    int hasUdfState=in.read();
    if (hasUdfState == 1) {
      ObjectInputStream ois=new ObjectInputStream(in);
      Serializable functionState=(Serializable)ois.readObject();
      if (functionState != null) {
        try {
          chkFunction.restoreState(functionState);
        }
 catch (        Exception e) {
          throw new Exception("Failed to restore state to function: " + e.getMessage(),e);
        }
      }
    }
  }
}
