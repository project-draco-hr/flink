{
  final String libraryPath=directory + File.separator + filename;
synchronized (loadedLibrarySet) {
    final File outputFile=new File(directory,filename);
    if (!outputFile.exists()) {
      final ClassLoader cl=ClassLoader.getSystemClassLoader();
      final InputStream in=cl.getResourceAsStream(JAR_PREFIX + filename);
      if (in == null) {
        throw new IOException("Unable to extract native library " + filename + " to "+ directory);
      }
      final OutputStream out=new FileOutputStream(outputFile);
      copy(in,out);
    }
    System.load(libraryPath);
    loadedLibrarySet.add(filename);
  }
}
