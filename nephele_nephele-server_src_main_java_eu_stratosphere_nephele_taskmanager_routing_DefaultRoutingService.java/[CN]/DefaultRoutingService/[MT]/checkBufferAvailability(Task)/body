{
  final int totalNumberOfBuffers=GlobalBufferPool.getInstance().getTotalNumberOfBuffers();
  int numberOfAlreadyRegisteredChannels=this.registeredChannels.size();
  if (this.multicastEnabled) {
    numberOfAlreadyRegisteredChannels+=NUMBER_OF_CHANNELS_FOR_MULTICAST;
  }
  final Environment env=task.getEnvironment();
  final int numberOfNewChannels=env.getNumberOfOutputChannels() + env.getNumberOfInputChannels();
  final int totalNumberOfChannels=numberOfAlreadyRegisteredChannels + numberOfNewChannels;
  final double buffersPerChannel=(double)totalNumberOfBuffers / (double)totalNumberOfChannels;
  if (buffersPerChannel < 1.0) {
    final StringBuilder sb=new StringBuilder(this.localConnectionInfo.getHostName());
    sb.append(" has not enough buffers available to safely execute ");
    sb.append(env.getTaskName());
    sb.append(" (");
    sb.append(totalNumberOfChannels - totalNumberOfBuffers);
    sb.append(" buffers are currently missing)");
    throw new InsufficientResourcesException(sb.toString());
  }
}
