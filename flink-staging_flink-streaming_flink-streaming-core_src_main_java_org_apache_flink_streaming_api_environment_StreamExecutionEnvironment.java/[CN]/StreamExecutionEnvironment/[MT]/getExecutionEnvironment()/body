{
  if (currentEnvironment != null) {
    return currentEnvironment;
  }
  ExecutionEnvironment env=ExecutionEnvironment.getExecutionEnvironment();
  if (env instanceof ContextEnvironment) {
    ContextEnvironment ctx=(ContextEnvironment)env;
    currentEnvironment=createContextEnvironment(ctx.getClient(),ctx.getJars(),ctx.getParallelism());
  }
 else   if (env instanceof OptimizerPlanEnvironment | env instanceof PreviewPlanEnvironment) {
    currentEnvironment=new StreamPlanEnvironment(env);
  }
 else {
    return createLocalEnvironment();
  }
  return currentEnvironment;
}
