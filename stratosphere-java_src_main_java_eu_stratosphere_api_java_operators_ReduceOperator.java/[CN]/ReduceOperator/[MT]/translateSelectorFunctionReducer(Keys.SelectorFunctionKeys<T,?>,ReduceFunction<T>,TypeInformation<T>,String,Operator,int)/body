{
  @SuppressWarnings("unchecked") final Keys.SelectorFunctionKeys<T,K> keys=(Keys.SelectorFunctionKeys<T,K>)rawKeys;
  TypeInformation<Tuple2<K,T>> typeInfoWithKey=new TupleTypeInfo<Tuple2<K,T>>(keys.getKeyType(),inputType);
  KeyExtractingMapper<T,K> extractor=new KeyExtractingMapper<T,K>(keys.getKeyExtractor());
  PlanUnwrappingReduceOperator<T,K> reducer=new PlanUnwrappingReduceOperator<T,K>(function,keys,name,inputType,typeInfoWithKey);
  PlanMapOperator<T,Tuple2<K,T>> keyExtractingMap=new PlanMapOperator<T,Tuple2<K,T>>(extractor,"Key Extractor",inputType,typeInfoWithKey);
  PlanMapOperator<Tuple2<K,T>,T> keyRemovingMap=new PlanMapOperator<Tuple2<K,T>,T>(new KeyRemovingMapper<T,K>(),"Key Remover",typeInfoWithKey,inputType);
  keyExtractingMap.setInput(input);
  reducer.setInput(keyExtractingMap);
  keyRemovingMap.setInput(reducer);
  keyExtractingMap.setDegreeOfParallelism(input.getDegreeOfParallelism());
  reducer.setDegreeOfParallelism(dop);
  keyRemovingMap.setDegreeOfParallelism(dop);
  return keyRemovingMap;
}
