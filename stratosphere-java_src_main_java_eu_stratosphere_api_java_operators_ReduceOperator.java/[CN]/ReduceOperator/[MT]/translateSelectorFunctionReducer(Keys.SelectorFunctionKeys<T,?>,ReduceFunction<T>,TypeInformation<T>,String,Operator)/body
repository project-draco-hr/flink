{
  @SuppressWarnings("unchecked") final Keys.SelectorFunctionKeys<T,K> keys=(Keys.SelectorFunctionKeys<T,K>)rawKeys;
  TypeInformation<Tuple2<K,T>> typeInfoWithKey=new TupleTypeInfo<Tuple2<K,T>>(keys.getKeyType(),inputType);
  KeyExtractingMapper<T,K> extractor=new KeyExtractingMapper<T,K>(keys.getKeyExtractor());
  PlanUnwrappingReduceOperator<T,K> reducer=new PlanUnwrappingReduceOperator<T,K>(function,keys,name,inputType,typeInfoWithKey);
  PlanMapOperator<T,Tuple2<K,T>> mapper=new PlanMapOperator<T,Tuple2<K,T>>(extractor,"Key Extractor",inputType,typeInfoWithKey);
  reducer.setInput(mapper);
  mapper.setInput(input);
  mapper.setDegreeOfParallelism(input.getDegreeOfParallelism());
  return reducer;
}
