{
  if (key == null || value == null) {
    throw new IllegalArgumentException("Null keys/values are not permitted as argument");
  }
  try {
    int offsetKey=lookupKey(key);
    if (offsetKey == OFFSET_NULL) {
      offsetKey=insertKey(key);
    }
    segment.inputView.setPosition(offsetKey + 4);
    int offsetValue;
    offsetValue=segment.inputView.readInt();
    segment.outputView.setPosition(writePosition);
    segment.outputView.writeInt(offsetValue);
    value.write(segment.outputView);
    int newWritePosition=segment.outputView.getPosition();
    segment.outputView.setPosition(offsetKey + 4);
    segment.outputView.writeInt(writePosition);
    writePosition=newWritePosition;
  }
 catch (  EOFException e) {
    throw new OutOfMemoryException();
  }
catch (  IOException e) {
    throw new RuntimeException(e);
  }
  numberOfValues++;
  if (numberOfKeys >= threshold) {
    resize(2 * offsets.length);
  }
}
