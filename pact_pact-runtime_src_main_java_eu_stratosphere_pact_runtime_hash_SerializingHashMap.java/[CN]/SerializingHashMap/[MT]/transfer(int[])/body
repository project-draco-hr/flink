{
  int newCapacity=newOffsets.length;
  K k=newKeyInstance();
  for (int i=0; i < newCapacity; i++) {
    newOffsets[i]=OFFSET_NULL;
  }
  try {
    for (int i=0; i < offsets.length; i++) {
      int offsetCurrent, offsetNext=offsets[i];
      while (offsetNext != OFFSET_NULL) {
        offsetCurrent=offsetNext;
        offsetNext=segment.randomAccessView.getInt(offsetCurrent);
        k.read(segment.inputView.setPosition(offsetCurrent + 8));
        int newBucket=indexFor(hash(k.hashCode()),newCapacity);
        segment.randomAccessView.putInt(offsetCurrent,newOffsets[newBucket]);
        newOffsets[newBucket]=offsetCurrent;
      }
    }
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
}
