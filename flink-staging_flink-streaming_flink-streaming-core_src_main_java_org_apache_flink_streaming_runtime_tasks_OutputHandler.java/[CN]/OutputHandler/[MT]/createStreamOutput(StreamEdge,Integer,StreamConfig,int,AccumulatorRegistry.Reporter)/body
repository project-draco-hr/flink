{
  TypeSerializer<T> outSerializer=upStreamConfig.getTypeSerializerOut1(vertex.userClassLoader);
  @SuppressWarnings("unchecked") StreamPartitioner<T> outputPartitioner=(StreamPartitioner<T>)edge.getPartitioner();
  ResultPartitionWriter bufferWriter=vertex.getEnvironment().getWriter(outputIndex);
  StreamRecordWriter<SerializationDelegate<StreamRecord<T>>> output=new StreamRecordWriter<>(bufferWriter,outputPartitioner,upStreamConfig.getBufferTimeout());
  output.setReporter(reporter);
  RecordWriterOutput<T> streamOutput=new RecordWriterOutput<T>(output,outSerializer,vertex.getExecutionConfig().areTimestampsEnabled());
  if (LOG.isDebugEnabled()) {
    LOG.debug("Partitioner set: {} with {} outputs for {}",outputPartitioner.getClass().getSimpleName(),outputIndex,vertex.getClass().getSimpleName());
  }
  return streamOutput;
}
