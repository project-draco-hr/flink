{
  if (envelope.getBuffer() != null) {
    throw new RuntimeException("Error: This method can only process envelopes without buffers.");
  }
  EnvelopeReceiverList receiverList=getReceiverListForEnvelope(envelope,true);
  if (receiverList.hasLocalReceiver()) {
    ChannelID receiver=receiverList.getLocalReceiver();
    Channel channel=this.channels.get(receiver);
    if (channel == null) {
      throw new LocalReceiverCancelledException(receiver);
    }
    if (channel.isInputChannel()) {
      throw new IOException("Local receiver " + receiver + " of backward event is not an output channel.");
    }
    OutputChannel outputChannel=(OutputChannel)channel;
    outputChannel.queueEnvelope(envelope);
  }
 else   if (receiverList.hasRemoteReceiver()) {
    RemoteReceiver remoteReceiver=receiverList.getRemoteReceiver();
    if (envelope.getSequenceNumber() == 0) {
      generateSenderHint(envelope,remoteReceiver);
    }
    this.nettyConnectionManager.enqueue(envelope,remoteReceiver);
  }
}
