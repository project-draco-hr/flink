{
  if (SenderHintEvent.isSenderHintEvent(envelope)) {
    final SenderHintEvent seh=(SenderHintEvent)envelope.deserializeEvents().get(0);
    if (this.channels.get(seh.getSource()) != null) {
      addReceiverListHint(seh.getSource(),seh.getRemoteReceiver());
      return;
    }
  }
  EnvelopeReceiverList receiverList=getReceiverListForEnvelope(envelope,false);
  if (receiverList == null) {
    releaseEnvelope(envelope);
    if (LOG.isDebugEnabled()) {
      LOG.debug("Dropping envelope for cleaned up receiver.");
    }
    return;
  }
  if (!receiverList.hasLocalReceiver() || receiverList.hasRemoteReceiver()) {
    throw new IOException("Bug in network stack: Envelope dispatched from the incoming network pipe has no local receiver or has a remote receiver");
  }
  ChannelID localReceiver=receiverList.getLocalReceiver();
  Channel channel=this.channels.get(localReceiver);
  if (channel == null) {
    releaseEnvelope(envelope);
    if (LOG.isDebugEnabled()) {
      LOG.debug("Dropping envelope for cancelled receiver " + localReceiver);
    }
  }
 else {
    channel.queueEnvelope(envelope);
  }
}
