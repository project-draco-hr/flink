{
  try {
    Field samplesField=SampledStat.class.getDeclaredField("samples");
    Field sampleValue=Class.forName("org.apache.kafka.common.metrics.stats.SampledStat$Sample").getDeclaredField("value");
    Field sampleEventCount=Class.forName("org.apache.kafka.common.metrics.stats.SampledStat$Sample").getDeclaredField("eventCount");
    samplesField.setAccessible(true);
    sampleValue.setAccessible(true);
    sampleEventCount.setAccessible(true);
    List samples=(List)samplesField.get(avg);
    AvgSumCount res=new AvgSumCount();
    for (int i=0; i < samples.size(); i++) {
      res.sum+=(double)sampleValue.get(samples.get(i));
      res.count+=(long)sampleEventCount.get(samples.get(i));
    }
    return res;
  }
 catch (  Throwable t) {
    throw new RuntimeException("Unable to extract sum and count from Avg using reflection. " + "You can turn off the metrics from Flink's Kafka connector if this issue persists.",t);
  }
}
