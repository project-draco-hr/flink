{
  if (!triggerResult.isFire() && !triggerResult.isPurge()) {
    return;
  }
  AppendingState<IN,ACC> windowState;
  MergingWindowSet<W> mergingWindows=null;
  if (windowAssigner instanceof MergingWindowAssigner) {
    mergingWindows=getMergingWindowSet();
    W stateWindow=mergingWindows.getStateWindow(window);
    windowState=getPartitionedState(stateWindow,windowSerializer,windowStateDescriptor);
  }
 else {
    windowState=getPartitionedState(window,windowSerializer,windowStateDescriptor);
  }
  if (triggerResult.isFire()) {
    timestampedCollector.setAbsoluteTimestamp(window.maxTimestamp());
    ACC contents=windowState.get();
    userFunction.apply(context.key,context.window,contents,timestampedCollector);
  }
  if (triggerResult.isPurge()) {
    windowState.clear();
    if (mergingWindows != null) {
      mergingWindows.retireWindow(window);
    }
    context.clear();
  }
}
