{
  StreamTaskState taskState=super.snapshotOperatorState(checkpointId,timestamp);
  AbstractStateBackend.CheckpointStateOutputView out=getStateBackend().createCheckpointStateOutputView(checkpointId,timestamp);
  int numKeys=windows.size();
  out.writeInt(numKeys);
  for (  Map.Entry<K,Map<W,Context>> keyWindows : windows.entrySet()) {
    int numWindows=keyWindows.getValue().size();
    out.writeInt(numWindows);
    for (    Context context : keyWindows.getValue().values()) {
      context.writeToState(out);
    }
  }
  taskState.setOperatorState(out.closeAndGetHandle());
  return taskState;
}
