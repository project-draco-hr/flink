{
  if (!triggerResult.isFire() && !triggerResult.isPurge()) {
    return;
  }
  if (triggerResult.isFire()) {
    timestampedCollector.setTimestamp(window.maxTimestamp());
    setKeyContext(key);
    MergingState<IN,ACC> windowState=getPartitionedState(window,windowSerializer,windowStateDescriptor);
    ACC contents=windowState.get();
    userFunction.apply(context.key,context.window,contents,timestampedCollector);
    if (triggerResult.isPurge()) {
      windowState.clear();
    }
  }
 else   if (triggerResult.isPurge()) {
    setKeyContext(key);
    MergingState<IN,ACC> windowState=getPartitionedState(window,windowSerializer,windowStateDescriptor);
    windowState.clear();
  }
}
