{
  while (true) {
    changeExecutionState(ExecutionState.REPLAYING,null);
    if (this.executionObserver.isCanceled()) {
      changeExecutionState(ExecutionState.CANCELED,null);
      return;
    }
    resetAllOutputBroker();
    try {
      replayCheckpoint();
      if (this.executionObserver.isCanceled()) {
        throw new InterruptedException();
      }
    }
 catch (    Exception e) {
      if (this.restartRequested.compareAndSet(true,false)) {
        while (!Thread.currentThread().isInterrupted()) {
        }
        Thread.interrupted();
        continue;
      }
      if (this.executionObserver.isCanceled()) {
        changeExecutionState(ExecutionState.CANCELED,null);
      }
 else {
        changeExecutionState(ExecutionState.FAILED,StringUtils.stringifyException(e));
      }
      return;
    }
    if (this.restartRequested.compareAndSet(true,false)) {
      while (!Thread.currentThread().isInterrupted()) {
      }
      Thread.interrupted();
      continue;
    }
    break;
  }
  changeExecutionState(ExecutionState.FINISHING,null);
  try {
    waitForAllOutputBrokerToFinish();
  }
 catch (  Exception e) {
    if (this.executionObserver.isCanceled()) {
      changeExecutionState(ExecutionState.CANCELED,null);
    }
 else {
      changeExecutionState(ExecutionState.FAILED,StringUtils.stringifyException(e));
    }
    return;
  }
  changeExecutionState(ExecutionState.FINISHED,null);
}
