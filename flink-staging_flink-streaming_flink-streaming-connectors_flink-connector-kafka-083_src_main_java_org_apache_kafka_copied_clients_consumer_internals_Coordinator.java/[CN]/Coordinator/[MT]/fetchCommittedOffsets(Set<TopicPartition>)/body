{
  while (true) {
    ensureCoordinatorKnown();
    ensurePartitionAssignment();
    RequestFuture<Map<TopicPartition,Long>> future=sendOffsetFetchRequest(partitions);
    client.poll(future);
    if (future.succeeded())     return future.value();
    if (!future.isRetriable())     throw future.exception();
    Utils.sleep(retryBackoffMs);
  }
}
