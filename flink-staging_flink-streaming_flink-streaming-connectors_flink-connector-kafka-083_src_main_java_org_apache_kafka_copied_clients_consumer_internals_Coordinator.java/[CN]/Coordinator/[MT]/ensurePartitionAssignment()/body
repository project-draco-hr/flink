{
  if (!subscriptions.partitionAssignmentNeeded())   return;
  log.debug("Revoking previously assigned partitions {}",this.subscriptions.assignedPartitions());
  try {
    Set<TopicPartition> revoked=new HashSet<TopicPartition>(subscriptions.assignedPartitions());
    rebalanceCallback.onPartitionsRevoked(revoked);
  }
 catch (  Exception e) {
    log.error("User provided callback " + this.rebalanceCallback.getClass().getName() + " failed on partition revocation: ",e);
  }
  reassignPartitions();
  log.debug("Setting newly assigned partitions {}",this.subscriptions.assignedPartitions());
  try {
    Set<TopicPartition> assigned=new HashSet<TopicPartition>(subscriptions.assignedPartitions());
    rebalanceCallback.onPartitionsAssigned(assigned);
  }
 catch (  Exception e) {
    log.error("User provided callback " + this.rebalanceCallback.getClass().getName() + " failed on partition assignment: ",e);
  }
}
