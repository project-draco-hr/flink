{
  List<Set<Context>> toTrigger=new ArrayList<>();
  Iterator<Map.Entry<Long,Set<Context>>> it=watermarkTimers.entrySet().iterator();
  while (it.hasNext()) {
    Map.Entry<Long,Set<Context>> triggers=it.next();
    if (triggers.getKey() <= mark.getTimestamp()) {
      toTrigger.add(triggers.getValue());
      it.remove();
    }
  }
  for (  Set<Context> ctxs : toTrigger) {
    for (    Context ctx : ctxs) {
      if (ctx.watermarkTimer <= mark.getTimestamp()) {
        TriggerResult triggerResult=ctx.onEventTime(ctx.watermarkTimer);
        processTriggerResult(triggerResult,ctx.window);
      }
    }
  }
  output.emitWatermark(mark);
  this.currentWatermark=mark.getTimestamp();
}
