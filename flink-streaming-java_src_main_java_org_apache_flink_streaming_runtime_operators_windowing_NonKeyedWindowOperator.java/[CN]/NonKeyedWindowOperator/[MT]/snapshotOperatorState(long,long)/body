{
  StreamTaskState taskState=super.snapshotOperatorState(checkpointId,timestamp);
  StateBackend.CheckpointStateOutputView out=getStateBackend().createCheckpointStateOutputView(checkpointId,timestamp);
  int numWindows=windows.size();
  out.writeInt(numWindows);
  for (  Context context : windows.values()) {
    context.writeToState(out);
  }
  taskState.setOperatorState(out.closeAndGetHandle());
  return taskState;
}
