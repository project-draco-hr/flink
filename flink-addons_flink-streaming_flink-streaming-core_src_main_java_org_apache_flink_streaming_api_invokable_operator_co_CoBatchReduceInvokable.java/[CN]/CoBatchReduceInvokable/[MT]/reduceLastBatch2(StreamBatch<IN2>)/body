{
  if (streamBatch.miniBatchInProgress()) {
    streamBatch.addToBuffer();
  }
  if (streamBatch.changed == true && streamBatch.minibatchCounter >= 0) {
    if (streamBatch.circularBuffer.isFull()) {
      for (long i=0; i < (numberOfBatches2 - streamBatch.minibatchCounter); i++) {
        if (!streamBatch.circularBuffer.isEmpty()) {
          streamBatch.circularBuffer.remove();
        }
      }
    }
    if (!streamBatch.circularBuffer.isEmpty()) {
      reduce2(streamBatch);
    }
  }
}
