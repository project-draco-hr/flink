{
  if (!keySerializer.getClass().getName().equals(keySerializerClassName) || !valueSerializer.getClass().getName().equals(valueSerializerClassName)) {
    throw new IllegalArgumentException("Cannot restore the state from the snapshot with the given serializers. " + "State (K/V) was serialized with (" + valueSerializerClassName + "/"+ keySerializerClassName+ ")");
  }
  HashMap<K,V> stateMap=new HashMap<>(numEntries);
  DataInputDeserializer in=new DataInputDeserializer(data,0,data.length);
  for (int i=0; i < numEntries; i++) {
    K key=keySerializer.deserialize(in);
    V value=valueSerializer.deserialize(in);
    stateMap.put(key,value);
  }
  return new MemHeapKvState<K,V>(keySerializer,valueSerializer,defaultValue,stateMap);
}
