{
  IndexExpr ie=(IndexExpr)expr;
  Expr array=ie.arrayExpr();
  if (array.getSchema().is(NULL).always()) {
    ie.replaceInParent(new ConstExpr(null));
    return true;
  }
  if (!(array instanceof ArrayExpr)) {
    return false;
  }
  Expr index=ie.indexExpr();
  if (!(index instanceof ConstExpr)) {
    return false;
  }
  Expr replaceBy;
  ConstExpr c=(ConstExpr)index;
  JsonLong li=(JsonLong)c.value;
  if (li == null) {
    replaceBy=c;
  }
 else {
    long i=li.get();
    if (i < 0 || i >= array.numChildren()) {
      replaceBy=new ConstExpr(null);
    }
 else {
      replaceBy=array.child((int)i);
    }
  }
  ie.replaceInParent(replaceBy);
  return true;
}
