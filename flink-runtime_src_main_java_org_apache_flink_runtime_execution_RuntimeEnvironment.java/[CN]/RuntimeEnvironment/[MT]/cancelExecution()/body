{
  if (!canceled.compareAndSet(false,true)) {
    return;
  }
  LOG.info("Canceling " + owner.getTaskNameWithSubtasks());
  if (this.invokable != null) {
    try {
      this.invokable.cancel();
    }
 catch (    Throwable e) {
      LOG.error("Error while cancelling the task.",e);
    }
  }
  final Thread executingThread=this.executingThread;
  executingThread.interrupt();
  try {
    executingThread.join(5000);
  }
 catch (  InterruptedException e) {
  }
  if (!executingThread.isAlive()) {
    return;
  }
  while (executingThread != null && executingThread.isAlive()) {
    LOG.warn("Task " + owner.getTaskNameWithSubtasks() + " did not react to cancelling signal. Sending repeated interrupt.");
    if (LOG.isDebugEnabled()) {
      StringBuilder bld=new StringBuilder("Task ").append(owner.getTaskNameWithSubtasks()).append(" is stuck in method:\n");
      StackTraceElement[] stack=executingThread.getStackTrace();
      for (      StackTraceElement e : stack) {
        bld.append(e).append('\n');
      }
      LOG.debug(bld.toString());
    }
    executingThread.interrupt();
    try {
      executingThread.join(1000);
    }
 catch (    InterruptedException e) {
    }
  }
}
