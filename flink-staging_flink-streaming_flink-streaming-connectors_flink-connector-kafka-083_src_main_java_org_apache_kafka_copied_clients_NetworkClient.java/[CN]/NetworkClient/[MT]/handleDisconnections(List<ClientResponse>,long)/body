{
  for (  String node : this.selector.disconnected()) {
    connectionStates.disconnected(node);
    log.debug("Node {} disconnected.",node);
    for (    ClientRequest request : this.inFlightRequests.clearAll(node)) {
      log.trace("Cancelled request {} due to node {} being disconnected",request,node);
      ApiKeys requestKey=ApiKeys.forId(request.request().header().apiKey());
      if (requestKey == ApiKeys.METADATA)       metadataFetchInProgress=false;
 else       responses.add(new ClientResponse(request,now,true,null));
    }
  }
  if (this.selector.disconnected().size() > 0)   this.metadata.requestUpdate();
}
