{
  if (state == null) {
    throw new RuntimeException("Cannot set state to null.");
  }
  if (!restored) {
    restored=true;
    checkpoint=false;
  }
  this.state=state;
}
