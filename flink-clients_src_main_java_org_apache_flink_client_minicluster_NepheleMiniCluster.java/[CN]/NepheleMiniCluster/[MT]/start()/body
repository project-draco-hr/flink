{
  String forkNumberString=System.getProperty("forkNumber");
  int forkNumber=-1;
  try {
    forkNumber=Integer.parseInt(forkNumberString);
  }
 catch (  NumberFormatException e) {
  }
  if (forkNumber != -1) {
    jobManagerRpcPort=1024 + forkNumber * 300;
    taskManagerRpcPort=1024 + forkNumber * 300 + 100;
    taskManagerDataPort=1024 + forkNumber * 300 + 200;
  }
synchronized (startStopLock) {
    if (this.configDir != null) {
      GlobalConfiguration.loadConfiguration(configDir);
    }
 else {
      Configuration conf=getMiniclusterDefaultConfig(jobManagerRpcPort,taskManagerRpcPort,taskManagerDataPort,memorySize,hdfsConfigFile,lazyMemoryAllocation,defaultOverwriteFiles,defaultAlwaysCreateDirectory,taskManagerNumSlots,numTaskTracker);
      GlobalConfiguration.includeConfiguration(conf);
    }
    initializeIOFormatClasses();
    Thread[] allThreads=new Thread[Thread.activeCount()];
    int numThreads=Thread.enumerate(allThreads);
    for (int i=0; i < numThreads; i++) {
      Thread t=allThreads[i];
      String name=t.getName();
      if (name.startsWith("IPC")) {
        t.join();
      }
    }
    jobManager=new JobManager(ExecutionMode.LOCAL);
    waitForJobManagerToBecomeReady(numTaskTracker);
  }
}
