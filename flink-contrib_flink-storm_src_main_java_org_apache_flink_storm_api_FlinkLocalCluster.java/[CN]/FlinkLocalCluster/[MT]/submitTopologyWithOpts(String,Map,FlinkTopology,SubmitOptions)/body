{
  LOG.info("Running Storm topology on FlinkLocalCluster");
  if (conf != null) {
    topology.getExecutionEnvironment().getConfig().setGlobalJobParameters(new StormConfig(conf));
  }
  StreamGraph streamGraph=topology.getExecutionEnvironment().getStreamGraph();
  streamGraph.setJobName(topologyName);
  JobGraph jobGraph=streamGraph.getJobGraph();
  if (flink == null) {
    Configuration configuration=new Configuration();
    configuration.addAll(jobGraph.getJobConfiguration());
    configuration.setLong(ConfigConstants.TASK_MANAGER_MEMORY_SIZE_KEY,-1L);
    configuration.setInteger(ConfigConstants.TASK_MANAGER_NUM_TASK_SLOTS,jobGraph.getMaximumParallelism());
    flink=new LocalFlinkMiniCluster(configuration,true);
    this.flink.start();
  }
  this.flink.submitJobDetached(jobGraph);
}
