{
  final Configuration configuration=new Configuration();
  configuration.setString(ConfigConstants.RECOVERY_MODE,"zookeeper");
  configuration.setString(ConfigConstants.ZOOKEEPER_QUORUM_KEY,testingCluster.getConnectString());
  ActorRef jm=null;
  try {
    Props jmProps=createJobManagerProps(configuration);
    jm=actorSystem.actorOf(jmProps);
    Future<Object> leaderFuture=Patterns.ask(jm,TestingJobManagerMessages.getNotifyWhenLeader(),timeout);
    Await.ready(leaderFuture,duration);
  }
  finally {
    TestingUtils.stopActor(jm);
  }
}
