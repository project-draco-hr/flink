{
  this.nextPartialSolution.accept(PlanCacheCleaner.INSTANCE);
  this.partialSolution.setCandidateProperties(in.getGlobalProperties(),in.getLocalProperties());
  final BulkPartialSolutionPlanNode pspn=this.partialSolution.getCurrentPartialSolutionPlanNode();
  List<PlanNode> candidates=this.nextPartialSolution.getAlternativePlans(estimator);
  for (Iterator<PlanNode> planDeleter=candidates.iterator(); planDeleter.hasNext(); ) {
    PlanNode candidate=planDeleter.next();
    if (!(globPropsReq.isMetBy(candidate.getGlobalProperties()) && locPropsReq.isMetBy(candidate.getLocalProperties()))) {
      planDeleter.remove();
    }
  }
  if (terminationCriterion == null) {
    for (    PlanNode candidate : candidates) {
      BulkIterationPlanNode node=new BulkIterationPlanNode(this,"BulkIteration (" + this.getPactContract().getName() + ")",in,pspn,candidate);
      GlobalProperties gProps=candidate.getGlobalProperties().clone();
      LocalProperties lProps=candidate.getLocalProperties().clone();
      node.initProperties(gProps,lProps);
      target.add(node);
    }
  }
 else {
    List<PlanNode> terminationCriterionCandidates=this.terminationCriterion.getAlternativePlans(estimator);
    for (    PlanNode candidate : candidates) {
      for (      PlanNode terminationCandidate : terminationCriterionCandidates) {
        if (this.singleRoot.areBranchCompatible(candidate,terminationCandidate)) {
          BulkIterationPlanNode node=new BulkIterationPlanNode(this,"BulkIteration (" + this.getPactContract().getName() + ")",in,pspn,candidate,terminationCandidate);
          GlobalProperties gProps=candidate.getGlobalProperties().clone();
          LocalProperties lProps=candidate.getLocalProperties().clone();
          node.initProperties(gProps,lProps);
          target.add(node);
        }
      }
    }
  }
}
