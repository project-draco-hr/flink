{
  final String filePath=args[0];
  final long totalStart=System.nanoTime();
  final HashMap<Integer,SerialTriangleEntry> map=new HashMap<Integer,SerialTriangleEntry>(900000,0.85f);
{
    long readAndBuildStart=System.nanoTime();
    RandomAccessFile file=null;
    FileChannel channel=null;
    try {
      file=new RandomAccessFile(filePath,"r");
      channel=file.getChannel();
      final ByteBuffer buffer=ByteBuffer.allocateDirect(READ_BUFFER_CAPACITY);
      int current=0;
      int first=0;
      while (channel.read(buffer) != -1) {
        buffer.flip();
        while (buffer.hasRemaining()) {
          int next=buffer.get();
          if (next == '\n') {
            Integer fi=Integer.valueOf(first);
            SerialTriangleEntry firstEntry=map.get(fi);
            if (firstEntry == null) {
              firstEntry=new SerialTriangleEntry();
              map.put(fi,firstEntry);
            }
            firstEntry.add(current);
            Integer si=Integer.valueOf(current);
            SerialTriangleEntry secondEntry=map.get(si);
            if (secondEntry == null) {
              secondEntry=new SerialTriangleEntry();
              map.put(si,secondEntry);
            }
            secondEntry.add(first);
            current=0;
          }
 else           if (next == ',') {
            first=current;
            current=0;
          }
 else {
            current*=10;
            current+=(next - '0');
          }
        }
        buffer.clear();
      }
    }
 catch (    IOException ioex) {
      System.err.println("Error reading the input into the hashtable: " + ioex.getMessage());
      ioex.printStackTrace(System.err);
      return;
    }
 finally {
      try {
        if (channel != null) {
          channel.close();
          channel=null;
        }
        if (file != null) {
          file.close();
          file=null;
        }
      }
 catch (      IOException ioex) {
        System.err.println("Error closing the input file: " + ioex.getMessage());
        ioex.printStackTrace(System.err);
        return;
      }
    }
    long readAndBuildElapsed=System.nanoTime() - readAndBuildStart;
    System.out.println("Reading and Building took: " + (readAndBuildElapsed / 1000000) + "msecs");
  }
{
    long sortingStart=System.nanoTime();
    for (    Map.Entry<Integer,SerialTriangleEntry> entry : map.entrySet()) {
      SerialTriangleEntry tEntry=entry.getValue();
      tEntry.finalizeListBuilding();
    }
    long sortingElapsed=System.nanoTime() - sortingStart;
    System.out.println("Finalizing took: " + (sortingElapsed / 1000000) + "msecs");
  }
  long degreeComputationStart=System.nanoTime();
  final Iterator<Map.Entry<Integer,SerialTriangleEntry>> entryIter=map.entrySet().iterator();
  while (entryIter.hasNext()) {
    final Map.Entry<Integer,SerialTriangleEntry> entry=entryIter.next();
    final int key=entry.getKey().intValue();
    final SerialTriangleEntry tEntry=entry.getValue();
    final int degree=tEntry.size();
    for (int i=0; i < degree; i++) {
      Integer id=Integer.valueOf(tEntry.getId(i));
      final SerialTriangleEntry other=map.get(id);
      other.setDegree(key,degree);
    }
  }
  long degreeComputationElapsed=System.nanoTime() - degreeComputationStart;
  System.out.println("Degree computation took: " + (degreeComputationElapsed / 1000000) + "msecs");
}
