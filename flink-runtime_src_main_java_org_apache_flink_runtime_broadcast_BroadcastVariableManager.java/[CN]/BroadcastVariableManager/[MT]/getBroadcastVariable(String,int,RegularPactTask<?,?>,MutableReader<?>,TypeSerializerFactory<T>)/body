{
  final BroadcastVariableKey key=new BroadcastVariableKey(holder.getEnvironment().getJobVertexId(),name,superstep);
  while (true) {
    final BroadcastVariableMaterialization<T> newMat=new BroadcastVariableMaterialization<T>(key);
    final BroadcastVariableMaterialization<?> previous=variables.putIfAbsent(key,newMat);
    @SuppressWarnings("unchecked") final BroadcastVariableMaterialization<T> materialization=(previous == null) ? newMat : (BroadcastVariableMaterialization<T>)previous;
    try {
      return materialization.getMaterializedVariable(reader,serializerFactory,holder);
    }
 catch (    MaterializationExpiredException e) {
      if (variables.replace(key,previous,newMat)) {
        try {
          return newMat.getMaterializedVariable(reader,serializerFactory,holder);
        }
 catch (        MaterializationExpiredException ee) {
        }
      }
    }
  }
}
