{
  LOG.info("-------------------------------------------------------------------------");
  LOG.info("    Starting KafkaTestBase ");
  LOG.info("-------------------------------------------------------------------------");
  Class<?> clazz=Class.forName("org.apache.flink.streaming.connectors.kafka.KafkaTestEnvironmentImpl");
  kafkaServer=(KafkaTestEnvironment)InstantiationUtil.instantiate(clazz);
  LOG.info("Starting KafkaTestBase.prepare() for Kafka " + kafkaServer.getVersion());
  kafkaServer.prepare(NUMBER_OF_KAFKA_SERVERS);
  standardProps=kafkaServer.getStandardProperties();
  brokerConnectionStrings=kafkaServer.getBrokerConnectionString();
  Configuration flinkConfig=new Configuration();
  flinkConfig.setInteger(ConfigConstants.LOCAL_NUMBER_TASK_MANAGER,1);
  flinkConfig.setInteger(ConfigConstants.TASK_MANAGER_NUM_TASK_SLOTS,8);
  flinkConfig.setInteger(ConfigConstants.TASK_MANAGER_MEMORY_SIZE_KEY,16);
  flinkConfig.setString(ConfigConstants.RESTART_STRATEGY_FIXED_DELAY_DELAY,"0 s");
  flinkConfig.setString(ConfigConstants.METRICS_REPORTERS_LIST,"my_reporter");
  flinkConfig.setString(ConfigConstants.METRICS_REPORTER_PREFIX + "my_reporter." + ConfigConstants.METRICS_REPORTER_CLASS_SUFFIX,JMXReporter.class.getName());
  flink=new ForkableFlinkMiniCluster(flinkConfig,false);
  flink.start();
  flinkPort=flink.getLeaderRPCPort();
}
