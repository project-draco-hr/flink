{
  final T record=this.nextRecordToSerialize;
  if (record == null) {
    return 0;
  }
  if (writableByteChannel != this.lastWritableByteChannel) {
    final Buffer buffer=(Buffer)writableByteChannel;
    if (buffer.isBackedByMemory()) {
      throw new IllegalStateException("This record serializer only works with memory backed buffers");
    }
    this.wrapper=new DataOutputWrapper(((MemoryBuffer)buffer).getByteBuffer());
    this.lastWritableByteChannel=writableByteChannel;
  }
  record.write(this.wrapper);
  return 0;
}
