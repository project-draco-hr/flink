{
  this.maximumBufferSize=bufferProvider.getMaximumBufferSize();
  try {
    final Buffer buf=bufferProvider.requestEmptyBuffer(this.maximumBufferSize);
    if (buf == null) {
      throw new IllegalStateException("Cannot retrieve compression buffer");
    }
    if (!buf.isBackedByMemory()) {
      throw new IllegalStateException("Compression buffer is not backed by memory");
    }
    this.compressionBuffer=(MemoryBuffer)buf;
  }
 catch (  IOException ioe) {
    throw new RuntimeException(StringUtils.stringifyException(ioe));
  }
  if (allocateTempBuffer) {
    try {
      final Buffer buf=bufferProvider.requestEmptyBuffer(this.maximumBufferSize);
      if (buf == null) {
        throw new IllegalStateException("Cannot retrieve temporary buffer");
      }
      if (!buf.isBackedByMemory()) {
        throw new IllegalStateException("Temporary buffer is not backed by memory");
      }
      this.temporaryBuffer=(MemoryBuffer)buf;
    }
 catch (    IOException ioe) {
      throw new RuntimeException(StringUtils.stringifyException(ioe));
    }
  }
 else {
    this.temporaryBuffer=null;
  }
}
