{
synchronized (lock) {
    discarded=true;
    numAcknowledgedTasks=-1;
    try {
      if (releaseState) {
        for (        TaskState taskState : taskStates.values()) {
          taskState.discard(userClassLoader);
        }
      }
    }
  finally {
      taskStates.clear();
      notYetAcknowledgedTasks.clear();
    }
  }
}
