{
  List<DataSinkNode> previewPlan;
  if (isUsingProgramEntryPoint()) {
    previewPlan=PactCompiler.createPreOptimizedPlan(getPlan());
  }
 else   if (isUsingInteractiveMode()) {
    PreviewPlanEnvironment env=new PreviewPlanEnvironment();
    env.setAsContext();
    try {
      invokeInteractiveModeForExecution();
    }
 catch (    ProgramAbortException e) {
    }
catch (    ProgramInvocationException e) {
      throw e;
    }
catch (    Throwable t) {
      throw new ProgramInvocationException("Program invokation failed with " + t.getClass().getSimpleName() + ": "+ t.getMessage(),t);
    }
    previewPlan=env.previewPlan;
  }
 else {
    throw new RuntimeException();
  }
  PlanJSONDumpGenerator jsonGen=new PlanJSONDumpGenerator();
  StringWriter string=new StringWriter(1024);
  PrintWriter pw=null;
  try {
    pw=new PrintWriter(string);
    jsonGen.dumpPactPlanAsJSON(previewPlan,pw);
  }
  finally {
    pw.close();
  }
  return string.toString();
}
