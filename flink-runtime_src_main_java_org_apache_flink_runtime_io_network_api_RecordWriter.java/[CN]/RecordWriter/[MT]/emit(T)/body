{
  for (  int targetChannel : this.channelSelector.selectChannels(record,this.numChannels)) {
    RecordSerializer<T> serializer=this.serializers[targetChannel];
    RecordSerializer.SerializationResult result=serializer.addRecord(record);
    while (result.isFullBuffer()) {
      Buffer buffer=serializer.getCurrentBuffer();
      if (buffer != null) {
        sendBuffer(buffer,targetChannel);
      }
      buffer=this.bufferPool.requestBufferBlocking(this.bufferPool.getBufferSize());
      result=serializer.setNextBuffer(buffer);
    }
  }
}
