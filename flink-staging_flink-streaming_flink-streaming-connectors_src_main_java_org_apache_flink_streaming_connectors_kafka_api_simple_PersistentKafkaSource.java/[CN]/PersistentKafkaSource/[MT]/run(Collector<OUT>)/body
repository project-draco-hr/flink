{
  MessageWithOffset msg;
  while (iterator.hasNext()) {
    msg=iterator.nextWithOffset();
    gotMessage(msg);
    OUT out=schema.deserialize(msg.getMessage());
    collector.collect(out);
    if (checkpointCounter > NUM_RECORDS_PER_CHECKPOINT) {
      kafkaOffSet=new SimpleState<Long>(msg.getOffset());
      kafkaOffSet.checkpoint();
    }
  }
}
