{
  boolean success=false;
synchronized (queues) {
    checkInProducePhase();
    try {
      if (!isReleased) {
        for (        IntermediateResultPartitionQueue queue : queues) {
          queue.finish();
        }
        success=true;
      }
    }
  finally {
      isFinished=true;
    }
  }
  if (success) {
    maybeNotifyConsumers(true);
    if (!partitionType.isPersistent() && bufferPool != null) {
      bufferPool.destroy();
    }
  }
}
