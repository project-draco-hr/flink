{
  MesosWorkerStore workerStore;
  RecoveryMode recoveryMode=RecoveryMode.fromConfig(flinkConfig);
  if (recoveryMode == RecoveryMode.STANDALONE) {
    workerStore=new StandaloneMesosWorkerStore();
  }
 else   if (recoveryMode == RecoveryMode.ZOOKEEPER) {
    CuratorFramework client=ZooKeeperUtils.startCuratorFramework(flinkConfig);
    workerStore=ZooKeeperMesosWorkerStore.createMesosWorkerStore(client,flinkConfig);
  }
 else {
    throw new IllegalConfigurationException("Unexpected recovery mode '" + recoveryMode + ".");
  }
  return workerStore;
}
