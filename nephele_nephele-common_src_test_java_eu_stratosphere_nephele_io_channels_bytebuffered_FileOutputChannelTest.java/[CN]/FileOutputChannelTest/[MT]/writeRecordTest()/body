{
  StringRecord record=new StringRecord("abc");
  Decompressor decompressorMock=mock(Decompressor.class);
  this.uncompressedDataBuffer=mock(Buffer.class);
  BufferPairResponse bufferPair=new BufferPairResponse(this.uncompressedDataBuffer,this.uncompressedDataBuffer);
  PowerMockito.mockStatic(CompressionLoader.class);
  when(CompressionLoader.getDecompressorByCompressionLevel(Matchers.any(CompressionLevel.class))).thenReturn(decompressorMock);
  OutputGate<StringRecord> outGate=mock(OutputGate.class);
  ByteBufferedOutputChannelBroker outputBroker=mock(ByteBufferedOutputChannelBroker.class);
  when(outputBroker.requestEmptyWriteBuffers()).thenReturn(bufferPair);
  when(this.serializationBuffer.dataLeftFromPreviousSerialization()).thenReturn(true,false,false,true,false);
  when(this.uncompressedDataBuffer.remaining()).thenReturn(0);
  FileOutputChannel<StringRecord> fileOutputChannel=new FileOutputChannel<StringRecord>(outGate,1,null,CompressionLevel.NO_COMPRESSION);
  fileOutputChannel.setByteBufferedOutputChannelBroker(outputBroker);
  Whitebox.setInternalState(fileOutputChannel,"serializationBuffer",this.serializationBuffer);
  try {
    fileOutputChannel.writeRecord(record);
  }
 catch (  IOException e) {
    fail();
    e.printStackTrace();
  }
  fileOutputChannel.requestClose();
  assertEquals(false,fileOutputChannel.isClosed());
  fileOutputChannel.processEvent(new ByteBufferedChannelCloseEvent());
  assertEquals(true,fileOutputChannel.isClosed());
  try {
    fileOutputChannel.writeRecord(record);
    fail();
  }
 catch (  IOException e) {
  }
}
