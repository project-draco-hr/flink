{
  if (this.inLastBlock) {
    throw new EOFException();
  }
  if (this.currentSegment != null) {
    this.positionBeforeSegment+=this.limitInSegment - ChannelWriterOutputView.HEADER_LENGTH;
    sendReadRequest(this.currentSegment);
  }
  final MemorySegment seg;
  try {
    seg=this.reader.getReturnQueue().take();
  }
 catch (  InterruptedException iex) {
    throw new IOException("ChannelWriterOutputView was interrupted while waiting for the next buffer");
  }
  if (seg.getShort(0) != ChannelWriterOutputView.HEADER_MAGIC_NUMBER) {
    throw new IOException("The current block does not belong to a ChannelWriterOutputView / ChannelReaderInputView: Wrong magic number.");
  }
  this.currentSegment=seg;
  this.positionInSegment=ChannelWriterOutputView.HEADER_LENGTH;
  this.limitInSegment=seg.getInt(ChannelWriterOutputView.HEAD_BLOCK_LENGTH_OFFSET);
  if ((seg.getShort(ChannelWriterOutputView.HEADER_FLAGS_OFFSET) & ChannelWriterOutputView.FLAG_LAST_BLOCK) != 0) {
    this.numRequestsRemaining=0;
    this.inLastBlock=true;
  }
}
