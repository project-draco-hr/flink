{
  if (this.closed) {
    throw new IllegalStateException("Already closed.");
  }
  this.closed=true;
  ArrayList<MemorySegment> list=new ArrayList<MemorySegment>(this.numSegments);
  list.add(this.currentSegment);
  this.currentSegment=null;
  final LinkedBlockingQueue<MemorySegment> queue=this.reader.getReturnQueue();
  this.reader.close();
  for (int i=1; i < this.numSegments; i++) {
    final MemorySegment m=queue.poll();
    if (m == null) {
      throw new RuntimeException("Bug in ChannelReaderInputView: MemorySegments lost.");
    }
    list.add(m);
  }
  return list;
}
