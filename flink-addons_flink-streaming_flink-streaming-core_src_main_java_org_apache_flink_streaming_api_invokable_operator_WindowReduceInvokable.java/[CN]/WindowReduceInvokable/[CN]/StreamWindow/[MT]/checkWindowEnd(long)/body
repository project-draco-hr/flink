{
  nextRecordTime=timeStamp;
  while (miniBatchEnd()) {
    addToBuffer();
    if (batchEnd()) {
      reduceBatch();
    }
  }
}
