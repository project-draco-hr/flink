{
  if (count == 0) {
    if (segments.size() == 1) {
      currentWriteSegment=null;
      memoryManager.release(segments);
    }
 else     if (segments.size() > 1) {
      throw new RuntimeException("Too many memory segments left");
    }
  }
  return count;
}
