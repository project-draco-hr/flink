{
  Configuration config=new Configuration();
  ForkableFlinkMiniCluster cluster=new ForkableFlinkMiniCluster(config,false);
  final StreamExecutionEnvironment env=StreamExecutionEnvironment.createRemoteEnvironment("localhost",cluster.getJobManagerRPCPort());
  long N=10;
  DataStream<Long> stream=env.generateSequence(1,N);
  long i=1;
  for (Iterator it=DataStreamUtils.collect(stream); it.hasNext(); ) {
    Long x=(Long)it.next();
    if (x != i) {
      Assert.fail(String.format("Should have got %d, got %d instead.",i,x));
    }
    i++;
  }
  if (i != N + 1) {
    Assert.fail(String.format("Should have collected %d numbers, got %d instead.",N,i - 1));
  }
}
