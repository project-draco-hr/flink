{
  String[] programArgs=line.hasOption(ARGS_OPTION.getOpt()) ? line.getOptionValues(ARGS_OPTION.getOpt()) : line.getArgs();
  String jarFilePath=null;
  if (line.hasOption(JAR_OPTION.getOpt())) {
    jarFilePath=line.getOptionValue(JAR_OPTION.getOpt());
  }
 else   if (programArgs.length > 0) {
    jarFilePath=programArgs[0];
    programArgs=Arrays.copyOfRange(programArgs,1,programArgs.length);
  }
 else {
    System.out.println("Error: Jar file is not set.");
    return null;
  }
  File jarFile=new File(jarFilePath);
  if (!jarFile.exists()) {
    System.out.println("Error: Jar file: '" + jarFile + "' does not exist.");
    return null;
  }
 else   if (!jarFile.isFile()) {
    System.out.println("Error: Jar file '" + jarFile + "' is not a file.");
    return null;
  }
  String entryPointClass=line.hasOption(CLASS_OPTION.getOpt()) ? line.getOptionValue(CLASS_OPTION.getOpt()) : null;
  try {
    return entryPointClass == null ? new PackagedProgram(jarFile,programArgs) : new PackagedProgram(jarFile,entryPointClass,programArgs);
  }
 catch (  ProgramInvocationException e) {
    handleError(e);
    return null;
  }
}
