{
  Throwable rootException=graph.getFailureCause();
  List<ExceptionWithContext> localExceptions=new ArrayList<>();
  boolean truncated=false;
  for (  ExecutionVertex task : graph.getAllExecutionVertices()) {
    Throwable t=task.getFailureCause();
    if (t != null) {
      if (localExceptions.size() >= MAX_NUMBER_EXCEPTION_TO_REPORT) {
        truncated=true;
        break;
      }
      InstanceConnectionInfo location=task.getCurrentAssignedResourceLocation();
      String locationString=location != null ? location.getFQDNHostname() + ':' + location.dataPort() : "(unassigned)";
      localExceptions.add(new ExceptionWithContext(t,task.getTaskName(),locationString));
    }
  }
  if (localExceptions.size() == 1 && localExceptions.get(0).getException() == rootException) {
    localExceptions=null;
  }
  return JsonFactory.generateExceptionsJson(rootException,localExceptions,truncated);
}
