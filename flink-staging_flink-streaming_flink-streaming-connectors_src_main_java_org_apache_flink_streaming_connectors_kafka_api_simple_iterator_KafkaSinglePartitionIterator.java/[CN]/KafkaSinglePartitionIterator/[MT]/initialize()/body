{
  PartitionMetadata metadata;
  do {
    metadata=findLeader(hosts,port,topic,partition);
    try {
      Thread.sleep(DEFAULT_WAIT_ON_EMPTY_FETCH);
    }
 catch (    InterruptedException e) {
      throw new InterruptedException("Establishing connection to Kafka failed");
    }
  }
 while (metadata == null);
  if (metadata.leader() == null) {
    throw new RuntimeException("Can't find Leader for Topic and Partition. (at " + hosts.get(0) + ":"+ port);
  }
  leadBroker=metadata.leader().host();
  clientName="Client_" + topic + "_"+ partition;
  consumer=new SimpleConsumer(leadBroker,port,100000,64 * 1024,clientName);
  readOffset=initialOffset.getOffset(consumer,topic,partition,clientName);
  resetFetchResponse(readOffset);
}
