{
  if (LOG.isInfoEnabled()) {
    LOG.info("Initializing consumer {} / {} with hosts {}",topic,partition,hosts);
  }
  PartitionMetadata metadata=getPartitionMetadata();
  leadBroker=metadata.leader();
  clientName="Client_" + topic + "_"+ partition;
  consumer=new SimpleConsumer(leadBroker.host(),leadBroker.port(),consumerConfig.socketTimeoutMs(),consumerConfig.socketReceiveBufferBytes(),clientName);
  try {
    readOffset=initialOffset.getOffset(consumer,topic,partition,clientName);
  }
 catch (  NotLeaderForPartitionException e) {
    throw new RuntimeException("Unable to get offset",e);
  }
  try {
    resetFetchResponse(readOffset);
  }
 catch (  ClosedChannelException e) {
    if (LOG.isWarnEnabled()) {
      LOG.warn("Got ClosedChannelException, trying to find new leader.");
    }
    findNewLeader();
  }
}
