{
  FetchRequest req=new FetchRequestBuilder().clientId(clientName).addFetch(topic,partition,offset,consumerConfig.fetchMessageMaxBytes()).build();
  fetchResponse=consumer.fetch(req);
  if (fetchResponse.hasError()) {
    short code=fetchResponse.errorCode(topic,partition);
    if (LOG.isErrorEnabled()) {
      LOG.error("Error fetching data from the Broker:" + leadBroker + " Reason: "+ code);
    }
    if (code == ErrorMapping.OffsetOutOfRangeCode()) {
      if (LOG.isErrorEnabled()) {
        LOG.error("Asked for invalid offset {}",offset);
      }
      String reset=consumerConfig.autoOffsetReset();
      if (reset.equals("smallest")) {
        LOG.info("Setting read offset to beginning (smallest)");
        readOffset=new BeginningOffset().getOffset(consumer,topic,partition,clientName);
      }
 else       if (reset.equals("largest")) {
        LOG.info("Setting read offset to current offset (largest)");
        readOffset=new CurrentOffset().getOffset(consumer,topic,partition,clientName);
      }
 else {
        throw new RuntimeException("Unknown 'autooffset.reset' mode '" + reset + "' Supported values are 'smallest' and 'largest'.");
      }
    }
    findNewLeader();
  }
  iter=fetchResponse.messageSet(topic,partition).iterator();
}
