{
  if (similarityMap.containsKey(ALL_VALUES) && !similarityMap.get(ALL_VALUES).isEmpty()) {
    similarityMap=new Int2ObjectOpenHashMap<List<ValueSimilarity<?>>>(similarityMap);
    List<ValueSimilarity<?>> allSimilarity=similarityMap.remove(ALL_VALUES);
    for (int index=0; index < schema.length; index++) {
      List<ValueSimilarity<?>> similarities=similarityMap.get(index);
      if (similarities == null)       similarityMap.put(index,similarities=new ArrayList<ValueSimilarity<?>>());
      for (      ValueSimilarity sim : allSimilarity)       if (sim.isApplicable(schema[index]))       similarities.add(sim);
    }
  }
  ObjectIterator<Entry<List<ValueSimilarity<?>>>> iterator=similarityMap.int2ObjectEntrySet().iterator();
  while (iterator.hasNext()) {
    Int2ObjectMap.Entry<List<ValueSimilarity<?>>> entry=iterator.next();
    if (entry.getValue().isEmpty())     iterator.remove();
  }
  return similarityMap;
}
