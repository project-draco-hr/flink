{
  Thread.currentThread().setContextClassLoader(prog.getUserCodeClassLoader());
  if (prog.isUsingProgramEntryPoint()) {
    return getOptimizedPlan(prog.getPlanWithJars(),parallelism);
  }
 else   if (prog.isUsingInteractiveMode()) {
    OptimizerPlanEnvironment env=new OptimizerPlanEnvironment(this.compiler);
    if (parallelism > 0) {
      env.setDegreeOfParallelism(parallelism);
    }
    env.setAsContext();
    try {
      prog.invokeInteractiveModeForExecution();
    }
 catch (    ProgramInvocationException e) {
      throw e;
    }
catch (    Throwable t) {
      if (env.optimizerPlan != null) {
        return env.optimizerPlan;
      }
 else {
        throw new ProgramInvocationException("The program caused an error: ",t);
      }
    }
    throw new ProgramInvocationException("The program plan could not be fetched. The program silently swallowed the control flow exceptions.");
  }
 else {
    throw new RuntimeException();
  }
}
