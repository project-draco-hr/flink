{
  if (acks == 0)   return null;
  Map<TopicPartition,ProduceResponse.PartitionResponse> responseMap=new HashMap<TopicPartition,ProduceResponse.PartitionResponse>();
  for (  Map.Entry<TopicPartition,ByteBuffer> entry : partitionRecords.entrySet()) {
    responseMap.put(entry.getKey(),new ProduceResponse.PartitionResponse(Errors.forException(e).code(),ProduceResponse.INVALID_OFFSET));
  }
switch (versionId) {
case 0:
    return new ProduceResponse(responseMap);
default :
  throw new IllegalArgumentException(String.format("Version %d is not valid. Valid versions for %s are 0 to %d",versionId,this.getClass().getSimpleName(),ProtoUtils.latestVersion(ApiKeys.PRODUCE.id)));
}
}
