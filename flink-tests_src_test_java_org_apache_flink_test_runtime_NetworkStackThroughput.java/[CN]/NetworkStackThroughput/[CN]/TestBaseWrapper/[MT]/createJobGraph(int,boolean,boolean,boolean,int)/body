{
  JobGraph jobGraph=new JobGraph("Speed Test");
  SimpleInputVertex producer=new SimpleInputVertex("Speed Test Producer",jobGraph);
  producer.setInvokableClass(SpeedTestProducer.class);
  producer.setNumberOfSubtasks(numSubtasks);
  producer.getConfiguration().setInteger(DATA_VOLUME_GB_CONFIG_KEY,dataVolumeGb);
  producer.getConfiguration().setBoolean(IS_SLOW_SENDER_CONFIG_KEY,isSlowSender);
  JobTaskVertex forwarder=null;
  if (useForwarder) {
    forwarder=new JobTaskVertex("Speed Test Forwarder",jobGraph);
    forwarder.setInvokableClass(SpeedTestForwarder.class);
    forwarder.setNumberOfSubtasks(numSubtasks);
  }
  SimpleOutputVertex consumer=new SimpleOutputVertex("Speed Test Consumer",jobGraph);
  consumer.setInvokableClass(SpeedTestConsumer.class);
  consumer.setNumberOfSubtasks(numSubtasks);
  consumer.getConfiguration().setBoolean(IS_SLOW_RECEIVER_CONFIG_KEY,isSlowReceiver);
  if (useForwarder) {
    producer.connectTo(forwarder,ChannelType.NETWORK,DistributionPattern.BIPARTITE);
    forwarder.connectTo(consumer,ChannelType.NETWORK,DistributionPattern.BIPARTITE);
    forwarder.setVertexToShareInstancesWith(producer);
    consumer.setVertexToShareInstancesWith(producer);
  }
 else {
    producer.connectTo(consumer,ChannelType.NETWORK,DistributionPattern.BIPARTITE);
    producer.setVertexToShareInstancesWith(consumer);
  }
  return jobGraph;
}
