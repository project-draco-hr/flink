{
  final int parallelism=(args != null && args.length > 0) ? Integer.parseInt(args[0]) : 1;
  final String pageViewsFile="hdfs://marrus.local:50040/user/pig/tests/data/pigmix/page_views";
  final String powerUsersFile="hdfs://marrus.local:50040/user/pig/tests/data/pigmix/power_users";
  FileDataSource pageViews=new FileDataSource(TextInputFormat.class,pageViewsFile,"Read PageViews");
  pageViews.setDegreeOfParallelism(parallelism);
  FileDataSource powerUsers=new FileDataSource(TextInputFormat.class,powerUsersFile,"Read PowerUsers");
  powerUsers.setDegreeOfParallelism(parallelism);
  MapContract projectPageViews=new MapContract(ProjectPageViews.class,pageViews,"Project Page Views");
  projectPageViews.setDegreeOfParallelism(parallelism);
  MapContract projectPowerUsers=new MapContract(ProjectPowerUsers.class,powerUsers,"Project Power Users");
  projectPowerUsers.setDegreeOfParallelism(parallelism);
  MatchContract joiner=new MatchContract(Join.class,PactString.class,0,0,projectPowerUsers,projectPageViews,"Join");
  joiner.setDegreeOfParallelism(parallelism);
  ReduceContract group=new ReduceContract(Group.class,PactString.class,0,joiner,"Group");
  group.setDegreeOfParallelism(40);
  FileDataSink sink=new FileDataSink(RecordOutputFormat.class,"hdfs://marrus.local:50040/pigmix/result_L3",group,"Result");
  sink.setDegreeOfParallelism(parallelism);
  sink.getParameters().setInteger(RecordOutputFormat.NUM_FIELDS_PARAMETER,2);
  sink.getParameters().setClass(RecordOutputFormat.FIELD_TYPE_PARAMETER_PREFIX + 0,PactString.class);
  sink.getParameters().setClass(RecordOutputFormat.FIELD_TYPE_PARAMETER_PREFIX + 1,PactDouble.class);
  Plan plan=new Plan(sink,"L3 Big Join with Grouping");
  return plan;
}
