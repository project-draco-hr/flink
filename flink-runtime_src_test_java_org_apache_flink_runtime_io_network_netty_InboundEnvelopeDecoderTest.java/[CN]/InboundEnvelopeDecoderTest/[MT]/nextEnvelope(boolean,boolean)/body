{
  int bufferSize=0;
  AbstractEvent[] events=null;
  if (withBuffer) {
    bufferSize=BUFFER_SIZES[random.nextInt(BUFFER_SIZES.length)];
  }
  if (withEvents) {
    events=new AbstractEvent[random.nextInt(MAX_NUM_EVENTS) + 1];
    for (int i=0; i < events.length; i++) {
      events[i]=(random.nextBoolean() ? new TestEvent1(random.nextLong()) : new TestEvent2(random.nextLong()));
    }
  }
  return nextEnvelope(bufferSize,events);
}
