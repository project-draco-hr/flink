{
  for (  Envelope env : envelopes) {
    ch.writeOutbound(env);
    if (env.getBuffer() != null) {
      verify(env.getBuffer(),times(1)).recycleBuffer();
    }
  }
  CompositeByteBuf encodedEnvelopes=new CompositeByteBuf(ByteBufAllocator.DEFAULT,false,envelopes.length);
  ByteBuf buf;
  while ((buf=(ByteBuf)ch.readOutbound()) != null) {
    encodedEnvelopes.addComponent(buf);
  }
  return encodedEnvelopes.writerIndex(encodedEnvelopes.capacity());
}
