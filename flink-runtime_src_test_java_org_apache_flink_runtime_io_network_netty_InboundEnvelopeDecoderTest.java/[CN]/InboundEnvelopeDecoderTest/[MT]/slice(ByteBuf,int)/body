{
  if (sliceSizes.length == 0) {
    throw new IllegalStateException("Need to provide at least one slice size");
  }
  int numSlices=sliceSizes.length;
  for (int i=1; i < numSlices; i++) {
    sliceSizes[i]+=sliceSizes[i - 1];
  }
  for (int i=0; i < sliceSizes.length - 1; i++) {
    if (sliceSizes[i] >= sliceSizes[i + 1] || sliceSizes[i] <= 0 || sliceSizes[i] >= buf.capacity()) {
      throw new IllegalStateException(String.format("Slice size %s are off for %s",Arrays.toString(sliceSizes),buf));
    }
  }
  ByteBuf[] slices=new ByteBuf[numSlices + 1];
  slices[0]=buf.slice(0,sliceSizes[0]).retain();
  for (int i=1; i < numSlices; i++) {
    slices[i]=buf.slice(sliceSizes[i - 1],sliceSizes[i] - sliceSizes[i - 1]).retain();
  }
  slices[numSlices]=buf.slice(sliceSizes[numSlices - 1],buf.capacity() - sliceSizes[numSlices - 1]).retain();
  return slices;
}
