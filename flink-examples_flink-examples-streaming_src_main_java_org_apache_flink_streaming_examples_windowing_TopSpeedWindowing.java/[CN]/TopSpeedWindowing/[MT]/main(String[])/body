{
  if (!parseParameters(args)) {
    return;
  }
  final StreamExecutionEnvironment env=StreamExecutionEnvironment.getExecutionEnvironment();
  env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);
  @SuppressWarnings({"rawtypes","serial"}) DataStream<Tuple4<Integer,Integer,Double,Long>> carData;
  if (fileInput) {
    carData=env.readTextFile(inputPath).map(new ParseCarData());
  }
 else {
    int numOfCars=2;
    carData=env.addSource(CarSource.create(numOfCars));
  }
  int evictionSec=10;
  double triggerMeters=50;
  DataStream<Tuple4<Integer,Integer,Double,Long>> topSpeeds=carData.assignTimestampsAndWatermarks(new CarTimestamp()).keyBy(0).window(GlobalWindows.create()).evictor(TimeEvictor.of(Time.of(evictionSec,TimeUnit.SECONDS))).trigger(DeltaTrigger.of(triggerMeters,new DeltaFunction<Tuple4<Integer,Integer,Double,Long>>(){
    private static final long serialVersionUID=1L;
    @Override public double getDelta(    Tuple4<Integer,Integer,Double,Long> oldDataPoint,    Tuple4<Integer,Integer,Double,Long> newDataPoint){
      return newDataPoint.f2 - oldDataPoint.f2;
    }
  }
,carData.getType().createSerializer(env.getConfig()))).maxBy(1);
  if (fileOutput) {
    topSpeeds.print();
    topSpeeds.writeAsText(outputPath);
  }
 else {
    topSpeeds.print();
  }
  env.execute("CarTopSpeedWindowingExample");
}
