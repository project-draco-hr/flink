{
  final DatagramPacket requestPacket=new DatagramPacket(new byte[64],64);
  while (!Thread.interrupted()) {
    try {
      this.serverSocket.receive(requestPacket);
      if (!isPacketForUs(requestPacket)) {
        LOG.debug("Received request packet which is not destined to this Nephele setup");
        continue;
      }
      final int packetTypeID=getPacketTypeID(requestPacket);
      if (packetTypeID == JM_LOOKUP_REQUEST_ID) {
        LOG.debug("Received job manager lookup request from " + requestPacket.getSocketAddress());
        final DatagramPacket responsePacket=createJobManagerLookupReplyPacket(this.ipcPort);
        responsePacket.setAddress(requestPacket.getAddress());
        responsePacket.setPort(requestPacket.getPort());
        this.serverSocket.send(responsePacket);
      }
 else       if (packetTypeID == TM_ADDRESS_REQUEST_ID) {
        LOG.debug("Received task manager address request from " + requestPacket.getSocketAddress());
        final DatagramPacket responsePacket=createTaskManagerAddressReplyPacket(requestPacket.getAddress());
        responsePacket.setAddress(requestPacket.getAddress());
        responsePacket.setPort(requestPacket.getPort());
        this.serverSocket.send(responsePacket);
      }
 else {
        LOG.error("Received packet of unknown type " + packetTypeID + ", discarding...");
      }
    }
 catch (    SocketTimeoutException ste) {
      LOG.debug("Discovery service: socket timeout");
    }
catch (    IOException ioe) {
      LOG.error("Discovery service stopped working with IOException:\n" + ioe.toString());
      break;
    }
  }
  this.serverSocket.close();
}
