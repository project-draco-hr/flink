{
  DefaultFullHttpResponse response;
  StringWriter writer=new StringWriter();
  try {
    JsonGenerator gen=JsonFactory.jacksonFactory.createJsonGenerator(writer);
    gen.writeStartObject();
    gen.writeStringField("error",error);
    gen.writeEndObject();
    gen.close();
    response=new DefaultFullHttpResponse(HttpVersion.HTTP_1_1,HttpResponseStatus.BAD_REQUEST,Unpooled.wrappedBuffer(writer.toString().getBytes()));
    response.headers().set(HttpHeaders.Names.CONTENT_TYPE,"application/json");
  }
 catch (  IOException e) {
    response=new DefaultFullHttpResponse(HttpVersion.HTTP_1_1,HttpResponseStatus.BAD_REQUEST,Unpooled.wrappedBuffer(error.getBytes()));
    response.headers().set(HttpHeaders.Names.CONTENT_TYPE,"text/plain");
  }
  response.headers().set(HttpHeaders.Names.CONTENT_ENCODING,"utf-8");
  response.headers().set(HttpHeaders.Names.CONTENT_LENGTH,response.content().readableBytes());
  if (ctx.channel().isActive()) {
    ctx.writeAndFlush(response);
  }
}
