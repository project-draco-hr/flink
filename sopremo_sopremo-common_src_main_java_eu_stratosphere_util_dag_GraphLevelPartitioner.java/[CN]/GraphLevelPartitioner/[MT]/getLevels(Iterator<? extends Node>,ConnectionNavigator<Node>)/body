{
  final List<Node> remainingNodes=new IdentityList<Node>();
  while (startNodes.hasNext())   gatherNodes(remainingNodes,navigator,startNodes.next());
  final List<Node> usedNodes=new IdentityList<Node>();
  final List<Level<Node>> levels=new ArrayList<Level<Node>>();
  while (!remainingNodes.isEmpty()) {
    final List<Node> independentNodes=new ArrayList<Node>();
    for (    final Node node : remainingNodes)     if (isIndependent(node,usedNodes,navigator))     independentNodes.add(node);
    if (independentNodes.isEmpty())     throw new IllegalStateException("graph does not have nodes without input");
    levels.add(new Level<Node>(independentNodes,navigator));
    remainingNodes.removeAll(independentNodes);
    usedNodes.addAll(independentNodes);
  }
  return levels;
}
