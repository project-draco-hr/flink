{
  while (true) {
    ExecutionState2 current=this.executionState;
    if (current == ExecutionState2.CANCELED || current == ExecutionState2.CANCELING) {
      return;
    }
    if (STATE_UPDATER.compareAndSet(this,current,ExecutionState2.FAILED)) {
      String message=ExceptionUtils.stringifyException(error);
      notifyObservers(ExecutionState2.FAILED,message);
      taskManager.notifyExecutionStateChange(jobId,executionId,ExecutionState2.FAILED,message);
      return;
    }
  }
}
