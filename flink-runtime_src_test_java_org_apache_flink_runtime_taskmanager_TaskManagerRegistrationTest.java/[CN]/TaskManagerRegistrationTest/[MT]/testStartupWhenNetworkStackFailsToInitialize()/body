{
  ServerSocket blocker=null;
  try {
    blocker=new ServerSocket(0,50,InetAddress.getByName("localhost"));
    final Configuration cfg=new Configuration();
    cfg.setString(ConfigConstants.TASK_MANAGER_HOSTNAME_KEY,"localhost");
    cfg.setInteger(ConfigConstants.TASK_MANAGER_DATA_PORT_KEY,blocker.getLocalPort());
    cfg.setInteger(ConfigConstants.TASK_MANAGER_MEMORY_SIZE_KEY,1);
    new JavaTestKit(actorSystem){
{
        ActorRef taskManager=null;
        ActorRef jobManager=null;
        ActorRef resourceManager=null;
        try {
          jobManager=startJobManager(config);
          resourceManager=startResourceManager(config,jobManager);
          taskManager=TaskManager.startTaskManagerComponentsAndActor(cfg,ResourceID.generate(),actorSystem,"localhost",NONE_STRING,new Some<LeaderRetrievalService>(new StandaloneLeaderRetrievalService(jobManager.path().toString())),false,TaskManager.class);
          watch(taskManager);
          expectTerminated(timeout,taskManager);
        }
 catch (        Exception e) {
          e.printStackTrace();
          fail(e.getMessage());
        }
 finally {
          stopActor(taskManager);
          stopActor(jobManager);
        }
      }
    }
;
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
 finally {
    if (blocker != null) {
      try {
        blocker.close();
      }
 catch (      IOException e) {
      }
    }
  }
}
