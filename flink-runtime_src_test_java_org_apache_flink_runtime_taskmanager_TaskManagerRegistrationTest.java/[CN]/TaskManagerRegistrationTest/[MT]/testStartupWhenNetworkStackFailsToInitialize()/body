{
  ServerSocket blocker=null;
  try {
    blocker=new ServerSocket(0,50,InetAddress.getByName("localhost"));
    final Configuration cfg=new Configuration();
    cfg.setString(ConfigConstants.TASK_MANAGER_HOSTNAME_KEY,"localhost");
    cfg.setInteger(ConfigConstants.TASK_MANAGER_DATA_PORT_KEY,blocker.getLocalPort());
    cfg.setInteger(ConfigConstants.TASK_MANAGER_MEMORY_SIZE_KEY,1);
    new JavaTestKit(actorSystem){
{
        try {
          final ActorRef jobManager=startJobManager();
          final ActorRef taskManager=TaskManager.startTaskManagerComponentsAndActor(cfg,actorSystem,"localhost",NONE_STRING,new Some<String>(jobManager.path().toString()),false,TaskManager.class);
          watch(taskManager);
          expectTerminated(new FiniteDuration(20,TimeUnit.SECONDS),taskManager);
          stopActor(taskManager);
          stopActor(jobManager);
        }
 catch (        Exception e) {
          e.printStackTrace();
          fail(e.getMessage());
        }
      }
    }
;
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
 finally {
    if (blocker != null) {
      try {
        blocker.close();
      }
 catch (      IOException e) {
      }
    }
  }
}
