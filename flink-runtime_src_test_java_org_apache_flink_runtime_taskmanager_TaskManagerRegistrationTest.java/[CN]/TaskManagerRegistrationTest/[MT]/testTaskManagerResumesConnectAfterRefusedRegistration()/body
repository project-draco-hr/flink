{
  new JavaTestKit(actorSystem){
{
      try {
        final ActorRef taskManager=startTaskManager(getTestActor());
        new Within(new FiniteDuration(2,TimeUnit.SECONDS)){
          @Override protected void run(){
            expectMsgClass(RegisterTaskManager.class);
            getLastSender().tell(new RefuseRegistration(UUID.randomUUID(),"test reason"),getTestActor());
          }
        }
;
        FiniteDuration maxDelay=(FiniteDuration)TaskManager.DELAY_AFTER_REFUSED_REGISTRATION().$times(2.0);
        new Within(maxDelay){
          @Override protected void run(){
            expectMsgClass(RegisterTaskManager.class);
          }
        }
;
        stopActor(taskManager);
      }
 catch (      Throwable e) {
        e.printStackTrace();
        fail(e.getMessage());
      }
    }
  }
;
}
