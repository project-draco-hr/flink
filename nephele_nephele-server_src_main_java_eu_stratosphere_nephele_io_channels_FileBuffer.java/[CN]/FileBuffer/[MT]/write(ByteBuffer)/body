{
  if (!this.writeMode) {
    throw new IOException("Cannot write to buffer, buffer already switched to read mode");
  }
  if (this.totalBytesWritten >= this.bufferSize) {
    return 0;
  }
  int bytesWritten;
  final int rem=(int)(this.bufferSize - this.totalBytesWritten);
  if (src.remaining() > rem) {
    final int excess=src.remaining() - rem;
    src.limit(src.limit() - excess);
    bytesWritten=this.fileChannel.write(src,this.offset + this.totalBytesWritten);
    src.limit(src.limit() + excess);
  }
 else {
    bytesWritten=this.fileChannel.write(src,this.offset + this.totalBytesWritten);
  }
  this.totalBytesWritten+=bytesWritten;
  return bytesWritten;
}
