{
  if (!this.writeMode) {
    throw new IOException("Cannot write to buffer, buffer already switched to read mode");
  }
  if (this.fileChannel == null) {
    try {
      this.fileChannel=this.fileBufferManager.getFileChannelForWriting(this.channelID);
    }
 catch (    ChannelCanceledException e) {
      throw new IOException("Received unexpected ChannelCanceledException");
    }
    if (this.fileChannel == null) {
      return 0;
    }
  }
  if (this.totalBytesWritten >= this.bufferSize) {
    return 0;
  }
  final long bytesWritten=this.fileChannel.write(src);
  this.totalBytesWritten+=bytesWritten;
  return (int)bytesWritten;
}
