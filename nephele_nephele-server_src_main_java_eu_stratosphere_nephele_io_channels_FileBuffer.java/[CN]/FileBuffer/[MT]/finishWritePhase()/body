{
  if (this.writeMode.compareAndSet(true,false)) {
    final long currentFileSize=this.offset + this.totalBytesWritten;
    if (this.fileChannel != null) {
      this.fileChannel.position(currentFileSize);
    }
    this.fileChannel=null;
    this.bufferSize=this.totalBytesWritten;
    this.fileID=this.fileBufferManager.reportEndOfWritePhase(this.ownerID,currentFileSize);
  }
}
