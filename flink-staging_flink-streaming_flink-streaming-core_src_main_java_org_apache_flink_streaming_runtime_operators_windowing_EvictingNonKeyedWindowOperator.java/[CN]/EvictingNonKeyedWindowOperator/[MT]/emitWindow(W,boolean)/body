{
  timestampedCollector.setTimestamp(window.getEnd());
  Tuple2<WindowBuffer<IN>,TriggerContext> bufferAndTrigger;
  if (purge) {
    bufferAndTrigger=windows.remove(window);
  }
 else {
    bufferAndTrigger=windows.get(window);
  }
  if (bufferAndTrigger == null) {
    LOG.debug("Window {} already gone.",window);
    return;
  }
  EvictingWindowBuffer<IN> windowBuffer=(EvictingWindowBuffer<IN>)bufferAndTrigger.f0;
  int toEvict=0;
  if (windowBuffer.size() > 0) {
    toEvict=evictor.evict((Iterable)windowBuffer.getElements(),windowBuffer.size(),window);
  }
  windowBuffer.removeElements(toEvict);
  userFunction.apply(window,bufferAndTrigger.f0.getUnpackedElements(),timestampedCollector);
}
