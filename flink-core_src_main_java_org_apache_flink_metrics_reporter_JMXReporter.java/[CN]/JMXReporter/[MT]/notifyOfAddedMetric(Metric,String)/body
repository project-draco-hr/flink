{
  AbstractBean jmxMetric;
  ObjectName jmxName;
  try {
    jmxName=new ObjectName(name);
  }
 catch (  MalformedObjectNameException e) {
    throw new IllegalArgumentException("Metric name did not conform to JMX ObjectName rules: " + name,e);
  }
  if (metric instanceof Gauge) {
    jmxMetric=new JmxGauge((Gauge<?>)metric);
  }
 else   if (metric instanceof Counter) {
    jmxMetric=new JmxCounter((Counter)metric);
  }
 else {
    throw new IllegalArgumentException("Unknown metric type: " + metric.getClass());
  }
  try {
    mBeanServer.registerMBean(jmxMetric,jmxName);
  }
 catch (  NotCompliantMBeanException e) {
    LOG.error("Metric did not comply with JMX MBean naming rules.",e);
  }
catch (  InstanceAlreadyExistsException e) {
    LOG.error("A metric with the name " + jmxName + " was already registered.",e);
  }
catch (  MBeanRegistrationException e) {
    LOG.error("Failed to register metric.",e);
  }
}
