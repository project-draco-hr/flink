{
  PactRecord rec;
  if (this.currentIterator != null && (rec=this.currentIterator.next(target)) != null) {
    return rec;
  }
 else   if (this.closed) {
    throw new IllegalStateException();
  }
 else {
    while (true) {
      if (this.currentElement == SENTINEL) {
        return null;
      }
 else       if (this.currentElement != null) {
        this.currentElement.buffer.reset();
        this.queues.empty.add(this.currentElement);
      }
      try {
        this.currentElement=queues.spill.take();
        if (this.currentElement == SENTINEL) {
          return null;
        }
        if (this.currentElement == SPILLING_MARKER) {
          this.currentElement=null;
          continue;
        }
      }
 catch (      InterruptedException e) {
        throw new RuntimeException("Iterator was interrupted getting the next sortedBuffer.");
      }
      this.currentIterator=this.currentElement.buffer.getIterator();
      if ((rec=this.currentIterator.next(target)) != null) {
        return rec;
      }
      this.currentIterator=null;
    }
  }
}
