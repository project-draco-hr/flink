{
  try {
    while (running) {
      try {
        Thread.sleep(commitInterval);
        @SuppressWarnings("unchecked") HashMap<KafkaTopicPartition,Long> currentOffsets=new HashMap<>(consumer.partitionState.size());
        for (        Map.Entry<KafkaTopicPartition,KafkaPartitionState> entry : consumer.partitionState.entrySet()) {
          currentOffsets.put(entry.getKey(),entry.getValue().getOffset());
        }
        consumer.commitOffsets(currentOffsets);
      }
 catch (      InterruptedException e) {
        if (running) {
          throw e;
        }
      }
    }
  }
 catch (  Throwable t) {
    LOG.warn("Periodic checkpoint committer is stopping the fetcher because of an error",t);
    consumer.fetcher.stopWithError(t);
  }
}
