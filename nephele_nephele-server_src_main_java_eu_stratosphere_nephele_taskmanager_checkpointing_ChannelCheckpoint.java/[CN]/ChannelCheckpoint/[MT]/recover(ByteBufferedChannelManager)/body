{
  if (!this.checkpointFinished) {
    LOG.debug("Checkpoint is not yet finished!");
  }
  if (this.fileChannel.isOpen()) {
    LOG.debug("File channel is still open!");
  }
  final String filename=getFilename();
  FileInputStream fis=null;
  try {
    fis=new FileInputStream(filename);
  }
 catch (  IOException ioe) {
    LOG.error(ioe);
    return;
  }
  try {
    byteBufferedChannelManager.getFileBufferManager().registerExternalDataSourceForChannel(this.sourceChannelID,filename);
  }
 catch (  IOException ioe) {
    LOG.error(ioe);
  }
  this.fileInputChannel=fis.getChannel();
  if (this.fileInputChannel == null) {
    LOG.error("FileChannel is null");
  }
  final CheckpointOutgoingConnection outgoingConnection=byteBufferedChannelManager.createOutgoingCheckpointConnection(byteBufferedChannelManager,this.fileInputChannel,this.sourceChannelID);
  LOG.info("Recovering from " + filename + " to "+ outgoingConnection.getConnectionAddress().getHostName()+ ":"+ outgoingConnection.getConnectionAddress().getPort()+ "//"+ outgoingConnection.getConnectionAddress());
  try {
    outgoingConnection.write(this.fileChannel.size());
  }
 catch (  IOException e) {
    e.printStackTrace();
    outgoingConnection.reportTransmissionProblem(e);
    return;
  }
  LOG.info("Finished Recovery for channel " + this.sourceChannelID + " to "+ outgoingConnection.getConnectionAddress().getHostName());
  System.out.println("Finished Recovery");
  this.finishCheckpoint=false;
}
