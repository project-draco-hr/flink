{
  final String filename=getFilename();
  FileInputStream fis=null;
  try {
    fis=new FileInputStream(filename);
  }
 catch (  IOException ioe) {
    LOG.info("IO in new FileInputstream");
    LOG.error(ioe);
    return;
  }
  try {
    byteBufferedChannelManager.getFileBufferManager().registerExternalDataSourceForChannel(this.sourceChannelID,filename);
  }
 catch (  IOException ioe) {
    LOG.error(ioe);
  }
  this.fileInputChannel=fis.getChannel();
  LOG.info("Recovering from " + filename);
  if (this.outgoingConnection == null) {
    this.outgoingConnection=byteBufferedChannelManager.createOutgoingCheckpointConnection(byteBufferedChannelManager,this.fileInputChannel,this.sourceChannelID);
  }
  try {
    while (true) {
      this.outgoingConnection.write();
    }
  }
 catch (  EOFException e) {
    LOG.info("EOF. Checkpoint recovered.");
  }
catch (  IOException e) {
    e.printStackTrace();
    return;
  }
  try {
    this.outgoingConnection.closeConnection();
  }
 catch (  IOException e) {
    e.printStackTrace();
  }
}
