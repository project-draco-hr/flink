{
  if (!this.checkpointFinished) {
    LOG.error("Checkpoint is not finished!");
  }
  if (this.fileChannel.isOpen()) {
    LOG.error("File channel is still open!");
  }
  final String filename=getFilename();
  FileInputStream fis=null;
  try {
    fis=new FileInputStream(filename);
  }
 catch (  IOException ioe) {
    LOG.error(ioe);
    return;
  }
  try {
    fileBufferManager.registerExternalDataSourceForChannel(this.sourceChannelID,filename);
  }
 catch (  IOException ioe) {
    LOG.error(ioe);
  }
  this.fileChannel=fis.getChannel();
  final IncomingConnection incomingConnection=networkConnectionManager.registerIncomingConnection(connectionID,this.fileChannel);
  try {
    while (true) {
      incomingConnection.read();
    }
  }
 catch (  EOFException e) {
  }
catch (  IOException e) {
    incomingConnection.reportTransmissionProblem(null,e);
    return;
  }
catch (  InterruptedException e) {
    LOG.info("Caught interrupted exception: " + StringUtils.stringifyException(e));
  }
  incomingConnection.closeConnection(null);
}
