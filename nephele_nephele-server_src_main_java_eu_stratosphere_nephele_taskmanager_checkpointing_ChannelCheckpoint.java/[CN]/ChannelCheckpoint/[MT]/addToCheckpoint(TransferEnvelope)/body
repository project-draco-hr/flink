{
  if (this.checkpointFinished) {
    LOG.error("Recieved Envelope" + transferEnvelope.getSequenceNumber() + " for a finished Checkpoint from "+ transferEnvelope.getSource());
  }
  if (transferEnvelope.getSequenceNumber() != this.expectedSequenceNumber) {
    throw new IOException("Expected envelope with sequence number " + this.expectedSequenceNumber + " but received "+ transferEnvelope.getSequenceNumber());
  }
  ++this.expectedSequenceNumber;
  if (!transferEnvelope.getSource().equals(this.sourceChannelID)) {
    throw new IOException("Received envelope with unexpected source channel ID " + transferEnvelope.getSource());
  }
  if (this.isPersistent) {
    this.writeEnvelopeToDisk(transferEnvelope);
    Iterator<AbstractEvent> iter=transferEnvelope.getEventList().iterator();
    while (iter.hasNext()) {
      if (iter.next() instanceof ByteBufferedChannelCloseEvent) {
        LOG.info("Envelope " + transferEnvelope.getSequenceNumber() + "contains Close Event");
        markChannelCheckpointAsFinished(transferEnvelope.getSequenceNumber());
      }
    }
  }
 else {
    if (!this.queuedEnvelopes.contains(transferEnvelope)) {
      this.queuedEnvelopes.add(transferEnvelope);
    }
  }
}
