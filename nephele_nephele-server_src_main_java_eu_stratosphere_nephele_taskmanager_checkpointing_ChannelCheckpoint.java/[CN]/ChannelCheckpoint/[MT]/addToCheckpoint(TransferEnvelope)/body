{
  if (transferEnvelope.getSequenceNumber() != this.expectedSequenceNumber) {
    throw new IOException("Expected envelope with sequence number " + this.expectedSequenceNumber + " but received "+ transferEnvelope.getSequenceNumber());
  }
  ++this.expectedSequenceNumber;
  if (!transferEnvelope.getSource().equals(this.sourceChannelID)) {
    throw new IOException("Received envelope with unexpected source channel ID " + transferEnvelope.getSource());
  }
  if (this.isPersistent) {
    this.writeEnvelopeToDisk(transferEnvelope);
  }
 else {
    this.queuedEnvelopes.add(transferEnvelope);
  }
}
