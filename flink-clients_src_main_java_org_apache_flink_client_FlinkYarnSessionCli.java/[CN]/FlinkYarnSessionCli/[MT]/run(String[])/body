{
  Options options=new Options();
  getYARNSessionCLIOptions(options);
  CommandLineParser parser=new PosixParser();
  CommandLine cmd=null;
  try {
    cmd=parser.parse(options,args);
  }
 catch (  Exception e) {
    System.out.println(e.getMessage());
    printUsage();
    return 1;
  }
  if (cmd.hasOption(QUERY.getOpt())) {
    AbstractFlinkYarnClient flinkYarnClient=getFlinkYarnClient();
    String description=null;
    try {
      description=flinkYarnClient.getClusterDescription();
    }
 catch (    Exception e) {
      System.err.println("Error while querying the YARN cluster for available resources: " + e.getMessage());
      e.printStackTrace(System.err);
      return 1;
    }
    System.out.println(description);
    return 0;
  }
 else {
    AbstractFlinkYarnClient flinkYarnClient=createFlinkYarnClient(cmd);
    if (flinkYarnClient == null) {
      System.err.println("Error while starting the YARN Client. Please check log output!");
      return 1;
    }
    try {
      yarnCluster=flinkYarnClient.deploy(null);
    }
 catch (    Exception e) {
      System.err.println("Error while deploying YARN cluster: " + e.getMessage());
      e.printStackTrace(System.err);
      return 1;
    }
    String jobManagerAddress=yarnCluster.getJobManagerAddress().getHostName() + ":" + yarnCluster.getJobManagerAddress().getPort();
    System.err.println("Flink JobManager is now running on " + jobManagerAddress);
    System.err.println("JobManager Web Interface: " + yarnCluster.getWebInterfaceURL());
    String confDirPath=CliFrontend.getConfigurationDirectoryFromEnv();
    File yarnPropertiesFile=new File(confDirPath + File.separator + CliFrontend.YARN_PROPERTIES_FILE);
    Properties yarnProps=new Properties();
    yarnProps.setProperty(CliFrontend.YARN_PROPERTIES_JOBMANAGER_KEY,jobManagerAddress);
    if (flinkYarnClient.getTaskManagerSlots() != -1) {
      yarnProps.setProperty(CliFrontend.YARN_PROPERTIES_DOP,Integer.toString(flinkYarnClient.getTaskManagerSlots() * flinkYarnClient.getTaskManagerCount()));
    }
    if (flinkYarnClient.getDynamicPropertiesEncoded() != null) {
      yarnProps.setProperty(CliFrontend.YARN_PROPERTIES_DYNAMIC_PROPERTIES_STRING,flinkYarnClient.getDynamicPropertiesEncoded());
    }
    writeYarnProperties(yarnProps,yarnPropertiesFile);
    runInteractiveCli(yarnCluster);
    if (!yarnCluster.hasBeenStopped()) {
      LOG.info("Command Line Interface requested session shutdown");
      yarnCluster.shutdown();
    }
    try {
      yarnPropertiesFile.delete();
    }
 catch (    Exception e) {
      LOG.warn("Exception while deleting the JobManager address file",e);
    }
  }
  return 0;
}
