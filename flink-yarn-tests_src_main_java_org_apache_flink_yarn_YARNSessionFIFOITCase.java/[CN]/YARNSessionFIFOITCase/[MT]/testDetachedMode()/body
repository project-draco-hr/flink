{
  LOG.info("Starting testDetachedMode()");
  addTestAppender(FlinkYarnSessionCli.class,Level.INFO);
  Runner runner=startWithArgs(new String[]{"-j",flinkUberjar.getAbsolutePath(),"-t",flinkLibFolder.getAbsolutePath(),"-n","1","-jm","768","-tm","1024","--name","MyCustomName","--detached"},"Flink JobManager is now running on",RunTypes.YARN_SESSION);
  checkForLogString("The Flink YARN client has been started in detached mode");
  Assert.assertFalse("The runner should detach.",runner.isAlive());
  LOG.info("Waiting until two containers are running");
  while (getRunningContainers() < 2) {
    sleep(500);
  }
  LOG.info("Two containers are running. Killing the application");
  try {
    YarnClient yc=YarnClient.createYarnClient();
    yc.init(yarnConfiguration);
    yc.start();
    List<ApplicationReport> apps=yc.getApplications(EnumSet.of(YarnApplicationState.RUNNING));
    Assert.assertEquals(1,apps.size());
    ApplicationReport app=apps.get(0);
    Assert.assertEquals("MyCustomName",app.getName());
    ApplicationId id=app.getApplicationId();
    yc.killApplication(id);
    while (yc.getApplications(EnumSet.of(YarnApplicationState.KILLED)).size() == 0) {
      sleep(500);
    }
  }
 catch (  Throwable t) {
    LOG.warn("Killing failed",t);
    Assert.fail();
  }
  LOG.info("Finished testDetachedMode()");
}
