{
synchronized (queue) {
    if (hasBeenDiscarded) {
      throw new IllegalQueueIteratorRequestException("Queue has been discarded during produce phase.");
    }
    if (hasConsumer) {
      throw new IllegalQueueIteratorRequestException("Consumable once queue has been consumed/is being consumed.");
    }
    hasConsumer=true;
    return new PipelinedPartitionQueueIterator(this);
  }
}
