{
synchronized (queue) {
    Buffer buffer;
    while ((buffer=queue.poll()) != null) {
      if (!buffer.isRecycled()) {
        buffer.recycle();
      }
    }
    hasFinishedProduce=true;
    hasBeenDiscarded=true;
    maybeNotifyListener();
  }
}
