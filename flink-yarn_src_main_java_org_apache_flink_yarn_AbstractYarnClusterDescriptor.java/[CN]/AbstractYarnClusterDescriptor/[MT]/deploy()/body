{
  try {
    UserGroupInformation.setConfiguration(conf);
    UserGroupInformation ugi=UserGroupInformation.getCurrentUser();
    if (UserGroupInformation.isSecurityEnabled()) {
      if (!ugi.hasKerberosCredentials()) {
        throw new YarnDeploymentException("In secure mode. Please provide Kerberos credentials in order to authenticate. " + "You may use kinit to authenticate and request a TGT from the Kerberos server.");
      }
      return ugi.doAs(new PrivilegedExceptionAction<YarnClusterClient>(){
        @Override public YarnClusterClient run() throws Exception {
          return deployInternal();
        }
      }
);
    }
 else {
      return deployInternal();
    }
  }
 catch (  Exception e) {
    throw new RuntimeException("Couldn't deploy Yarn cluster",e);
  }
}
