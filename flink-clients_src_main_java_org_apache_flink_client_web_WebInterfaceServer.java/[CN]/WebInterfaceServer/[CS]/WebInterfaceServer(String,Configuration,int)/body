{
  if (config == null) {
    config=GlobalConfiguration.getConfiguration();
  }
  String basePath=config.getString(ConfigConstants.FLINK_BASE_DIR_PATH_KEY,"");
  File tmpDir;
  File uploadDir;
  File planDumpDir;
  URL webRootDir=this.getClass().getClassLoader().getResource(WEB_ROOT_DIR);
  if (webRootDir == null) {
    throw new FileNotFoundException("Cannot start web interface server because the web " + "root dir " + WEB_ROOT_DIR + " is not included in the jar.");
  }
  String tmpDirPath=config.getString(ConfigConstants.WEB_TMP_DIR_KEY,ConfigConstants.DEFAULT_WEB_TMP_DIR);
  tmpDir=new File(tmpDirPath);
  if (!tmpDir.isAbsolute()) {
    tmpDir=new File(basePath + "/" + tmpDirPath);
  }
  String uploadDirPath=config.getString(ConfigConstants.WEB_JOB_UPLOAD_DIR_KEY,ConfigConstants.DEFAULT_WEB_JOB_STORAGE_DIR);
  uploadDir=new File(uploadDirPath);
  if (!uploadDir.isAbsolute()) {
    uploadDir=new File(basePath + "/" + uploadDirPath);
  }
  String planDumpDirPath=config.getString(ConfigConstants.WEB_PLAN_DUMP_DIR_KEY,ConfigConstants.DEFAULT_WEB_PLAN_DUMP_DIR);
  planDumpDir=new File(planDumpDirPath);
  if (!planDumpDir.isAbsolute()) {
    planDumpDir=new File(basePath + "/" + planDumpDirPath);
  }
  if (LOG.isInfoEnabled()) {
    LOG.info("Setting up web client server, using web-root directory '" + webRootDir.toExternalForm() + "'.");
    LOG.info("Web frontend server will store temporary files in '" + tmpDir.getAbsolutePath() + "', uploaded jobs in '"+ uploadDir.getAbsolutePath()+ "', plan-json-dumps in '"+ planDumpDir.getAbsolutePath()+ "'.");
    LOG.info("Web client will submit jobs to JobManager at " + config.getString(ConfigConstants.JOB_MANAGER_IPC_ADDRESS_KEY,null) + ", port "+ config.getInteger(ConfigConstants.JOB_MANAGER_IPC_PORT_KEY,ConfigConstants.DEFAULT_JOB_MANAGER_IPC_PORT)+ ".");
  }
  server=new Server(port);
  checkAndCreateDirectories(tmpDir,true);
  checkAndCreateDirectories(uploadDir,true);
  checkAndCreateDirectories(planDumpDir,true);
  int jobManagerWebPort=config.getInteger(ConfigConstants.JOB_MANAGER_WEB_PORT_KEY,ConfigConstants.DEFAULT_JOB_MANAGER_WEB_FRONTEND_PORT);
  CliFrontend cli=new CliFrontend(configDir);
  ServletContextHandler servletContext=new ServletContextHandler(ServletContextHandler.SESSIONS);
  servletContext.setContextPath("/");
  servletContext.addServlet(new ServletHolder(new JobJSONServlet(uploadDir)),"/pactPlan");
  servletContext.addServlet(new ServletHolder(new PlanDisplayServlet(jobManagerWebPort)),"/showPlan");
  servletContext.addServlet(new ServletHolder(new JobsServlet(uploadDir,tmpDir,"launch.html")),"/jobs");
  servletContext.addServlet(new ServletHolder(new JobSubmissionServlet(cli,uploadDir,planDumpDir)),"/runJob");
  ResourceHandler pactPlanHandler=new ResourceHandler();
  pactPlanHandler.setDirectoriesListed(false);
  pactPlanHandler.setResourceBase(planDumpDir.getAbsolutePath());
  ContextHandler pactPlanContext=new ContextHandler();
  pactPlanContext.setContextPath("/ajax-plans");
  pactPlanContext.setHandler(pactPlanHandler);
  ResourceHandler resourceHandler=new ResourceHandler();
  resourceHandler.setDirectoriesListed(false);
  resourceHandler.setResourceBase(webRootDir.toExternalForm());
  HandlerList handlers=new HandlerList();
  handlers.addHandler(servletContext);
  handlers.addHandler(pactPlanContext);
  handlers.addHandler(resourceHandler);
  File af=null;
  String authFile=config.getString(ConfigConstants.WEB_ACCESS_FILE_KEY,ConfigConstants.DEFAULT_WEB_ACCESS_FILE_PATH);
  if (authFile != null) {
    af=new File(authFile);
    if (!af.exists()) {
      LOG.error("The specified file '" + af.getAbsolutePath() + "' with the authentication information is missing. Starting server without HTTP authentication.");
      af=null;
    }
  }
  server.setHandler(handlers);
}
