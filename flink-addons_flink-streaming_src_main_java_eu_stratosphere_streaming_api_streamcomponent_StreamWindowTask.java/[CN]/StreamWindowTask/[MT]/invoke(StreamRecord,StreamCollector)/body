{
  int numTuple=record.getBatchSize();
  int tupleIndex=0;
  for (int i=0; i < numTuple; ++i) {
    long progress=record.getTuple(i).getField(windowFieldId);
    if (initTimestamp == -1) {
      initTimestamp=progress;
      nextTimestamp=initTimestamp + computeGranularity;
      tempRecord=new ArrayStreamRecord(record.getBatchSize());
    }
 else {
      if (progress > nextTimestamp) {
        if (window.isFull()) {
          StreamRecord expiredRecord=window.popFront();
          incrementCompute(tempRecord);
          decrementCompute(expiredRecord);
          window.pushBack(tempRecord);
          if (window.isEmittable()) {
            produceRecord(progress);
          }
        }
 else {
          incrementCompute(tempRecord);
          window.pushBack(tempRecord);
          if (window.isFull()) {
            produceRecord(progress);
          }
        }
        initTimestamp=nextTimestamp;
        nextTimestamp=initTimestamp + computeGranularity;
        tempRecord=new ArrayStreamRecord(record.getBatchSize());
      }
      tempRecord.setTuple(tupleIndex++,record.getTuple(i));
    }
  }
}
