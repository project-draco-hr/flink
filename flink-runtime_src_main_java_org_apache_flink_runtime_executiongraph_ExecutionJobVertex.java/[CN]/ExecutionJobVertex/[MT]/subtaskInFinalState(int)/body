{
synchronized (stateMonitor) {
    if (!finishedSubtasks[subtask]) {
      finishedSubtasks[subtask]=true;
      numSubtasksInFinalState++;
      if (numSubtasksInFinalState == parallelism) {
        try {
          getJobVertex().finalizeOnMaster(getGraph().getUserClassLoader());
        }
 catch (        Throwable t) {
          getGraph().fail(t);
        }
        stateMonitor.notifyAll();
        graph.jobVertexInFinalState(this);
      }
    }
  }
}
