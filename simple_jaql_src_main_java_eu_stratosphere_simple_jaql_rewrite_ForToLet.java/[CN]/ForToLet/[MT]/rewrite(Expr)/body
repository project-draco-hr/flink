{
  ForExpr fe=(ForExpr)expr;
  BindingExpr bind=fe.binding();
  Expr inExpr=bind.inExpr();
  if (!(inExpr instanceof ArrayExpr) || inExpr.numChildren() != 1) {
    return false;
  }
  Expr elem=inExpr.child(0);
  Expr ret=fe.collectExpr();
  if (ret.getSchema().is(ARRAY,NULL).maybeNot()) {
    ret=new AsArrayFn(ret);
  }
 else   if (ret.getSchema().is(NULL).maybe()) {
    ret=new EmptyOnNullFn(ret);
  }
  bind.type=BindingExpr.Type.EQ;
  bind.setChild(0,elem);
  Expr doExpr=new DoExpr(bind,ret);
  fe.replaceInParent(doExpr);
  return true;
}
