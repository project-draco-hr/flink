{
  if (!parseParameters(args)) {
    return;
  }
  ExecutionEnvironment env=ExecutionEnvironment.getExecutionEnvironment();
  DataSet<Point> points=getPointDataSet(env);
  DataSet<Centroid> centroids=getCentroidDataSet(env);
  IterativeDataSet<Centroid> loop=centroids.iterate(numIterations);
  DataSet<Centroid> newCentroids=points.map(new SelectNearestCenter()).withBroadcastSet(loop,"centroids").map(new CountAppender()).groupBy(0).reduce(new CentroidAccumulator()).map(new CentroidAverager());
  DataSet<Centroid> finalCentroids=loop.closeWith(newCentroids);
  DataSet<Tuple2<Integer,Point>> clusteredPoints=points.map(new SelectNearestCenter()).withBroadcastSet(finalCentroids,"centroids");
  if (fileOutput) {
    clusteredPoints.writeAsCsv(outputPath,"\n"," ");
  }
 else {
    clusteredPoints.print();
  }
  env.execute("KMeans Example");
}
