def globalvars(func):
    'get objects defined in global scope that are referred to by func\n\n    return a dict of {name:object}'
    if PY3:
        im_func = '__func__'
        func_code = '__code__'
        func_globals = '__globals__'
    else:
        im_func = 'im_func'
        func_code = 'func_code'
        func_globals = 'func_globals'
    if ismethod(func):
        func = getattr(func, im_func)
    if isfunction(func):
        globs = (getattr(func, func_globals) or {})
        func = getattr(func, func_code).co_names
    else:
        return {}
    return dict(((name, globs[name]) for name in func if (name in globs)))
