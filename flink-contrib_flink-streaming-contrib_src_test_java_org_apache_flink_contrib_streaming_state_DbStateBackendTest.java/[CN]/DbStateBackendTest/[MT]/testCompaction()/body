{
  DbBackendConfig conf=new DbBackendConfig("flink","flink",url1);
  MockAdapter adapter=new MockAdapter();
  conf.setKvStateCompactionFrequency(2);
  conf.setDbAdapter(adapter);
  DbStateBackend backend1=new DbStateBackend(conf);
  DbStateBackend backend2=new DbStateBackend(conf);
  DbStateBackend backend3=new DbStateBackend(conf);
  backend1.initializeForJob(new DummyEnvironment("test",3,0),"dummy_1",StringSerializer.INSTANCE);
  backend2.initializeForJob(new DummyEnvironment("test",3,1),"dummy_2",StringSerializer.INSTANCE);
  backend3.initializeForJob(new DummyEnvironment("test",3,2),"dummy_3",StringSerializer.INSTANCE);
  ValueState<String> s1State=backend1.createValueState(StringSerializer.INSTANCE,new ValueStateDescriptor<>("a1",StringSerializer.INSTANCE,null));
  ValueState<String> s2State=backend2.createValueState(StringSerializer.INSTANCE,new ValueStateDescriptor<>("a2",StringSerializer.INSTANCE,null));
  ValueState<String> s3State=backend3.createValueState(StringSerializer.INSTANCE,new ValueStateDescriptor<>("a3",StringSerializer.INSTANCE,null));
  LazyDbValueState<?,?,?> s1=(LazyDbValueState<?,?,?>)s1State;
  LazyDbValueState<?,?,?> s2=(LazyDbValueState<?,?,?>)s2State;
  LazyDbValueState<?,?,?> s3=(LazyDbValueState<?,?,?>)s3State;
  assertTrue(s1.isCompactor());
  assertFalse(s2.isCompactor());
  assertFalse(s3.isCompactor());
  assertNotNull(s1.getExecutor());
  assertNull(s2.getExecutor());
  assertNull(s3.getExecutor());
  s1.snapshot(1,100);
  s1.notifyCheckpointComplete(1);
  s1.snapshot(2,200);
  s1.snapshot(3,300);
  s1.notifyCheckpointComplete(2);
  s1.notifyCheckpointComplete(3);
  s1.snapshot(4,400);
  s1.snapshot(5,500);
  s1.notifyCheckpointComplete(4);
  s1.notifyCheckpointComplete(5);
  s1.dispose();
  s2.dispose();
  s3.dispose();
  s1.getExecutor().awaitTermination(5,TimeUnit.SECONDS);
  assertEquals(2,adapter.numCompcations.get());
  assertEquals(5,adapter.keptAlive);
  backend1.close();
  backend2.close();
  backend3.close();
}
