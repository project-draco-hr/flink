{
  Environment env=new DummyEnvironment("test",1,0);
  DbStateBackend backend=new DbStateBackend(conf);
  backend.initializeForJob(env);
  String state1="dummy state";
  String state2="row row row your boat";
  Integer state3=42;
  StateHandle<String> handle1=backend.checkpointStateSerializable(state1,439568923746L,System.currentTimeMillis());
  StateHandle<String> handle2=backend.checkpointStateSerializable(state2,439568923746L,System.currentTimeMillis());
  StateHandle<Integer> handle3=backend.checkpointStateSerializable(state3,439568923746L,System.currentTimeMillis());
  assertEquals(state1,handle1.getState(getClass().getClassLoader()));
  handle1.discardState();
  assertEquals(state2,handle2.getState(getClass().getClassLoader()));
  handle2.discardState();
  assertFalse(isTableEmpty(backend.getConnection(),"checkpoints_" + env.getJobID().toString()));
  assertEquals(state3,handle3.getState(getClass().getClassLoader()));
  handle3.discardState();
  assertTrue(isTableEmpty(backend.getConnection(),"checkpoints_" + env.getJobID().toString()));
  backend.close();
}
