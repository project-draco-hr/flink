{
  StateBackend stateBackend=StateBackend.fromConfig(config);
  if (stateBackend == StateBackend.FILESYSTEM) {
    String recoveryPath=config.getString(ConfigConstants.STATE_BACKEND_FS_RECOVERY_PATH,"");
    if (recoveryPath.equals("")) {
      throw new IllegalConfigurationException("Missing recovery path. Specify via " + "configuration key '" + ConfigConstants.STATE_BACKEND_FS_RECOVERY_PATH + "'.");
    }
 else {
      return FileStateHandle.createProvider(recoveryPath);
    }
  }
 else {
    throw new IllegalConfigurationException("Unexpected state backend configuration " + stateBackend);
  }
}
