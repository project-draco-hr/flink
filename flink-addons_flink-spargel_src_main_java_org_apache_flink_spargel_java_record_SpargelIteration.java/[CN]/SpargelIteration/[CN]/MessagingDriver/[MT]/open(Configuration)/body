{
  if (messagingFunction == null) {
    ClassLoader cl=getRuntimeContext().getUserCodeClassLoader();
    Class<K> vertexKeyClass=parameters.getClass(KEY_PARAM,null,cl);
    Class<V> vertexValueClass=parameters.getClass(VALUE_PARAM,null,cl);
    Class<E> edgeClass=parameters.getClass(EDGE_PARAM,null,cl);
    vertexKey=InstantiationUtil.instantiate(vertexKeyClass,Key.class);
    vertexValue=InstantiationUtil.instantiate(vertexValueClass,Value.class);
    K edgeKeyHolder=InstantiationUtil.instantiate(vertexKeyClass,Key.class);
    E edgeValueHolder=InstantiationUtil.instantiate(edgeClass,Value.class);
    ClassLoader ucl=getRuntimeContext().getUserCodeClassLoader();
    try {
      this.messagingFunction=(MessagingFunction<K,V,M,E>)InstantiationUtil.readObjectFromConfig(parameters,UDF_PARAM,ucl);
    }
 catch (    Exception e) {
      String message=e.getMessage() == null ? "." : ": " + e.getMessage();
      throw new Exception("Could not instantiate MessagingFunction" + message,e);
    }
    this.messagingFunction.init(getIterationRuntimeContext(),edgeKeyHolder,edgeValueHolder);
    this.messagingFunction.setup(parameters);
  }
  this.messagingFunction.preSuperstep();
}
