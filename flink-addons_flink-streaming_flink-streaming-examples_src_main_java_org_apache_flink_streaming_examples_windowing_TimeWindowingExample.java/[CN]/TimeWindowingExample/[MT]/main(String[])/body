{
  StreamExecutionEnvironment env=StreamExecutionEnvironment.createLocalEnvironment(PARALLELISM);
  env.setBufferTimeout(100);
  DataStream<Integer> stream=env.addSource(new CountingSourceWithSleep()).groupBy(new KeySelector<Integer,Integer>(){
    private static final long serialVersionUID=1L;
    @Override public Integer getKey(    Integer value) throws Exception {
      if (value < 3) {
        return 0;
      }
 else {
        return 1;
      }
    }
  }
).window(Count.of(100)).every(Time.of(1000,TimeUnit.MILLISECONDS)).sum();
  stream.print();
  env.execute();
}
