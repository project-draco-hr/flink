{
  StringWriter sw=new StringWriter();
  PrintWriter p=new PrintWriter(sw);
  if (e instanceof ProgramInvocationException || e instanceof CompilerException || e instanceof IllegalArgumentException) {
    p.println(e.getClass().getSimpleName() + ((e.getMessage() != null) ? ": " + e.getMessage() : ""));
    Throwable cause=e.getCause();
    if (cause != null) {
      p.println(cause.toString());
    }
 else {
      cause=e;
    }
    for (    StackTraceElement traceElement : cause.getStackTrace()) {
      p.println("\tat " + traceElement);
      if (traceElement.getMethodName().equals("handleRequest")) {
        break;
      }
    }
  }
 else {
    e.printStackTrace(p);
  }
  p.close();
  StringWriter writer=new StringWriter();
  JsonGenerator gen=JsonFactory.jacksonFactory.createJsonGenerator(writer);
  gen.writeStartObject();
  gen.writeStringField("error",sw.toString());
  gen.writeEndObject();
  gen.close();
  return writer.toString();
}
