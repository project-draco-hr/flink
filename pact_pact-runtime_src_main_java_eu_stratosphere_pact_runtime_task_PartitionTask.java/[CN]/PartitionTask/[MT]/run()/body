{
  final MutableObjectIterator<PactRecord> input=this.inputs[0];
  final MutableObjectIterator<PactRecord> histogramInput=this.inputs[1];
  if (!(this.output instanceof OutputCollector))   throw new Exception("Error: Partition Task has a collector that is not an OutputCollector. " + "Another task was probably accidentally chained.");
  final OutputCollector output=(OutputCollector)this.output;
  final PactRecord record=new PactRecord();
  final PactRecord histogramRecord=new PactRecord();
  if (usesSample) {
    ArrayList<PactRecord> borders=new ArrayList<PactRecord>();
    while (histogramInput.next(histogramRecord)) {
      borders.add(histogramRecord.createCopy());
    }
    splitBorders=borders.toArray(new PactRecord[borders.size()]);
  }
  func=new HistogramPartitionFunction(splitBorders,order);
  for (  AbstractRecordWriter<PactRecord> recWriter : output.getWriters()) {
    ChannelSelector<PactRecord> selector=recWriter.getOutputGate().getChannelSelector();
    if (selector instanceof OutputEmitter) {
      ((OutputEmitter)selector).setPartitionFunction(func);
    }
  }
  while (this.running && input.next(record)) {
    output.collect(record);
  }
}
