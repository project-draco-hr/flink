{
  final int oldSize=this.size.getAndIncrement();
  if (oldSize == 0) {
    this.head=new SpillingQueueElement(transferEnvelope);
    this.tail=this.head;
  }
 else {
synchronized (this.tail) {
      if (this.tail.canBeAdded(transferEnvelope)) {
        this.tail.add(transferEnvelope);
      }
 else {
        final SpillingQueueElement newTail=new SpillingQueueElement(transferEnvelope);
        this.tail.setNextElement(newTail);
        this.tail=newTail;
      }
    }
  }
  final Buffer buffer=transferEnvelope.getBuffer();
  if (buffer != null) {
    if (buffer.isBackedByMemory()) {
      this.sizeOfMemoryBuffers.addAndGet(buffer.size());
    }
  }
  return true;
}
