{
  if (isEmpty()) {
    this.head=new SpillingQueueElement(transferEnvelope);
    this.tail=this.head;
  }
 else {
    if (this.tail.canBeAdded(transferEnvelope)) {
      this.tail.add(transferEnvelope);
    }
 else {
      final SpillingQueueElement newTail=new SpillingQueueElement(transferEnvelope);
      this.tail.setNextElement(newTail);
      this.tail=newTail;
    }
  }
  final Buffer buffer=transferEnvelope.getBuffer();
  if (buffer != null) {
    if (buffer.isBackedByMemory()) {
      this.sizeOfMemoryBuffers+=buffer.size();
    }
  }
  ++this.size;
  return true;
}
