{
  MutableObjectIterator<Value> input=inputs[DATA_INPUT];
  SerializedUpdateBuffer buffer=null;
  PactRecord rec=new PactRecord();
  while (true) {
    try {
      boolean success=input.next(rec);
      if (success) {
        rec.write(buffer);
      }
      if (!success) {
        break;
      }
    }
 catch (    StateChangeException ex) {
      if (stateListeners[DATA_INPUT].isChanged()) {
        if (stateListeners[DATA_INPUT].getState() == ChannelState.CLOSED) {
          buffer.flush();
          BackTrafficQueueStore.getInstance().publishIterationEnd(getEnvironment().getJobID(),getEnvironment().getIndexInSubtaskGroup(),buffer);
          buffer=null;
          publishState(ChannelState.CLOSED,getEnvironment().getOutputGate(0));
        }
 else         if (stateListeners[DATA_INPUT].getState() == ChannelState.OPEN && buffer == null) {
          buffer=(SerializedUpdateBuffer)BackTrafficQueueStore.getInstance().receiveUpdateBuffer(getEnvironment().getJobID(),getEnvironment().getIndexInSubtaskGroup());
        }
 else {
          throw new RuntimeException("Illegal state");
        }
      }
    }
  }
  if (buffer != null) {
    buffer.close();
  }
  inputs[PLACEMENT_INPUT].next(new PactRecord());
  output.close();
}
