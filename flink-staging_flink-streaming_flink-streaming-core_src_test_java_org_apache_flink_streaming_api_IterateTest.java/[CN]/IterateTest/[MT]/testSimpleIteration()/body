{
  StreamExecutionEnvironment env=StreamExecutionEnvironment.getExecutionEnvironment();
  env.setParallelism(PARALLELISM);
  iterated=new boolean[PARALLELISM];
  DataStream<Boolean> source=env.fromCollection(Collections.nCopies(PARALLELISM * 2,false));
  IterativeDataStream<Boolean> iteration=source.iterate(3000);
  DataStream<Boolean> increment=iteration.flatMap(new IterationHead()).map(NoOpBoolMap);
  iteration.map(NoOpBoolMap).addSink(new NoOpSink());
  iteration.closeWith(increment).addSink(new NoOpSink());
  env.execute();
  for (  boolean iter : iterated) {
    assertTrue(iter);
  }
}
