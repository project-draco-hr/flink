{
  Set<Tuple2<Integer,StreamInvokable<?,?>>> invokables=streamGraph.getInvokables();
  List<Integer> flatteners=new ArrayList<Integer>();
  for (  Tuple2<Integer,StreamInvokable<?,?>> entry : invokables) {
    if (entry.f1 instanceof WindowFlattener) {
      flatteners.add(entry.f0);
    }
  }
  for (  Integer flattenerID : flatteners) {
    StreamNode input=streamGraph.getVertex(flattenerID).getInEdges().get(0).getSourceVertex();
    if (input.getInvokable() instanceof WindowMerger) {
      StreamNode mergeInput=input.getInEdges().get(0).getSourceVertex();
      streamGraph.addEdge(mergeInput.getID(),flattenerID,new DistributePartitioner(true),0,new ArrayList<String>());
      if (input.getOutEdges().size() > 1) {
        streamGraph.removeEdge(streamGraph.getEdge(input.getID(),flattenerID));
      }
 else {
        streamGraph.removeVertex(input);
      }
      streamGraph.setParallelism(flattenerID,mergeInput.getParallelism());
    }
  }
}
