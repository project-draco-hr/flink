{
  List<FileInputSplit> snapshot=new ArrayList<>(this.pendingSplits.size());
  for (  FileInputSplit split : this.pendingSplits) {
    snapshot.add(split);
  }
  if (this.currentSplit != null && this.currentSplit.equals(pendingSplits.peek())) {
    this.pendingSplits.remove();
  }
  if (this.format instanceof CheckpointableInputFormat && this.isSplitOpen) {
    S formatState=(S)((CheckpointableInputFormat)format).getCurrentState();
    return new Tuple3<>(snapshot,currentSplit,currentSplit == null ? null : formatState);
  }
 else {
    LOG.info("The format used is not checkpointable. The current input split will be restarted upon recovery.");
    return new Tuple3<>(snapshot,currentSplit,null);
  }
}
