{
  Preconditions.checkState(currentKey != null,"No key set");
  if (currentNSState == null) {
    Preconditions.checkState(currentNamespace != null,"No namespace set");
    currentNSState=createNewNamespaceMap();
    state.put(currentNamespace,currentNSState);
  }
  ACC currentValue=currentNSState.get(currentKey);
  try {
    if (currentValue == null) {
      currentNSState.put(currentKey,foldFunction.fold(stateDesc.getDefaultValue(),value));
    }
 else {
      currentNSState.put(currentKey,foldFunction.fold(currentValue,value));
    }
  }
 catch (  Exception e) {
    throw new RuntimeException("Could not add value to folding state.",e);
  }
}
