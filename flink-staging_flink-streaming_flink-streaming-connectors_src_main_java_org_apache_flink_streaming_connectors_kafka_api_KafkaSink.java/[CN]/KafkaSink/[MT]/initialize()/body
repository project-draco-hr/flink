{
  props=new Properties();
  props.put("metadata.broker.list",brokerAddr);
  props.put("request.required.acks","1");
  props.put("serializer.class",DefaultEncoder.class.getCanonicalName());
  props.put("key.serializer.class",EncoderWrapper.class.getCanonicalName());
  props.put("partitioner.class",PartitionerWrapper.class.getCanonicalName());
  EncoderWrapper<IN> encoderWrapper=new EncoderWrapper<IN>(scheme);
  encoderWrapper.write(props);
  PartitionerWrapper<IN> partitionerWrapper=new PartitionerWrapper<IN>(partitioner);
  partitionerWrapper.write(props);
  ProducerConfig config=new ProducerConfig(props);
  try {
    producer=new Producer<IN,byte[]>(config);
  }
 catch (  NullPointerException e) {
    throw new RuntimeException("Cannot connect to Kafka broker " + brokerAddr);
  }
  initDone=true;
}
