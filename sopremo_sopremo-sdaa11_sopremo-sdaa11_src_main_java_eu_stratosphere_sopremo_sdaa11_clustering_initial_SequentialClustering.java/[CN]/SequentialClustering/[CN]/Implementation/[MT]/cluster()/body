{
  while (queue.getNumberOfClusters() > 1) {
    ClusterPair pair=queue.getFirstElement();
    HierarchicalCluster cluster1=pair.getCluster1();
    HierarchicalCluster cluster2=pair.getCluster2();
    HierarchicalCluster mergedCluster=new MergedCluster(cluster1,cluster2,createNewId());
    queue.removeCluster(cluster1);
    queue.removeCluster(cluster2);
    boolean makeFinal=canBeFinal(mergedCluster);
    mergedCluster.makeFinal(makeFinal);
    if (makeFinal) {
      queue.add(mergedCluster);
    }
 else {
      for (      HierarchicalCluster child : mergedCluster.getChildren()) {
        clusters.add(child);
      }
    }
  }
  clusters.addAll(queue.getClusters());
  queue=null;
}
