{
  final String tmpDir=ServerTestUtils.getTempDir();
  final ChannelCheckpoint channelCheckpoint=new ChannelCheckpoint(VERTEX_ID,SOURCE_CHANNEL_ID,tmpDir);
  final TransferEnvelope transferEnvelope=generateTransferEnvelope(SOURCE_CHANNEL_ID,TARGET_CHANNEL_ID,0);
  try {
    channelCheckpoint.makePersistent();
    channelCheckpoint.addToCheckpoint(transferEnvelope);
    assertFalse(channelCheckpoint.isChannelCheckpointFinished());
    channelCheckpoint.markChannelCheckpointAsFinished();
    assertTrue(channelCheckpoint.isChannelCheckpointFinished());
  }
 catch (  IOException ioe) {
    fail(ioe.getMessage());
  }
 finally {
    channelCheckpoint.discard();
  }
}
