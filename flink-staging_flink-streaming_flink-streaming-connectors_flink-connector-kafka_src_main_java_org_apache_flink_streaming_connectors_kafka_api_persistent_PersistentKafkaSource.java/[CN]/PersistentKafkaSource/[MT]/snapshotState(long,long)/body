{
  if (lastOffsets == null) {
    LOG.warn("State snapshot requested on not yet opened source. Returning null");
    return null;
  }
  LOG.info("Snapshotting state. Offsets: {}, checkpoint id {}, timestamp {}",Arrays.toString(lastOffsets),checkpointId,checkpointTimestamp);
  long[] currentOffsets=Arrays.copyOf(lastOffsets,lastOffsets.length);
  pendingCheckpoints.put(checkpointId,currentOffsets);
  return currentOffsets;
}
