{
  LOG.info("Commit checkpoint {}",checkpointId);
  long[] checkpointOffsets;
synchronized (pendingCheckpoints) {
    final int posInMap=pendingCheckpoints.indexOf(checkpointId);
    if (posInMap == -1) {
      LOG.warn("Unable to find pending checkpoint for id {}",checkpointId);
      return;
    }
    checkpointOffsets=(long[])pendingCheckpoints.remove(posInMap);
    if (!pendingCheckpoints.isEmpty()) {
      for (int i=0; i < posInMap; i++) {
        pendingCheckpoints.remove(0);
      }
    }
  }
  if (LOG.isInfoEnabled()) {
    LOG.info("Committing offsets {} to ZooKeeper",Arrays.toString(checkpointOffsets));
  }
  setOffsetsInZooKeeper(checkpointOffsets);
}
