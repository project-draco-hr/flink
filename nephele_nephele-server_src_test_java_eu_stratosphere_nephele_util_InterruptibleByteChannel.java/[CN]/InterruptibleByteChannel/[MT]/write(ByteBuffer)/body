{
  if (!this.isOpen) {
    throw new ClosedChannelException();
  }
  if (!this.isInWritePhase) {
    throw new IllegalStateException("Channel is not in write phase anymore");
  }
  if (src.remaining() > this.buffer.remaining()) {
    increaseBufferSize();
  }
  int numberOfBytesToAccept=src.remaining();
  if (!this.writeInterruptPositions.isEmpty() && (this.buffer.position() + numberOfBytesToAccept < this.writeInterruptPositions.peek().intValue())) {
    numberOfBytesToAccept=this.writeInterruptPositions.poll().intValue() - this.buffer.position();
    this.buffer.limit(this.buffer.position() + numberOfBytesToAccept);
    this.buffer.put(src);
    this.buffer.limit(this.buffer.capacity());
    return numberOfBytesToAccept;
  }
  this.buffer.put(src);
  return numberOfBytesToAccept;
}
