{
  if (readNext() == null) {
    throw new RuntimeException("DataStream must not be empty");
  }
  while (nextRecord != null) {
    Object key=keySelector.getKey(nextObject);
    StreamDiscretizer<IN> groupDiscretizer=groupedDiscretizers.get(key);
    if (groupDiscretizer == null) {
      groupDiscretizer=makeNewGroup(key);
      groupedDiscretizers.put(key,groupDiscretizer);
    }
    groupDiscretizer.processRealElement(nextObject);
    readNext();
  }
  for (  StreamDiscretizer<IN> group : groupedDiscretizers.values()) {
    group.emitFinalWindow();
  }
}
