{
  if (id == null) {
    throw new IllegalArgumentException("Argument id is null");
  }
  if (environment == null) {
    throw new IllegalArgumentException("Argument environment is null");
  }
  if (initialCheckpointState == null) {
    throw new IllegalArgumentException("Argument initialCheckpointState is null");
  }
  Task task=null;
synchronized (this) {
    final Task runningTask=this.runningTasks.get(id);
    if (runningTask == null) {
      if (CheckpointUtils.hasCompleteCheckpointAvailable(id)) {
        task=new ReplayTask(id,environment,this);
      }
 else {
        task=new RuntimeTask(id,environment,initialCheckpointState,this);
      }
    }
 else {
      if (CheckpointUtils.hasPartialCheckpointAvailable(id)) {
        task=new ReplayTask((RuntimeTask)runningTask,this);
      }
 else {
        return null;
      }
    }
    final Environment ee=task.getEnvironment();
    this.routingService.register(task,activeOutputChannels,hasAlreadyBeenDeployed);
    boolean enableProfiling=false;
    if (this.profiler != null && jobConfiguration.getBoolean(ProfilingUtils.PROFILE_JOB_KEY,true)) {
      enableProfiling=true;
    }
    if (enableProfiling) {
      task.registerProfiler(this.profiler,jobConfiguration);
    }
    if (!this.taskManagerPlugins.isEmpty()) {
      final Iterator<TaskManagerPlugin> it=this.taskManagerPlugins.values().iterator();
      while (it.hasNext()) {
        it.next().registerTask(id,jobConfiguration,ee);
      }
    }
    this.runningTasks.put(id,task);
  }
  return task;
}
