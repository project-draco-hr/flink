{
  SopremoPlan parsedPlan;
  try {
    parsedPlan=new QueryParser().getPlan(new ByteArrayInputStream(jaqlScript.getBytes()));
  }
 catch (  Exception e) {
    e.printStackTrace();
    Assert.fail("cannot parse jaql script: " + jaqlScript + " "+ e.toString());
    return;
  }
  if (parsedPlan == null && expected != null)   Assert.fail("empty plan unexpected");
  List<Operator> expectedNodes=toList(expected.getReachableNodes());
  List<Operator> actualNodes=toList(parsedPlan.getContainedOperators());
  if (expectedNodes.size() != actualNodes.size())   Assert.fail(String.format("%d nodes expected instead of %d",expectedNodes.size(),actualNodes.size()));
  for (int index=0; index < expectedNodes.size(); index++) {
    if (!expectedNodes.get(index).equals(actualNodes.get(index))) {
      if (!expectedNodes.get(index).getTransformation().equals(actualNodes.get(index).getTransformation()))       Assert.fail(String.format("transformation of %d. node differs: %s expected instead of %s",index,expectedNodes.get(index).getTransformation(),actualNodes.get(index).getTransformation()));
 else       Assert.fail(String.format("%d. node differs: %s expected instead of %s",index,expectedNodes.get(index),actualNodes.get(index)));
    }
  }
}
