{
  KafkaOnePartitionIterator partition;
  while (true) {
    for (int i=nextPartition(lastCheckedPartitionIndex); i < partitions.size(); i=nextPartition(i)) {
      partition=partitions.get(i);
      if (partition.fetchHasNext()) {
        lastCheckedPartitionIndex=i;
        return partition.nextWithOffset();
      }
    }
    try {
      Thread.sleep(waitOnEmptyFetch);
    }
 catch (    InterruptedException e) {
      e.printStackTrace();
    }
  }
}
