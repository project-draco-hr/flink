{
  EvaluationExpression rewritten=this.process(expression);
  if (rewritten == expression) {
    if (expression instanceof ContainerExpression) {
      List<EvaluationExpression> children=new ArrayList<EvaluationExpression>(((ContainerExpression)expression).getChildren());
      for (int index=0; index < children.size(); index++)       children.set(index,this.rewrite(children.get(index)));
      if (!((ContainerExpression)expression).getChildren().equals(children)) {
        ((ContainerExpression)expression).setChildren(children);
        rewritten=this.process(expression);
        if (rewritten != expression)         return rewritten;
      }
    }
    for (    DynamicProperty<EvaluationExpression> property : ReflectUtil.getDynamicClass(expression.getClass()).getProperties(EvaluationExpression.class)) {
      EvaluationExpression propertyValue=property.get(expression);
      EvaluationExpression newValue=this.rewrite(propertyValue);
      if (propertyValue != newValue)       property.set(expression,newValue);
    }
  }
  return rewritten;
}
