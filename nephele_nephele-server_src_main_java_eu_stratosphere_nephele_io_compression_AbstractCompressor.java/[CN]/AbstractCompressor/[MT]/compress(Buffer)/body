{
  if (!uncompressedData.isBackedByMemory()) {
    throw new IllegalStateException("Uncompressed data buffer is not backed by memory");
  }
  setUncompressedDataBuffer((MemoryBuffer)uncompressedData);
  setCompressedDataBuffer(this.bufferProvider.lockCompressionBuffer());
  this.compressedDataBuffer.clear();
  this.uncompressedDataBufferLength=this.uncompressedDataBuffer.position();
  final int numberOfCompressedBytes=compressBytesDirect(0);
  this.compressedDataBuffer.position(numberOfCompressedBytes + SIZE_LENGTH);
  final Buffer compressedBuffer=this.compressedBuffer;
  this.bufferProvider.releaseCompressionBuffer(this.uncompressedBuffer);
  setUncompressedDataBuffer(null);
  setCompressedDataBuffer(null);
  return compressedBuffer;
}
