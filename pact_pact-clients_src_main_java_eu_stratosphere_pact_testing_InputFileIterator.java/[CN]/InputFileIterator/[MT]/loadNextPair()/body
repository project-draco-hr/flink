{
  try {
    do {
      while (this.currentFormat != null && this.currentFormat.reachedEnd())       if (this.formatIterator.hasNext())       this.currentFormat=this.formatIterator.next();
 else {
        nextPair=(KeyValuePair<K,V>)NO_MORE_PAIR;
        return;
      }
      if (!this.reusePair)       nextPair=currentFormat.createPair();
 else       nextPair=buffer[bufferIndex++ % 2];
    }
 while (!currentFormat.nextRecord(this.nextPair));
  }
 catch (  final IOException e) {
    nextPair=(KeyValuePair<K,V>)NO_MORE_PAIR;
    Assert.fail("reading expected values " + StringUtils.stringifyException(e));
  }
}
