{
  Object key=keySelector.getKey(element.getValue());
  OUT value=values.value().get(key);
  if (value != null) {
    OUT folded=userFunction.fold(outTypeSerializer.copy(value),element.getValue());
    values.value().put(key,folded);
    output.collect(element.replace(folded));
  }
 else {
    OUT first=userFunction.fold(outTypeSerializer.copy(initialValue),element.getValue());
    values.value().put(key,first);
    output.collect(element.replace(first));
  }
}
