{
  final int[] positions=fields.toArray();
  @SuppressWarnings("unchecked") final Class<? extends Key>[] keyTypes=new Class[fields.size()];
  for (int i=0; i < fields.size(); i++) {
    Class<? extends Key> type=schema.getType(positions[i]);
    if (type == null) {
      throw new MissingFieldTypeInfoException(i);
    }
 else {
      keyTypes[i]=type;
    }
  }
  return new PactRecordComparatorFactory(positions,keyTypes,directions);
}
