{
  this.totalNumberOfMemorySegments=numberOfSegmentsToAllocate;
  this.memorySegmentSize=segmentSize;
  this.availableMemorySegments=new ArrayBlockingQueue<MemorySegment>(numberOfSegmentsToAllocate);
  try {
    for (int i=0; i < numberOfSegmentsToAllocate; i++) {
      availableMemorySegments.add(new MemorySegment(new byte[segmentSize]));
    }
  }
 catch (  OutOfMemoryError err) {
    int requiredMb=(numberOfSegmentsToAllocate * segmentSize) >> 20;
    int allocatedMb=((availableMemorySegments.size()) * segmentSize) >> 20;
    int missingMb=requiredMb - allocatedMb;
    throw new OutOfMemoryError("Could not allocate enough memory segments for GlobalBufferPool (required (Mb): " + requiredMb + ", allocated (Mb): "+ allocatedMb+ ", missing (Mb): "+ missingMb+ ").");
  }
  int allocatedMb=((availableMemorySegments.size()) * segmentSize) >> 20;
  LOG.info("Allocated {} MB for network buffer pool (number of memory segments: {}, bytes per segment: {}).",allocatedMb,availableMemorySegments.size(),segmentSize);
}
