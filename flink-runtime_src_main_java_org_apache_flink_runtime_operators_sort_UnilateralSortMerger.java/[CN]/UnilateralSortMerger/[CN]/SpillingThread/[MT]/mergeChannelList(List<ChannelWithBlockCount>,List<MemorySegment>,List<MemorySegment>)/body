{
  final double numMerges=Math.ceil(channelIDs.size() / ((double)this.maxFanIn));
  final int channelsToMergePerStep=(int)Math.ceil(channelIDs.size() / numMerges);
  final List<List<MemorySegment>> readBuffers=new ArrayList<List<MemorySegment>>(channelsToMergePerStep);
  getSegmentsForReaders(readBuffers,allReadBuffers,channelsToMergePerStep);
  final ArrayList<ChannelWithBlockCount> mergedChannelIDs=new ArrayList<ChannelWithBlockCount>((int)(numMerges + 1));
  final ArrayList<ChannelWithBlockCount> channelsToMergeThisStep=new ArrayList<ChannelWithBlockCount>(channelsToMergePerStep);
  int channelNum=0;
  while (isRunning() && channelNum < channelIDs.size()) {
    channelsToMergeThisStep.clear();
    for (int i=0; i < channelsToMergePerStep && channelNum < channelIDs.size(); i++, channelNum++) {
      channelsToMergeThisStep.add(channelIDs.get(channelNum));
    }
    if (channelsToMergeThisStep.size() < 2) {
      mergedChannelIDs.addAll(channelsToMergeThisStep);
    }
 else {
      mergedChannelIDs.add(mergeChannels(channelsToMergeThisStep,readBuffers,writeBuffers));
    }
  }
  return mergedChannelIDs;
}
