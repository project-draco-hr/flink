{
  NepheleMiniCluster testMiniCluster=null;
  try {
    testMiniCluster=new NepheleMiniCluster();
    testMiniCluster.setJobManagerRpcPort(TEST_JM_PORT);
    testMiniCluster.start();
    String jarFile=getClass().getResource(JAR_FILE).getFile();
    String testData=getClass().getResource(TEST_DATA_FILE).toString();
    PackagedProgram program=new PackagedProgram(new File(jarFile),new String[]{testData});
    Client c=new Client(new InetSocketAddress("localhost",TEST_JM_PORT),new Configuration());
    c.run(program.getPlanWithJars(),true);
  }
 catch (  Throwable t) {
    System.err.println(t.getMessage());
    t.printStackTrace();
    Assert.fail("Error during the packaged program execution: " + t.getMessage());
  }
 finally {
    if (testMiniCluster != null) {
      try {
        testMiniCluster.stop();
      }
 catch (      Throwable t) {
      }
    }
  }
}
