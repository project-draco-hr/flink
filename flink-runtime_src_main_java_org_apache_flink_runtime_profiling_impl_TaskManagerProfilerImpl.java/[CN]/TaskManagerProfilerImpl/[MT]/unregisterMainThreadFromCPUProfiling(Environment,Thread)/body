{
synchronized (this.monitoredThreads) {
    LOG.debug("Unregistering thread {} from CPU monitoring",thread);
    final EnvironmentThreadSet environmentThreadSet=this.monitoredThreads.remove(environment);
    if (environmentThreadSet != null) {
      if (environmentThreadSet.getMainThread() != thread) {
        LOG.error("The thread " + thread.getName() + " is not the main thread of this environment");
      }
      if (environmentThreadSet.getNumberOfUserThreads() > 0) {
        LOG.error("Thread " + environmentThreadSet.getMainThread().getName() + " has still unfinished user threads!");
      }
    }
  }
}
