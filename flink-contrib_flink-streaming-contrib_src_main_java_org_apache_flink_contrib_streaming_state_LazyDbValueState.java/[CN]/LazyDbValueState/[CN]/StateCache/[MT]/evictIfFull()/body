{
  if (size() > cacheSize) {
    if (LOG.isDebugEnabled()) {
      LOG.debug("State cache is full for {}, evicting {} elements.",kvStateId,evictionSize);
    }
    try {
      int numEvicted=0;
      Iterator<Entry<Tuple2<K,N>,Optional<V>>> entryIterator=entrySet().iterator();
      while (numEvicted++ < evictionSize && entryIterator.hasNext()) {
        Entry<Tuple2<K,N>,Optional<V>> next=entryIterator.next();
        if (modified.remove(next.getKey()) != null) {
          batchInsert.add(next,nextTs);
        }
        entryIterator.remove();
      }
      batchInsert.flush(nextTs);
    }
 catch (    IOException e) {
      throw new RuntimeException(e);
    }
  }
}
