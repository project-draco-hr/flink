{
  MockContext<IN,OUT> mockContext=new MockContext<IN,OUT>(inputs);
  final ScheduledExecutorService timerService=Executors.newSingleThreadScheduledExecutor();
  final Object lock=new Object();
  final StreamTask<?,?> mockTask=createMockTaskWithTimer(timerService,lock);
  operator.setup(mockTask,new StreamConfig(new Configuration()),mockContext.output);
  try {
    operator.open();
    StreamRecord<IN> nextRecord;
    for (    IN in : inputs) {
synchronized (lock) {
        operator.processElement(new StreamRecord<IN>(in));
      }
    }
    operator.close();
  }
 catch (  Exception e) {
    throw new RuntimeException("Cannot invoke operator.",e);
  }
 finally {
    timerService.shutdownNow();
  }
  return mockContext.getOutputs();
}
