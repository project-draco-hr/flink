{
  try {
    while (isRunning && consumerIterator.hasNext()) {
      OUT out=schema.deserialize(consumerIterator.next().message());
      if (schema.isEndOfStream(out)) {
        break;
      }
      collector.collect(out);
    }
  }
  finally {
    consumer.shutdown();
  }
}
