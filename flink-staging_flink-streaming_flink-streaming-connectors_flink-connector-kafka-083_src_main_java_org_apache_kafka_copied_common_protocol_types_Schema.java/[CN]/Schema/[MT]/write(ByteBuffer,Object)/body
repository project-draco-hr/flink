{
  Struct r=(Struct)o;
  for (int i=0; i < fields.length; i++) {
    Field f=fields[i];
    try {
      Object value=f.type().validate(r.get(f));
      f.type.write(buffer,value);
    }
 catch (    Exception e) {
      throw new SchemaException("Error writing field '" + f.name + "': "+ (e.getMessage() == null ? e.getClass().getName() : e.getMessage()));
    }
  }
}
