{
  Crc32 crc=new Crc32();
  crc.update(CURRENT_MAGIC_VALUE);
  byte attributes=0;
  if (type.id > 0)   attributes=(byte)(attributes | (COMPRESSION_CODEC_MASK & type.id));
  crc.update(attributes);
  if (key == null) {
    crc.updateInt(-1);
  }
 else {
    crc.updateInt(key.length);
    crc.update(key,0,key.length);
  }
  if (value == null) {
    crc.updateInt(-1);
  }
 else {
    int size=valueSize >= 0 ? valueSize : (value.length - valueOffset);
    crc.updateInt(size);
    crc.update(value,valueOffset,size);
  }
  return crc.getValue();
}
