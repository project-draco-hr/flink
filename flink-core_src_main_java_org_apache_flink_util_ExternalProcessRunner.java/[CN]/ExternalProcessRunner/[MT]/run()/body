{
  try {
    int returnCode=process.waitFor();
    pipeForwarder.join();
    if (returnCode != 0) {
      final String errorOutput=getErrorOutput().toString();
      if (!errorOutput.isEmpty()) {
        throw new RuntimeException(errorOutput);
      }
    }
    return returnCode;
  }
 catch (  InterruptedException e) {
    try {
      Class<?> processClass=process.getClass();
      Method destroyForcibly=processClass.getMethod("destroyForcibly");
      destroyForcibly.setAccessible(true);
      destroyForcibly.invoke(process);
    }
 catch (    NoSuchMethodException ex) {
      process.destroy();
    }
    throw new InterruptedException("Interrupted while waiting for external process.");
  }
}
