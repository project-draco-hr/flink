{
  for (  Entry<K,Optional<V>> state : cache.modified.entrySet()) {
    batchInsert.add(state,checkpointId);
  }
  batchInsert.flush(checkpointId);
  cache.modified.clear();
  nextCheckpointId=checkpointId + 1;
  return new DbKvStateSnapshot<K,V>(kvStateId,checkpointId);
}
