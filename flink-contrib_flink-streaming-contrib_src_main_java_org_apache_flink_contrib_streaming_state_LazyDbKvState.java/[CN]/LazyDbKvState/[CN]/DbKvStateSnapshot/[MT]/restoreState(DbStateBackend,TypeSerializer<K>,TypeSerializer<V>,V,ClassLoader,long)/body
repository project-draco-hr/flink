{
  retry(new Callable<Void>(){
    public Void call() throws Exception {
      for (      Connection c : stateBackend.getConnections().connections()) {
        stateBackend.getConfiguration().getDbAdapter().cleanupFailedCheckpoints(kvStateId,c,checkpointId,nextId);
      }
      return null;
    }
  }
,stateBackend.getConfiguration().getMaxNumberOfSqlRetries(),stateBackend.getConfiguration().getSleepBetweenSqlRetries());
  boolean cleanup=stateBackend.getEnvironment().getIndexInSubtaskGroup() == 0;
  LazyDbKvState<K,V> restored=new LazyDbKvState<K,V>(kvStateId,cleanup,stateBackend.getConnections(),stateBackend.getConfiguration(),keySerializer,valueSerializer,defaultValue,nextId);
  if (LOG.isDebugEnabled()) {
    LOG.debug("KV state({},{}) restored.",kvStateId,nextId);
  }
  return restored;
}
