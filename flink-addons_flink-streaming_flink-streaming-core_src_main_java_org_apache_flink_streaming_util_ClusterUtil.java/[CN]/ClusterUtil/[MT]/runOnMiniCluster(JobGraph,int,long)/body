{
  Configuration configuration=jobGraph.getJobConfiguration();
  NepheleMiniCluster exec=new NepheleMiniCluster();
  exec.setMemorySize(memorySize);
  exec.setNumTaskTracker(numberOfTaskTrackers);
  if (LOG.isInfoEnabled()) {
    LOG.info("Running on mini cluster");
  }
  try {
    exec.start();
    Client client=new Client(new InetSocketAddress("localhost",exec.getJobManagerRpcPort()),configuration,ClusterUtil.class.getClassLoader());
    client.run(jobGraph,true);
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
 finally {
    try {
      exec.stop();
    }
 catch (    Throwable t) {
    }
  }
}
