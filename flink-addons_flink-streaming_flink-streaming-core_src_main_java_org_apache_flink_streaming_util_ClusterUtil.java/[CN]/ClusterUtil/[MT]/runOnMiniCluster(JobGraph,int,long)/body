{
  Configuration configuration=jobGraph.getJobConfiguration();
  NepheleMiniCluster exec=new NepheleMiniCluster();
  exec.setMemorySize(memorySize);
  exec.setNumTaskManager(1);
  exec.setTaskManagerNumSlots(degreeOfPrallelism);
  if (LOG.isInfoEnabled()) {
    LOG.info("Running on mini cluster");
  }
  try {
    exec.start();
    Client client=new Client(new InetSocketAddress("localhost",exec.getJobManagerRpcPort()),configuration,ClusterUtil.class.getClassLoader());
    client.run(jobGraph,true);
  }
 catch (  ProgramInvocationException e) {
    if (e.getMessage().contains("GraphConversionException")) {
      throw new Exception(CANNOT_EXECUTE_EMPTY_JOB,e);
    }
 else {
      throw e;
    }
  }
catch (  Exception e) {
    throw e;
  }
 finally {
    try {
      exec.stop();
    }
 catch (    Throwable t) {
    }
  }
}
