{
  Configuration configuration=jobGraph.getJobConfiguration();
  LocalFlinkMiniCluster exec=null;
  configuration.setLong(ConfigConstants.TASK_MANAGER_MEMORY_SIZE_KEY,memorySize);
  configuration.setInteger(ConfigConstants.TASK_MANAGER_NUM_TASK_SLOTS,degreeOfParallelism);
  if (LOG.isInfoEnabled()) {
    LOG.info("Running on mini cluster");
  }
  try {
    exec=new LocalFlinkMiniCluster(configuration,true);
    Client client=new Client(new InetSocketAddress("localhost",exec.getJobManagerRPCPort()),configuration,ClusterUtil.class.getClassLoader());
    client.run(jobGraph,true);
  }
 catch (  ProgramInvocationException e) {
    if (e.getMessage().contains("GraphConversionException")) {
      throw new Exception(CANNOT_EXECUTE_EMPTY_JOB,e);
    }
 else {
      throw e;
    }
  }
catch (  Exception e) {
    throw e;
  }
 finally {
    if (exec != null) {
      exec.stop();
    }
  }
}
