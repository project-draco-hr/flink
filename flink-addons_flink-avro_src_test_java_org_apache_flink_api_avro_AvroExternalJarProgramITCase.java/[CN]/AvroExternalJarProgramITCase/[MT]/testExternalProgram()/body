{
  LocalFlinkMiniCluster testMiniCluster=null;
  try {
    Configuration config=new Configuration();
    config.setInteger(ConfigConstants.TASK_MANAGER_NUM_TASK_SLOTS,4);
    testMiniCluster=new LocalFlinkMiniCluster(config);
    String jarFile=JAR_FILE;
    String testData=getClass().getResource(TEST_DATA_FILE).toString();
    PackagedProgram program=new PackagedProgram(new File(jarFile),new String[]{testData});
    Client c=new Client(new InetSocketAddress("localhost",testMiniCluster.getJobManagerRPCPort()),new Configuration(),program.getUserCodeClassLoader());
    c.run(program,4,true);
  }
 catch (  Throwable t) {
    System.err.println(t.getMessage());
    t.printStackTrace();
    Assert.fail("Error during the packaged program execution: " + t.getMessage());
  }
 finally {
    if (testMiniCluster != null) {
      try {
        testMiniCluster.stop();
      }
 catch (      Throwable t) {
      }
    }
  }
}
