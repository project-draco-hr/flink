{
  if (clazz == null) {
    throw new NullPointerException();
  }
  if (castTo != null && !castTo.isAssignableFrom(clazz)) {
    throw new RuntimeException("The class '" + clazz.getName() + "' is not a subclass of '"+ castTo.getName()+ "' as is required.");
  }
  try {
    return clazz.newInstance();
  }
 catch (  InstantiationException iex) {
    final String errorMessage;
    if (!isProperClass(clazz)) {
      errorMessage="The class is no proper class, it is either abstract, an interface, or a primitive type.";
    }
 else     if (!hasPublicNullaryConstructor(clazz)) {
      errorMessage="The class is missing a public nullary constructor (constructor without arguments).";
    }
 else {
      throw new RuntimeException("Could not instantiate type '" + clazz.getName() + "' due to an unspecified exception: "+ iex.getMessage(),iex);
    }
    throw new RuntimeException("Could not instantiate type '" + clazz.getName() + "': "+ errorMessage);
  }
catch (  IllegalAccessException iaex) {
    final String errorMessage;
    if (!isPublic(clazz)) {
      errorMessage="The class is not public.";
    }
 else {
      errorMessage="The nullary constructor is not public.";
    }
    throw new RuntimeException("Could not instantiate type '" + clazz.getName() + "': "+ errorMessage);
  }
catch (  Throwable t) {
    String message=t.getMessage();
    throw new RuntimeException("Could not instantiate type '" + clazz.getName() + "' Most likely the constructor (or a member variable initialization) threw an exception"+ (message == null ? "." : ": " + message),t);
  }
}
