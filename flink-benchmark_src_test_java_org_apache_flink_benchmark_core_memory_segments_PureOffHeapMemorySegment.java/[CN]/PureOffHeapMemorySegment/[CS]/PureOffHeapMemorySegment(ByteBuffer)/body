{
  if (buffer == null || !buffer.isDirect()) {
    throw new IllegalArgumentException("Can't initialize from non-direct ByteBuffer.");
  }
  this.buffer=buffer;
  this.size=buffer.capacity();
  this.address=getAddress(buffer);
  this.addressLimit=this.address + size;
  if (address >= Long.MAX_VALUE - Integer.MAX_VALUE) {
    throw new RuntimeException("Segment initialized with too large address: " + address);
  }
}
