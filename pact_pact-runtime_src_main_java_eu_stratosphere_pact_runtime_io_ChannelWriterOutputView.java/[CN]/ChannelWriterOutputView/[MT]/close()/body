{
  writeCurrentSegment(true);
  this.currentSegment=null;
  final LinkedBlockingQueue<MemorySegment> queue=this.writer.getReturnQueue();
  this.writer.close();
  ArrayList<MemorySegment> list=new ArrayList<MemorySegment>(this.numSegments);
  for (int i=0; i < this.numSegments; i++) {
    final MemorySegment m=queue.poll();
    if (m == null) {
      throw new RuntimeException("Bug in ChannelWriterOutputView: MemorySegments lost.");
    }
    list.add(m);
  }
  return list;
}
