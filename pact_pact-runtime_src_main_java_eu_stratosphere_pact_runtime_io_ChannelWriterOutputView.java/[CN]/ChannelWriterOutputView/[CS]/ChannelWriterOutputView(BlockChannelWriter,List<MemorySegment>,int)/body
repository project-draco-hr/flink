{
  if (writer == null || memory == null)   throw new NullPointerException();
  if (memory.isEmpty())   throw new IllegalArgumentException("Empty memory segment collection given.");
  this.writer=writer;
  this.segmentSize=segmentSize;
  this.numSegments=memory.size();
  final LinkedBlockingQueue<MemorySegment> queue=writer.getReturnQueue();
  for (int i=memory.size() - 1; i >= 0; --i) {
    final MemorySegment seg=memory.get(i);
    if (seg.size() != segmentSize) {
      throw new IllegalArgumentException("The supplied memory segments are not of the specified size.");
    }
    queue.add(seg);
  }
  try {
    nextSegment();
  }
 catch (  IOException ioex) {
    throw new RuntimeException("BUG: IOException occurred while getting first block for ChannelWriterOutputView.",ioex);
  }
}
