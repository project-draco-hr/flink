{
  FieldValueExpr fe=(FieldValueExpr)expr;
  Expr recExpr=fe.recExpr();
  if (!(recExpr instanceof ConstExpr || recExpr instanceof RecordExpr)) {
    return false;
  }
  Expr nameExpr=fe.nameExpr();
  if (!(nameExpr instanceof ConstExpr)) {
    return false;
  }
  ConstExpr c=(ConstExpr)nameExpr;
  JsonString name=(JsonString)c.value;
  Expr replaceBy=null;
  if (name == null) {
    replaceBy=c;
  }
 else   if (recExpr instanceof ConstExpr) {
    c=(ConstExpr)recExpr;
    if (!(c.value instanceof JsonRecord)) {
      return false;
    }
    JsonRecord rec=(JsonRecord)c.value;
    JsonValue value=rec.get(name);
    c.value=value;
    replaceBy=c;
  }
 else {
    RecordExpr re=(RecordExpr)recExpr;
    for (int i=0; i < re.numFields(); i++) {
      FieldExpr f=re.field(i);
      if (f instanceof NameValueBinding) {
        NameValueBinding b=(NameValueBinding)f;
        if (b.staticNameMatches(name).always()) {
          if (replaceBy != null) {
            throw new RuntimeException("duplicate field in record:" + name);
          }
          replaceBy=b.valueExpr();
        }
      }
 else       if (f instanceof CopyField) {
        CopyField p=(CopyField)f;
        if (p.staticNameMatches(name).always()) {
          if (replaceBy != null) {
            throw new RuntimeException("duplicate field in record:" + name);
          }
          replaceBy=p.toPathExpr();
        }
      }
 else {
        return false;
      }
    }
    if (replaceBy == null) {
      replaceBy=new ConstExpr(null);
    }
  }
  expr.replaceInParent(replaceBy);
  return true;
}
