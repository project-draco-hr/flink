{
  Configuration configuration=jobGraph.getJobConfiguration();
  LocalFlinkMiniCluster exec=null;
  configuration.setLong(ConfigConstants.TASK_MANAGER_MEMORY_SIZE_KEY,memorySize);
  configuration.setInteger(ConfigConstants.TASK_MANAGER_NUM_TASK_SLOTS,parallelism);
  if (LOG.isInfoEnabled()) {
    LOG.info("Running on mini cluster");
  }
  try {
    exec=new LocalFlinkMiniCluster(configuration,true);
    ActorRef jobClient=exec.getJobClient();
    JobClient.submitJobAndWait(jobGraph,true,jobClient,exec.timeout());
  }
 catch (  Exception e) {
    throw e;
  }
 finally {
    if (exec != null) {
      exec.stop();
    }
  }
}
