{
  int degreeOfParallelism=2;
  JobGraph jobGraph=new JobGraph();
  JobInputVertex input=JobGraphUtils.createInput(TextInputFormat.class,"file:///home/ssc/Desktop/stratosphere/test-inputs/simple","FileInput",jobGraph,degreeOfParallelism);
  JobTaskVertex head=JobGraphUtils.createTask(BulkIterationHeadPactTask.class,"BulkIterationHead",jobGraph,degreeOfParallelism);
  TaskConfig headConfig=new TaskConfig(head.getConfiguration());
  headConfig.setDriver(MapDriver.class);
  headConfig.setStubClass(AppendMapper.AppendHeadMapper.class);
  headConfig.setMemorySize(10 * JobGraphUtils.MEGABYTE);
  headConfig.setBackChannelMemoryFraction(0.8f);
  headConfig.setNumberOfIterations(3);
  JobTaskVertex intermediate=JobGraphUtils.createTask(BulkIterationIntermediatePactTask.class,"BulkIntermediate",jobGraph,degreeOfParallelism);
  TaskConfig intermediateConfig=new TaskConfig(intermediate.getConfiguration());
  intermediateConfig.setDriver(MapDriver.class);
  intermediateConfig.setStubClass(AppendMapper.AppendIntermediateMapper.class);
  intermediateConfig.setGateIterativeAndSetNumberOfEventsUntilInterrupt(0,1);
  JobTaskVertex tail=JobGraphUtils.createTask(BulkIterationTailPactTask.class,"BulkIterationTail",jobGraph,degreeOfParallelism);
  TaskConfig tailConfig=new TaskConfig(tail.getConfiguration());
  tailConfig.setDriver(MapDriver.class);
  tailConfig.setStubClass(AppendMapper.AppendTailMapper.class);
  tailConfig.setGateIterativeAndSetNumberOfEventsUntilInterrupt(0,1);
  JobTaskVertex sync=JobGraphUtils.createSingletonTask(BulkIterationSynchronizationPactTask.class,"BulkIterationSync",jobGraph);
  TaskConfig syncConfig=new TaskConfig(sync.getConfiguration());
  syncConfig.setDriver(MapDriver.class);
  syncConfig.setStubClass(EmptyMapStub.class);
  syncConfig.setGateIterativeAndSetNumberOfEventsUntilInterrupt(0,degreeOfParallelism);
  JobOutputVertex output=JobGraphUtils.createFileOutput(jobGraph,"FinalOutput",degreeOfParallelism);
  TaskConfig outputConfig=new TaskConfig(output.getConfiguration());
  outputConfig.setStubClass(SimpleOutFormat.class);
  outputConfig.setStubParameter(FileOutputFormat.FILE_PARAMETER_KEY,"file:///tmp/stratosphere/iterations");
  JobOutputVertex fakeTailOutput=JobGraphUtils.createFakeOutput(jobGraph,"FakeTailOutput",degreeOfParallelism);
  JobOutputVertex fakeSyncOutput=JobGraphUtils.createSingletonFakeOutput(jobGraph,"FakeSyncOutput");
  JobGraphUtils.connectLocal(input,head);
  JobGraphUtils.connectLocal(head,intermediate);
  JobGraphUtils.connectLocal(head,sync);
  JobGraphUtils.connectLocal(head,output);
  JobGraphUtils.connectLocal(intermediate,tail);
  JobGraphUtils.connectLocal(tail,fakeTailOutput);
  JobGraphUtils.connectLocal(sync,fakeSyncOutput);
  head.setVertexToShareInstancesWith(tail);
  GlobalConfiguration.loadConfiguration("/home/ssc/Desktop/stratosphere/local-conf");
  Configuration conf=GlobalConfiguration.getConfiguration();
  JobGraphUtils.submit(jobGraph,conf);
}
