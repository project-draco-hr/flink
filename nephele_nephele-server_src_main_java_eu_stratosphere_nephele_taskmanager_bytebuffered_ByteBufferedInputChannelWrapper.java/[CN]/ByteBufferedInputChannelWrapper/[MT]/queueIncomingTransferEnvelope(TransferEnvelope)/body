{
synchronized (this.queuedEnvelopes) {
    final int sequenceNumber=transferEnvelope.getSequenceNumber();
    if (sequenceNumber != this.nextExpectedSequenceNumber) {
      if (sequenceNumber > this.nextExpectedSequenceNumber) {
        while (sequenceNumber > this.nextExpectedSequenceNumber) {
          wait(100);
        }
      }
 else {
        throw new IOException("Received envelope with sequence number " + sequenceNumber + ", but "+ this.nextExpectedSequenceNumber+ " is expected");
      }
    }
    this.queuedEnvelopes.add(transferEnvelope);
    ++this.nextExpectedSequenceNumber;
    if (transferEnvelope.getBuffer() != null) {
      if (transferEnvelope.getBuffer().isBackedByMemory()) {
        ++this.numberOfMemoryBuffers;
      }
 else {
        ++this.numberOfFileBuffers;
      }
    }
  }
  this.byteBufferedInputChannel.checkForNetworkEvents();
}
