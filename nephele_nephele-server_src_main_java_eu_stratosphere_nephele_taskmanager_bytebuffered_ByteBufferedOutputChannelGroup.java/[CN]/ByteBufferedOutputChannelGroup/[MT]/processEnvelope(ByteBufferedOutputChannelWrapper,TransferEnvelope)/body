{
  final TransferEnvelopeProcessingLog processingLog=outgoingTransferEnvelope.getProcessingLog();
  if (this.ephemeralCheckpoint != null && processingLog.mustBeWrittenToCheckpoint()) {
    this.ephemeralCheckpoint.addTransferEnvelope(outgoingTransferEnvelope);
    final EventList eventList=outgoingTransferEnvelope.getEventList();
    if (!eventList.isEmpty()) {
      final Iterator<AbstractEvent> it=eventList.iterator();
      while (it.hasNext()) {
        if (it.next() instanceof ByteBufferedChannelCloseEvent && this.commonChannelType == ChannelType.FILE) {
          ;
          System.out.println("Close Event in " + outgoingTransferEnvelope.getSequenceNumber() + " source "+ outgoingTransferEnvelope.getSource());
          this.ephemeralCheckpoint.markChannelAsFinished(outgoingTransferEnvelope.getSource(),outgoingTransferEnvelope.getSequenceNumber());
          if (this.ephemeralCheckpoint.isPersistent() && this.commonChannelType == ChannelType.FILE) {
            channelWrapper.processEvent(new ByteBufferedChannelCloseEvent());
          }
          break;
        }
      }
    }
  }
  if (processingLog.mustBeSentViaNetwork() && !processingLog.isSentViaNetwork()) {
    this.byteBufferedChannelManager.queueOutgoingTransferEnvelope(outgoingTransferEnvelope);
  }
  if (outgoingTransferEnvelope.getBuffer() != null) {
    this.channelsWithWriteBuffers.remove(channelWrapper);
  }
}
