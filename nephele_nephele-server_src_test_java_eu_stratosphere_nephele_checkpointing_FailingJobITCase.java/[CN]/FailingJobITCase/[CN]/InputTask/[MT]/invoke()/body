{
  boolean failing=false;
  final int failAfterRecord=getTaskConfiguration().getInteger(FAILED_AFTER_RECORD_KEY,-1);
synchronized (FAILED_ONCE) {
    failing=(getIndexInSubtaskGroup() == getTaskConfiguration().getInteger(FAILURE_INDEX_KEY,-1)) && FAILED_ONCE.add(getEnvironment().getTaskName());
  }
  final FailingJobRecord record=new FailingJobRecord();
  for (int i=0; i < RECORDS_TO_GENERATE; ++i) {
    this.recordWriter.emit(record);
    if (i == failAfterRecord && failing) {
      throw new RuntimeException("Runtime exception in " + getEnvironment().getTaskName() + " "+ getIndexInSubtaskGroup());
    }
  }
}
