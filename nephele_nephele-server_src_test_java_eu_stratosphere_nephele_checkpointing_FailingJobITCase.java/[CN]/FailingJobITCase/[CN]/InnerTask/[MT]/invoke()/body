{
  final FailingJobRecord record=new FailingJobRecord();
  int count=0;
  boolean failing=(getRuntimeConfiguration().getBoolean(FAILURE_KEY,false) && (getIndexInSubtaskGroup() == getRuntimeConfiguration().getInteger(FAILURE_INDEX_KEY,-1)));
  while (this.recordReader.next(record)) {
    this.recordWriter.emit(record);
    if (count++ == FAILED_AFTER_RECORD && failing) {
      if (FAILED_ONCE.compareAndSet(false,true)) {
        throw new RuntimeException("Runtime exception in " + getEnvironment().getTaskName() + " "+ getIndexInSubtaskGroup());
      }
    }
  }
}
