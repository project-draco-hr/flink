{
  final FailingJobRecord record=new FailingJobRecord();
  boolean failing=false;
  final int failAfterRecord=getRuntimeConfiguration().getInteger(FAILED_AFTER_RECORD_KEY,-1);
  failing=(getIndexInSubtaskGroup() == getRuntimeConfiguration().getInteger(FAILURE_INDEX_KEY,-1));
  int count=0;
  while (this.recordReader.next(record)) {
    this.recordWriter.emit(record);
    if (count++ == failAfterRecord && failing) {
      throw new RuntimeException("Runtime exception in " + getEnvironment().getTaskName() + " "+ getIndexInSubtaskGroup());
    }
  }
}
