{
  final SharedSlot sharedSlot=new SharedSlot(slot,this);
  final Instance location=slot.getInstance();
synchronized (lock) {
    allSlots.add(sharedSlot);
    SubSlot subslot=sharedSlot.allocateSubSlot(vertexId);
    subslot.setLocality(slot.getLocality());
    boolean entryForNewJidExists=false;
    for (    Map.Entry<AbstractID,Map<Instance,List<SharedSlot>>> entry : availableSlotsPerJid.entrySet()) {
      if (entry.getKey().equals(groupId)) {
        entryForNewJidExists=true;
        continue;
      }
      Map<Instance,List<SharedSlot>> available=entry.getValue();
      putIntoMultiMap(available,location,sharedSlot);
    }
    if (!entryForNewJidExists) {
      availableSlotsPerJid.put(groupId,new LinkedHashMap<Instance,List<SharedSlot>>());
    }
    return subslot;
  }
}
