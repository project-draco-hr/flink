{
  while (running) {
    delivery=consumer.nextDelivery();
synchronized (ctx.getCheckpointLock()) {
      OUT result=schema.deserialize(delivery.getBody());
      addId(ctx,delivery.getEnvelope().getDeliveryTag());
      if (schema.isEndOfStream(result)) {
        break;
      }
      ctx.collect(result);
    }
  }
}
