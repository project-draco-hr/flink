{
  ConnectionFactory factory=setupConnectionFactory();
  factory.setHost(hostName);
  if (port != null) {
    factory.setPort(port);
  }
  if (username != null) {
    factory.setUsername(username);
  }
  if (password != null) {
    factory.setPassword(password);
  }
  try {
    connection=factory.newConnection();
    channel=connection.createChannel();
    channel.queueDeclare(queueName,true,false,false,null);
    consumer=new QueueingConsumer(channel);
    RuntimeContext runtimeContext=getRuntimeContext();
    if (runtimeContext instanceof StreamingRuntimeContext && ((StreamingRuntimeContext)runtimeContext).isCheckpointingEnabled()) {
      autoAck=false;
      channel.txSelect();
    }
 else {
      autoAck=true;
    }
    LOG.debug("Starting RabbitMQ source with autoAck status: " + autoAck);
    channel.basicConsume(queueName,autoAck,consumer);
  }
 catch (  IOException e) {
    throw new RuntimeException("Cannot create RMQ connection with " + queueName + " at "+ hostName,e);
  }
}
