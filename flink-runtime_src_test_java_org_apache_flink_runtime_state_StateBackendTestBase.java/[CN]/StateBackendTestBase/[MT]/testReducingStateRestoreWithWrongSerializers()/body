{
  try {
    backend.initializeForJob(new DummyEnvironment("test",1,0),"test_op",IntSerializer.INSTANCE);
    ReducingStateDescriptor<String> kvId=new ReducingStateDescriptor<>("id",new ReduceFunction<String>(){
      @Override public String reduce(      String value1,      String value2) throws Exception {
        return value1 + "," + value2;
      }
    }
,StringSerializer.INSTANCE);
    ReducingState<String> state=backend.getPartitionedState(null,VoidSerializer.INSTANCE,kvId);
    @SuppressWarnings("unchecked") KvState<Integer,Void,ReducingState<String>,ReducingStateDescriptor<String>,B> kv=(KvState<Integer,Void,ReducingState<String>,ReducingStateDescriptor<String>,B>)state;
    kv.setCurrentKey(1);
    state.add("1");
    kv.setCurrentKey(2);
    state.add("2");
    KvStateSnapshot<Integer,Void,ReducingState<String>,ReducingStateDescriptor<String>,B> snapshot=kv.snapshot(682375462378L,System.currentTimeMillis());
    kv.dispose();
    @SuppressWarnings("unchecked") TypeSerializer<Integer> fakeIntSerializer=(TypeSerializer<Integer>)(TypeSerializer<?>)FloatSerializer.INSTANCE;
    try {
      snapshot.restoreState(backend,fakeIntSerializer,getClass().getClassLoader(),1);
      fail("should recognize wrong serializers");
    }
 catch (    IllegalArgumentException e) {
    }
catch (    Exception e) {
      fail("wrong exception " + e);
    }
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
}
