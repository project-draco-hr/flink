{
  int longestPath=getLongestPathAmongChildren() + 1;
  int[] verticesPerSubStage=new int[longestPath];
  this.layoutMap=new AbstractSWTVertex[longestPath][];
  for (int i=0; i < getNumberOfChildren(); i++) {
    AbstractSWTComponent child=getChildAt(i);
    if (child instanceof AbstractSWTVertex) {
      AbstractSWTVertex childVertex=(AbstractSWTVertex)child;
      verticesPerSubStage[longestPath - childVertex.getLongestPath(this) - 1]++;
    }
  }
  for (int i=0; i < verticesPerSubStage.length; i++) {
    this.layoutMap[i]=new AbstractSWTVertex[verticesPerSubStage[i]];
    this.largestNumberOfParallelVertices=Math.max(this.largestNumberOfParallelVertices,verticesPerSubStage[i]);
    verticesPerSubStage[i]=0;
  }
  for (int i=0; i < getNumberOfChildren(); i++) {
    AbstractSWTComponent child=getChildAt(i);
    if (child instanceof AbstractSWTVertex) {
      AbstractSWTVertex childVertex=(AbstractSWTVertex)child;
      int index=longestPath - childVertex.getLongestPath(this) - 1;
      int alreadyAdded=verticesPerSubStage[index];
      this.layoutMap[index][alreadyAdded]=childVertex;
      verticesPerSubStage[index]++;
    }
  }
}
