{
  byte[] dest=new byte[size];
  if (buffer.hasArray()) {
    System.arraycopy(buffer.array(),buffer.arrayOffset() + offset,dest,0,size);
  }
 else {
    int pos=buffer.position();
    buffer.get(dest);
    buffer.position(pos);
  }
  return dest;
}
