{
  final String yarnClientUsername=System.getenv(Client.ENV_CLIENT_USERNAME);
  LOG.info("YARN daemon runs as '" + UserGroupInformation.getCurrentUser().getShortUserName() + "' setting"+ " user to execute Flink ApplicationMaster/JobManager to '"+ yarnClientUsername+ "'");
  UserGroupInformation ugi=UserGroupInformation.createRemoteUser(yarnClientUsername);
  for (  Token<? extends TokenIdentifier> toks : UserGroupInformation.getCurrentUser().getTokens()) {
    ugi.addToken(toks);
  }
  ugi.doAs(new PrivilegedAction<Object>(){
    @Override public Object run(){
      try {
        new ApplicationMaster().run();
      }
 catch (      Exception e) {
        e.printStackTrace();
      }
      return null;
    }
  }
);
}
