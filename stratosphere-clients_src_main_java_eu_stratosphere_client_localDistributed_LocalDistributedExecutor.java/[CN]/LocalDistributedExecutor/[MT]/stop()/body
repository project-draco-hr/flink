{
  if (!this.running) {
    return;
  }
  for (  TaskManager t : this.taskManagers) {
    t.shutdown();
  }
  boolean isTaskManagersShutDown=false;
  int timeout=START_STOP_TIMEOUT * this.taskManagers.size();
  for (int sleep=0; sleep < timeout; sleep+=SLEEP_TIME) {
    isTaskManagersShutDown=true;
    for (    TaskManager t : this.taskManagers) {
      if (!t.isShutDown()) {
        isTaskManagersShutDown=false;
      }
    }
    if (isTaskManagersShutDown) {
      break;
    }
    Thread.sleep(SLEEP_TIME);
  }
  if (!isTaskManagersShutDown) {
    throw new RuntimeException(String.format("TaskManager shut down timed out (%d ms).",timeout));
  }
  this.jobManager.shutdown();
  for (int sleep=0; sleep < START_STOP_TIMEOUT; sleep+=SLEEP_TIME) {
    if (this.jobManager.isShutDown()) {
      break;
    }
    Thread.sleep(SLEEP_TIME);
  }
  try {
    if (!this.jobManager.isShutDown()) {
      throw new RuntimeException(String.format("Job manager shut down timed out (%d ms).",START_STOP_TIMEOUT));
    }
  }
  finally {
    this.taskManagers.clear();
    this.jobManager=null;
    this.running=false;
  }
}
