{
  if (!this.running) {
    return;
  }
  for (  LocalTaskManagerThread t : this.taskManagerThreads) {
    t.shutDown();
    t.interrupt();
    t.join(START_STOP_TIMEOUT);
  }
  boolean isTaskManagersShutDown=false;
  int timeout=START_STOP_TIMEOUT * this.taskManagerThreads.size();
  for (int sleep=0; sleep < timeout; sleep+=SLEEP_TIME) {
    isTaskManagersShutDown=true;
    for (    LocalTaskManagerThread t : this.taskManagerThreads) {
      if (!t.isShutDown()) {
        isTaskManagersShutDown=false;
      }
    }
    if (isTaskManagersShutDown) {
      break;
    }
    Thread.sleep(SLEEP_TIME);
  }
  if (!isTaskManagersShutDown) {
    throw new RuntimeException(String.format("Task managers shut down timed out (%d ms).",timeout));
  }
  this.jobManagerThread.shutDown();
  this.jobManagerThread.interrupt();
  this.jobManagerThread.join(START_STOP_TIMEOUT);
  for (int sleep=0; sleep < START_STOP_TIMEOUT; sleep+=SLEEP_TIME) {
    if (this.jobManagerThread.isShutDown()) {
      break;
    }
    Thread.sleep(SLEEP_TIME);
  }
  try {
    if (!this.jobManagerThread.isShutDown()) {
      throw new RuntimeException(String.format("Job manager shut down timed out (%d ms).",START_STOP_TIMEOUT));
    }
  }
  finally {
    this.taskManagerThreads.clear();
    this.jobManagerThread=null;
    this.running=false;
  }
}
