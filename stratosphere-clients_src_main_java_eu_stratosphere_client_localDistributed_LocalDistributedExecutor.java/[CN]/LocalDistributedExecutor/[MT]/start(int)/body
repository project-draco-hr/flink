{
  if (this.running) {
    return;
  }
  long javaMem=HardwareDescriptionFactory.extractFromSystem().getSizeOfFreeMemory();
  javaMem/=numTaskMgr;
  javaMem>>>=20;
  Configuration conf=NepheleMiniCluster.getMiniclusterDefaultConfig(JOB_MANAGER_RPC_PORT,6500,7501,javaMem,null,false,true,false);
  GlobalConfiguration.includeConfiguration(conf);
  this.jobManager=new JobManager(ExecutionMode.CLUSTER);
  for (int tm=0; tm < numTaskMgr; tm++) {
    Configuration tmConf=new Configuration();
    tmConf.setInteger(ConfigConstants.TASK_MANAGER_IPC_PORT_KEY,ConfigConstants.DEFAULT_TASK_MANAGER_IPC_PORT + tm + numTaskMgr);
    tmConf.setInteger(ConfigConstants.TASK_MANAGER_DATA_PORT_KEY,ConfigConstants.DEFAULT_TASK_MANAGER_DATA_PORT + tm);
    GlobalConfiguration.includeConfiguration(tmConf);
    TaskManager t=new TaskManager();
    taskManagers.add(t);
  }
  int timeout=START_STOP_TIMEOUT * this.taskManagers.size();
  for (int sleep=0; sleep < timeout; sleep+=SLEEP_TIME) {
    if (jobManager.getNumberOfTaskTrackers() >= numTaskMgr) {
      break;
    }
    Thread.sleep(SLEEP_TIME);
  }
  if (jobManager.getNumberOfTaskTrackers() < numTaskMgr) {
    throw new RuntimeException(String.format("Task manager start up timed out (%d ms).",timeout));
  }
  this.running=true;
}
