{
  if (channelIDs.isEmpty()) {
    return new EmptyKeyValueIterator<K,V>();
  }
  LOG.debug("Initialting final merge. Opening " + channelIDs.size() + " ChannelReaders.");
  List<Iterator<KeyValuePair<K,V>>> iterators=new ArrayList<Iterator<KeyValuePair<K,V>>>();
  final int ioMemoryPerChannel=ioMemorySize / channelIDs.size();
  for (  Channel.ID id : channelIDs) {
    final Collection<MemorySegment> inputSegments=memoryManager.allocate(this.parent,1,ioMemoryPerChannel);
    freeSegmentsAtShutdown(inputSegments);
    ChannelReader reader=ioManager.createChannelReader(id,inputSegments,true);
    final Iterator<KeyValuePair<K,V>> iterator=new KVReaderIterator<K,V>(reader,keySerialization,valueSerialization,memoryManager,true);
    iterators.add(iterator);
  }
  return new MergeIterator<K,V>(iterators,keyComparator);
}
