{
  try {
    if (readThread != null) {
      try {
        readThread.shutdown();
      }
 catch (      Throwable t) {
        LOG.error("Error shutting down reader thread: " + t.getMessage(),t);
      }
    }
    if (sortThread != null) {
      try {
        sortThread.shutdown();
      }
 catch (      Throwable t) {
        LOG.error("Error shutting down sorter thread: " + t.getMessage(),t);
      }
    }
    if (spillThread != null) {
      try {
        spillThread.shutdown();
      }
 catch (      Throwable t) {
        LOG.error("Error shutting down spilling thread: " + t.getMessage(),t);
      }
    }
    if (readThread != null) {
      readThread.join();
    }
    if (sortThread != null) {
      sortThread.join();
    }
    if (spillThread != null) {
      spillThread.join();
    }
  }
  finally {
    memoryManager.release(this.allocatedMemory);
    this.allocatedMemory.clear();
  }
}
