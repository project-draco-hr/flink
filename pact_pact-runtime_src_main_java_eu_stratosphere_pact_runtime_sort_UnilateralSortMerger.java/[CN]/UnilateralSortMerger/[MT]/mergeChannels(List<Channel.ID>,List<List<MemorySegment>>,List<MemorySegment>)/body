{
  List<StreamChannelAccess<?,?>> channelAccesses=new ArrayList<StreamChannelAccess<?,?>>(channelIDs.size());
  registerChannelsToBeRemovedAtShudown(channelAccesses);
  MergeIterator mergeIterator=getMergingIterator(channelIDs,readBuffers,channelAccesses);
  final Channel.ID mergedChannelID=this.ioManager.createChannel();
  final ChannelWriter writer=this.ioManager.createChannelWriter(mergedChannelID,writeBuffers);
  channelAccesses.add(writer);
  PactRecord rec=new PactRecord();
  while (mergeIterator.next(rec)) {
    if (!writer.write(rec)) {
      throw new IOException("Writing of pair during merging failed");
    }
  }
  writer.close();
  unregisterChannelsToBeRemovedAtShudown(channelAccesses);
  return mergedChannelID;
}
