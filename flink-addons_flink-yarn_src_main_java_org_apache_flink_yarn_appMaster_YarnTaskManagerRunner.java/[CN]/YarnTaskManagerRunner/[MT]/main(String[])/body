{
  Map<String,String> envs=System.getenv();
  final String yarnClientUsername=envs.get(Client.ENV_CLIENT_USERNAME);
  final String localDirs=envs.get(Environment.LOCAL_DIRS.key());
  final String[] newArgs=Arrays.copyOf(args,args.length + 2);
  newArgs[newArgs.length - 2]="--tempDir";
  newArgs[newArgs.length - 1]=localDirs;
  LOG.info("Setting log path " + localDirs);
  LOG.info("YARN daemon runs as '" + UserGroupInformation.getCurrentUser().getShortUserName() + "' setting"+ " user to execute Flink TaskManager to '"+ yarnClientUsername+ "'");
  UserGroupInformation ugi=UserGroupInformation.createRemoteUser(yarnClientUsername);
  for (  Token<? extends TokenIdentifier> toks : UserGroupInformation.getCurrentUser().getTokens()) {
    ugi.addToken(toks);
  }
  ugi.doAs(new PrivilegedAction<Object>(){
    @Override public Object run(){
      try {
        Tuple2<ActorSystem,ActorRef> tuple=YarnUtils.startActorSystemAndTaskManager(newArgs);
        tuple._1().awaitTermination();
      }
 catch (      Exception e) {
        LOG.error("Error while running the TaskManager",e);
      }
      return null;
    }
  }
);
}
