{
  FileSystem fs=null;
synchronized (SYNCHRONIZATION_OBJECT) {
    if (uri.getScheme() == null) {
      try {
        uri=new URI("file",null,uri.getPath(),null);
      }
 catch (      URISyntaxException e) {
        throw new IOException("FileSystem: Scheme is null. file:// or hdfs:// are example schemes.");
      }
    }
    final FSKey key=new FSKey(uri.getScheme(),uri.getAuthority());
    if (CACHE.containsKey(key)) {
      return CACHE.get(key);
    }
    if (!FSDIRECTORY.containsKey(uri.getScheme())) {
      throw new IOException("No file system found with scheme " + uri.getScheme());
    }
    Class<? extends FileSystem> fsClass=null;
    try {
      fsClass=ClassUtils.getFileSystemByName(FSDIRECTORY.get(uri.getScheme()));
    }
 catch (    ClassNotFoundException e1) {
      throw new IOException(StringUtils.stringifyException(e1));
    }
    try {
      fs=fsClass.newInstance();
    }
 catch (    InstantiationException e) {
      throw new IOException("Could not instantiate file system class: " + e.getMessage(),e);
    }
catch (    IllegalAccessException e) {
      throw new IOException("Could not instantiate file system class: " + e.getMessage(),e);
    }
    fs.initialize(uri);
    CACHE.put(key,fs);
  }
  return fs;
}
