{
  try {
    Configuration config=new Configuration();
    config.setInteger(ConfigConstants.LOCAL_INSTANCE_MANAGER_NUMBER_TASK_MANAGER,2);
    config.setInteger(ConfigConstants.TASK_MANAGER_NUM_TASK_SLOTS,2);
    ForkableFlinkMiniCluster testCluster=new ForkableFlinkMiniCluster(config,false);
    try {
      int port=testCluster.getJobManagerRPCPort();
      PackagedProgram inputSplitTestProg=new PackagedProgram(new File(INPUT_SPLITS_PROG_JAR_FILE),new String[]{INPUT_SPLITS_PROG_JAR_FILE,"localhost",String.valueOf(port),"4"});
      inputSplitTestProg.invokeInteractiveModeForExecution();
      PackagedProgram streamingProg=new PackagedProgram(new File(STREAMING_PROG_JAR_FILE),new String[]{STREAMING_PROG_JAR_FILE,"localhost",String.valueOf(port)});
      streamingProg.invokeInteractiveModeForExecution();
      PackagedProgram kMeansProg=new PackagedProgram(new File(KMEANS_JAR_PATH),new String[]{KMEANS_JAR_PATH,"localhost",String.valueOf(port),"4",KMeansData.DATAPOINTS,KMeansData.INITIAL_CENTERS,"25"});
      kMeansProg.invokeInteractiveModeForExecution();
    }
  finally {
      testCluster.shutdown();
    }
  }
 catch (  Exception e) {
    e.printStackTrace();
    Assert.fail(e.getMessage());
  }
}
