{
  try {
    Configuration config=new Configuration();
    config.setInteger(ConfigConstants.LOCAL_NUMBER_TASK_MANAGER,2);
    config.setInteger(ConfigConstants.TASK_MANAGER_NUM_TASK_SLOTS,2);
    config.setString(ConfigConstants.STATE_BACKEND,"filesystem");
    config.setString(FsStateBackendFactory.CHECKPOINT_DIRECTORY_URI_CONF_KEY,folder.newFolder().getAbsoluteFile().toURI().toString());
    ForkableFlinkMiniCluster testCluster=new ForkableFlinkMiniCluster(config,false);
    testCluster.start();
    try {
      int port=testCluster.getLeaderRPCPort();
      PackagedProgram inputSplitTestProg=new PackagedProgram(new File(INPUT_SPLITS_PROG_JAR_FILE),new String[]{INPUT_SPLITS_PROG_JAR_FILE,"","localhost",String.valueOf(port),"4"});
      inputSplitTestProg.invokeInteractiveModeForExecution();
      PackagedProgram streamingInputSplitTestProg=new PackagedProgram(new File(STREAMING_INPUT_SPLITS_PROG_JAR_FILE),new String[]{STREAMING_INPUT_SPLITS_PROG_JAR_FILE,"localhost",String.valueOf(port),"4"});
      streamingInputSplitTestProg.invokeInteractiveModeForExecution();
      String classpath=new File(INPUT_SPLITS_PROG_JAR_FILE).toURI().toURL().toString();
      PackagedProgram inputSplitTestProg2=new PackagedProgram(new File(INPUT_SPLITS_PROG_JAR_FILE),new String[]{"",classpath,"localhost",String.valueOf(port),"4"});
      inputSplitTestProg2.invokeInteractiveModeForExecution();
      PackagedProgram streamingProg=new PackagedProgram(new File(STREAMING_PROG_JAR_FILE),new String[]{STREAMING_PROG_JAR_FILE,"localhost",String.valueOf(port)});
      streamingProg.invokeInteractiveModeForExecution();
      try {
        PackagedProgram streamingCheckpointedProg=new PackagedProgram(new File(STREAMING_CHECKPOINTED_PROG_JAR_FILE),new String[]{STREAMING_CHECKPOINTED_PROG_JAR_FILE,"localhost",String.valueOf(port)});
        streamingCheckpointedProg.invokeInteractiveModeForExecution();
      }
 catch (      Exception e) {
        assertEquals("Program should terminate with a 'SuccessException'","org.apache.flink.test.classloading.jar.CheckpointedStreamingProgram.SuccessException",e.getCause().getCause().getClass().getCanonicalName());
      }
      PackagedProgram kMeansProg=new PackagedProgram(new File(KMEANS_JAR_PATH),new String[]{KMEANS_JAR_PATH,"localhost",String.valueOf(port),"4",KMeansData.DATAPOINTS,KMeansData.INITIAL_CENTERS,"25"});
      kMeansProg.invokeInteractiveModeForExecution();
    }
  finally {
      testCluster.shutdown();
    }
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
}
