{
  Envelope nextEnvelope=null;
synchronized (channel) {
    if (channel.isWritable() && !queuedEnvelopes.isEmpty()) {
      nextEnvelope=queuedEnvelopes.poll();
    }
  }
  if (nextEnvelope != null) {
    channel.writeAndFlush(nextEnvelope).addListener(writeListener);
  }
}
