{
  this.states=states;
  long sumStateSize=0;
  if (states != null) {
    for (    StreamTaskState state : states) {
      if (state != null) {
        StateHandle<?> operatorState=state.getOperatorState();
        StateHandle<?> functionState=state.getFunctionState();
        HashMap<String,KvStateSnapshot<?,?,?>> kvStates=state.getKvStates();
        if (operatorState != null) {
          sumStateSize+=operatorState.getStateSize();
        }
        if (functionState != null) {
          sumStateSize+=functionState.getStateSize();
        }
        if (kvStates != null) {
          for (          KvStateSnapshot<?,?,?> kvState : kvStates.values()) {
            if (kvState != null) {
              sumStateSize+=kvState.getStateSize();
            }
          }
        }
      }
    }
  }
  stateSize=sumStateSize;
}
