{
  Preconditions.checkNotNull(actorSystem,"The actorSystem must not be null.");
  Preconditions.checkNotNull(jobManagerGateway,"The jobManagerGateway must not be null.");
  Preconditions.checkNotNull(jobGraph,"The jobGraph must not be null.");
  Preconditions.checkNotNull(timeout,"The timeout must not be null.");
  Props jobClientActorProps=Props.create(JobClientActor.class,jobManagerGateway.actor(),LOG,sysoutLogUpdates,jobManagerGateway.leaderSessionID());
  ActorRef jobClientActor=actorSystem.actorOf(jobClientActorProps);
  try {
    Future<Object> future=Patterns.ask(jobClientActor,new JobClientMessages.SubmitJobAndWait(jobGraph),new Timeout(AkkaUtils.INF_TIMEOUT()));
    Object answer=Await.result(future,AkkaUtils.INF_TIMEOUT());
    if (answer instanceof JobManagerMessages.JobResultSuccess) {
      LOG.info("Job execution complete");
      SerializedJobExecutionResult result=((JobManagerMessages.JobResultSuccess)answer).result();
      if (result != null) {
        return result.toJobExecutionResult(userCodeClassloader);
      }
 else {
        throw new Exception("Job was successfully executed but result contained a null JobExecutionResult.");
      }
    }
 else {
      throw new Exception("Unknown answer after submitting the job: " + answer);
    }
  }
 catch (  JobExecutionException e) {
    if (e.getCause() instanceof SerializedThrowable) {
      SerializedThrowable serializedThrowable=(SerializedThrowable)e.getCause();
      Throwable deserialized=serializedThrowable.deserializeError(userCodeClassloader);
      throw new JobExecutionException(jobGraph.getJobID(),"Job execution failed " + deserialized.getMessage(),deserialized);
    }
 else {
      throw e;
    }
  }
catch (  TimeoutException e) {
    throw new JobTimeoutException(jobGraph.getJobID(),"Timeout while waiting for JobManager answer. " + "Job time exceeded " + AkkaUtils.INF_TIMEOUT(),e);
  }
catch (  Throwable throwable) {
    throw new JobExecutionException(jobGraph.getJobID(),"Communication with JobManager failed: " + throwable.getMessage(),throwable);
  }
 finally {
    jobClientActor.tell(PoisonPill.getInstance(),ActorRef.noSender());
  }
}
