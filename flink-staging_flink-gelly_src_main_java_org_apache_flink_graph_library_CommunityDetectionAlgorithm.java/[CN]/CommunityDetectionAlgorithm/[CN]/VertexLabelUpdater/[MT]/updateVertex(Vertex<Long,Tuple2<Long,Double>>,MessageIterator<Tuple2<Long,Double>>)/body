{
  Map<Long,Double> receivedLabelsWithScores=new TreeMap<Long,Double>();
  Map<Long,Double> labelsWithHighestScore=new TreeMap<Long,Double>();
  for (  Tuple2<Long,Double> message : inMessages) {
    Long receivedLabel=message.f0;
    Double receivedScore=message.f1;
    if (receivedLabelsWithScores.containsKey(receivedLabel)) {
      Double newScore=receivedScore + receivedLabelsWithScores.get(receivedLabel);
      receivedLabelsWithScores.put(receivedLabel,newScore);
    }
 else {
      receivedLabelsWithScores.put(receivedLabel,receivedScore);
    }
    if (labelsWithHighestScore.containsKey(receivedLabel)) {
      Double currentScore=labelsWithHighestScore.get(receivedLabel);
      if (currentScore < receivedScore) {
        labelsWithHighestScore.put(receivedLabel,receivedScore);
      }
    }
 else {
      labelsWithHighestScore.put(receivedLabel,receivedScore);
    }
  }
  if (receivedLabelsWithScores.size() > 0) {
    Double maxScore=-Double.MAX_VALUE;
    Long maxScoreLabel=vertex.getValue().f0;
    for (    Long curLabel : receivedLabelsWithScores.keySet()) {
      if (receivedLabelsWithScores.get(curLabel) > maxScore) {
        maxScore=receivedLabelsWithScores.get(curLabel);
        maxScoreLabel=curLabel;
      }
    }
    Double highestScore=labelsWithHighestScore.get(maxScoreLabel);
    if (maxScoreLabel != vertex.getValue().f0) {
      highestScore-=delta / getSuperstepNumber();
    }
    setNewVertexValue(new Tuple2<Long,Double>(maxScoreLabel,highestScore));
  }
}
