{
  int parallelism=discretizedStream.getParallelism();
  if (isGrouped()) {
    DiscretizedStream<OUT> out=transform(transformation,"Window partitioner",getType(),new WindowPartitioner<OUT>(keyByKey)).setParallelism(parallelism);
    out.keyByKey=null;
    out.isPartitioned=true;
    return out;
  }
 else   if (transformation == WindowTransformation.REDUCEWINDOW && parallelism != discretizedStream.getExecutionEnvironment().getParallelism()) {
    DiscretizedStream<OUT> out=transform(transformation,"Window partitioner",getType(),new WindowPartitioner<OUT>(parallelism)).setParallelism(parallelism);
    out.isPartitioned=true;
    return out;
  }
 else {
    return this;
  }
}
