{
  int parallelism=discretizedStream.getParallelism();
  if (isGrouped()) {
    DiscretizedStream<OUT> out=transform(transformation,"Window partitioner",getType(),new WindowPartitioner<OUT>(groupByKey)).setParallelism(parallelism);
    out.groupByKey=null;
    out.isPartitioned=true;
    return out;
  }
 else   if (transformation != WindowTransformation.MAPWINDOW && parallelism != discretizedStream.getExecutionEnvironment().getDegreeOfParallelism()) {
    DiscretizedStream<OUT> out=transform(transformation,"Window partitioner",getType(),new WindowPartitioner<OUT>(parallelism)).setParallelism(parallelism);
    out.isPartitioned=true;
    return out;
  }
 else {
    this.isPartitioned=false;
    return this;
  }
}
