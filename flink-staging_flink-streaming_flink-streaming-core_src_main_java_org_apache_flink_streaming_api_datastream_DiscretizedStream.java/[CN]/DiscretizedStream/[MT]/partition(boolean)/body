{
  int parallelism=discretizedStream.getParallelism();
  if (isGrouped()) {
    DiscretizedStream<OUT> out=transform("Window partitioner",getType(),new WindowPartitioner<OUT>(groupByKey)).setParallelism(parallelism);
    out.groupByKey=null;
    return out;
  }
 else   if (!isMap) {
    return transform("Window partitioner",getType(),new WindowPartitioner<OUT>(discretizedStream.environment.getDegreeOfParallelism())).setParallelism(parallelism);
  }
 else {
    return this;
  }
}
