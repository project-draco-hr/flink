{
  if (!connectionId.isEmpty() && metricsPerConnection) {
    String nodeRequestName="node-" + connectionId + ".bytes-sent";
    Sensor nodeRequest=this.metrics.getSensor(nodeRequestName);
    if (nodeRequest == null) {
      String metricGrpName=metricGrpPrefix + "-node-metrics";
      Map<String,String> tags=new LinkedHashMap<String,String>(metricTags);
      tags.put("node-id","node-" + connectionId);
      nodeRequest=this.metrics.sensor(nodeRequestName);
      MetricName metricName=new MetricName("outgoing-byte-rate",metricGrpName,tags);
      nodeRequest.add(metricName,new Rate());
      metricName=new MetricName("request-rate",metricGrpName,"The average number of requests sent per second.",tags);
      nodeRequest.add(metricName,new Rate(new Count()));
      metricName=new MetricName("request-size-avg",metricGrpName,"The average size of all requests in the window..",tags);
      nodeRequest.add(metricName,new Avg());
      metricName=new MetricName("request-size-max",metricGrpName,"The maximum size of any request sent in the window.",tags);
      nodeRequest.add(metricName,new Max());
      String nodeResponseName="node-" + connectionId + ".bytes-received";
      Sensor nodeResponse=this.metrics.sensor(nodeResponseName);
      metricName=new MetricName("incoming-byte-rate",metricGrpName,tags);
      nodeResponse.add(metricName,new Rate());
      metricName=new MetricName("response-rate",metricGrpName,"The average number of responses received per second.",tags);
      nodeResponse.add(metricName,new Rate(new Count()));
      String nodeTimeName="node-" + connectionId + ".latency";
      Sensor nodeRequestTime=this.metrics.sensor(nodeTimeName);
      metricName=new MetricName("request-latency-avg",metricGrpName,tags);
      nodeRequestTime.add(metricName,new Avg());
      metricName=new MetricName("request-latency-max",metricGrpName,tags);
      nodeRequestTime.add(metricName,new Max());
    }
  }
}
