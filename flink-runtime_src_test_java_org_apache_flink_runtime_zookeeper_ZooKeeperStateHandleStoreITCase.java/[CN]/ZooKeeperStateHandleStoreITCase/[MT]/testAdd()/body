{
  LongStateHandleProvider stateHandleProvider=new LongStateHandleProvider();
  ZooKeeperStateHandleStore<Long> store=new ZooKeeperStateHandleStore<>(ZooKeeper.getClient(),stateHandleProvider);
  final String pathInZooKeeper="/testAdd";
  final Long state=1239712317L;
  store.add(pathInZooKeeper,state);
  assertEquals(1,stateHandleProvider.getStateHandles().size());
  assertEquals(state,stateHandleProvider.getStateHandles().get(0).getState(null));
  Stat stat=ZooKeeper.getClient().checkExists().forPath(pathInZooKeeper);
  assertNotNull(stat);
  assertEquals(0,stat.getEphemeralOwner());
  @SuppressWarnings("unchecked") Long actual=((StateHandle<Long>)InstantiationUtil.deserializeObject(ZooKeeper.getClient().getData().forPath(pathInZooKeeper),ClassLoader.getSystemClassLoader())).getState(null);
  assertEquals(state,actual);
}
