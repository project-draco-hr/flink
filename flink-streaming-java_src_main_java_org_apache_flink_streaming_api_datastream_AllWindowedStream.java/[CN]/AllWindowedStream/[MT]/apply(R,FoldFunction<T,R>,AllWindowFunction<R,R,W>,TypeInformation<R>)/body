{
  if (foldFunction instanceof RichFunction) {
    throw new UnsupportedOperationException("ReduceFunction of apply can not be a RichFunction.");
  }
  function=input.getExecutionEnvironment().clean(function);
  foldFunction=input.getExecutionEnvironment().clean(foldFunction);
  String callLocation=Utils.getCallLocationName();
  String udfName="AllWindowedStream." + callLocation;
  String opName;
  OneInputStreamOperator<T,R> operator;
  if (evictor != null) {
    opName="NonParallelTriggerWindow(" + windowAssigner + ", "+ trigger+ ", "+ evictor+ ", "+ udfName+ ")";
    operator=new EvictingNonKeyedWindowOperator<>(windowAssigner,windowAssigner.getWindowSerializer(getExecutionEnvironment().getConfig()),new ListWindowBuffer.Factory<>(getInputType().createSerializer(getExecutionEnvironment().getConfig())),new FoldApplyAllWindowFunction<>(initialValue,foldFunction,function),trigger,evictor);
  }
 else {
    opName="NonParallelTriggerWindow(" + windowAssigner + ", "+ trigger+ ", "+ udfName+ ")";
    operator=new NonKeyedWindowOperator<>(windowAssigner,windowAssigner.getWindowSerializer(getExecutionEnvironment().getConfig()),new FoldingWindowBuffer.Factory<>(foldFunction,initialValue,resultType.createSerializer(getExecutionEnvironment().getConfig())),function,trigger);
  }
  return input.transform(opName,resultType,operator).setParallelism(1);
}
