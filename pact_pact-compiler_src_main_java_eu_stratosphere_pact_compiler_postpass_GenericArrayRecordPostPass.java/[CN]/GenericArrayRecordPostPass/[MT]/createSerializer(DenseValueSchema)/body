{
  final int numFields=schema.getNumFields();
  if (numFields <= 0) {
    throw new IllegalArgumentException("Bug: Attempt to create serializer for " + numFields + " fields.");
  }
  @SuppressWarnings("unchecked") Class<? extends Value>[] types=new Class[numFields];
  for (int i=0; i < numFields; i++) {
    Class<? extends Value> type=schema.getType(i);
    if (type == null) {
      throw new MissingFieldTypeInfoException(i);
    }
 else {
      types[i]=type;
    }
  }
  return new ArrayRecordSerializerFactory(types);
}
