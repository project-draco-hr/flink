{
  SingleInputContract<?> contract=(SingleInputContract<?>)node.getSingleInputNode().getPactContract();
  Stub stub=contract.getUserCodeWrapper().getUserCodeObject();
  if (AbstractArrayModelStub.class.isAssignableFrom(stub.getClass())) {
    AbstractArrayModelStub ams=(AbstractArrayModelStub)stub;
    Class<? extends Value>[] types=ams.getDataTypes(0);
    if (types == null) {
      throw new CompilerPostPassException("Missing type annotation in UDF for '" + contract.getName() + "'.");
    }
    addToSchema(types,schema);
    schema.setNumFields(types.length);
  }
 else {
    throw new CompilerException("Incompatibe stub type. Array data model programs require array data model stubs.");
  }
}
