{
  SingleInputContract<?> contract=(SingleInputContract<?>)node.getSingleInputNode().getPactContract();
  Class<? extends Stub> stubClass=contract.getUserCodeClass();
  if (AbstractArrayModelStub.class.isAssignableFrom(stubClass)) {
    AbstractArrayModelStub ams=(AbstractArrayModelStub)InstantiationUtil.instantiate(stubClass,Stub.class);
    Class<? extends Value>[] types=ams.getDataTypes(0);
    if (types == null) {
      throw new CompilerPostPassException("Missing type annotation in UDF for '" + contract.getName() + "'.");
    }
    addToSchema(types,schema);
    schema.setNumFields(types.length);
  }
 else {
    throw new CompilerException("Incompatibe stub type. Array data model programs require array data model stubs.");
  }
}
