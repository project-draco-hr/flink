{
  final List<InternalProfilingData> profilingDataList=new ArrayList<InternalProfilingData>(16);
  final long timestamp=System.currentTimeMillis();
  final Iterator<Environment> iterator=this.monitoredThreads.keySet().iterator();
  while (iterator.hasNext()) {
    final Environment environment=iterator.next();
    final EnvironmentThreadSet environmentThreadSet=this.monitoredThreads.get(environment);
    final InternalExecutionVertexThreadProfilingData threadProfilingData=environmentThreadSet.captureCPUUtilization(environment.getJobID(),this.tmx,timestamp);
    if (threadProfilingData != null) {
      profilingDataList.add(threadProfilingData);
    }
  }
  InternalInstanceProfilingData instanceProfilingData=null;
  try {
    instanceProfilingData=this.instanceProfiler.generateProfilingData(timestamp);
  }
 catch (  ProfilingException e) {
    LOG.error(StringUtils.stringifyException(e));
  }
  if (instanceProfilingData != null) {
    profilingDataList.add(instanceProfilingData);
  }
  if (!profilingDataList.isEmpty()) {
    try {
      this.jobManagerProfiler.reportProfilingData(profilingDataList);
    }
 catch (    IOException e) {
      LOG.error(StringUtils.stringifyException(e));
    }
catch (    InterruptedException ie) {
      if (LOG.isDebugEnabled()) {
        LOG.debug(StringUtils.stringifyException(ie));
      }
    }
  }
}
