{
  String basePath=name.getPath();
  while (true) {
    try {
      final String endpoint=new URL(HTTP_PREFIX,this.host,this.port,basePath).toString();
      if (LOG.isDebugEnabled()) {
        LOG.debug("Trying S3 endpoint " + endpoint);
      }
      this.s3Client.setEndpoint(endpoint);
      final Owner owner=this.s3Client.getS3AccountOwner();
      LOG.info("Successfully established connection to Amazon S3 using the endpoint " + endpoint);
      LOG.info("Amazon S3 user is " + owner.getDisplayName());
      break;
    }
 catch (    MalformedURLException e) {
      throw new IOException(StringUtils.stringifyException(e));
    }
catch (    AmazonClientException e) {
      if (basePath.isEmpty()) {
        throw new IOException("Cannot establish connection to Amazon S3: " + StringUtils.stringifyException(e));
      }
 else {
        final int pos=basePath.lastIndexOf(Path.SEPARATOR);
        if (pos < 0) {
          basePath="";
        }
 else {
          basePath=basePath.substring(0,pos);
        }
      }
    }
  }
  this.directoryStructure=new S3DirectoryStructure(basePath);
}
