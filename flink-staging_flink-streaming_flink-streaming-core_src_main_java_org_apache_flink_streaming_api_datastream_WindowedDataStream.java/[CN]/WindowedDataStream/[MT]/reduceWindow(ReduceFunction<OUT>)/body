{
  WindowTransformation transformation=WindowTransformation.REDUCEWINDOW.with(reduceFunction);
  WindowBuffer<OUT> windowBuffer=getWindowBuffer(transformation,getTrigger(),getEviction(),discretizerKey);
  DiscretizedStream<OUT> discretized=discretize(transformation,windowBuffer);
  if (windowBuffer instanceof CompletePreAggregator) {
    return discretized;
  }
 else {
    return discretized.reduceWindow(reduceFunction);
  }
}
