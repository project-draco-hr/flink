{
  final int keyCnt=100;
  final int valCnt=20;
  initEnvironment(3 * 1024 * 1024);
  addInput(new UniformPactRecordGenerator(keyCnt,valCnt,false),0);
  addOutput(this.outList);
{
    final Configuration config=new Configuration();
    config.addAll(super.getConfiguration(),"");
    final TaskConfig combineConfig=new TaskConfig(config);
    combineConfig.setStubClass(MockReduceStub.class);
    combineConfig.setInputLocalStrategy(0,LocalStrategy.COMBININGSORT);
    combineConfig.setMemoryInput(0,3 * 1024 * 1024);
    combineConfig.setFilehandlesInput(0,2);
    PactRecordComparatorFactory fact=new PactRecordComparatorFactory(new int[]{0},new Class[]{PactInteger.class},new boolean[]{true});
    combineConfig.setInputComparator(fact,0);
    super.getTaskConfig().addChainedTask(ChainedCombineDriver.class,combineConfig,"combine");
  }
{
    final RegularPactTask<GenericMapper<PactRecord,PactRecord>,PactRecord> testTask=new RegularPactTask<GenericMapper<PactRecord,PactRecord>,PactRecord>();
    super.registerTask(testTask,MapDriver.class,MockMapStub.class);
    try {
      testTask.invoke();
    }
 catch (    Exception e) {
      e.printStackTrace();
      Assert.fail("Invoke method caused exception.");
    }
  }
  Assert.assertEquals(keyCnt,this.outList.size());
}
