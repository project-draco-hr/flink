{
  LOG.info("Start PACT code: " + this.getEnvironment().getTaskName() + " ("+ (this.getEnvironment().getIndexInSubtaskGroup() + 1)+ "/"+ this.getEnvironment().getCurrentNumberOfSubtasks()+ ")");
  FSDataOutputStream fdos=null;
  Path path=getFileOutputPath();
  FileSystem fs=path.getFileSystem();
  if (fs.exists(path) && fs.getFileStatus(path).isDir()) {
    path=path.suffix("/" + (this.getEnvironment().getIndexInSubtaskGroup() + 1));
  }
  fdos=fs.create(path,true);
  LOG.debug("Start writing output to " + path.toString() + " : "+ this.getEnvironment().getTaskName()+ " ("+ (this.getEnvironment().getIndexInSubtaskGroup() + 1)+ "/"+ this.getEnvironment().getCurrentNumberOfSubtasks()+ ")");
  format.setOutput(fdos);
  format.open();
  while (reader.hasNext() && !this.taskCanceled) {
    KeyValuePair pair=reader.next();
    format.writePair(pair);
  }
  format.close();
  fdos.close();
  if (fdos != null) {
    fdos.close();
  }
  if (!this.taskCanceled) {
    LOG.debug("Finished writing output to " + path.toString() + " : "+ this.getEnvironment().getTaskName()+ " ("+ (this.getEnvironment().getIndexInSubtaskGroup() + 1)+ "/"+ this.getEnvironment().getCurrentNumberOfSubtasks()+ ")");
    LOG.info("Finished PACT code: " + this.getEnvironment().getTaskName() + " ("+ (this.getEnvironment().getIndexInSubtaskGroup() + 1)+ "/"+ this.getEnvironment().getCurrentNumberOfSubtasks()+ ")");
  }
 else {
    LOG.warn("PACT code cancelled: " + this.getEnvironment().getTaskName() + " ("+ (this.getEnvironment().getIndexInSubtaskGroup() + 1)+ "/"+ this.getEnvironment().getCurrentNumberOfSubtasks()+ ")");
  }
}
