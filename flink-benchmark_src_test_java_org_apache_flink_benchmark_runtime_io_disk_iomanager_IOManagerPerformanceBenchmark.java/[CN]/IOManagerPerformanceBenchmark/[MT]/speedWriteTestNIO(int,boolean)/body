{
  final FileIOChannel.ID tmpChannel=ioManager.createChannel();
  File tempFile=null;
  FileChannel fs=null;
  try {
    tempFile=new File(tmpChannel.getPath());
    RandomAccessFile raf=new RandomAccessFile(tempFile,"rw");
    fs=raf.getChannel();
    ByteBuffer buf=direct ? ByteBuffer.allocateDirect(bufferSize) : ByteBuffer.allocate(bufferSize);
    int valsLeft=NUM_INTS_WRITTEN;
    while (valsLeft-- > 0) {
      if (buf.remaining() < 4) {
        buf.flip();
        fs.write(buf);
        buf.clear();
      }
      buf.putInt(valsLeft);
    }
    if (buf.position() > 0) {
      buf.flip();
      fs.write(buf);
    }
    fs.close();
    raf.close();
    fs=null;
  }
  finally {
    if (fs != null) {
      fs.close();
      fs=null;
    }
    if (tempFile != null) {
      tempFile.delete();
    }
  }
}
