{
  final FlinkTopologyBuilder builder=new FlinkTopologyBuilder();
  builder.setSpout(spoutId1,new GenderSpout(new Fields("id","gender")));
  builder.setSpout(spoutId2,new AgeSpout(new Fields("id","age")));
  builder.setBolt(boltId,new SingleJoinBolt(new Fields("gender","age"))).fieldsGrouping(spoutId1,new Fields("id")).fieldsGrouping(spoutId2,new Fields("id"));
  if (fileInputOutput) {
    final String[] tokens=outputPath.split(":");
    final String outputFile=tokens[tokens.length - 1];
    builder.setBolt(sinkId,new StormBoltFileSink(outputFile,formatter)).shuffleGrouping(boltId);
  }
 else {
    builder.setBolt(sinkId,new StormBoltPrintSink(formatter),4).shuffleGrouping(boltId);
  }
  return builder;
}
