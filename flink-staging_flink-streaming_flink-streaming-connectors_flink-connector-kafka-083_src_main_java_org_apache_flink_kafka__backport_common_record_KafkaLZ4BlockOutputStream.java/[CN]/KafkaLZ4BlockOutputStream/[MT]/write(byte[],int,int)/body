{
  net.jpountz.util.Utils.checkRange(b,off,len);
  ensureNotFinished();
  int bufferRemainingLength=maxBlockSize - bufferOffset;
  while (len > bufferRemainingLength) {
    System.arraycopy(b,off,buffer,bufferOffset,bufferRemainingLength);
    bufferOffset=maxBlockSize;
    writeBlock();
    off+=bufferRemainingLength;
    len-=bufferRemainingLength;
    bufferRemainingLength=maxBlockSize;
  }
  System.arraycopy(b,off,buffer,bufferOffset,len);
  bufferOffset+=len;
}
