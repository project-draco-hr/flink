{
  final Type type=schema.getType();
  if (type == Type.ARRAY || type == Type.ENUM || type == Type.RECORD || type == Type.MAP) {
    throw new RuntimeException("The given Avro file contains complex data types which are not supported right now");
  }
  if (type == Type.UNION) {
    List<Schema> types=schema.getTypes();
    if (types.size() > 2) {
      throw new RuntimeException("The given Avro file contains a union that has more than two elements");
    }
    if (types.size() == 1 && types.get(0).getType() != Type.UNION) {
      return types.get(0).getType();
    }
    if (types.get(0).getType() == Type.UNION || types.get(1).getType() == Type.UNION) {
      throw new RuntimeException("The given Avro file contains a nested union");
    }
    if (types.get(0).getType() == Type.NULL) {
      return types.get(1).getType();
    }
 else {
      if (types.get(1).getType() != Type.NULL) {
        throw new RuntimeException("The given Avro file is contains a union with two non-null types.");
      }
      return types.get(0).getType();
    }
  }
  return type;
}
