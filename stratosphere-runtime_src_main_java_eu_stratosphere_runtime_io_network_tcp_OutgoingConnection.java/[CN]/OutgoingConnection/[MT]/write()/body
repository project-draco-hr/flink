{
  final WritableByteChannel writableByteChannel=(WritableByteChannel)this.selectionKey.channel();
  if (this.currentEnvelope == null) {
synchronized (this.queuedEnvelopes) {
      if (this.queuedEnvelopes.isEmpty()) {
        return false;
      }
 else {
        this.currentEnvelope=this.queuedEnvelopes.peek();
        this.writer.setEnvelopeForWriting(this.currentEnvelope);
      }
    }
  }
  if (!this.writer.writeNextChunk(writableByteChannel)) {
    if (this.currentEnvelope.getBuffer() != null) {
      this.currentEnvelope.getBuffer().recycleBuffer();
    }
synchronized (this.queuedEnvelopes) {
      this.queuedEnvelopes.poll();
      this.currentEnvelope=null;
    }
  }
  return true;
}
