{
  StringBuffer buffer=new StringBuffer();
  BufferedReader reader=new BufferedReader(new InputStreamReader(socket.getInputStream()));
  while (true) {
    int data=reader.read();
    if (data == -1) {
      socket.close();
      int retry=0;
      boolean success=false;
      while (retry < maxRetry && !success) {
        retry++;
        LOG.warn("Lost connection to server socket. Retrying in 5 seconds...");
        try {
          socket=new Socket();
          socket.connect(new InetSocketAddress(hostname,port),CONNECTION_TIMEOUT_TIME);
          success=true;
        }
 catch (        ConnectException ce) {
          Thread.sleep(5000);
        }
      }
      if (success) {
        LOG.info("Server socket is reconnected.");
      }
 else {
        LOG.error("Could not reconnect to server socket.");
        break;
      }
      reader=new BufferedReader(new InputStreamReader(socket.getInputStream()));
      continue;
    }
    if (data == delimiter) {
      collector.collect(buffer.toString());
      buffer=new StringBuffer();
    }
 else     if (data != '\r') {
      buffer.append((char)data);
    }
  }
  if (buffer.length() > 0) {
    collector.collect(buffer.toString());
  }
}
