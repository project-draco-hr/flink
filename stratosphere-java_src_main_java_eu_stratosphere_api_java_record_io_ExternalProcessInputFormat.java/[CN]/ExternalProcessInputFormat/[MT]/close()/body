{
  try {
    int exitCode=this.extProc.exitValue();
    boolean exitCodeOk=false;
    for (int i=0; i < this.allowedExitCodes.length; i++) {
      if (this.allowedExitCodes[i] == exitCode) {
        exitCodeOk=true;
        break;
      }
    }
    if (!exitCodeOk) {
      throw new RuntimeException("External process did not finish with an allowed exit code: " + exitCode);
    }
  }
 catch (  IllegalThreadStateException itse) {
    this.extProc.destroy();
    if (!this.reachedEnd()) {
      throw new RuntimeException("External process was destroyed although stream was not fully read.");
    }
  }
 finally {
    this.extProcErrStream.close();
    this.extProcOutStream.close();
  }
}
