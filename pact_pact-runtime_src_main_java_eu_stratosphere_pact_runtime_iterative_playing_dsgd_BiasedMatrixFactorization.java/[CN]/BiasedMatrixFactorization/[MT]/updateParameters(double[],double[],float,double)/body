{
  double prediction=predictRating(userFeatures,itemFeatures);
  double err=rating - prediction;
  userFeatures[USER_BIAS_INDEX]+=biasLearningRate * learningRate * (err - biasReg * reg * userFeatures[USER_BIAS_INDEX]);
  itemFeatures[ITEM_BIAS_INDEX]+=biasLearningRate * learningRate * (err - biasReg * reg * itemFeatures[ITEM_BIAS_INDEX]);
  for (int feature=FEATURE_OFFSET; feature < numFeatures; feature++) {
    double userFeature=userFeatures[feature];
    double itemFeature=itemFeatures[feature];
    double deltaUserFeature=err * itemFeature - reg * userFeature;
    userFeatures[feature]+=learningRate * deltaUserFeature;
    double deltaItemFeature=err * userFeature - reg * itemFeature;
    itemFeatures[feature]+=learningRate * deltaItemFeature;
  }
}
