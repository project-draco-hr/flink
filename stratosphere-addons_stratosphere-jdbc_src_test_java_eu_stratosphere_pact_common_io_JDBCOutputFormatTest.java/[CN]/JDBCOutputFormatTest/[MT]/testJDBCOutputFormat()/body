{
  String sourceTable="books";
  String targetTable="newbooks";
  String driverPath="org.apache.derby.jdbc.EmbeddedDriver";
  String dbUrl="jdbc:derby:memory:ebookshop";
  Configuration cfg=new Configuration();
  cfg.setString("driver",driverPath);
  cfg.setString("url",dbUrl);
  cfg.setString("query","insert into " + targetTable + " (id, title, author, price, qty) values (?,?,?,?,?)");
  cfg.setInteger("fields",5);
  cfg.setClass("type0",PactInteger.class);
  cfg.setClass("type1",PactString.class);
  cfg.setClass("type2",PactString.class);
  cfg.setClass("type3",PactFloat.class);
  cfg.setClass("type4",PactInteger.class);
  jdbcOutputFormat=new JDBCOutputFormat();
  jdbcOutputFormat.configure(cfg);
  jdbcOutputFormat.open(1);
  jdbcInputFormat=new JDBCInputFormat(driverPath,dbUrl,"select * from " + sourceTable);
  jdbcInputFormat.configure(null);
  PactRecord record=new PactRecord();
  while (!jdbcInputFormat.reachedEnd()) {
    jdbcInputFormat.nextRecord(record);
    jdbcOutputFormat.writeRecord(record);
  }
  jdbcOutputFormat.close();
  jdbcInputFormat.close();
  jdbcInputFormat=new JDBCInputFormat(driverPath,dbUrl,"select * from " + targetTable);
  jdbcInputFormat.configure(null);
  int recordCount=0;
  while (!jdbcInputFormat.reachedEnd()) {
    jdbcInputFormat.nextRecord(record);
    Assert.assertEquals(5,record.getNumFields());
    Assert.assertEquals("Field 0 should be int",PactInteger.class,record.getField(0,PactInteger.class).getClass());
    Assert.assertEquals("Field 1 should be String",PactString.class,record.getField(1,PactString.class).getClass());
    Assert.assertEquals("Field 2 should be String",PactString.class,record.getField(2,PactString.class).getClass());
    Assert.assertEquals("Field 3 should be float",PactDouble.class,record.getField(3,PactDouble.class).getClass());
    Assert.assertEquals("Field 4 should be int",PactInteger.class,record.getField(4,PactInteger.class).getClass());
    int[] pos={0,1,2,3,4};
    Value[] values={new PactInteger(),new PactString(),new PactString(),new PactDouble(),new PactInteger()};
    Assert.assertTrue(record.equalsFields(pos,dbData[recordCount],values));
    recordCount++;
  }
  Assert.assertEquals(5,recordCount);
  jdbcInputFormat.close();
}
