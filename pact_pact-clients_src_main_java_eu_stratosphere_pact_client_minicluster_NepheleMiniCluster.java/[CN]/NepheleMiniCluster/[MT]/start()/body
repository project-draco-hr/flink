{
synchronized (startStopLock) {
    if (this.configDir != null) {
      GlobalConfiguration.loadConfiguration(configDir);
    }
 else {
      Configuration conf=getMiniclusterDefaultConfig(jobManagerRpcPort,taskManagerRpcPort,taskManagerDataPort,hdfsConfigFile,visualizerEnabled);
      GlobalConfiguration.includeConfiguration(conf);
    }
    jobManager=new JobManager(ExecutionMode.LOCAL);
    runner=new Thread(){
      @Override public void run(){
        jobManager.runTaskLoop();
      }
    }
;
    runner.setDaemon(true);
    runner.start();
    waitForJobManagerToBecomeReady();
  }
}
