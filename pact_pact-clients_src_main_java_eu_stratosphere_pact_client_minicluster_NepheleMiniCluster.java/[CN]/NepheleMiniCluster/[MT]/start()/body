{
synchronized (startStopLock) {
    if (this.configDir != null) {
      GlobalConfiguration.loadConfiguration(configDir);
    }
 else {
      Configuration conf=getMiniclusterDefaultConfig(jobManagerRpcPort,taskManagerRpcPort,taskManagerDataPort,hdfsConfigFile,visualizerEnabled);
      GlobalConfiguration.includeConfiguration(conf);
    }
    Thread[] allThreads=new Thread[Thread.activeCount()];
    int numThreads=Thread.enumerate(allThreads);
    for (int i=0; i < numThreads; i++) {
      Thread t=allThreads[i];
      String name=t.getName();
      if (name.equals("Local Taskmanager IO Loop") || name.equals("Discovery Service") || name.startsWith("IPC")) {
        t.join();
      }
    }
    jobManager=new JobManager(ExecutionMode.LOCAL);
    runner=new Thread("JobManager Task Loop"){
      @Override public void run(){
        jobManager.runTaskLoop();
      }
    }
;
    runner.setDaemon(true);
    runner.start();
    waitForJobManagerToBecomeReady();
  }
}
