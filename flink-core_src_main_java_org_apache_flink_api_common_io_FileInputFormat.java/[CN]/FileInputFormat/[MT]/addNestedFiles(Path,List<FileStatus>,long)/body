{
  final FileSystem fs=path.getFileSystem();
  for (  FileStatus dir : fs.listStatus(path)) {
    if (dir.isDir()) {
      addNestedFiles(dir.getPath(),files,length);
    }
 else {
      if (acceptFile(dir)) {
        files.add(dir);
        length+=dir.getLen();
        testForUnsplittable(dir);
      }
    }
  }
  return length;
}
