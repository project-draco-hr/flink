{
  if (stream == null || overLimit) {
    return null;
  }
  int countInWrapBuffer=0;
  int i=0;
  while (true) {
    if (readPos >= limit) {
      if (!fillBuffer()) {
        if (countInWrapBuffer > 0) {
          byte[] tmp=new byte[countInWrapBuffer];
          System.arraycopy(wrapBuffer,0,tmp,0,countInWrapBuffer);
          return tmp;
        }
 else {
          return null;
        }
      }
    }
    int startPos=readPos;
    int count=0;
    while (readPos < limit && i < delimiter.length) {
      if ((readBuffer[readPos++]) == delimiter[i]) {
        i++;
      }
 else {
        i=0;
      }
    }
    if (i == delimiter.length) {
      count=readPos - startPos - delimiter.length;
      if (countInWrapBuffer > 0) {
        byte[] end=new byte[countInWrapBuffer + count];
        if (count >= 0) {
          System.arraycopy(wrapBuffer,0,end,0,countInWrapBuffer);
          System.arraycopy(readBuffer,0,end,countInWrapBuffer,count);
          return end;
        }
 else {
          System.arraycopy(wrapBuffer,0,end,0,countInWrapBuffer + count);
          return end;
        }
      }
 else {
        byte[] end=new byte[count];
        System.arraycopy(readBuffer,startPos,end,0,count);
        return end;
      }
    }
 else {
      count=limit - startPos;
      while (wrapBuffer.length - countInWrapBuffer < count) {
        byte[] tmp=new byte[wrapBuffer.length * 2];
        System.arraycopy(wrapBuffer,0,tmp,0,countInWrapBuffer);
        wrapBuffer=tmp;
      }
      System.arraycopy(readBuffer,startPos,wrapBuffer,countInWrapBuffer,count);
      countInWrapBuffer+=count;
    }
  }
}
