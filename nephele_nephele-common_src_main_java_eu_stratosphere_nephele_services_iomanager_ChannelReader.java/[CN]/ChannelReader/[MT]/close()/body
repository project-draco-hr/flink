{
  if (!isClosing) {
    isClosing=true;
    fullBufferQueue.add(currentBuffer);
    lock.lock();
    while (fullBufferQueue.size() < fullBufferQueueSize) {
      allRequestsHandled.awaitUninterruptibly();
    }
    lock.unlock();
    try {
      file.close();
    }
 catch (    IOException e) {
      throw new ServiceException(e);
    }
  }
  return IOManager.unbindBuffers(fullBufferQueue);
}
