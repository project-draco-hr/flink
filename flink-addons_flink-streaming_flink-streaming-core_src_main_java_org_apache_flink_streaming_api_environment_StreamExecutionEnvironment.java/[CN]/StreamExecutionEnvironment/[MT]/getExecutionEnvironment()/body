{
  ExecutionEnvironment env=ExecutionEnvironment.getExecutionEnvironment();
  if (env instanceof ContextEnvironment) {
    ContextEnvironment ctx=(ContextEnvironment)env;
    return createContextEnvironment(ctx.getClient(),ctx.getJars(),ctx.getDegreeOfParallelism());
  }
 else   if (env instanceof OptimizerPlanEnvironment | env instanceof PreviewPlanEnvironment) {
    return new StreamPlanEnvironment(env);
  }
 else {
    return createLocalEnvironment();
  }
}
