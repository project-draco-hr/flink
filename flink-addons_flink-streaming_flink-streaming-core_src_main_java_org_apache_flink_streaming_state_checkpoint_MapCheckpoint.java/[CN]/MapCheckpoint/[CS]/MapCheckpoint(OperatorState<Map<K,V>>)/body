{
  if (operatorState instanceof MapState) {
    MapState<K,V> mapState=(MapState<K,V>)operatorState;
    this.removedItems=mapState.getRemovedItems();
    this.clear=mapState.isCleared();
    this.updatedItems=new HashMap<K,V>();
    for (    K key : mapState.getUpdatedItems()) {
      this.updatedItems.put(key,mapState.get(key));
    }
    this.checkpointedState=this.updatedItems;
  }
 else {
    throw new RuntimeException("MapCheckpoint can only be used with MapState");
  }
}
