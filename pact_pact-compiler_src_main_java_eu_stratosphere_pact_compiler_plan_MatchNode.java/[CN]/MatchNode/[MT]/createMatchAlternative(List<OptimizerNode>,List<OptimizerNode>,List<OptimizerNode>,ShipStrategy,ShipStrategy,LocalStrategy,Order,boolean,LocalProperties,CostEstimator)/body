{
  GlobalProperties gp1;
  GlobalProperties gp2;
  if (preds1.size() == 1) {
    gp1=PactConnection.getGlobalPropertiesAfterConnection(preds1.get(0),this,ss1);
  }
 else {
    gp1=new GlobalProperties();
  }
  if (preds2 != null && preds2.size() == 1) {
    gp2=PactConnection.getGlobalPropertiesAfterConnection(preds2.get(0),this,ss2);
  }
 else {
    gp2=new GlobalProperties();
  }
  int[] scrambledKeys1=null;
  int[] scrambledKeys2=null;
  if (ss1 == ShipStrategy.FORWARD && ss2 == ShipStrategy.PARTITION_HASH) {
    scrambledKeys1=getScrambledArray(getPactContract().getKeyColumnNumbers(0),gp1.getPartitionedFields());
    if (scrambledKeys1 != null) {
      int[] oldPartitions=gp2.getPartitionedFields();
      int[] newPositions=new int[scrambledKeys1.length];
      for (int i=0; i < scrambledKeys1.length; i++) {
        newPositions[i]=oldPartitions[scrambledKeys1[i]];
      }
      gp2.setPartitioning(gp2.getPartitioning(),newPositions);
    }
  }
  if (ss2 == ShipStrategy.FORWARD && ss1 == ShipStrategy.PARTITION_HASH) {
    scrambledKeys2=getScrambledArray(getPactContract().getKeyColumnNumbers(1),gp2.getPartitionedFields());
    if (scrambledKeys2 != null) {
      int[] oldPartitions=gp1.getPartitionedFields();
      int[] newPositions=new int[scrambledKeys2.length];
      for (int i=0; i < scrambledKeys2.length; i++) {
        newPositions[i]=oldPartitions[scrambledKeys2[i]];
      }
      gp1.setPartitioning(gp1.getPartitioning(),newPositions);
    }
  }
  LocalProperties outLp=outLpp;
  GlobalProperties outGp=new GlobalProperties();
  outGp.setPartitioning(gp1.getPartitioning(),gp1.getPartitionedFields());
  outGp.setOrdering(gp1.getOrdering());
  if (outLpp == null) {
    int[] keyColumns=getPactContract().getKeyColumnNumbers(0);
    outLp=new LocalProperties();
    if (order != Order.NONE) {
      Ordering ordering=new Ordering();
      for (      int keyColumn : keyColumns) {
        ordering.appendOrdering(keyColumn,order);
      }
      outLp.setOrdering(ordering);
    }
 else {
      outLp.setOrdering(null);
    }
    outLp.setGrouped(grouped,new FieldSet(keyColumns));
  }
  MatchNode n=new MatchNode(this,preds1,preds2,this.input1,this.input2,outGp,outLp);
  for (  PactConnection c : n.input1) {
    c.setShipStrategy(ss1);
    c.setScramblePartitionedFields(scrambledKeys2);
  }
  for (  PactConnection c : n.input2) {
    c.setShipStrategy(ss2);
    c.setScramblePartitionedFields(scrambledKeys1);
  }
  n.setLocalStrategy(ls);
  n.getGlobalProperties().filterByNodesConstantSet(this,0);
  n.getLocalProperties().filterByNodesConstantSet(this,0);
  estimator.costOperator(n);
  target.add(n);
  outGp=new GlobalProperties();
  outGp.setPartitioning(gp2.getPartitioning(),gp2.getPartitionedFields());
  outGp.setOrdering(gp2.getOrdering());
  if (outLpp == null) {
    int[] keyColumns=getPactContract().getKeyColumnNumbers(1);
    outLp=new LocalProperties();
    if (order != Order.NONE) {
      Ordering ordering=new Ordering();
      for (      int keyColumn : keyColumns) {
        ordering.appendOrdering(keyColumn,order);
      }
      outLp.setOrdering(ordering);
    }
 else {
      outLp.setOrdering(null);
    }
    outLp.setGrouped(grouped,new FieldSet(keyColumns));
  }
  n=new MatchNode(this,preds1,preds2,input1,input2,outGp,outLp);
  for (  PactConnection c : n.input1) {
    c.setShipStrategy(ss1);
    c.setScramblePartitionedFields(scrambledKeys2);
  }
  for (  PactConnection c : n.input2) {
    c.setShipStrategy(ss2);
    c.setScramblePartitionedFields(scrambledKeys1);
  }
  n.setLocalStrategy(ls);
  n.getGlobalProperties().filterByNodesConstantSet(this,1);
  n.getLocalProperties().filterByNodesConstantSet(this,1);
  estimator.costOperator(n);
  target.add(n);
}
