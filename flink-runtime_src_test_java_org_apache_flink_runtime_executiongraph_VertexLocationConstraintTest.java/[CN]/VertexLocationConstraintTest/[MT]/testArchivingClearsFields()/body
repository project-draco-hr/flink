{
  try {
    JobVertex vertex=new JobVertex("test vertex",new JobVertexID());
    JobGraph jg=new JobGraph("test job",vertex);
    ExecutionGraph eg=new ExecutionGraph(TestingUtils.defaultExecutionContext(),jg.getJobID(),jg.getName(),jg.getJobConfiguration(),timeout);
    eg.attachJobGraph(Collections.singletonList(vertex));
    ExecutionVertex ev=eg.getAllVertices().get(vertex.getID()).getTaskVertices()[0];
    Instance instance=ExecutionGraphTestUtils.getInstance(DummyInstanceGateway.INSTANCE);
    ev.setLocationConstraintHosts(Collections.singletonList(instance));
    assertNotNull(ev.getPreferredLocations());
    assertEquals(instance,ev.getPreferredLocations().iterator().next());
    eg.fail(new Exception());
    eg.prepareForArchiving();
    assertTrue(ev.getPreferredLocations() == null || !ev.getPreferredLocations().iterator().hasNext());
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail(e.getMessage());
  }
}
