{
  IJsonNode value=null;
  try {
    final int readInt=in.readInt();
    if (readInt == IJsonNode.Type.CustomNode.ordinal()) {
      final String className=in.readUTF();
      value=(IJsonNode)ReflectUtil.newInstance(Class.forName(className));
    }
 else     value=ReflectUtil.newInstance(IJsonNode.Type.values()[readInt].getClazz());
    value.read(in);
  }
 catch (  final ClassNotFoundException e) {
    throw new IllegalStateException("Cannot instantiate value because class is not in class path",e);
  }
  return value.canonicalize();
}
