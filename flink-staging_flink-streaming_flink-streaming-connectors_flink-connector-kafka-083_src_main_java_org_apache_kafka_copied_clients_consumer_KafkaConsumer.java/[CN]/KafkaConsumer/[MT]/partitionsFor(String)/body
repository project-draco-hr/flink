{
  acquire();
  try {
    Cluster cluster=this.metadata.fetch();
    List<PartitionInfo> parts=cluster.partitionsForTopic(topic);
    if (parts == null) {
      metadata.add(topic);
      client.awaitMetadataUpdate();
      parts=metadata.fetch().partitionsForTopic(topic);
    }
    return parts;
  }
  finally {
    release();
  }
}
