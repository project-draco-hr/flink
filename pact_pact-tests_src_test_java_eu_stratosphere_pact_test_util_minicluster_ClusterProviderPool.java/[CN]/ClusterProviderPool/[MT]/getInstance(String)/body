{
  ClusterProvider instance=clusterPool.get(clusterId);
  if (instance == null) {
    if (configPool == null) {
      loadClusterConfigs();
    }
    Configuration config=configPool.get(clusterId);
    if (config == null) {
      throw new Exception("No cluster configuration known for clusterId " + clusterId);
    }
    String clusterProviderType=config.getString(Constants.CLUSTER_PROVIDER_TYPE,"");
    if (clusterProviderType.equals("LocalClusterProvider")) {
      instance=new LocalClusterProvider(config);
    }
 else     if (clusterProviderType.equals("DistClusterProvider")) {
      instance=new DistClusterProvider(config);
    }
 else {
      throw new Exception("No or unknown cluster provider type configured");
    }
    instance.startHDFS();
    instance.startNephele();
    clusterPool.put(clusterId,instance);
  }
  return instance;
}
