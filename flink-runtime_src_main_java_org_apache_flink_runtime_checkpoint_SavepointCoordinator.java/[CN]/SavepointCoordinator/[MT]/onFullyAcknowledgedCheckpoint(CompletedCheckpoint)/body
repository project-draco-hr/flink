{
  Promise<String> promise=checkNotNull(savepointPromises.remove(checkpoint.getCheckpointID()));
  if (promise.isCompleted()) {
    throw new IllegalStateException("Savepoint promise completed");
  }
  try {
    String savepointPath=savepointStore.putState(checkpoint);
    promise.success(savepointPath);
  }
 catch (  Exception e) {
    LOG.warn("Failed to store savepoint.",e);
    promise.failure(e);
  }
}
