{
synchronized (this.lock) {
    if (this.isShutDown) {
      throw new IllegalStateException("Memory manager has been shut down.");
    }
    final Set<DefaultMemorySegment> segments=this.allocatedSegments.remove(owner);
    if (segments == null || segments.isEmpty()) {
      return;
    }
    if (isPreAllocated) {
      for (      DefaultMemorySegment seg : segments) {
        final byte[] buffer=seg.destroy();
        this.freeSegments.add(buffer);
      }
    }
 else {
      for (      DefaultMemorySegment seg : segments) {
        seg.destroy();
      }
      numNonAllocatedPages+=segments.size();
    }
    segments.clear();
  }
}
