{
  Thread.currentThread().setContextClassLoader(prog.getUserCodeClassLoader());
  if (prog.isUsingProgramEntryPoint()) {
    return run(prog.getPlanWithJars(),parallelism,wait);
  }
 else   if (prog.isUsingInteractiveMode()) {
    ContextEnvironment env=new ContextEnvironment(this,prog.getAllLibraries(),prog.getUserCodeClassLoader());
    if (parallelism > 0) {
      env.setDegreeOfParallelism(parallelism);
    }
    env.setAsContext();
    ContextEnvironment.disableLocalExecution();
    if (wait) {
      prog.invokeInteractiveModeForExecution();
    }
 else {
      Thread backGroundRunner=new Thread("Program Runner"){
        public void run(){
          try {
            prog.invokeInteractiveModeForExecution();
          }
 catch (          Throwable t) {
            LOG.error("The program execution failed.",t);
          }
        }
      }
;
      backGroundRunner.start();
    }
    return null;
  }
 else {
    throw new RuntimeException();
  }
}
