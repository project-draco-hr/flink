{
  Thread.currentThread().setContextClassLoader(prog.getUserCodeClassLoader());
  if (prog.isUsingProgramEntryPoint()) {
    return run(prog.getPlanWithJars(),parallelism,wait);
  }
 else   if (prog.isUsingInteractiveMode()) {
    LOG.info("Starting program in interactive mode");
    ContextEnvironment.setAsContext(this,prog.getAllLibraries(),prog.getUserCodeClassLoader(),parallelism,wait);
    ContextEnvironment.enableLocalExecution(false);
    try {
      prog.invokeInteractiveModeForExecution();
    }
  finally {
      ContextEnvironment.enableLocalExecution(true);
    }
    return new JobSubmissionResult(lastJobId);
  }
 else {
    throw new RuntimeException();
  }
}
