{
  final String hostname=configuration.getString(ConfigConstants.JOB_MANAGER_IPC_ADDRESS_KEY,null);
  if (hostname == null) {
    throw new ProgramInvocationException("Could not find hostname of job manager.");
  }
  FiniteDuration timeout=AkkaUtils.getTimeout(configuration);
  final ActorSystem actorSystem;
  final ActorRef client;
  try {
    Tuple2<ActorSystem,ActorRef> pair=JobClient.startActorSystemAndActor(configuration,false);
    actorSystem=pair._1();
    client=pair._2();
  }
 catch (  Exception e) {
    throw new ProgramInvocationException("Could not build up connection to JobManager.",e);
  }
  try {
    JobClient.uploadJarFiles(jobGraph,hostname,client,timeout);
  }
 catch (  IOException e) {
    throw new ProgramInvocationException("Could not upload the program's JAR files to the JobManager.",e);
  }
  try {
    if (wait) {
      return JobClient.submitJobAndWait(jobGraph,printStatusDuringExecution,client,timeout);
    }
 else {
      JobClient.submitJobDetached(jobGraph,client,timeout);
      return new JobSubmissionResult(jobGraph.getJobID());
    }
  }
 catch (  JobExecutionException e) {
    throw new ProgramInvocationException("The program execution failed: " + e.getMessage(),e);
  }
catch (  Exception e) {
    throw new ProgramInvocationException("Exception during program execution.",e);
  }
 finally {
    actorSystem.shutdown();
    actorSystem.awaitTermination();
  }
}
