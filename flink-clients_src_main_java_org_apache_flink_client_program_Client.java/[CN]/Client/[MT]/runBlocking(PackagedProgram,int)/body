{
  Thread.currentThread().setContextClassLoader(prog.getUserCodeClassLoader());
  if (prog.isUsingProgramEntryPoint()) {
    return runBlocking(prog.getPlanWithJars(),parallelism);
  }
 else   if (prog.isUsingInteractiveMode()) {
    LOG.info("Starting program in interactive mode");
    ContextEnvironment.setAsContext(new ContextEnvironmentFactory(this,prog.getAllLibraries(),prog.getClasspaths(),prog.getUserCodeClassLoader(),parallelism,true));
    try {
      prog.invokeInteractiveModeForExecution();
    }
  finally {
      ContextEnvironment.unsetContext();
    }
    return new JobSubmissionResult(lastJobID);
  }
 else {
    throw new RuntimeException();
  }
}
