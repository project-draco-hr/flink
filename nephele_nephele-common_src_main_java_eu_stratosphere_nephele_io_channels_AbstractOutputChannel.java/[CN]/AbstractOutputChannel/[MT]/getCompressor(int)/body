{
  if (getCompressionLevel() == CompressionLevel.NO_COMPRESSION)   throw new CompressionException("CompressionLevel is set to NO_COMPRESSION");
  String configurationKey=null;
switch (this.getType()) {
case FILE:
    configurationKey="channel.file.compressor";
  break;
case NETWORK:
configurationKey="channel.network.compressor";
break;
}
if (configurationKey == null) throw new CompressionException("Cannot determine configuration key for the channel type " + this.getType());
String className=GlobalConfiguration.getString(configurationKey,null);
if (className == null) throw new CompressionException("Configuration does not contain an entry for key " + configurationKey);
Class<? extends Compressor> compressionClass=null;
try {
compressionClass=(Class<? extends Compressor>)Class.forName(className);
}
 catch (ClassNotFoundException e) {
throw new CompressionException("Cannot find compressor class: " + StringUtils.stringifyException(e));
}
Constructor<? extends Compressor> constructor=null;
try {
constructor=compressionClass.getConstructor(int.class,CompressionLevel.class);
}
 catch (SecurityException e) {
throw new CompressionException(StringUtils.stringifyException(e));
}
catch (NoSuchMethodException e) {
throw new CompressionException("Cannot find matching constructor for compression class: " + StringUtils.stringifyException(e));
}
Compressor compressor=null;
try {
compressor=constructor.newInstance(bufferSize,getCompressionLevel());
}
 catch (Exception e) {
throw new CompressionException(StringUtils.stringifyException(e));
}
return compressor;
}
