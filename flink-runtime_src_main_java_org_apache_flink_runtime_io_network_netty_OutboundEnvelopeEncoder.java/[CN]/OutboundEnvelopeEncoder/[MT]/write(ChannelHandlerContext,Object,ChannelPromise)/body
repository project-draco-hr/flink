{
  Envelope env=(Envelope)msg;
  ByteBuf buf=ctx.alloc().directBuffer();
  encode(env,buf);
  if (buf.isReadable()) {
    ctx.write(buf,promise);
  }
 else {
    buf.release();
    ctx.write(Unpooled.EMPTY_BUFFER,promise);
  }
}
