{
  error.set(null);
  ServerSocket serverSo=new ServerSocket(0);
  SocketSource source=new SocketSource(serverSo,-1);
  source.start();
  int count=0;
  Socket channel;
  while (count < 100) {
    channel=serverSo.accept();
    count++;
    channel.close();
    assertEquals(0,source.socketSource.retries);
  }
  source.cancel();
  if (error.get() != null) {
    Throwable t=error.get();
    t.printStackTrace();
    fail("Error in spawned thread: " + t.getMessage());
  }
  assertEquals(100,count);
}
