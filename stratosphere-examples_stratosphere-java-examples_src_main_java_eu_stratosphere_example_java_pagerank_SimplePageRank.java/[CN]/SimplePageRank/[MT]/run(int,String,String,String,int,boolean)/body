{
  final ExecutionEnvironment env=ExecutionEnvironment.getExecutionEnvironment();
  env.setDegreeOfParallelism(dop);
  DataSet<Tuple2<Long,Double>> pageWithRankInput=env.readCsvFile(pageWithRankInputPath).types(Long.class,Double.class);
  IterativeDataSet<Tuple2<Long,Double>> iteration=pageWithRankInput.iterate(maxIterations);
  DataSet<Tuple2<Long,Long[]>> adjacencyListInput=env.readCsvFile(adjacencyListInputPath).types(Long.class,Long.class).groupBy(0).reduceGroup(new OutgoingEdgeCounter());
  DataSet<Tuple2<Long,Double>> iterationInner=iteration.join(adjacencyListInput).where(0).equalTo(0).flatMap(new JoinVertexWithEdgesMatch()).groupBy(0).reduce(new AggregatingReduce());
  DataSet<Tuple2<Long,Double>> termination=iterationInner.join(iteration).where(0).equalTo(0).with(new JoinOldAndNew());
  iteration.closeWith(iterationInner,termination).writeAsCsv(outputPath);
  env.execute();
}
