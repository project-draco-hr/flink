{
  this.isRunning=true;
  boolean operatorOpen=false;
  if (LOG.isDebugEnabled()) {
    LOG.debug("Task {} invoked",getName());
  }
  try {
    openOperator();
    operatorOpen=true;
    StreamRecord<IN> nextRecord;
    while (isRunning && (nextRecord=readNext()) != null) {
      headContext.setNextInput(nextRecord.getObject());
      streamOperator.processElement(nextRecord.getObject());
    }
    closeOperator();
    operatorOpen=false;
    if (LOG.isDebugEnabled()) {
      LOG.debug("Task {} invocation finished",getName());
    }
  }
 catch (  Exception e) {
    LOG.error(getEnvironment().getTaskNameWithSubtasks() + " failed",e);
    if (operatorOpen) {
      try {
        closeOperator();
      }
 catch (      Throwable t) {
        LOG.warn("Exception while closing operator.",t);
      }
    }
    throw e;
  }
 finally {
    this.isRunning=false;
    inputs.clearBuffers();
    inputs.cleanup();
    outputHandler.flushOutputs();
    clearBuffers();
  }
}
