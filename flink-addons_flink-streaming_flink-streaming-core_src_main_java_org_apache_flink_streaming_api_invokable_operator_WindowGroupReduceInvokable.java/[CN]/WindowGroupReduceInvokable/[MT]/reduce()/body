{
  iterator=state.getStreamRecordIterator();
  while (iterator.hasNext()) {
    StreamRecord<IN> nextRecord=iterator.next();
    IN nextValue=nextRecord.getObject();
    Object key=nextRecord.getField(keyPosition);
    IN currentValue=values.get(key);
    if (currentValue != null) {
      IN reduced=reducer.reduce(currentValue,nextValue);
      values.put(key,reduced);
      collector.collect(reduced);
    }
 else {
      values.put(key,nextValue);
      collector.collect(nextValue);
    }
  }
  values.clear();
}
