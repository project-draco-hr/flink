{
  SopremoPlan actualPlan=parseScript("$persons = read hdfs('persons.json');\n" + "$languages = read hdfs('languages.json');\n" + "$normalizedPersons = replace all $person in $persons \n"+ "	on $person.spokenLanguages\n"+ "	with $languages\n"+ "	default 'unknown language ' + $person.spokenLanguages;\n"+ "write $normalizedPersons to hdfs('normalizedPersons.json');");
  SopremoPlan expectedPlan=new SopremoPlan();
  Source persons=new Source("persons.json");
  Source languages=new Source("languages.json");
  Replace replace=new Replace().withInputs(persons,languages).withArrayElementsReplacement(true).withDefaultExpression(new ArithmeticExpression(new ConstantExpression("unknown language "),ArithmeticOperator.ADDITION,JsonUtil.createPath("0","spokenLanguages"))).withReplaceExpression(JsonUtil.createPath("0","spokenLanguages"));
  Sink normalizedPersons=new Sink("normalizedPersons.json").withInputs(replace);
  expectedPlan.setSinks(normalizedPersons);
  assertEquals(expectedPlan,actualPlan);
}
