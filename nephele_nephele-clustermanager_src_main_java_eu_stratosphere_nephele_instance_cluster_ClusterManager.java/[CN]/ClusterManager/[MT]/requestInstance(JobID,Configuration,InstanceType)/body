{
  AllocatedSlice slice=null;
  for (  final ClusterInstance host : this.registeredHosts.values()) {
    if (host.getType().equals(instanceType)) {
      slice=host.createSlice(instanceType,jobID);
      if (slice != null) {
        break;
      }
    }
  }
  if (slice == null) {
    for (    final ClusterInstance host : this.registeredHosts.values()) {
      slice=host.createSlice(instanceType,jobID);
      if (slice != null) {
        break;
      }
    }
  }
  if (slice == null) {
    throw new InstanceException("Could not find a suitable instance");
  }
  List<AllocatedSlice> allocatedSlices=this.slicesOfJobs.get(jobID);
  if (allocatedSlices == null) {
    allocatedSlices=new ArrayList<AllocatedSlice>();
    this.slicesOfJobs.put(jobID,allocatedSlices);
  }
  allocatedSlices.add(slice);
  if (this.instanceListener != null) {
    ClusterInstanceNotifier clusterInstanceNotifier=new ClusterInstanceNotifier(this.instanceListener,slice);
    clusterInstanceNotifier.start();
  }
}
