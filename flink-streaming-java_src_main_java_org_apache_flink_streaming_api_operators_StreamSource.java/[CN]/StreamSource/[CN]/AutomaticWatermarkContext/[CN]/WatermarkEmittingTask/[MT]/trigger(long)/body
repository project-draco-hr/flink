{
  final long currentTime=owner.getCurrentProcessingTime();
  if (currentTime > nextWatermarkTime) {
    final long watermarkTime=currentTime - (currentTime % watermarkInterval);
synchronized (lockingObject) {
      if (currentTime > nextWatermarkTime) {
        output.emitWatermark(new Watermark(watermarkTime));
        nextWatermarkTime+=watermarkInterval;
      }
    }
  }
  owner.registerTimer(owner.getCurrentProcessingTime() + watermarkInterval,new WatermarkEmittingTask(owner,lockingObject,output));
}
