{
  final ExecutionConfig executionConfig=getExecutionConfig();
  if (userFunction instanceof EventTimeSourceFunction) {
    ctx=new ManualWatermarkContext<OUT>(lockingObject,collector,getRuntimeContext().getExecutionConfig().areTimestampsEnabled());
  }
 else   if (executionConfig.getAutoWatermarkInterval() > 0) {
    ctx=new AutomaticWatermarkContext<OUT>(lockingObject,collector,executionConfig);
  }
 else   if (executionConfig.areTimestampsEnabled()) {
    ctx=new NonWatermarkContext<OUT>(lockingObject,collector);
  }
 else {
    ctx=new NonTimestampContext<OUT>(lockingObject,collector);
  }
  userFunction.run(ctx);
  ctx.close();
}
