{
  ForExpr fe=(ForExpr)expr;
  Expr inExpr=fe.binding().inExpr();
  Expr c=fe.collectExpr();
  if (isEmptyArrayOrNull(inExpr) || isEmptyArrayOrNull(c)) {
    fe.replaceInParent(new ArrayExpr());
    return true;
  }
  if (!(c instanceof ArrayExpr) || c.numChildren() != 1) {
    return false;
  }
  c=c.child(0);
  if (c instanceof VarExpr) {
    VarExpr ve=(VarExpr)c;
    if (ve.var() == fe.var()) {
      if (inExpr.getSchema().is(ARRAY,NULL).maybeNot() || inExpr.getSchema().is(NULL).maybe()) {
        inExpr=new AsArrayFn(inExpr);
      }
      fe.replaceInParent(inExpr);
      return true;
    }
  }
  expr=new TransformExpr(fe.binding(),c);
  fe.replaceInParent(expr);
  return true;
}
