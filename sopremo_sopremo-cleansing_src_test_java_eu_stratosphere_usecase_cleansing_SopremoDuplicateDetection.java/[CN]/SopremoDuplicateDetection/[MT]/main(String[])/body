{
  File fileIn=new File("data/restaurant.csv");
  Source source=new Source(CsvInputFormat.class,"file://" + fileIn.getAbsolutePath());
  source.setParameter(CsvInputFormat.COLUMN_NAMES,new String[]{"id","name","address","city","phone","type"});
  EvaluationExpression firstTwoLettersEqual=new ComparativeExpression(new FunctionCall("substring",createPath("0","name"),new ConstantExpression(IntNode.valueOf(0)),new ConstantExpression(IntNode.valueOf(2))),BinaryOperator.EQUAL,new FunctionCall("substring",createPath("1","name"),new ConstantExpression(IntNode.valueOf(0)),new ConstantExpression(IntNode.valueOf(2))));
  EvaluationExpression condition=new AndExpression(firstTwoLettersEqual);
  Join blockJoin=new Join(EvaluationExpression.VALUE,condition,source,source);
  Selection select=new Selection(new ComparativeExpression(createPath("0","id"),BinaryOperator.LESS,createPath("1","id")),blockJoin);
  Selection sim=new Selection(new ComparativeExpression(createPath("0","name"),BinaryOperator.EQUAL,createPath("1","name")),select);
  EvaluationExpression phone1=new FunctionCall("replaceAll",createPath("0","phone"),new ConstantExpression(JsonUtil.NODE_FACTORY.textNode("\\W")),new ConstantExpression(JsonUtil.NODE_FACTORY.textNode("")));
  EvaluationExpression phone2=new FunctionCall("replaceAll",createPath("1","phone"),new ConstantExpression(JsonUtil.NODE_FACTORY.textNode("\\W")),new ConstantExpression(JsonUtil.NODE_FACTORY.textNode("")));
  Selection phoneSimilarity=new Selection(new ComparativeExpression(phone1,BinaryOperator.EQUAL,phone2),sim);
  Projection proj=new Projection(new ArrayCreation(createPath("0","id"),createPath("1","id")),phoneSimilarity);
  File fileOut=new File("data/restaurant_out.json");
  final SopremoPlan sopremoPlan=new SopremoPlan(new Sink(JsonOutputFormat.class,"file://" + fileOut.getAbsolutePath(),proj));
  sopremoPlan.getContext().getFunctionRegistry().register(DuplicateDetectionFunctions.class);
  new TestPlan(sopremoPlan.assemblePact()).run();
}
