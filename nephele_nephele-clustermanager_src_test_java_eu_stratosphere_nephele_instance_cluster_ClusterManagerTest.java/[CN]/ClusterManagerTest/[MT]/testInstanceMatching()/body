{
  GlobalConfiguration.loadConfiguration(System.getProperty(USER_DIR_KEY) + CORRECT_CONF_DIR);
  final MyInstanceListener dummyInstanceListener=new MyInstanceListener();
  final ClusterManager cm=new ClusterManager();
  cm.setInstanceListener(dummyInstanceListener);
  List<InstanceTypeDescription> instanceTypeDescriptions=null;
  try {
    final int ipcPort=ConfigConstants.DEFAULT_TASK_MANAGER_IPC_PORT;
    final int dataPort=ConfigConstants.DEFAULT_TASK_MANAGER_DATA_PORT;
    HardwareDescription hardwareDescription=HardwareDescriptionFactory.construct(2,2L * 1024L * 1024L* 1024L,2L * 1024L * 1024L* 1024L);
    InstanceConnectionInfo ici=new InstanceConnectionInfo(InetAddress.getByName("192.168.198.1"),ipcPort,dataPort);
    cm.reportHeartBeat(ici,hardwareDescription);
    instanceTypeDescriptions=cm.getListOfAvailableInstanceTypes();
    assertEquals(3,instanceTypeDescriptions.size());
    assertTrue(LARGE_INSTANCE_TYPE_NAME.equals(instanceTypeDescriptions.get(0).getInstanceType().getIdentifier()));
    assertTrue(MEDIUM_INSTANCE_TYPE_NAME.equals(instanceTypeDescriptions.get(1).getInstanceType().getIdentifier()));
    assertTrue(SMALL_INSTANCE_TYPE_NAME.equals(instanceTypeDescriptions.get(2).getInstanceType().getIdentifier()));
    assertEquals(1,instanceTypeDescriptions.get(0).getMaximumNumberOfAvailableInstances());
    assertEquals(2,instanceTypeDescriptions.get(1).getMaximumNumberOfAvailableInstances());
    assertEquals(4,instanceTypeDescriptions.get(2).getMaximumNumberOfAvailableInstances());
    hardwareDescription=HardwareDescriptionFactory.construct(3,2L * 1024L * 1024L* 1024L,1024L * 1024L * 1024L);
    ici=new InstanceConnectionInfo(InetAddress.getByName("192.168.198.3"),ipcPort,dataPort);
    cm.reportHeartBeat(ici,hardwareDescription);
    instanceTypeDescriptions=cm.getListOfAvailableInstanceTypes();
    assertEquals(3,instanceTypeDescriptions.size());
    assertTrue(LARGE_INSTANCE_TYPE_NAME.equals(instanceTypeDescriptions.get(0).getInstanceType().getIdentifier()));
    assertTrue(MEDIUM_INSTANCE_TYPE_NAME.equals(instanceTypeDescriptions.get(1).getInstanceType().getIdentifier()));
    assertTrue(SMALL_INSTANCE_TYPE_NAME.equals(instanceTypeDescriptions.get(2).getInstanceType().getIdentifier()));
    assertEquals(1,instanceTypeDescriptions.get(0).getMaximumNumberOfAvailableInstances());
    assertEquals(2,instanceTypeDescriptions.get(1).getMaximumNumberOfAvailableInstances());
    assertEquals(5,instanceTypeDescriptions.get(2).getMaximumNumberOfAvailableInstances());
  }
 catch (  UnknownHostException e) {
    fail(e.getMessage());
  }
 finally {
    if (cm != null) {
      cm.shutdown();
    }
  }
}
