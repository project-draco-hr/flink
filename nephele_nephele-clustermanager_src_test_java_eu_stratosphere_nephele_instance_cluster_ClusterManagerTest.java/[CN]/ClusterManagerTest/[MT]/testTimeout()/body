{
  if (!EXECUTE_LONG_TESTS) {
    System.err.println("Skipping test testTimeout");
    return;
  }
  GlobalConfiguration.loadConfiguration(System.getProperty("user.dir") + "/correct-conf");
  Configuration overwrite=new Configuration();
  overwrite.setInteger("cloud.ec2.cleanupinterval",10000);
  GlobalConfiguration.includeConfiguration(overwrite);
  MyInstanceNotifiable dummyInstanceNotifiable=new MyInstanceNotifiable();
  ClusterManager cm=new ClusterManager();
  cm.setInstanceListener(dummyInstanceNotifiable);
  try {
    InetAddress inetAddress=null;
    try {
      inetAddress=InetAddress.getByName("localhost");
    }
 catch (    UnknownHostException e) {
      e.printStackTrace();
    }
    InstanceConnectionInfo instanceConnectionInfo=new InstanceConnectionInfo(inetAddress,1234,1235);
    cm.reportHeartBeat(instanceConnectionInfo);
    JobID jobID=new JobID();
    for (int i=0; i < 4; ++i) {
      cm.requestInstance(jobID,new Configuration(),cm.getDefaultInstanceType());
    }
    assertEquals(4,dummyInstanceNotifiable.resourcesOfJobs.get(jobID).size());
    try {
      cm.requestInstance(jobID,new Configuration(),cm.getDefaultInstanceType());
      assertTrue(false);
    }
 catch (    InstanceException e) {
      assertTrue(true);
    }
    List<AllocatedResource> resources=new ArrayList<AllocatedResource>(dummyInstanceNotifiable.resourcesOfJobs.get(jobID));
    try {
      Thread.sleep(25 * 1000);
    }
 catch (    InterruptedException e1) {
    }
    assertEquals(0,dummyInstanceNotifiable.resourcesOfJobs.get(jobID).size());
    try {
      cm.releaseAllocatedResource(jobID,new Configuration(),resources.get(0));
      assertTrue(false);
    }
 catch (    Exception e) {
      assertTrue(true);
    }
    try {
      cm.requestInstance(jobID,new Configuration(),cm.getDefaultInstanceType());
      assertTrue(false);
    }
 catch (    InstanceException e) {
      assertTrue(true);
    }
  }
  finally {
    if (cm != null) {
      cm.shutdown();
    }
  }
}
