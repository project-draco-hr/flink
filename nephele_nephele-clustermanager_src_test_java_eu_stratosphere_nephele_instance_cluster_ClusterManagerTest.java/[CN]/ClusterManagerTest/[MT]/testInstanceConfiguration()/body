{
  final String configDir=getConfigDir();
  if (configDir == null) {
    fail("Cannot find configuration directory for cluster manager test");
  }
  GlobalConfiguration.loadConfiguration(configDir);
  final TestInstanceListener testInstanceListener=new TestInstanceListener();
  final ClusterManager cm=new ClusterManager();
  cm.setInstanceListener(testInstanceListener);
  try {
    final InstanceType defaultIT=cm.getDefaultInstanceType();
    assertNotNull(defaultIT);
    assertEquals(SMALL_INSTANCE_TYPE_NAME,defaultIT.getIdentifier());
    assertEquals(2,defaultIT.getNumberOfComputeUnits());
    assertEquals(2,defaultIT.getNumberOfCores());
    assertEquals(2048,defaultIT.getMemorySize());
    assertEquals(10,defaultIT.getDiskCapacity());
    assertEquals(10,defaultIT.getPricePerHour());
    final Map<InstanceType,InstanceTypeDescription> instanceTypeDescriptions=cm.getMapOfAvailableInstanceTypes();
    assertEquals(3,instanceTypeDescriptions.size());
  }
  finally {
    if (cm != null) {
      cm.shutdown();
    }
  }
}
