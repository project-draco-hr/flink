{
  if (isInMemory()) {
    freeMemory.add(this.currentPartitionBuffer);
    this.currentPartitionBuffer=null;
    if (this.overflowSegments != null) {
      for (int k=0; k < this.numOverflowSegments; k++) {
        freeMemory.add(this.overflowSegments[k]);
      }
    }
    for (int k=this.inMemoryBuffers.size() - 1; k >= 0; --k) {
      freeMemory.add(this.inMemoryBuffers.get(k));
    }
    this.inMemoryBuffers.clear();
  }
 else {
    spillBuffer(this.currentPartitionBuffer,this.probeSideChannel);
    this.probeSideChannel.close();
    spilledPartitions.add(this);
  }
}
