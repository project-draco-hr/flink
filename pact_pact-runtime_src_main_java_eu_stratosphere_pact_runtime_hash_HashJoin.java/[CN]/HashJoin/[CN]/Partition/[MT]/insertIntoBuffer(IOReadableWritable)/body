{
  if (isInMemory()) {
    final int bufferNum=this.blockCounter - 1;
    final MemorySegment targetBuffer=this.currentPartitionBuffer;
    final long pointer=(((long)bufferNum) << 32) | targetBuffer.outputView.getPosition();
    try {
      object.write(targetBuffer.outputView);
      this.recordCounter++;
      return pointer;
    }
 catch (    IOException ioex) {
      return -1;
    }
  }
 else {
    try {
      object.write(this.currentPartitionBuffer.outputView);
    }
 catch (    IOException ioex) {
      final MemorySegment toSpill=this.currentPartitionBuffer;
      this.currentPartitionBuffer=null;
      spillBuffer(toSpill);
      addBuffer(getNextWriteBehindBuffer());
      try {
        object.write(this.currentPartitionBuffer.outputView);
      }
 catch (      IOException iioex) {
        throw new IOException("Record could not be added to fresh buffer. " + "Probably cause: Record length exceeds buffer size limit.");
      }
    }
    this.recordCounter++;
    return 0;
  }
}
