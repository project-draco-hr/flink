{
  if (isInMemory()) {
    final int bufferNum=this.partitionBuffers.size() - 1;
    final Buffer.Output targetBuffer=this.partitionBuffers.get(bufferNum);
    final long pointer=(((long)bufferNum) << 32) | targetBuffer.getPosition();
    if (targetBuffer.write(object)) {
      this.recordCounter++;
      return pointer;
    }
 else {
      return -1;
    }
  }
 else {
    final Buffer.Output targetBuffer=this.partitionBuffers.get(0);
    if (!targetBuffer.write(object)) {
      this.partitionBuffers.clear();
      spillBuffer(targetBuffer);
      addBuffer(getNextWriteBehindBuffer());
      final Buffer.Output newBuffer=this.partitionBuffers.get(0);
      if (!newBuffer.write(object)) {
        throw new IOException("Record could not be added to fresh buffer. " + "Probably cause: Record length exceeds buffer size limit.");
      }
    }
    this.recordCounter++;
    return 0;
  }
}
