{
  final Partition p=null;
  long pointer=p.insertIntoBuffer(pair);
  if (pointer == -1) {
    MemorySegment nextSeg=getNextBuffer();
    if (nextSeg == null) {
      spillPartition();
      nextSeg=getNextBuffer();
      if (nextSeg == null) {
        throw new RuntimeException("Bug in HybridHashJoin: No memory became available after spilling partition.");
      }
    }
    p.addBuffer(nextSeg);
    pointer=p.insertIntoBuffer(pair);
    if (pointer == -1) {
      throw new IOException("Record could not be added to fresh buffer. Probably cause: Record length exceeds buffer size limit.");
    }
  }
}
