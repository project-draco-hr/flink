{
  final int partitionFanOut=getPartitioningFanOutNoEstimates(this.availableMemory.size());
  if (partitionFanOut > MAX_NUM_PARTITIONS) {
    throw new RuntimeException("Hash join created ");
  }
  createPartitions(partitionFanOut);
  final int numBuckets=getInitialTableSize(this.availableMemory.size(),this.segmentSize,partitionFanOut,this.avgRecordLen);
  initTable(numBuckets,0,(byte)partitionFanOut);
  while (input.hasNext()) {
    final KeyValuePair<K,V> pair=input.next();
    final int hashCode=hash(pair.getKey().hashCode(),0);
    insertIntoTable(pair,hashCode);
  }
}
