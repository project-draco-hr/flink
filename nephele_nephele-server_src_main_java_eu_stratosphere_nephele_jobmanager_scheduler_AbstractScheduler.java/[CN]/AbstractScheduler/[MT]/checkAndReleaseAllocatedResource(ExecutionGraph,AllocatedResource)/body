{
  if (allocatedResource == null) {
    LOG.error("Resource to lock is null!");
    return;
  }
  if (allocatedResource.getInstance() instanceof DummyInstance) {
    LOG.debug("Available instance is of type DummyInstance!");
    return;
  }
  final List<ExecutionVertex> assignedVertices=executionGraph.getVerticesAssignedToResource(allocatedResource);
  if (assignedVertices.isEmpty()) {
    return;
  }
  boolean resourceCanBeReleased=true;
  Iterator<ExecutionVertex> it=assignedVertices.iterator();
  while (it.hasNext()) {
    final ExecutionVertex vertex=it.next();
    final ExecutionState state=vertex.getExecutionState();
    if (state != ExecutionState.CREATED && state != ExecutionState.FINISHED && state != ExecutionState.FAILED && state != ExecutionState.CANCELED) {
      resourceCanBeReleased=false;
      break;
    }
  }
  if (resourceCanBeReleased) {
    final DummyInstance dummyInstance=DummyInstance.createDummyInstance(allocatedResource.getInstance().getType());
    final AllocatedResource dummyResource=new AllocatedResource(dummyInstance,allocatedResource.getInstanceType(),new AllocationID());
    it=assignedVertices.iterator();
    while (it.hasNext()) {
      final ExecutionVertex vertex=it.next();
      vertex.setAllocatedResource(dummyResource);
    }
    LOG.info("Releasing instance " + allocatedResource.getInstance());
    try {
      getInstanceManager().releaseAllocatedResource(executionGraph.getJobID(),executionGraph.getJobConfiguration(),allocatedResource);
    }
 catch (    InstanceException e) {
      LOG.error(StringUtils.stringifyException(e));
    }
  }
}
