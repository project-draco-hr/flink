{
  final int currentStageIndex=executionGraph.getIndexOfCurrentExecutionStage();
  final ExecutionStage previousStage=executionGraph.getStage(currentStageIndex - 1);
  final Map<AbstractInstance,List<ExecutionVertexID>> checkpointsToReplay=new HashMap<AbstractInstance,List<ExecutionVertexID>>();
  for (int i=0; i < previousStage.getNumberOfOutputExecutionVertices(); ++i) {
    final ExecutionVertex vertex=previousStage.getOutputExecutionVertex(i);
    final AbstractInstance instance=vertex.getAllocatedResource().getInstance();
    List<ExecutionVertexID> vertexIDs=checkpointsToReplay.get(instance);
    if (vertexIDs == null) {
      vertexIDs=new SerializableArrayList<ExecutionVertexID>();
      checkpointsToReplay.put(instance,vertexIDs);
    }
    vertexIDs.add(vertex.getID());
  }
  final Iterator<Map.Entry<AbstractInstance,List<ExecutionVertexID>>> it=checkpointsToReplay.entrySet().iterator();
  while (it.hasNext()) {
    final Map.Entry<AbstractInstance,List<ExecutionVertexID>> entry=it.next();
    this.deploymentManager.replayCheckpoints(executionGraph.getJobID(),entry.getKey(),entry.getValue());
  }
}
