{
  final ExecutionGraph executionGraph=executionStage.getExecutionGraph();
  final Map<InstanceType,Integer> requiredInstances=new HashMap<InstanceType,Integer>();
  executionStage.collectRequiredInstanceTypes(requiredInstances,ExecutionState.SCHEDULED);
  if (requiredInstances.isEmpty()) {
    return;
  }
  this.instanceManager.requestInstance(executionGraph.getJobID(),executionGraph.getJobConfiguration(),requiredInstances,null);
  final ExecutionGraphIterator it2=new ExecutionGraphIterator(executionGraph,executionGraph.getIndexOfCurrentExecutionStage(),true,true);
  while (it2.hasNext()) {
    final ExecutionVertex vertex=it2.next();
    if (vertex.getExecutionState() == ExecutionState.SCHEDULED) {
      vertex.setExecutionState(ExecutionState.ASSIGNING);
    }
  }
}
