{
  if (!semaphore.tryAcquire()) {
    Assert.fail("Concurrent invocation of snapshotState.");
  }
 else {
    int startCount=count;
    if (startCount != count) {
      semaphore.release();
      Assert.fail("Count is different at start end end of snapshot.");
    }
    semaphore.release();
  }
  return 0;
}
