{
  final File outputFile=new File(ServerTestUtils.getTempDir() + File.separator + ServerTestUtils.getRandomFilename());
  final FileOutputStream outputStream=new FileOutputStream(outputFile);
  final FileChannel fileChannel=outputStream.getChannel();
  final Deque<MemorySegment> recycleQueue=new ArrayDeque<MemorySegment>();
  final DefaultSerializer serializer=new DefaultSerializer();
  final MemorySegment byteBuffer=new MemorySegment(new byte[BUFFER_SIZE]);
  final ByteBuffer initBuffer=ByteBuffer.allocate(1);
  initBuffer.put(BUFFER_CONTENT);
  initBuffer.flip();
  recycleQueue.add(byteBuffer);
  for (int i=0; i < BUFFER_SIZE; i++) {
    final MemoryBuffer buffer=BufferFactory.createFromMemory(i,recycleQueue.poll(),new BufferPoolConnector(recycleQueue));
    for (int j=0; j < i; j++) {
      buffer.write(initBuffer);
      initBuffer.position(0);
    }
    buffer.flip();
    final TransferEnvelope transferEnvelope=new TransferEnvelope(i,this.jobID,this.sourceChannelID);
    transferEnvelope.setBuffer(buffer);
    serializer.setTransferEnvelope(transferEnvelope);
    while (serializer.write(fileChannel))     ;
    buffer.recycleBuffer();
  }
  fileChannel.close();
  return outputFile;
}
